<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>DeepAR Inference Formats - Amazon SageMaker</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="deepar-in-formats" /><meta name="default_state" content="deepar-in-formats" /><link rel="icon" type="image/ico" href="../../../assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="../../../assets/images/favicon.ico" /><link rel="canonical" href="deepar-in-formats.html" /><meta name="description" content="Query a trained model by using the model's endpoint. The endpoint takes the following JSON request format. The following is the format of a response, where [...] are arrays of numbers: DeepAR forecasting supports getting inferences by using batch transform from data using the JSON Lines format. In this format, each record is represented on a single line as a JSON object, and lines are separated by newline characters. The format is identical to the JSON Lines format used for model training. For information, see" /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon SageMaker" /><meta name="guide" content="Developer Guide" /><meta name="abstract" content="Use Internet Monitor to build, train, and host machine learning models in AWS." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="deepar-in-formats.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/sagemaker/latest/dg/deepar-in-formats.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/sagemaker/latest/dg/deepar-in-formats.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/sagemaker/latest/dg/deepar-in-formats.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/sagemaker/latest/dg/deepar-in-formats.html" hreflang="de" /><link rel="alternative" href="deepar-in-formats.html" hreflang="en-us" /><link rel="alternative" href="deepar-in-formats.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/sagemaker/latest/dg/deepar-in-formats.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/sagemaker/latest/dg/deepar-in-formats.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/sagemaker/latest/dg/deepar-in-formats.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/sagemaker/latest/dg/deepar-in-formats.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/sagemaker/latest/dg/deepar-in-formats.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/sagemaker/latest/dg/deepar-in-formats.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/sagemaker/latest/dg/deepar-in-formats.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/sagemaker/latest/dg/deepar-in-formats.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/sagemaker/latest/dg/deepar-in-formats.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/sagemaker/latest/dg/deepar-in-formats.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/sagemaker/latest/dg/deepar-in-formats.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/sagemaker/latest/dg/deepar-in-formats.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/sagemaker/latest/dg/deepar-in-formats.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/sagemaker/latest/dg/deepar-in-formats.html" hreflang="zh-tw" /><link rel="alternative" href="deepar-in-formats.html" hreflang="x-default" /><meta name="feedback-item" content="SageMaker" /><meta name="this_doc_product" content="Amazon SageMaker" /><meta name="this_doc_guide" content="Developer Guide" /><script defer="" src="../../../assets/r/vendor4.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/vendor3.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/vendor1.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/awsdocs-common.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/awsdocs-doc-page.js@version=2021.12.02"></script><link href="../../../assets/r/vendor4.css@version=2021.12.02.css" rel="stylesheet" /><link href="../../../assets/r/awsdocs-common.css@version=2021.12.02.css" rel="stylesheet" /><link href="../../../assets/r/awsdocs-doc-page.css@version=2021.12.02.css" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'sagemaker'}"></script><meta id="panorama-serviceSubSection" value="Developer Guide" /><meta id="panorama-serviceConsolePage" value="DeepAR Inference Formats" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>DeepAR Inference Formats - Amazon SageMaker</title><meta name="pdf" content="/pdfs/sagemaker/latest/dg/sagemaker-dg.pdf#deepar-in-formats" /><meta name="rss" content="amazon-sagemaker-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=285" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/deepar-in-formats.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/deepar-in-formats.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/deepar-in-formats.html" /><meta name="keywords" content="SageMaker,Amazon SageMaker,machine learning,notebook instance" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon SageMaker",
        "item" : "https://docs.aws.amazon.com/sagemaker/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Developer Guide",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Train machine learning models",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/train-model.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Choose an Algorithm",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/algorithms-choose.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Use Amazon SageMaker Built-in Algorithms or Pre-trained Models",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/algos.html"
      },
      {
        "@type" : "ListItem",
        "position" : 7,
        "name" : "Built-in SageMaker Algorithms for Time-Series Data",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/algorithms-time-series.html"
      },
      {
        "@type" : "ListItem",
        "position" : 8,
        "name" : "DeepAR Forecasting Algorithm",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/deepar.html"
      },
      {
        "@type" : "ListItem",
        "position" : 9,
        "name" : "DeepAR Inference Formats",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/deepar.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="https://docs.aws.amazon.com/pdfs/sagemaker/latest/dg/sagemaker-dg.pdf#deepar-in-formats" target="_blank" rel="noopener noreferrer" title="Open PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="https://docs.aws.amazon.com/index.html">Documentation</a><a href="https://docs.aws.amazon.com/sagemaker/index.html">Amazon SageMaker</a><a href="whatis.html">Developer Guide</a></div><div id="page-toc-src"><a href="deepar-in-formats.html#deepar-json-request">Inference Formats</a><a href="deepar-in-formats.html#deepar-json-response">Inference Formats</a><a href="deepar-in-formats.html#deepar-batch">Batch Transform with the DeepAR Algorithm</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="deepar-in-formats">DeepAR Inference Formats</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div>
            <h2 id="deepar-json-request">DeepAR JSON Request Formats</h2>
            <p>Query a trained model by using the model's endpoint. The endpoint takes the
                following JSON request format. </p>
            <p>In the request, the <code class="code">instances</code> field corresponds to the time series
                that should be forecast by the model. </p>
            <p>If the model was trained with categories, you must provide a <code class="code">cat</code> for
                each instance. If the model was trained without the <code class="code">cat</code> field, it
                should be omitted.</p>
            <p>If the model was trained with a custom feature time series
                    (<code class="code">dynamic_feat</code>), you have to provide the same number of
                    <code class="code">dynamic_feat</code>values for each instance. Each of them should have a
                length given by <code class="code">length(target) + prediction_length</code>, where the last
                    <code class="code">prediction_length</code> values correspond to the time points in the
                future that will be predicted. If the model was trained without custom feature time
                series, the field should not be included in the request.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
    "instances": [
        <span>{</span>
            "start": "2009-11-01 00:00:00",
            "target": [4.0, 10.0, "NaN", 100.0, 113.0],
            "cat": [0, 1],
            "dynamic_feat": [[1.0, 1.1, 2.1, 0.5, 3.1, 4.1, 1.2, 5.0, ...]]
        },
        <span>{</span>
            "start": "2012-01-30",
            "target": [1.0],
            "cat": [2, 1],
            "dynamic_feat": [[2.0, 3.1, 4.5, 1.5, 1.8, 3.2, 0.1, 3.0, ...]]
        },
        <span>{</span>
            "start": "1999-01-30",
            "target": [2.0, 1.0],
            "cat": [1, 3],
            "dynamic_feat": [[1.0, 0.1, -2.5, 0.3, 2.0, -1.2, -0.1, -3.0, ...]]
        }
    ],
    "configuration": <span>{</span>
         "num_samples": 50,
         "output_types": ["mean", "quantiles", "samples"],
         "quantiles": ["0.5", "0.9"]
    }
}
</code></pre>
            <p>The <code class="code">configuration</code> field is optional.
                    <code class="code">configuration.num_samples</code> sets the number of sample paths that the
                model generates to estimate the mean and quantiles.
                    <code class="code">configuration.output_types</code> describes the information that will be
                returned in the request. Valid values are <code class="code">"mean"</code>
                <code class="code">"quantiles"</code> and <code class="code">"samples"</code>. If you specify
                    <code class="code">"quantiles"</code>, each of the quantile values in
                    <code class="code">configuration.quantiles</code> is returned as a time series. If you
                specify <code class="code">"samples"</code>, the model also returns the raw samples used to
                calculate the other outputs.</p>
         
            <h2 id="deepar-json-response">DeepAR JSON Response Formats</h2>
            <p>The following is the format of a response, where <code class="code">[...]</code> are arrays of
                numbers:</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
    "predictions": [
        <span>{</span>
            "quantiles": <span>{</span>
                "0.9": [...],
                "0.5": [...]
            },
            "samples": [...],
            "mean": [...]
        },
        <span>{</span>
            "quantiles": <span>{</span>
                "0.9": [...],
                "0.5": [...]
            },
            "samples": [...],
            "mean": [...]
        },
        <span>{</span>
            "quantiles": <span>{</span>
                "0.9": [...],
                "0.5": [...]
            },
            "samples": [...],
            "mean": [...]
        }
    ]
}
</code></pre>
            <p>DeepAR has a response timeout of 60 seconds. When passing multiple time series in
                a single request, the forecasts are generated sequentially. Because the forecast for
                each time series typically takes about 300 to 1000 milliseconds or longer, depending
                on the model size, passing too many time series in a single request can cause time
                outs. It's better to send fewer time series per request and send more requests.
                Because the DeepAR algorithm uses multiple workers per instance, you can achieve
                much higher throughput by sending multiple requests in parallel.</p>
            <p>By default, DeepAR uses one worker per CPU for inference, if there is sufficient
                memory per CPU. If the model is large and there isn't enough memory to run a model
                on each CPU, the number of workers is reduced. The number of workers used for
                inference can be overwritten using the environment variable
                    <code class="code">MODEL_SERVER_WORKERS</code> For example, by setting
                    <code class="code">MODEL_SERVER_WORKERS=1</code>) when calling the SageMaker <a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_CreateModel.html"><code class="code">CreateModel</code></a> API.</p>


         
            <h2 id="deepar-batch">Batch Transform with the DeepAR Algorithm</h2>
            <p>DeepAR forecasting supports getting inferences by using batch transform from data
                using the JSON Lines format. In this format, each record is represented on a single
                line as a JSON object, and lines are separated by newline characters. The format is
                identical to the JSON Lines format used for model training. For information, see
                    <a href="deepar.html#deepar-inputoutput">Input/Output Interface for the DeepAR
                Algorithm</a>. For
                example:</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>"start": "2009-11-01 00:00:00", "target": [4.3, "NaN", 5.1, ...], "cat": [0, 1], "dynamic_feat": [[1.1, 1.2, 0.5, ..]]}
<span>{</span>"start": "2012-01-30 00:00:00", "target": [1.0, -5.0, ...], "cat": [2, 3], "dynamic_feat": [[1.1, 2.05, ...]]}
<span>{</span>"start": "1999-01-30 00:00:00", "target": [2.0, 1.0], "cat": [1, 4], "dynamic_feat": [[1.3, 0.4]]}</code></pre>


            <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>When creating the transformation job with <a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_CreateTransformJob.html"><code class="code">CreateTransformJob</code></a>, set the <code class="code">BatchStrategy</code>
                    value to <code class="code">SingleRecord</code> and set the <code class="code">SplitType</code> value in
                    the <a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_TransformInput.html"><code class="code">TransformInput</code></a> configuration to <code class="code">Line</code>, as
                    the default values currently cause runtime failures.</p></div></div>


            <p>Similar to the hosted endpoint inference request format, the <code class="code">cat</code> and
                the <code class="code">dynamic_feat</code> fields for each instance are required if both of the
                following are true:</p>
            <div class="itemizedlist">
                 
                 
            <ul class="itemizedlist"><li class="listitem">
                    <p>The model is trained on a dataset that contained both the <code class="code">cat</code>
                        and the <code class="code">dynamic_feat</code> fields.</p>
                </li><li class="listitem">
                    <p>The corresponding <code class="code">cardinality</code> and
                            <code class="code">num_dynamic_feat</code> values used in the training job are not
                        set to <code class="code">"".</code></p>
                </li></ul></div>
            <p>Unlike hosted endpoint inference, the configuration field is set once for the
                entire batch inference job using an environment variable named
                    <code class="code">DEEPAR_INFERENCE_CONFIG</code>. The value of
                    <code class="code">DEEPAR_INFERENCE_CONFIG</code> can be passed when the model is created by
                calling <a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_CreateTransformJob.html"><code class="code">CreateTransformJob</code></a> API. If
                    <code class="code">DEEPAR_INFERENCE_CONFIG</code> is missing in the container environment,
                the inference container uses the following default:</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "num_samples": 100,
    "output_types": ["mean", "quantiles"],
    "quantiles": ["0.1", "0.2", "0.3", "0.4", "0.5", "0.6", "0.7", "0.8", "0.9"]
}</code></pre>
            <p>The output is also in JSON Lines format, with one line per prediction, in an order
                identical to the instance order in the corresponding input file. Predictions are
                encoded as objects identical to the ones returned by responses in online inference
                mode. For example:</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span> "quantiles": <span>{</span> "0.1": [...], "0.2": [...] }, "samples": [...], "mean": [...] }</code></pre>
            <p>Note that in the <a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_TransformInput.html"><code class="code">TransformInput</code></a> configuration of the SageMaker <a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_CreateTransformJob.html"><code class="code">CreateTransformJob</code></a> request clients must explicitly set the
                    <code class="code">AssembleWith</code> value to <code class="code">Line</code>, as the default value
                    <code class="code">None</code> concatenates all JSON objects on the same line.</p>

            <p>For example, here is a SageMaker <a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_CreateTransformJob.html"><code class="code">CreateTransformJob</code></a> request for a DeepAR job with a custom
                    <code class="code">DEEPAR_INFERENCE_CONFIG</code>:</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "BatchStrategy": "SingleRecord",
   "Environment": <span>{</span> 
      "DEEPAR_INFERENCE_CONFIG" : "<span>{</span> \"num_samples\": 200, \"output_types\": [\"mean\"] }",
      ...
   },
   "TransformInput": <span>{</span>
      "SplitType": "Line",
      ...
   },
   "TransformOutput": <span>{</span> 
      "AssembleWith": "Line",
      ...
   },
   ...
}</code></pre>
        <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="https://docs.aws.amazon.com/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./deepar-tuning.html">Model Tuning</div><div id="next" class="next-link" accesskey="n" href="./algorithms-unsupervised.html">Unsupervised</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=https://docs.aws.amazon.com/en_us/sagemaker/latest/dg/deepar-in-formats.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=https://docs.aws.amazon.com/en_us/sagemaker/latest/dg/deepar-in-formats.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>
<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Use Your Own Inference Code with Hosting Services - Amazon SageMaker</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="your-algorithms-inference-code" /><meta name="default_state" content="your-algorithms-inference-code" /><link rel="icon" type="image/ico" href="../../../assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="../../../assets/images/favicon.ico" /><link rel="canonical" href="your-algorithms-inference-code.html" /><meta name="description" content="How Amazon SageMaker interacts with a Docker container that runs your own inference code for hosting services." /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon SageMaker" /><meta name="guide" content="Developer Guide" /><meta name="abstract" content="Use Internet Monitor to build, train, and host machine learning models in AWS." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="your-algorithms-inference-code.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/sagemaker/latest/dg/your-algorithms-inference-code.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/sagemaker/latest/dg/your-algorithms-inference-code.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/sagemaker/latest/dg/your-algorithms-inference-code.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/sagemaker/latest/dg/your-algorithms-inference-code.html" hreflang="de" /><link rel="alternative" href="your-algorithms-inference-code.html" hreflang="en-us" /><link rel="alternative" href="your-algorithms-inference-code.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/sagemaker/latest/dg/your-algorithms-inference-code.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/sagemaker/latest/dg/your-algorithms-inference-code.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/sagemaker/latest/dg/your-algorithms-inference-code.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/sagemaker/latest/dg/your-algorithms-inference-code.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/sagemaker/latest/dg/your-algorithms-inference-code.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/sagemaker/latest/dg/your-algorithms-inference-code.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/sagemaker/latest/dg/your-algorithms-inference-code.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/sagemaker/latest/dg/your-algorithms-inference-code.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/sagemaker/latest/dg/your-algorithms-inference-code.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/sagemaker/latest/dg/your-algorithms-inference-code.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/sagemaker/latest/dg/your-algorithms-inference-code.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/sagemaker/latest/dg/your-algorithms-inference-code.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/sagemaker/latest/dg/your-algorithms-inference-code.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/sagemaker/latest/dg/your-algorithms-inference-code.html" hreflang="zh-tw" /><link rel="alternative" href="your-algorithms-inference-code.html" hreflang="x-default" /><meta name="feedback-item" content="SageMaker" /><meta name="this_doc_product" content="Amazon SageMaker" /><meta name="this_doc_guide" content="Developer Guide" /><script defer="" src="../../../assets/r/vendor4.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/vendor3.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/vendor1.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/awsdocs-common.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/awsdocs-doc-page.js@version=2021.12.02"></script><link href="../../../assets/r/vendor4.css@version=2021.12.02.css" rel="stylesheet" /><link href="../../../assets/r/awsdocs-common.css@version=2021.12.02.css" rel="stylesheet" /><link href="../../../assets/r/awsdocs-doc-page.css@version=2021.12.02.css" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'sagemaker'}"></script><meta id="panorama-serviceSubSection" value="Developer Guide" /><meta id="panorama-serviceConsolePage" value="Use Your Own Inference Code with Hosting Services" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Use Your Own Inference Code with Hosting Services - Amazon SageMaker</title><meta name="pdf" content="/pdfs/sagemaker/latest/dg/sagemaker-dg.pdf#your-algorithms-inference-code" /><meta name="rss" content="amazon-sagemaker-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=285" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/your-algorithms-inference-code.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/your-algorithms-inference-code.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/your-algorithms-inference-code.html" /><meta name="keywords" content="SageMaker,Amazon SageMaker,machine learning,notebook instance,create Docker container" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon SageMaker",
        "item" : "https://docs.aws.amazon.com/sagemaker/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Developer Guide",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Use Docker containers to build models",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/docker-containers.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Create a container with your own algorithms and models",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/docker-containers-create.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Use your own inference code",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/your-algorithms-inference-main.html"
      },
      {
        "@type" : "ListItem",
        "position" : 7,
        "name" : "Use Your Own Inference Code with Hosting Services",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/your-algorithms-inference-main.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="https://docs.aws.amazon.com/pdfs/sagemaker/latest/dg/sagemaker-dg.pdf#your-algorithms-inference-code" target="_blank" rel="noopener noreferrer" title="Open PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="https://docs.aws.amazon.com/index.html">Documentation</a><a href="https://docs.aws.amazon.com/sagemaker/index.html">Amazon SageMaker</a><a href="whatis.html">Developer Guide</a></div><div id="page-toc-src"><a href="your-algorithms-inference-code.html#your-algorithms-inference-code-run-image">How SageMaker Runs Your Inference
                Image</a><a href="your-algorithms-inference-code.html#your-algorithms-inference-code-load-artifacts">How SageMaker Loads Your
                Model Artifacts</a><a href="your-algorithms-inference-code.html#your-algorithms-inference-code-container-response">How Your Container
                Should Respond to Inference Requests</a><a href="your-algorithms-inference-code.html#your-algorithms-inference-algo-ping-requests">How Your Container Should
                Respond to Health Check (Ping) Requests</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="your-algorithms-inference-code">Use Your Own Inference Code with Hosting
            Services</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>This section explains how Amazon SageMaker interacts with a Docker container that runs your own
        inference code for hosting services. Use this information to write inference code and create
        a Docker image. </p><div class="highlights"><h6>Topics</h6><ul><li><a href="your-algorithms-inference-code.html#your-algorithms-inference-code-run-image">How SageMaker Runs Your Inference
                Image</a></li><li><a href="your-algorithms-inference-code.html#your-algorithms-inference-code-load-artifacts">How SageMaker Loads Your
                Model Artifacts</a></li><li><a href="your-algorithms-inference-code.html#your-algorithms-inference-code-container-response">How Your Container
                Should Respond to Inference Requests</a></li><li><a href="your-algorithms-inference-code.html#your-algorithms-inference-algo-ping-requests">How Your Container Should
                Respond to Health Check (Ping) Requests</a></li><li><a href="your-algorithms-containers-inference-private.html">Use a Private Docker Registry
            for Real-Time Inference Containers</a></li></ul></div>
        <h2 id="your-algorithms-inference-code-run-image">How SageMaker Runs Your Inference
                Image</h2>
        <p>To configure a container to run as an executable, use an <code class="code">ENTRYPOINT</code>
            instruction in a Dockerfile. Note the following: </p>
        <div class="itemizedlist">
             
             
             
             
             
            
             
        <ul class="itemizedlist"><li class="listitem">
                <p>For model inference, SageMaker runs the container as:</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">docker run <code class="replaceable">image</code> serve</code></pre>
                <p>SageMaker overrides default <code class="code">CMD</code> statements in a container by
                    specifying the <code class="code">serve</code> argument after the image name. The
                        <code class="code">serve</code> argument overrides arguments that you provide with the
                        <code class="code">CMD</code> command in the Dockerfile.</p>
                <p> </p>
            </li><li class="listitem">
                <p>SageMaker expects all containers to run with root users. Create your container so
                    that it uses only root users. When SageMaker runs your container, users that do not
                    have root-level access can cause permissions issues.</p>
                <p> </p>
            </li><li class="listitem">
                <p>We recommend that you use the <code class="code">exec</code> form of the
                        <code class="code">ENTRYPOINT</code> instruction:</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">ENTRYPOINT ["executable", "param1", "param2"]</code></pre>
                <p>For example:</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">ENTRYPOINT ["python", "k_means_inference.py"]</code></pre>
                <p>The <code class="code">exec</code> form of the <code class="code">ENTRYPOINT</code> instruction starts
                    the executable directly, not as a child of <code>/bin/sh</code>. This
                    enables it to receive signals like <code class="code">SIGTERM</code> and <code class="code">SIGKILL</code>
                    from the SageMaker API operations, which is a requirement. </p>
                <p> </p>
                <p>For example, when you use the <a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_CreateEndpoint.html"><code class="code">CreateEndpoint</code></a> API to create an endpoint, SageMaker
                    provisions the number of ML compute instances required by the endpoint
                    configuration, which you specify in the request. SageMaker runs the Docker container
                    on those instances. </p>
                <p> </p>
                <p>If you reduce the number of instances backing the endpoint (by calling the
                        <a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_UpdateEndpointWeightsAndCapacities.html"><code class="code">UpdateEndpointWeightsAndCapacities</code></a> API), SageMaker runs a
                    command to stop the Docker container on the instances that are being terminated.
                    The command sends the <code class="code">SIGTERM</code> signal, then it sends the
                        <code class="code">SIGKILL</code> signal thirty seconds later.</p>
                <p> </p>
                <p>If you update the endpoint (by calling the <a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_UpdateEndpoint.html"><code class="code">UpdateEndpoint</code></a> API), SageMaker launches another set of ML
                    compute instances and runs the Docker containers that contain your inference
                    code on them. Then it runs a command to stop the previous Docker containers. To
                    stop a Docker container, command sends the <code class="code">SIGTERM</code> signal, then it
                    sends the <code class="code">SIGKILL</code> signal 30 seconds later. </p>
                <p> </p>
            </li><li class="listitem">
                <p>SageMaker uses the container definition that you provided in your <a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_CreateModel.html"><code class="code">CreateModel</code></a> request to set environment variables and
                    the DNS hostname for the container as follows:</p>
                <p> </p>
                <div class="itemizedlist">
                     
                     
                <ul class="itemizedlist"><li class="listitem">
                        <p>It sets environment variables using the
                                <code class="code">ContainerDefinition.Environment</code> string-to-string
                            map.</p>
                    </li><li class="listitem">
                        <p>It sets the DNS hostname using the
                                <code class="code">ContainerDefinition.ContainerHostname</code>.</p>
                        <p> </p>
                    </li></ul></div>
            </li><li class="listitem">
                <p>If you plan to use GPU devices for model inferences (by specifying GPU-based
                    ML compute instances in your
                        <code class="code">CreateEndpointConfig</code> request), make sure that your containers
                    are <code class="code">nvidia-docker</code> compatible. Don't bundle NVIDIA drivers with the
                    image. For more
                    information about <code class="code">nvidia-docker</code>, see <a href="https://github.com/NVIDIA/nvidia-docker" rel="noopener noreferrer" target="_blank"><span>NVIDIA/nvidia-docker</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>. </p>
                <p> </p>
            </li><li class="listitem">
                <p>You can't use the <code class="code">tini</code> initializer as your entry point in SageMaker
                    containers because it gets confused by the <code class="code">train</code> and
                        <code class="code">serve</code> arguments.</p>
                <p></p>
            </li></ul></div>
     
        <h2 id="your-algorithms-inference-code-load-artifacts">How SageMaker Loads Your
                Model Artifacts</h2>
        <p>In your <a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_CreateModel.html"><code class="code">CreateModel</code></a> request, the container definition includes the
                <code class="code">ModelDataUrl</code> parameter, which identifies the S3 location where model
            artifacts are stored. SageMaker uses this information to determine from where to copy the
            model artifacts. It copies the artifacts to the <code>/opt/ml/model</code>
            directory for use by your inference code.</p>
        <p>The <code class="code">ModelDataUrl</code> must point to a tar.gz file. Otherwise, SageMaker won't
            download the file. </p>
        <p>If you trained your model in SageMaker, the model artifacts are saved as a single
            compressed tar file in Amazon S3. If you trained your model outside SageMaker, you need to
            create this single compressed tar file and save it in a S3 location. SageMaker decompresses
            this tar file into /opt/ml/model directory before your container starts.</p>
        <p>For deploying large models, we recommend that you follow <a href="large-model-inference-uncompressed.html">Deploying uncompressed models</a>.</p>
     
        <h2 id="your-algorithms-inference-code-container-response">How Your Container
                Should Respond to Inference Requests</h2>
        <p>To obtain inferences, the client application sends a POST request to the SageMaker
            endpoint. SageMaker passes the request to the container, and returns the inference result
            from the container to the client.</p>
        <p>For more information about the inference requests that your container will receive,
            see the following actions in the <em>Amazon SageMaker API Reference</em>:</p>
        <div class="itemizedlist">
             
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_runtime_InvokeEndpoint.html">
                        InvokeEndpoint</a></p>
            </li><li class="listitem">
                <p><a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_runtime_InvokeEndpointAsync.html">
                        InvokeEndpointAsync</a></p>
            </li><li class="listitem">
                <p><a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_runtime_InvokeEndpointWithResponseStream.html"> InvokeEndpointWithResponseStream</a></p>
            </li></ul></div>
        <div class="itemizedlist">
            <h6>Requirements for inference containers</h6>
            <p>To respond to inference requests, your container must meet the following
                requirements:</p>
             
             
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p>SageMaker strips all <code class="code">POST</code> headers except those supported by
                        <code class="code">InvokeEndpoint</code>. SageMaker might add additional headers. Inference
                    containers must be able to safely ignore these additional headers.</p>
            </li><li class="listitem">
                <p>To receive inference requests, the container must have a web server listening
                    on port 8080 and must accept <code class="code">POST</code> requests to the
                        <code class="code">/invocations</code> and <code class="code">/ping</code> endpoints. </p>
            </li><li class="listitem">
                <p>A customer's model containers must accept socket connection requests within
                    250 ms.</p>
            </li><li class="listitem">
                <p>A customer's model containers must respond to requests within 60 seconds. The
                    model itself can have a maximum processing time of 60 seconds before responding
                    to the <code class="code">/invocations</code>. If your model is going to take 50-60 seconds
                    of processing time, the SDK socket timeout should be set to be 70
                    seconds.</p>
            </li></ul></div>
        <div class="example"><h6>Example invocation functions</h6><div class="example-contents"><p>The following examples demonstrate how the code in your container can process
                inference requests. These examples handle requests that client applications send by
                using the InvokeEndpoint action.</p><awsdocs-tabs><dl style="display: none">
                <dt>FastAPI</dt><dd tab-id="fastapi">
                        <p>FastAPI is a web framework for building APIs with Python.</p>
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python ">from fastapi import FastAPI, status, Request, Response
. . .
app = FastAPI()
. . .
@app.post('/invocations')
async def invocations(request: Request):
    # model() is a hypothetical function that gets the inference output:
    model_resp = await model(Request)

    response = Response(
        content=model_resp,
        status_code=status.HTTP_200_OK,
        media_type="text/plain",
    )
    return response
. . .</code></pre>
                        <p>In this example, the <code class="code">invocations</code> function handles the
                            inference request that SageMaker sends to the <code class="code">/invocations</code>
                            endpoint.</p>
                    </dd>
                <dt>Flask</dt><dd tab-id="flask">
                        <p>Flask is a framework for developing web applications with
                            Python.</p>
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python ">import flask
. . .
app = flask.Flask(__name__)
. . .
@app.route('/invocations', methods=["POST"])
def invoke(request):
    # model() is a hypothetical function that gets the inference output:
    resp_body = model(request)
    return flask.Response(resp_body, mimetype='text/plain')
    </code></pre>
                        <p>In this example, the <code class="code">invoke</code> function handles the
                            inference request that SageMaker sends to the <code class="code">/invocations</code>
                            endpoint.</p>
                    </dd>
            </dl></awsdocs-tabs></div></div>
        <div class="example"><h6>Example invocation functions for streaming requests</h6><div class="example-contents"><p>The following examples demonstrate how the code in your inference container can
                process streaming inference requests. These examples handle requests that client
                applications send by using the InvokeEndpointWithResponseStream action.</p><p>When a container handles a streaming inference request, it returns the model's
                inference as a series of parts incrementally as the model generates them. Client
                applications start receiving responses immediately when they're available. They
                don't need to wait for the model to generate the entire response. You can implement
                streaming to support fast interactive experiences, such as chatbots, virtual
                assistants, and music generators.</p><awsdocs-tabs><dl style="display: none">
                <dt>FastAPI</dt><dd tab-id="fastapi">
                        <p>FastAPI is a web framework for building APIs with Python.</p>
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python ">from starlette.responses import StreamingResponse
from fastapi import FastAPI, status, Request
. . .
app = FastAPI()
. . .
@app.post('/invocations')
async def invocations(request: Request):
    # Streams inference response using HTTP chunked encoding
    async def generate():
        # model() is a hypothetical function that gets the inference output:
        yield await model(Request)
        yield "\n"

    response = StreamingResponse(
        content=generate(),
        status_code=status.HTTP_200_OK,
        media_type="text/plain",
    )
    return response
. . .</code></pre>
                        <p>In this example, the <code class="code">invocations</code> function handles the
                            inference request that SageMaker sends to the <code class="code">/invocations</code>
                            endpoint. To stream the response, the example uses the
                                <code class="code">StreamingResponse</code> class from the Starlette
                            framework.</p>
                    </dd>
                <dt>Flask</dt><dd tab-id="flask">
                        <p>Flask is a framework for developing web applications with
                            Python.</p>
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python ">import flask
. . .
app = flask.Flask(__name__)
. . .
@app.route('/invocations', methods=["POST"])
def invocations(request):
    # Streams inference response using HTTP chunked encoding

    def generate():
        # model() is a hypothetical function that gets the inference output:
        yield model(request)
        yield "\n"
    return flask.Response(
        flask.stream_with_context(generate()), mimetype='text/plain')
. . .</code></pre>
                        <p>In this example, the <code class="code">invocations</code> function handles the
                            inference request that SageMaker sends to the <code class="code">/invocations</code>
                            endpoint. To stream the response, the example uses the
                                <code class="code">flask.stream_with_context</code> function from the Flask
                            framework.</p>
                    </dd>
            </dl></awsdocs-tabs></div></div>
     
        <h2 id="your-algorithms-inference-algo-ping-requests">How Your Container Should
                Respond to Health Check (Ping) Requests</h2>
        
        <p>SageMaker launches new inference containers in the following situations:</p>
        <div class="itemizedlist">
             
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p>Responding to <code class="code">CreateEndpoint</code>, <code class="code">UpdateEndpoint</code>, and
                        <code class="code">UpdateEndpointWeightsAndCapacities</code> API calls</p>
            </li><li class="listitem">
                <p>Security patching</p>
            </li><li class="listitem">
                <p>Replacing unhealthy instances</p>
            </li></ul></div>
        <p>Soon after container startup, SageMaker starts sending periodic GET requests to the
                <code class="code">/ping</code> endpoint.</p>
        <p>The simplest requirement on the container is to respond with an HTTP 200 status code
            and an empty body. This indicates to SageMaker that the container is ready to accept
            inference requests at the <code class="code">/invocations</code> endpoint.</p>

        <p>If the container does not begin to pass health checks, by consistently responding with
            200s, during the 4 minutes after startup, new instance launch will fail. This will cause
                <code class="code">CreateEndPoint</code> to fail, leaving the endpoint in a failed state. The
            update requested by <code class="code">UpdateEndpoint</code> will not be completed, security patches
            would not be applied, and unhealthy instances will not be replaced.</p>
        <p>While the minimum bar is for the container to return a static 200, a container
            developer can use this functionality to perform deeper checks. The request timeout on
                <code class="code">/ping</code> attempts is 2 seconds.</p>
    <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="https://docs.aws.amazon.com/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./your-algorithms-inference-main.html">Use Your Own Inference Code</div><div id="next" class="next-link" accesskey="n" href="./your-algorithms-containers-inference-private.html">Private Docker Registry for Inference</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=https://docs.aws.amazon.com/en_us/sagemaker/latest/dg/your-algorithms-inference-code.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=https://docs.aws.amazon.com/en_us/sagemaker/latest/dg/your-algorithms-inference-code.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>
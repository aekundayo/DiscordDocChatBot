<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Capture data from batch transform job - Amazon SageMaker</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="model-monitor-data-capture-batch" /><meta name="default_state" content="model-monitor-data-capture-batch" /><link rel="icon" type="image/ico" href="../../../assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="../../../assets/images/favicon.ico" /><link rel="canonical" href="model-monitor-data-capture-batch.html" /><meta name="description" content="How to capture data with Amazon SageMaker Model Monitor." /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon SageMaker" /><meta name="guide" content="Developer Guide" /><meta name="abstract" content="Use Internet Monitor to build, train, and host machine learning models in AWS." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="model-monitor-data-capture-batch.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/sagemaker/latest/dg/model-monitor-data-capture-batch.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/sagemaker/latest/dg/model-monitor-data-capture-batch.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/sagemaker/latest/dg/model-monitor-data-capture-batch.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/sagemaker/latest/dg/model-monitor-data-capture-batch.html" hreflang="de" /><link rel="alternative" href="model-monitor-data-capture-batch.html" hreflang="en-us" /><link rel="alternative" href="model-monitor-data-capture-batch.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/sagemaker/latest/dg/model-monitor-data-capture-batch.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/sagemaker/latest/dg/model-monitor-data-capture-batch.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/sagemaker/latest/dg/model-monitor-data-capture-batch.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/sagemaker/latest/dg/model-monitor-data-capture-batch.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/sagemaker/latest/dg/model-monitor-data-capture-batch.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/sagemaker/latest/dg/model-monitor-data-capture-batch.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/sagemaker/latest/dg/model-monitor-data-capture-batch.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/sagemaker/latest/dg/model-monitor-data-capture-batch.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/sagemaker/latest/dg/model-monitor-data-capture-batch.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/sagemaker/latest/dg/model-monitor-data-capture-batch.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/sagemaker/latest/dg/model-monitor-data-capture-batch.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/sagemaker/latest/dg/model-monitor-data-capture-batch.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/sagemaker/latest/dg/model-monitor-data-capture-batch.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/sagemaker/latest/dg/model-monitor-data-capture-batch.html" hreflang="zh-tw" /><link rel="alternative" href="model-monitor-data-capture-batch.html" hreflang="x-default" /><meta name="feedback-item" content="SageMaker" /><meta name="this_doc_product" content="Amazon SageMaker" /><meta name="this_doc_guide" content="Developer Guide" /><script defer="" src="../../../assets/r/vendor4.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/vendor3.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/vendor1.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/awsdocs-common.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/awsdocs-doc-page.js@version=2021.12.02"></script><link href="../../../assets/r/vendor4.css@version=2021.12.02.css" rel="stylesheet" /><link href="../../../assets/r/awsdocs-common.css@version=2021.12.02.css" rel="stylesheet" /><link href="../../../assets/r/awsdocs-doc-page.css@version=2021.12.02.css" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'sagemaker'}"></script><meta id="panorama-serviceSubSection" value="Developer Guide" /><meta id="panorama-serviceConsolePage" value="Capture data from batch transform job" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Capture data from batch transform job - Amazon SageMaker</title><meta name="pdf" content="/pdfs/sagemaker/latest/dg/sagemaker-dg.pdf#model-monitor-data-capture-batch" /><meta name="rss" content="amazon-sagemaker-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=285" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/model-monitor-data-capture-batch.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/model-monitor-data-capture-batch.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/model-monitor-data-capture-batch.html" /><meta name="keywords" content="SageMaker,Amazon SageMaker,machine learning,notebook instance" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon SageMaker",
        "item" : "https://docs.aws.amazon.com/sagemaker/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Developer Guide",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Monitor data and model quality",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/model-monitor.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Capture data",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/model-monitor-data-capture.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Capture data from batch transform job",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/model-monitor-data-capture.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="https://docs.aws.amazon.com/pdfs/sagemaker/latest/dg/sagemaker-dg.pdf#model-monitor-data-capture-batch" target="_blank" rel="noopener noreferrer" title="Open PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="https://docs.aws.amazon.com/index.html">Documentation</a><a href="https://docs.aws.amazon.com/sagemaker/index.html">Amazon SageMaker</a><a href="whatis.html">Developer Guide</a></div><div id="page-toc-src"><a href="model-monitor-data-capture-batch.html#data-capture-batch-enable">How to enable data capture</a><a href="model-monitor-data-capture-batch.html#data-capture-batch-view">How to view data captured</a><a href="model-monitor-data-capture-batch.html#data-capture-batch-inferenceid">InferenceId Generation</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="model-monitor-data-capture-batch">Capture data from batch transform job</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>
                The steps required to turn on data capture for your batch transform job are similar
                whether you use the AWS SDK for Python (Boto) or the SageMaker Python SDK. If you use the AWS SDK,
                define the <a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_DataCaptureConfig.html">DataCaptureConfig</a> dictionary, along with required fields, within the
                <code class="code">CreateTransformJob</code> method to turn on data capture. If you use the SageMaker
                Python SDK, import the <code class="code">BatchDataCaptureConfig</code> class and initialize an
                instance from this class. Then, pass this object to the
                <code class="code">batch_data_capture_config</code> parameter of your transform job instance.
            </p><p>
                To use the following code snippets, replace the <code class="replaceable">italicized placeholder
                text</code> in the example code with your own information.
            </p>
                <h2 id="data-capture-batch-enable">How to enable data capture</h2>
                <p>
                    Specify a data capture configuration when you launch a transform job. Whether
                    you use the AWS SDK for Python (Boto3) or the SageMaker Python SDK, you must provide the
                    <code class="code">DestinationS3Uri</code> argument, which is the directory where you want
                    the transform job to log the captured data. Optionally, you can also set the
                    following parameters:
                </p>
                <div class="itemizedlist">
                     
                     
                <ul class="itemizedlist"><li class="listitem">
                        <p>
                            <code class="code">KmsKeyId</code>: The AWS KMS key used to encrypt the captured data.
                        </p>
                    </li><li class="listitem">
                        <p>
                            <code class="code">GenerateInferenceId</code>: A Boolean flag that, when capturing
                            the data, indicates if you want the transform job to append the
                            inference ID and time to your output. This is useful for model quality
                            monitoring, where you need to ingest the Ground Truth data. The inference ID
                            and time help to match the captured data with your Ground Truth data.
                        </p>
                    </li></ul></div>
                <awsdocs-tabs><dl style="display: none">
                    <dt>AWS SDK for Python (Boto3)</dt><dd tab-id="aws-sdk-for-python-(boto3)">
                            <p>
                                Configure the data you want to capture with the <a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_DataCaptureConfig.html">DataCaptureConfig</a> dictionary when you create a transform
                                job using the <code class="code">CreateTransformJob</code> method.
                            </p>
                            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python ">input_data_s3_uri = "s3://<code class="replaceable">input_S3_uri</code>"
output_data_s3_uri = "s3://<code class="replaceable">output_S3_uri</code>"
data_capture_destination = "s3://<code class="replaceable">captured_data_S3_uri</code>"

model_name = "<code class="replaceable">model_name</code>"

sm_client.create_transform_job(
    TransformJobName="<code class="replaceable">transform_job_name</code>",
    MaxConcurrentTransforms=2,
    ModelName=model_name,
    TransformInput=<span>{</span>
        "DataSource": <span>{</span>
            "S3DataSource": <span>{</span>
                "S3DataType": "S3Prefix",
                "S3Uri": input_data_s3_uri,
            }
        },
        "ContentType": "text/csv",
        "CompressionType": "None",
        "SplitType": "Line",
    },
    TransformOutput=<span>{</span>
        "S3OutputPath": output_data_s3_uri,
        "Accept": "text/csv",
        "AssembleWith": "Line",
    },
    TransformResources=<span>{</span>
        "InstanceType": "<code class="replaceable">ml.m4.xlarge</code>",
        "InstanceCount": <code class="replaceable">1</code>,
    },
    DataCaptureConfig=<span>{</span>
       "DestinationS3Uri": data_capture_destination,
       "KmsKeyId": "<code class="replaceable">kms_key</code>",
       "GenerateInferenceId": True,
    }
    )</code></pre>
                        </dd>
                    <dt>SageMaker Python SDK</dt><dd tab-id="sagemaker-python-sdk">
                            <p>
                                Import the <code class="code">BatchDataCaptureConfig</code> class from the <a href="https://sagemaker.readthedocs.io/en/stable/api/inference/model_monitor.html" rel="noopener noreferrer" target="_blank"><span>sagemaker.model_monitor</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.
                            </p>
                            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python ">from sagemaker.transformer import Transformer
from sagemaker.inputs import BatchDataCaptureConfig

# Optional - The S3 URI of where to store captured data in S3
data_capture_destination = "s3://<code class="replaceable">captured_data_S3_uri</code>"

model_name = "<code class="replaceable">model_name</code>"

transformer = Transformer(model_name=model_name, ...)
transform_arg = transformer.transform(
    batch_data_capture_config=BatchDataCaptureConfig(
        destination_s3_uri=data_capture_destination,
        kms_key_id="<code class="replaceable">kms_key</code>",
        generate_inference_id=True,
    ),
    ...
)</code></pre>
                        </dd>
                </dl></awsdocs-tabs>
             
                <h2 id="data-capture-batch-view">How to view data captured</h2>
                <p>
                    Once the transform job completes, the captured data gets logged under the
                    <code class="code">DestinationS3Uri</code> you provided with the data capture
                    configuration. There are two subdirectories under <code class="code">DestinationS3Uri</code>,
                    <code class="code">/input</code> and <code class="code">/output</code>. If <code class="code">DestinationS3Uri</code>
                    is <code class="code">s3://my-data-capture</code>, then the transform job creates the the
                    following directories:
                </p>
                <div class="itemizedlist">
                     
                     
                <ul class="itemizedlist"><li class="listitem">
                        <p>
                            <code class="code">s3://my-data-capture/input</code>: The captured input data for the
                            transform job.
                        </p>
                    </li><li class="listitem">
                        <p>
                            <code class="code">s3://my-data-capture/output</code>: The captured output data for
                            the transform job.
                        </p>
                    </li></ul></div>
                <p>
                    To avoid data duplication, the captured data under the preceding two directories
                    are manifests. Each manifest is a JSONL file that contains the Amazon S3 locations of
                    the source objects. A manifest file may look like the following example:
                </p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python "># under "/input" directory
[
    <span>{</span>"prefix":"s3://<code class="replaceable">input_S3_uri</code>/"},
    "dummy_0.csv",
    "dummy_1.csv",
    "dummy_2.csv",
    ...
]

# under "/output" directory
[
    <span>{</span>"prefix":"s3://<code class="replaceable">output_S3_uri</code>/"},
    "dummy_0.csv.out",
    "dummy_1.csv.out",
    "dummy_2.csv.out",
    ...
]</code></pre>
                <p>
                    The transform job organizes and labels these manifests with a
                    <code class="replaceable">yyyy/mm/dd/hh</code> S3 prefix to indicate when they were
                    captured. This helps the model monitor determine the appropriate portion of data
                    to analyze. For example, if you start your transform job at 2022-8-26 13PM UTC,
                    then the captured data is labeled with a <code class="code">2022/08/26/13/</code> prefix
                    string.
                </p>
             
                <h2 id="data-capture-batch-inferenceid">InferenceId Generation</h2>
                <p>
                    When you configure <code class="code">DataCaptureConfig</code> for a transform job, you can
                    turn on the Boolean flag <code class="code">GenerateInferenceId</code>. This is particularly
                    useful when you need to run model quality and model bias monitoring jobs, for
                    which you need user-ingested Ground Truth data. Model monitor relies on an inference ID
                    to match the captured data and the Ground Truth data. For addition details about Ground Truth
                    ingestion, see <a href="model-monitor-model-quality-merge.html">Ingest Ground Truth Labels and Merge
                    Them With Predictions</a>. When
                    <code class="code">GenerateInferenceId</code> is on, the transform output appends an
                    inference ID (a random UUID) as well as the transform job start time in UTC for
                    each record. You need these two values to run model quality and model bias
                    monitoring. When you construct the Ground Truth data, you need to provide the same
                    inference ID to match the output data. Currently, this feature supports
                    transform outputs in CSV, JSON, and JSONL formats.
                </p>
                <p>
                    If your transform output is in CSV format, the output file looks like the
                    following example:
                </p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">0, 1f1d57b1-2e6f-488c-8c30-db4e6d757861,2022-08-30T00:49:15Z
1, 22445434-0c67-45e9-bb4d-bd1bf26561e6,2022-08-30T00:49:15Z
...</code></pre>
                <p>
                    The last two columns are inference ID and the transform job start time. Do not
                    modify them. The remaining columns are your transform job outputs.
                </p>
                <p>
                    If your transform output is in JSON or JSONL format, the output file looks
                    like the following example:
                </p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>"output": 0, "SageMakerInferenceId": "1f1d57b1-2e6f-488c-8c30-db4e6d757861", "SageMakerInferenceTime": "2022-08-30T00:49:15Z"}
<span>{</span>"output": 1, "SageMakerInferenceId": "22445434-0c67-45e9-bb4d-bd1bf26561e6", "SageMakerInferenceTime": "2022-08-30T00:49:15Z"}
...
                </code></pre>
                <p>
                    There are two appended fields that are reserved,
                    <code class="code">SageMakerInferenceId</code> and <code class="code">SageMakerInferenceTime</code>. Do
                    not modify these fields if you need to run model quality or model bias
                    monitoring — you need them for merge jobs.
                </p>
            <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="https://docs.aws.amazon.com/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./model-monitor-data-capture-endpoint.html">Capture data from real-time endpoint</div><div id="next" class="next-link" accesskey="n" href="./model-monitor-data-quality.html">Monitor data quality</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=https://docs.aws.amazon.com/en_us/sagemaker/latest/dg/model-monitor-data-capture-batch.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=https://docs.aws.amazon.com/en_us/sagemaker/latest/dg/model-monitor-data-capture-batch.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>
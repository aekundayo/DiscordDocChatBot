<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Train, Compile, and Package Your Model - Amazon SageMaker</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="edge-getting-started-step2" /><meta name="default_state" content="edge-getting-started-step2" /><link rel="icon" type="image/ico" href="../../../assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="../../../assets/images/favicon.ico" /><link rel="canonical" href="edge-getting-started-step2.html" /><meta name="description" content="In this section you will create SageMaker and AWS IoT client objects, download a pre-trained machine learning model, upload your model to your Amazon S3 bucket, compile your model for your target device with SageMaker Neo, and package your model so that it can be deployed with the Edge Manager agent." /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon SageMaker" /><meta name="guide" content="Developer Guide" /><meta name="abstract" content="Use Internet Monitor to build, train, and host machine learning models in AWS." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="edge-getting-started-step2.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/sagemaker/latest/dg/edge-getting-started-step2.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/sagemaker/latest/dg/edge-getting-started-step2.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/sagemaker/latest/dg/edge-getting-started-step2.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/sagemaker/latest/dg/edge-getting-started-step2.html" hreflang="de" /><link rel="alternative" href="edge-getting-started-step2.html" hreflang="en-us" /><link rel="alternative" href="edge-getting-started-step2.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/sagemaker/latest/dg/edge-getting-started-step2.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/sagemaker/latest/dg/edge-getting-started-step2.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/sagemaker/latest/dg/edge-getting-started-step2.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/sagemaker/latest/dg/edge-getting-started-step2.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/sagemaker/latest/dg/edge-getting-started-step2.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/sagemaker/latest/dg/edge-getting-started-step2.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/sagemaker/latest/dg/edge-getting-started-step2.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/sagemaker/latest/dg/edge-getting-started-step2.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/sagemaker/latest/dg/edge-getting-started-step2.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/sagemaker/latest/dg/edge-getting-started-step2.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/sagemaker/latest/dg/edge-getting-started-step2.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/sagemaker/latest/dg/edge-getting-started-step2.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/sagemaker/latest/dg/edge-getting-started-step2.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/sagemaker/latest/dg/edge-getting-started-step2.html" hreflang="zh-tw" /><link rel="alternative" href="edge-getting-started-step2.html" hreflang="x-default" /><meta name="feedback-item" content="SageMaker" /><meta name="this_doc_product" content="Amazon SageMaker" /><meta name="this_doc_guide" content="Developer Guide" /><script defer="" src="../../../assets/r/vendor4.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/vendor3.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/vendor1.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/awsdocs-common.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/awsdocs-doc-page.js@version=2021.12.02"></script><link href="../../../assets/r/vendor4.css@version=2021.12.02.css" rel="stylesheet" /><link href="../../../assets/r/awsdocs-common.css@version=2021.12.02.css" rel="stylesheet" /><link href="../../../assets/r/awsdocs-doc-page.css@version=2021.12.02.css" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'sagemaker'}"></script><meta id="panorama-serviceSubSection" value="Developer Guide" /><meta id="panorama-serviceConsolePage" value="Train, Compile, and Package Your Model" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Train, Compile, and Package Your Model - Amazon SageMaker</title><meta name="pdf" content="/pdfs/sagemaker/latest/dg/sagemaker-dg.pdf#edge-getting-started-step2" /><meta name="rss" content="amazon-sagemaker-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=285" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/edge-getting-started-step2.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/edge-getting-started-step2.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/edge-getting-started-step2.html" /><meta name="keywords" content="SageMaker,Amazon SageMaker,machine learning,notebook instance,inference,deploy model,endpoint,prediction,ML application,serverless machine learning,multi model deployment,inference pipelines,ML model" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon SageMaker",
        "item" : "https://docs.aws.amazon.com/sagemaker/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Developer Guide",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Deploy models for inference",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/deploy-model.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Deploy models at the edge with SageMaker Edge Manager",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/edge.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Getting Started",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/edge-manager-getting-started.html"
      },
      {
        "@type" : "ListItem",
        "position" : 7,
        "name" : "Train, Compile, and Package Your Model",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/edge-manager-getting-started.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="https://docs.aws.amazon.com/pdfs/sagemaker/latest/dg/sagemaker-dg.pdf#edge-getting-started-step2" target="_blank" rel="noopener noreferrer" title="Open PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="https://docs.aws.amazon.com/index.html">Documentation</a><a href="https://docs.aws.amazon.com/sagemaker/index.html">Amazon SageMaker</a><a href="whatis.html">Developer Guide</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="edge-getting-started-step2">Train, Compile, and Package Your
                Model</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>In this section you will create SageMaker and AWS IoT client objects, download a pre-trained
            machine learning model, upload your model to your Amazon S3 bucket, compile your model for
            your target device with SageMaker Neo, and package your model so that it can be deployed with
            the Edge Manager agent.</p><div class="procedure"><ol><li>
                <p><b>Import libraries and create client
                    objects.</b></p>
                <p>This tutorial uses the AWS SDK for Python (Boto3) to create clients to interact with SageMaker,
                    Amazon S3, and AWS IoT.</p>
                <p>Import Boto3, specify your Region, and initialize the client objects you need
                    as shown in the following example:</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python ">import boto3
import json
import time

AWS_REGION = 'us-west-2'# Specify your Region
bucket = <code class="replaceable">'bucket-name'</code>

sagemaker_client = boto3.client('sagemaker', region_name=AWS_REGION)
iot_client = boto3.client('iot', region_name=AWS_REGION)</code></pre>
                <p>Define variables and assign them the role ARN you created for SageMaker and AWS IoT
                    as strings:</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python "># Replace with the role ARN you created for SageMaker
sagemaker_role_arn = "arn:aws:iam::<code class="replaceable">&lt;account&gt;:role/*</code>"

# Replace with the role ARN you created for AWS IoT. 
# Note: The name must start with 'SageMaker'
iot_role_arn = "arn:aws:iam::<code class="replaceable">&lt;account&gt;:role/SageMaker*</code>"</code></pre>
            </li><li>
                <p><b>Train a machine learning model.</b></p>
                <p>See <a href="how-it-works-training.html">Train a Model with Amazon SageMaker</a> for more
                    information on how to train a machine learning model using SageMaker. You can
                    optionally upload your locally trained model directly into an Amazon S3 URI
                    bucket.</p>
                <p>If you do not have a model yet, you can use a pre-trained model for the next 
                    steps in this tutorial. For example, you can save the MobileNet V2 models from the 
                    TensorFlow framework. MobileNet V2 is an image classification model optimized for mobile 
                    applications. For more information about MobileNet V2, see the 
                    <a href="https://github.com/tensorflow/models/tree/master/research/slim/nets/mobilenet" rel="noopener noreferrer" target="_blank"><span>MobileNet GitHub README</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p>

                    
                    <p>Type the following into your Jupyter Notebook to save the pre-trained MobileNet V2 model:</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python "># Save the MobileNet V2 model to local storage
   import tensorflow as tf
   model = tf.keras.applications.MobileNetV2()
   model.save(“mobilenet_v2.h5”)</code></pre>
                <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><div class="itemizedlist">
                         
                         
                    <ul class="itemizedlist"><li class="listitem">
                            <p>If you do not have TensorFlow installed, you can do so by running 
                            <code class="code">pip install tensorflow=2.4</code></p></li><li class="listitem">
                            <p>Use TensorFlow version 2.4 or lower for this tutorial.</p>
                        </li></ul></div></div></div>
                <p>The model will be saved into the <code>mobilenet_v2.h5</code> file. Before packaging the model, 
                    you will need to first compile your model using SageMaker Neo. See <a href="neo-supported-devices-edge.html">Supported Frameworks, Devices, Systems, and Architectures</a> to 
                    check if your version of TensorFlow (or other framework of choice) is currently 
                    supported by SageMaker Neo.</p>
                    <p>SageMaker Neo requires models to be stored as a 
                    compressed TAR file. Repackage it as a compressed TAR file (*.tar.gz):</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python "># Package MobileNet V2 model into a TAR file 
   import tarfile
   
   tarfile_name='mobilenet-v2.tar.gz'
   
   with tarfile.open(tarfile_name, mode='w:gz') as archive:
       archive.add('mobilenet-v2.h5')</code></pre>
            </li><li>
                <p><b>Upload your model to Amazon S3.</b></p>
                <p>Once you have a machine learning model, store it in an Amazon S3 bucket. The
                    following example uses an AWS CLI command to upload the model the to the Amazon S3
                    bucket you created earlier in a directory called <em>models</em>. Type in the following into your Jupyter Notebook:</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python ">!aws s3 cp mobilenet-v2.tar.gz s3://<span>{</span>bucket}/models/</code></pre>
            </li><li>
                <p><b>Compile your model with SageMaker Neo.</b></p>
                <p>Compile your machine learning model with SageMaker Neo for an edge device. You need
                    to know your Amazon S3 bucket URI where you stored the trained model, the machine
                    learning framework you used to train your model, the shape of your model’s
                    input, and your target device.</p>
                <p>For the MobileNet V2 model, use the following:</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python ">framework = 'tensorflow'
target_device = 'jetson_nano'
data_shape = '<span>{</span>"data":[1,3,224,224]}'</code></pre>
                <p>SageMaker Neo requires a specific model input shape and model format based on the
                    deep learning framework you use. For more information about how to save your
                    model, see <a href="neo-compilation-preparing-model.html#neo-job-compilation-expected-inputs">What input data shapes does SageMaker Neo expect?</a>. For more information
                    about devices and frameworks supported by Neo, see <a href="neo-supported-devices-edge.html">Supported Frameworks, Devices, Systems, and Architectures</a>.</p>
                <p>Use the <code class="code">CreateCompilationJob</code> API to create a compilation job with
                    SageMaker Neo. Provide a name to the compilation job, the SageMaker Role ARN, the Amazon S3 URI
                    where your model is stored, the input shape of the model, the name of the
                    framework, the Amazon S3 URI where you want SageMaker to store your compiled model, and
                    your edge device target.</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python "># Specify the path where your model is stored
model_directory = 'models'
s3_model_uri = 's3://<span>{</span>}/<span>{</span>}/<span>{</span>}'.format(bucket, model_directory, tarfile_name)

# Store compiled model in S3 within the 'compiled-models' directory
compilation_output_dir = 'compiled-models'
s3_output_location = 's3://<span>{</span>}/<span>{</span>}/'.format(bucket, compilation_output_dir)

# Give your compilation job a name
compilation_job_name = 'getting-started-demo'

sagemaker_client.create_compilation_job(CompilationJobName=compilation_job_name,
                                        RoleArn=sagemaker_role_arn,
                                        InputConfig=<span>{</span>
                                            'S3Uri': s3_model_uri,
                                            'DataInputConfig': data_shape,
                                            'Framework' : framework.upper()},
                                        OutputConfig=<span>{</span>
                                            'S3OutputLocation': s3_output_location,
                                            'TargetDevice': target_device},
                                        StoppingCondition=<span>{</span>'MaxRuntimeInSeconds': 900})
                </code></pre>
            </li><li>
                <p><b>Package your compiled model.</b></p>
                <p>Packaging jobs take SageMaker Neo–compiled models and make any changes
                    necessary to deploy the model with the inference engine, Edge Manager agent.
                    To package your model, create an edge packaging job with the
                        <code class="code">create_edge_packaging</code> API or the SageMaker console.</p>
                <p>You need to provide the name that you used for your Neo compilation job, a
                     name for the packaging job, a role ARN (see <a href="edge-getting-started-step1.html">Setting Up</a> section), a name for the
                    model, a model version, and the Amazon S3 bucket URI for the output of the packaging
                    job. Note that Edge Manager packaging job names are case-sensitive. 
                    The following is an example of how to create a packaging job using the API.</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python ">edge_packaging_name='edge-packaging-demo'
model_name="sample-model"
model_version="1.1"</code></pre>
                <p>Define the Amazon S3 URI where you want to store the packaged model.</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python "># Output directory where you want to store the output of the packaging job
packaging_output_dir = 'packaged_models'
packaging_s3_output = 's3://<span>{</span>}/<span>{</span>}'.format(bucket, packaging_output_dir)</code></pre>
                <p>Use <code class="code">CreateEdgePackagingJob</code> to package your Neo-compiled model.
                    Provide a name for your edge packaging job and the name you provided for your
                    compilation job (in this example, it was stored in the variable
                        <code class="code">compilation_job_name</code>). Also provide a name for your model, a
                    version for your model (this is used to help you keep track of what model
                    version you are using), and the S3 URI where you want SageMaker to store the packaged
                    model.</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python ">sagemaker_client.create_edge_packaging_job(
                    EdgePackagingJobName=edge_packaging_name,
                    CompilationJobName=compilation_job_name,
                    RoleArn=sagemaker_role_arn,
                    ModelName=model_name,
                    ModelVersion=model_version,
                    OutputConfig=<span>{</span>
                        "S3OutputLocation": packaging_s3_output
                        }
                    )</code></pre>
            </li></ol></div><awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="https://docs.aws.amazon.com/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./edge-getting-started-step1.html">Setting Up</div><div id="next" class="next-link" accesskey="n" href="./edge-getting-started-step3.html">Create and Register Fleets and Authenticate
                Devices</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=https://docs.aws.amazon.com/en_us/sagemaker/latest/dg/edge-getting-started-step2.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=https://docs.aws.amazon.com/en_us/sagemaker/latest/dg/edge-getting-started-step2.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>
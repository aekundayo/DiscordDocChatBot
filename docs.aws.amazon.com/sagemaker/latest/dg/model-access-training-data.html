<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Access Training Data - Amazon SageMaker</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="model-access-training-data" /><meta name="default_state" content="model-access-training-data" /><link rel="icon" type="image/ico" href="../../../assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="../../../assets/images/favicon.ico" /><link rel="canonical" href="model-access-training-data.html" /><meta name="description" content="Discusses the different input modes and AWS cloud storage for accessing the training dataset." /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon SageMaker" /><meta name="guide" content="Developer Guide" /><meta name="abstract" content="Use Internet Monitor to build, train, and host machine learning models in AWS." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="model-access-training-data.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/sagemaker/latest/dg/model-access-training-data.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/sagemaker/latest/dg/model-access-training-data.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/sagemaker/latest/dg/model-access-training-data.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/sagemaker/latest/dg/model-access-training-data.html" hreflang="de" /><link rel="alternative" href="model-access-training-data.html" hreflang="en-us" /><link rel="alternative" href="model-access-training-data.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/sagemaker/latest/dg/model-access-training-data.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/sagemaker/latest/dg/model-access-training-data.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/sagemaker/latest/dg/model-access-training-data.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/sagemaker/latest/dg/model-access-training-data.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/sagemaker/latest/dg/model-access-training-data.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/sagemaker/latest/dg/model-access-training-data.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/sagemaker/latest/dg/model-access-training-data.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/sagemaker/latest/dg/model-access-training-data.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/sagemaker/latest/dg/model-access-training-data.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/sagemaker/latest/dg/model-access-training-data.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/sagemaker/latest/dg/model-access-training-data.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/sagemaker/latest/dg/model-access-training-data.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/sagemaker/latest/dg/model-access-training-data.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/sagemaker/latest/dg/model-access-training-data.html" hreflang="zh-tw" /><link rel="alternative" href="model-access-training-data.html" hreflang="x-default" /><meta name="feedback-item" content="SageMaker" /><meta name="this_doc_product" content="Amazon SageMaker" /><meta name="this_doc_guide" content="Developer Guide" /><script defer="" src="../../../assets/r/vendor4.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/vendor3.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/vendor1.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/awsdocs-common.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/awsdocs-doc-page.js@version=2021.12.02"></script><link href="../../../assets/r/vendor4.css@version=2021.12.02.css" rel="stylesheet" /><link href="../../../assets/r/awsdocs-common.css@version=2021.12.02.css" rel="stylesheet" /><link href="../../../assets/r/awsdocs-doc-page.css@version=2021.12.02.css" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'sagemaker'}"></script><meta id="panorama-serviceSubSection" value="Developer Guide" /><meta id="panorama-serviceConsolePage" value="Access Training Data" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Access Training Data - Amazon SageMaker</title><meta name="pdf" content="/pdfs/sagemaker/latest/dg/sagemaker-dg.pdf#model-access-training-data" /><meta name="rss" content="amazon-sagemaker-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=285" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/model-access-training-data.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/model-access-training-data.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/model-access-training-data.html" /><meta name="keywords" content="SageMaker,Amazon SageMaker,machine learning,notebook instance,data input" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon SageMaker",
        "item" : "https://docs.aws.amazon.com/sagemaker/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Developer Guide",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Train machine learning models",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/train-model.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Access Training Data",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/train-model.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="https://docs.aws.amazon.com/pdfs/sagemaker/latest/dg/sagemaker-dg.pdf#model-access-training-data" target="_blank" rel="noopener noreferrer" title="Open PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="https://docs.aws.amazon.com/index.html">Documentation</a><a href="https://docs.aws.amazon.com/sagemaker/index.html">Amazon SageMaker</a><a href="whatis.html">Developer Guide</a></div><div id="page-toc-src"><a href="model-access-training-data.html#model-access-training-data-input-modes">SageMaker Input Modes and AWS Cloud
        Storage</a><a href="model-access-training-data.html#model-access-training-data-using-pysdk">Choosing Data Input Mode Using the
        SageMaker Python SDK</a><a href="model-access-training-data.html#model-access-training-data-fsx">Configure Data Input Channel to Use
        Amazon FSx for Lustre</a><a href="model-access-training-data.html#model-access-training-data-best-practices">Best Practices for Choosing Data
        Source and Input Mode</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="model-access-training-data">Access Training Data</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>When you create a training job, you specify the location of a training dataset and an input
    mode for accessing the dataset. For data location, Amazon SageMaker supports Amazon Simple Storage Service (Amazon S3), Amazon Elastic File System
    (Amazon EFS), and Amazon FSx for Lustre. The input modes determine whether to stream data files of the dataset
    in real time or download the whole dataset at the start of the training job.</p><div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>Your input dataset must be in the same AWS Region as your training job.</p></div></div>
    <h2 id="model-access-training-data-input-modes">SageMaker Input Modes and AWS Cloud
        Storage</h2>
    <p>This section summarizes SageMaker input modes for Amazon S3 and file systems in Amazon EFS and
      Amazon FSx for Lustre.</p>
    <div class="mediaobject">
       
        <img src="../../../images/sagemaker/latest/dg/images/sagemaker-training-input-mode.png" class="aws-docs-img-whiteBg aws-docs-img-padding" />
       
    </div>
    <div class="itemizedlist">
       
       
       
       
       
    <ul class="itemizedlist"><li class="listitem">
        <p><em>File mode</em> presents a file system view of the
          dataset to the training container. This is the default input mode if you don't explicitly
          specify one of the other two options. If you use file mode, SageMaker downloads the training
          data from the storage location to a local directory in the Docker container. Training
          starts after the full dataset has been downloaded. In file mode, the training instance
          must have enough storage space to fit the entire dataset. File mode download speed depends
          on the size of dataset, the average size of files, and the number of files. You can
          configure the dataset for file mode by providing either an Amazon S3 prefix,
          manifest file, or augmented manifest file. You should use an S3 prefix when all your
          dataset files are located within a common S3 prefix. File mode is compatible with <a href="https://sagemaker.readthedocs.io/en/stable/overview.html#local-mode" rel="noopener noreferrer" target="_blank"><span>SageMaker local
            mode</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> (starting a SageMaker training container interactively in seconds). For
          distributed training, you can shard the dataset across multiple instances with the
            <code class="code">ShardedByS3Key</code> option.</p>
      </li><li class="listitem">
        <p><em>Fast file mode</em> provides file system access to an Amazon S3
          data source while leveraging the performance advantage of pipe mode. At the start of
          training, fast file mode identifies the data files but does not download them. Training can
          start without waiting for the entire dataset to download. This means that the training
          startup takes less time when there are fewer files in the Amazon S3 prefix provided.</p>
        <p>In contrast to pipe mode, fast file mode works with random access to the data. However,
          it works best when data is read sequentially. Fast file mode doesn't support augmented
          manifest files.</p>
        <p>Fast file mode exposes S3 objects using a POSIX-compliant file system interface, as if
          the files are available on the local disk of your training instance. It streams S3 content
          on demand as your training script consumes data. This means that your dataset no longer
          needs to fit into the training instance storage space as a whole, and you don't need to wait
          for the dataset to be downloaded to the training instance before training starts. Fast file
          currently supports S3 prefixes only (it does not support manifest and augmented manifest).
          Fast file mode is compatible with SageMaker local mode.</p>
      </li><li class="listitem">
        <p><em>Pipe mode</em> streams data directly from an Amazon S3 data
          source. Streaming can provide faster start times and better throughput than file
          mode.</p>
        <p>When you stream the data directly, you can reduce the size of the Amazon EBS volumes used
          by the training instance. Pipe mode needs only enough disk space to store the final model
          artifacts.</p>
        <p>It is another streaming mode that is largely replaced by the newer and simpler-to-use
          fast file mode. In pipe mode, data is pre-fetched from Amazon S3 at high concurrency and
          throughput, and streamed into a named pipe, which also known as a First-In-First-Out
          (FIFO) pipe for its behavior. Each pipe may only be read by a single process. A SageMaker
          specific extension to TensorFlow conveniently <a href="https://sagemaker.readthedocs.io/en/stable/frameworks/tensorflow/using_tf.html#training-with-pipe-mode-using-pipemodedataset" rel="noopener noreferrer" target="_blank"><span>integrates Pipe mode into the native TensorFlow data loader</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> for streaming text,
          TFRecords, or RecordIO file formats. Pipe mode also supports managed sharding and
          shuffling of data.</p>
      </li><li class="listitem">
        <p>Amazon FSx for Lustre – FSx for Lustre can scale to hundreds of gigabytes of throughput
          and millions of IOPS with low-latency file retrieval. When starting a training job, SageMaker
          mounts the FSx for Lustre file system to the training instance file system, then starts your
          training script. Mounting itself is a relatively fast operation that doesn't depend on the
          size of the dataset stored in FSx for Lustre. </p>
        <p>To access FSx for Lustre, your training job must connect to an Amazon Virtual Private Cloud (VPC), which
          requires DevOps setup and involvement. To avoid data transfer costs, the file system uses a
          single Availability Zone, and you need to specify a VPC subnet which maps to this
          Availability Zone ID when running the training job.</p>
      </li><li class="listitem">
        <p>Amazon EFS – To use Amazon EFS as a data source, the data must already reside in Amazon EFS
          prior to training. SageMaker mounts the specified Amazon EFS file system to the training instance,
          then starts your training script. Your training job must connect to a VPC to access
          Amazon EFS.</p>
        <div class="awsdocs-note awsdocs-tip"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Tip</h6></div><div class="awsdocs-note-text"><p>To learn more about how to specify your VPC configuration to SageMaker estimators, see
            <a href="https://sagemaker.readthedocs.io/en/stable/overview.html?highlight=VPC#use-file-systems-as-training-inputs" rel="noopener noreferrer" target="_blank"><span>Use File Systems as Training Inputs</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> in the <em>SageMaker Python
                SDK documentation</em>.</p></div></div>
      </li></ul></div>
   
    <h2 id="model-access-training-data-using-pysdk">Choosing Data Input Mode Using the
        SageMaker Python SDK</h2>
    <p>SageMaker Python SDK provides the generic <a href="https://sagemaker.readthedocs.io/en/stable/api/training/estimators.html#sagemaker.estimator.Estimator" rel="noopener noreferrer" target="_blank"><span>Estimator class</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> and its <a href="https://sagemaker.readthedocs.io/en/stable/frameworks/index.html" rel="noopener noreferrer" target="_blank"><span>variations for ML
        frameworks</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> for launching training jobs. You can specify one of the data input modes
      while configuring the SageMaker <code class="code">Estimator</code> class or the <code class="code">Estimator.fit</code>
      method. The following code templates show the two ways to specify input modes.</p>
    <p><b>To specify the input mode using the Estimator
      class</b></p>
    
    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="py ">from sagemaker.<code class="userinput">estimator</code> import <code class="userinput">Estimator</code>
from sagemaker.inputs import TrainingInput

estimator = Estimator(
    checkpoint_s3_uri='<code class="replaceable">s3://my-bucket/checkpoint-destination/</code>',
    output_path='<code class="replaceable">s3://my-bucket/output-path/</code>',
    base_job_name='<code class="replaceable">job-name</code>',
    input_mode='<code class="replaceable">File</code>'  # Available options: File | Pipe | FastFile
    ...
)

# Run the training job
estimator.fit(
    inputs=TrainingInput(s3_data="<code class="replaceable">s3://my-bucket/my-data/train</code>")
)</code></pre>
    <p>For more information, see the <a href="https://sagemaker.readthedocs.io/en/stable/api/training/estimators.html#sagemaker.estimator.Estimator" rel="noopener noreferrer" target="_blank"><span>sagemaker.estimator.Estimator</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> class in the <em>SageMaker Python SDK
        documentation</em>.</p>
    <p><b>To specify the input mode through the Estimator fit
        method</b></p>
    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="py ">from sagemaker.<code class="userinput">estimator</code> import <code class="userinput">Estimator</code>
from sagemaker.inputs import TrainingInput

estimator = Estimator(
    checkpoint_s3_uri='<code class="replaceable">s3://my-bucket/checkpoint-destination/</code>',
    output_path='<code class="replaceable">s3://my-bucket/output-path/</code>',
    base_job_name='<code class="replaceable">job-name</code>',
    ...
)

# Run the training job
estimator.fit(
    inputs=TrainingInput(
        s3_data="<code class="replaceable">s3://my-bucket/my-data/train</code>",
        input_mode='<code class="replaceable">File</code>'  # Available options: File | Pipe | FastFile
    )
)</code></pre>
    
    <p>For more information, see the <a href="https://sagemaker.readthedocs.io/en/stable/api/training/estimators.html#sagemaker.estimator.Estimator.fit" rel="noopener noreferrer" target="_blank"><span>sagemaker.estimator.Estimator.fit</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> class method and the <a href="https://sagemaker.readthedocs.io/en/stable/api/utility/inputs.html#sagemaker.inputs.TrainingInput" rel="noopener noreferrer" target="_blank"><span>sagemaker.inputs.TrainingInput</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> class in the <em>SageMaker Python SDK
        documentation</em>.</p>
    <div class="awsdocs-note awsdocs-tip"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Tip</h6></div><div class="awsdocs-note-text"><p>To learn more about how to configure Amazon FSx for Lustre or Amazon EFS with your VPC
        configuration using the SageMaker Python SDK estimators, see <a href="https://sagemaker.readthedocs.io/en/stable/overview.html?highlight=VPC#use-file-systems-as-training-inputs" rel="noopener noreferrer" target="_blank"><span>Use File Systems as Training Inputs</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> in the <em>SageMaker Python
          SDK documentation</em>.</p></div></div>
    <div class="awsdocs-note awsdocs-tip"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Tip</h6></div><div class="awsdocs-note-text"><p>The data input mode integrations with Amazon S3, Amazon EFS, and FSx for Lustre are recommended ways
        to optimally configure data source for the best practices. You can strategically improve
        data loading performance using the SageMaker managed storage options and input modes, but it's
        not strictly constrained. You can write your own data reading logic directly in your
        training container. For example, you can set to read from a different data source, write
        your own S3 data loader class, or use third-party frameworks' data loading functions within
        your training script. However, you must make sure that you specify the right paths that SageMaker
        can recognize.</p></div></div>
    <div class="awsdocs-note awsdocs-tip"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Tip</h6></div><div class="awsdocs-note-text"><p>If you use a custom training container, make sure you install the <a href="https://github.com/aws/sagemaker-training-toolkit" rel="noopener noreferrer" target="_blank"><span>SageMaker training toolkit</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>
        that helps set up the environment for SageMaker training jobs. Otherwise, you must specify the
        environment variables explicitly in your Dockerfile. For more information, see <a href="docker-containers-create.html">Create a
          container with your own algorithms and models</a>.</p></div></div>
    <p>For more information about how to set the data input modes using the low-level SageMaker APIs,
      see <a href="your-algorithms-training-algo-running-container.html">How Amazon SageMaker Provides
                Training Information</a>, the <a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_CreateTrainingJob.html"><code class="code">CreateTrainingJob</code></a> API, and the <code class="code">TrainingInputMode</code> in
        <a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_AlgorithmSpecification.html"><code class="code">AlgorithmSpecification</code></a>.</p>
   
    <h2 id="model-access-training-data-fsx">Configure Data Input Channel to Use
        Amazon FSx for Lustre</h2>
    <p>Learn how to use Amazon FSx for Lustre as your data source for higher throughput and faster
      training by reducing the time for data loading.</p>
     
      <h3 id="model-access-training-data-fsx-sync-s3">Sync Amazon S3 and Amazon FSx for Lustre</h3>
      <p>To link your Amazon S3 to Amazon FSx for Lustre and upload your training datasets, do the
        following.</p>
      <div class="orderedlist">
         
         
         
      <ol><li><p>Prepare your dataset and upload to an Amazon S3 bucket. For example, assume that the Amazon S3 paths for a
          train dataset and a test dataset are in the following format.</p>
          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="txt ">s3://my-bucket/data/train
s3://my-bucket/data/test</code></pre></li><li>
          <p>To create an FSx for Lustre file system linked with the Amazon S3 bucket with the training
            data, follow the steps at <a href="https://docs.aws.amazon.com/fsx/latest/LustreGuide/create-dra-linked-data-repo.html">Linking your file system
              to an Amazon S3 bucket</a> in the <em>Amazon FSx for Lustre User Guide</em>. Make
            sure that you add an endpoint to your VPC allowing Amazon S3 access. For more information,
            see <a href="https://docs.aws.amazon.com/sagemaker/latest/dg/train-vpc.html#train-vpc-s3">Create an Amazon S3 VPC Endpoint</a>. When you specify <b>Data repository
              path</b>, provide the Amazon S3 bucket URI of the folder that contains your
            datasets. For example, based on the example S3 paths in step 1, the data repository path
            should be the following.</p>
          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="txt ">s3://my-bucket/data</code></pre>
        </li><li>
          <p>After the FSx for Lustre file system is created, check the configuration information by
            running the following commands.</p>
          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="bash ">aws fsx describe-file-systems &amp;&amp; \
aws fsx describe-data-repository-association</code></pre>
          <p>These commands return <code class="code">FileSystemId</code>, <code class="code">MountName</code>,
            <code class="code">FileSystemPath</code>, and <code class="code">DataRepositoryPath</code>. For example, the
            outputs should look like the following.</p>
          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="txt "># Output of aws fsx describe-file-systems
"FileSystemId": "fs-0123456789abcdef0"
"MountName": "1234abcd"

# Output of aws fsx describe-data-repository-association
"FileSystemPath": "/ns1",
"DataRepositoryPath": "s3://my-bucket/data/"</code></pre>
          <p>After the sync between Amazon S3 and Amazon FSx has completed, your datasets are saved in Amazon FSx in the
            following directories.</p>
          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="txt ">/ns1/train  # synced with s3://my-bucket/data/train
/ns1/test   # synced with s3://my-bucket/data/test</code></pre>
        </li></ol></div>
     
     
      <h3 id="model-access-training-data-fsx-set-as-input-channel">Set the Amazon FSx file
          system path as the data input channel for SageMaker training</h3>
      <p>The following procedures walk you through the process of setting the Amazon FSx file system
        as the data source for SageMaker training jobs.</p>
      <awsdocs-tabs><dl style="display: none">
        <dt>Using the SageMaker Python SDK</dt><dd tab-id="using-the-sagemaker-python-sdk">
            <p>To properly set the Amazon FSx file system as the data source, configure the SageMaker estimator
              classes and <code class="code">FileSystemInput</code> using the following instruction.</p>
            <div class="orderedlist">
               
               
               
            <ol><li>
                <p>Configure a FileSystemInput class object.</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="py ">from sagemaker.inputs import FileSystemInput

train_fs = FileSystemInput(
    file_system_id="<code class="replaceable">fs-0123456789abcdef0</code>",
    file_system_type="FSxLustre",
    directory_path="<code class="replaceable">/1234abcd/ns1/</code>",
    file_system_access_mode="ro",
)</code></pre>
                <div class="awsdocs-note awsdocs-tip"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Tip</h6></div><div class="awsdocs-note-text"><p>When you specify <code class="code">directory_path</code>, make sure that you provide the
                    Amazon FSx file system path starting with <code class="code">MountName</code>.</p></div></div>
              </li><li>
                <p>Configure a SageMaker estimator with the VPC configuration used for the Amazon FSx file
                  system.</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="py ">from sagemaker.<code class="replaceable">estimator</code> import <code class="replaceable">Estimator</code>

estimator = <code class="replaceable">Estimator</code>(
    ...
    role="<code class="replaceable">your-iam-role-with-access-to-your-fsx</code>",
    subnets=["<code class="replaceable">subnet-id</code>"],  # Should be the same as the subnet used for Amazon FSx
    security_group_ids="<code class="replaceable">security-group-id</code>"
)</code></pre>
              </li><li>
                <p>Launch the training job by running the estimator.fit method with the Amazon FSx file
                  system.</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="py ">estimator.fit(train_fs)</code></pre>
              </li></ol></div>
            <p>To find more code examples, see <a href="https://sagemaker.readthedocs.io/en/stable/overview.html#use-file-systems-as-training-inputs" rel="noopener noreferrer" target="_blank"><span>Use File Systems as Training Inputs</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> in the <em>SageMaker Python SDK
                documentation</em>.</p>
          </dd>
        <dt>Using the SageMaker CreateTrainingJob API</dt><dd tab-id="using-the-sagemaker-createtrainingjob-api">
            <p>As part of the <a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_CreateTrainingJob.html">CreateTrainingJob</a> request JSON, configure <code class="code">InputDataConfig</code> as
              follows.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"InputDataConfig": [ 
    <span>{</span> 
        "ChannelName": "<code class="replaceable">string</code>",
        "DataSource": <span>{</span> 
            "FileSystemDataSource": <span>{</span> 
                "DirectoryPath": "<code class="replaceable">/1234abcd/ns1/</code>",
                "FileSystemAccessMode": "ro",
                "FileSystemId": "<code class="replaceable">fs-0123456789abcdef0</code>",
                "FileSystemType": "FSxLustre"
            }
        }
    }
],</code></pre>
            <div class="awsdocs-note awsdocs-tip"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Tip</h6></div><div class="awsdocs-note-text"><p>When you specify <code class="code">DirectoryPath</code>, make sure that you provide the
                Amazon FSx file system path starting with <code class="code">MountName</code>.</p></div></div>
          </dd>
      </dl></awsdocs-tabs>
     
    
     
      <h3 id="model-access-training-data-fsx-tips-considerations">Tips and Considerations When Configuring FSx for Lustre</h3>
      <div class="orderedlist">
         
         
      <ol><li>
          <p>When you use EFA-enabled instances such as P4d and P3dn, make sure that you set
            appropriate inbound and output rules in the security group. Specially, opening up these
            ports is necessary for SageMaker to access the Amazon FSx file system in the training job. To
            learn more, see <a href="https://docs.aws.amazon.com/fsx/latest/LustreGuide/limit-access-security-groups.html">File System Access
              Control with Amazon VPC</a>.</p>
        </li><li>
          <p>Make sure the IAM Role used to launch the SageMaker training job has access
            to Amazon FSx.</p>
        </li></ol></div>
     
    
   
    <h2 id="model-access-training-data-best-practices">Best Practices for Choosing Data
        Source and Input Mode</h2>
    <p>The best data source for your training job depends on workload characteristics such as the
      size of the dataset, the file format, the average size of files, the training duration, a
      sequential or random data loader read pattern, and how fast your model can consume the
      training data. The following best practices provide guidelines to get started with the most
      suitable input mode and data storage for your use case.</p>
    <div class="mediaobject">
       
        <img src="../../../images/sagemaker/latest/dg/images/sagemaker-training-choose-mode-and-storage.png" class="aws-docs-img-whiteBg aws-docs-img-padding" />
       
      <div class="caption">This flowchart summarizes and visualizes best practices of choosing the
        best storage as the data source and input file mode. All of the cases in the flowchart are
        described in the following sections.</div>
    </div>
     
      <h3 id="model-access-training-data-best-practices-efs">When to use Amazon EFS</h3>
      <p>If your dataset is stored in Amazon Elastic File System, you might have a preprocessing or annotations
        application that uses Amazon EFS for storage. You can run a training job configured with a data
        channel that points to the Amazon EFS file system. For more information, see <a href="https://aws.amazon.com/blogs/machine-learning/speed-up-training-on-amazon-sagemaker-using-amazon-efs-or-amazon-fsx-for-lustre-file-systems/" rel="noopener noreferrer" target="_blank"><span>Speed up training on Amazon SageMaker using Amazon FSx for Lustre and Amazon EFS file systems</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>. If
        you cannot achieve better performance, check your optimization options following the <a href="https://docs.aws.amazon.com/efs/latest/ug/performance.html#performance-overview">Amazon Elastic File System performance guide</a> or consider using different input modes or data
        storage.</p>
     
     
      <h3 id="model-access-training-data-best-practices-file-mode">Use file mode for
          small datasets</h3>
      <p>If the dataset is stored in Amazon Simple Storage Service and its overall volume is relatively small (for
        example, less than 50-100 GB), try using file mode. The overhead of downloading a 50 GB
        dataset can vary based on the total number of files. For example, it takes about 5 minutes
        if a dataset is chunked into 100 MB shards. Whether this startup overhead is acceptable
        primarily depends on the overall duration of your training job, because a longer training
        phase means a proportionally smaller download phase.</p>
     
     
      <h3 id="model-access-training-data-best-practices-serialize">Serializing many small files</h3>
      <p>If your dataset size is small (less than 50-100 GB), but is made up of many small files
        (less than 50 MB per file), the file mode download overhead grows, because each file needs
        to be downloaded individually from Amazon Simple Storage Service to the training instance volume. To reduce this
        overhead and data traversal time in general, consider serializing groups of such small files
        into fewer larger file containers (such as 150 MB per file) by using file formats, such as
          <a href="https://www.tensorflow.org/tutorials/load_data/tfrecord" rel="noopener noreferrer" target="_blank"><span>TFRecord</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> for
        TensorFlow, <a href="https://webdataset.github.io/webdataset/" rel="noopener noreferrer" target="_blank"><span> WebDataset</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> for
        PyTorch, and <a href="https://mxnet.apache.org/versions/1.8.0/api/faq/recordio" rel="noopener noreferrer" target="_blank"><span>RecordIO</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> for MXNet.</p>
     
     
      <h3 id="model-access-training-data-best-practices-fastfile">When to use fast file
          mode</h3>
      <p>For larger datasets with larger files (more than 50 MB per file), the first option is to
        try fast file mode, which is more straightforward to use than FSx for Lustre because it doesn't
        require creating a file system, or connecting to a VPC. Fast file mode is ideal for large
        file containers (more than 150 MB), and might also do well with files more than 50 MB.
        Because fast file mode provides a POSIX interface, it supports random reads (reading
        non-sequential byte-ranges). However, this is not the ideal use case, and your throughput
        might be lower than with the sequential reads. However, if you have a relatively large and
        computationally intensive ML model, fast file mode might still be able to saturate the
        effective bandwidth of the training pipeline and not result in an IO bottleneck. You'll need
        to experiment and see. To switch from file mode to fast file mode (and back), just add (or
        remove) the <code class="code">input_mode='FastFile'</code> parameter while defining your input channel
        using the SageMaker Python SDK:</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="py ">sagemaker.inputs.TrainingInput(S3_INPUT_FOLDER,  input_mode = 'FastFile')</code></pre>
     
     
      <h3 id="model-access-training-data-best-practices-fsx">When to use Amazon FSx for Lustre</h3>
      <p>If your dataset is too large for file mode, has many small files that you can't
        serialize easily, or uses a random read access pattern, FSx for Lustre is a good option to
        consider. Its file system scales to hundreds of gigabytes per second (GB/s) of throughput
        and millions of IOPS, which is ideal when you have many small files. However, note that
        there might be the cold start issue due to lazy loading and the overhead of setting up and
        initializing the FSx for Lustre file system.</p>
      <div class="awsdocs-note awsdocs-tip"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Tip</h6></div><div class="awsdocs-note-text"><p>To learn more, see <a href="http://aws.amazon.com/blogs/machine-learning/choose-the-best-data-source-for-your-amazon-sagemaker-training-job/" rel="noopener noreferrer" target="_blank"><span>Choose the best data source for your Amazon SageMaker training job</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>. This AWS machine
          learning blog further discusses case studies and performance benchmark of data sources and
          input modes.</p></div></div>
     
  <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="https://docs.aws.amazon.com/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./training-compiler-release-notes.html">Release Notes</div><div id="next" class="next-link" accesskey="n" href="./train-heterogeneous-cluster.html">Train Using a Heterogeneous Cluster</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=https://docs.aws.amazon.com/en_us/sagemaker/latest/dg/model-access-training-data.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=https://docs.aws.amazon.com/en_us/sagemaker/latest/dg/model-access-training-data.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>
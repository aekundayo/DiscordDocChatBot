<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Monitoring user resource access from Amazon SageMaker Studio - Amazon SageMaker</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="monitor-user-access" /><meta name="default_state" content="monitor-user-access" /><link rel="icon" type="image/ico" href="../../../assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="../../../assets/images/favicon.ico" /><link rel="canonical" href="monitor-user-access.html" /><meta name="description" content="Monitor how your Amazon SageMaker Studio users access AWS resources." /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon SageMaker" /><meta name="guide" content="Developer Guide" /><meta name="abstract" content="Use Internet Monitor to build, train, and host machine learning models in AWS." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="monitor-user-access.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/sagemaker/latest/dg/monitor-user-access.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/sagemaker/latest/dg/monitor-user-access.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/sagemaker/latest/dg/monitor-user-access.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/sagemaker/latest/dg/monitor-user-access.html" hreflang="de" /><link rel="alternative" href="monitor-user-access.html" hreflang="en-us" /><link rel="alternative" href="monitor-user-access.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/sagemaker/latest/dg/monitor-user-access.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/sagemaker/latest/dg/monitor-user-access.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/sagemaker/latest/dg/monitor-user-access.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/sagemaker/latest/dg/monitor-user-access.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/sagemaker/latest/dg/monitor-user-access.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/sagemaker/latest/dg/monitor-user-access.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/sagemaker/latest/dg/monitor-user-access.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/sagemaker/latest/dg/monitor-user-access.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/sagemaker/latest/dg/monitor-user-access.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/sagemaker/latest/dg/monitor-user-access.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/sagemaker/latest/dg/monitor-user-access.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/sagemaker/latest/dg/monitor-user-access.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/sagemaker/latest/dg/monitor-user-access.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/sagemaker/latest/dg/monitor-user-access.html" hreflang="zh-tw" /><link rel="alternative" href="monitor-user-access.html" hreflang="x-default" /><meta name="feedback-item" content="SageMaker" /><meta name="this_doc_product" content="Amazon SageMaker" /><meta name="this_doc_guide" content="Developer Guide" /><script defer="" src="../../../assets/r/vendor4.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/vendor3.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/vendor1.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/awsdocs-common.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/awsdocs-doc-page.js@version=2021.12.02"></script><link href="../../../assets/r/vendor4.css@version=2021.12.02.css" rel="stylesheet" /><link href="../../../assets/r/awsdocs-common.css@version=2021.12.02.css" rel="stylesheet" /><link href="../../../assets/r/awsdocs-doc-page.css@version=2021.12.02.css" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'sagemaker'}"></script><meta id="panorama-serviceSubSection" value="Developer Guide" /><meta id="panorama-serviceConsolePage" value="Monitoring user resource access from Amazon SageMaker Studio" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Monitoring user resource access from Amazon SageMaker Studio - Amazon SageMaker</title><meta name="pdf" content="/pdfs/sagemaker/latest/dg/sagemaker-dg.pdf#monitor-user-access" /><meta name="rss" content="amazon-sagemaker-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=285" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/monitor-user-access.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/monitor-user-access.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/monitor-user-access.html" /><meta name="keywords" content="SageMaker,Amazon SageMaker,machine learning,notebook instance" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon SageMaker",
        "item" : "https://docs.aws.amazon.com/sagemaker/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Developer Guide",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Monitor AWS resources provisioned while using Amazon SageMaker",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/monitoring-overview.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Monitoring user resource access from Amazon SageMaker Studio",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/monitoring-overview.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="https://docs.aws.amazon.com/pdfs/sagemaker/latest/dg/sagemaker-dg.pdf#monitor-user-access" target="_blank" rel="noopener noreferrer" title="Open PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="https://docs.aws.amazon.com/index.html">Documentation</a><a href="https://docs.aws.amazon.com/sagemaker/index.html">Amazon SageMaker</a><a href="whatis.html">Developer Guide</a></div><div id="page-toc-src"><a href="monitor-user-access.html#monitor-user-access-prereq">Prerequisites</a><a href="monitor-user-access.html#monitor-user-access-considerations">Considerations when using sourceIdentity</a><a href="monitor-user-access.html#monitor-user-access-enable">Turn on sourceIdentity</a><a href="monitor-user-access.html#monitor-user-access-disable">Turn off sourceIdentity</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="monitor-user-access">Monitoring user resource access from Amazon SageMaker Studio</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>With Amazon SageMaker Studio, you can monitor user resource access. To view resource access activity,
    you can configure AWS CloudTrail to monitor and record user activities by following
    the steps in <a href="logging-using-cloudtrail.html">Log Amazon SageMaker API Calls with AWS CloudTrail</a>. </p><p>However, the AWS CloudTrail logs for resource access only list the Studio
    execution IAM role as the identifier. This level of logging is enough to audit user activity
    when each user profile has a distinct execution role. However, when a single execution IAM
    role is shared between several user profiles, you can't get information about the specific user
    that accessed the AWS resources.  </p><p>You can get information about which specific user performed an action in an
    AWS CloudTrail log when using a shared execution role, using
      the <code class="code">sourceIdentity</code> configuration to propagate the Studio user profile name.
    For more information about source identity, see <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_temp_control-access_monitor.html">Monitor and control
      actions taken with assumed roles</a>. </p>
    <h2 id="monitor-user-access-prereq">Prerequisites</h2>

<div class="itemizedlist">
   
   
   
   
<ul class="itemizedlist"><li class="listitem">
    <p>Install and configure the AWS Command Line Interface following the steps in <a href="https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html">Installing or updating the
            latest version of the AWS CLI</a>.</p>
  </li><li class="listitem">
    <p>Ensure that Studio users in your domain don’t have a policy that allows them to update
          or modify the Studio domain.  </p>
  </li><li class="listitem">
        <p>To turn on or turn off <code class="code">sourceIdentity</code> propagation, all apps in the domain
          must be in the <code class="code">Stopped</code> or <code class="code">Deleted</code> state. For more information
          about how to stop and shut down apps, see <a href="studio-tasks-update-apps.html">Shut down and Update Studio
            Apps</a>.</p>
      </li><li class="listitem">
    <p>All execution roles must have the following trust policy permissions: </p>
    <div class="itemizedlist">
       
       
    <ul class="itemizedlist"><li class="listitem">
        <p>Any role that the Studio domain's execution role assumes must have
                the <code class="code">sts:SetSourceIdentity</code> permission in the trust policy as
              follows.</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Effect": "Allow",
            "Principal": <span>{</span>
                "Service": "sagemaker.amazonaws.com"
            },
            "Action": [
                "sts:AssumeRole",
                "sts:SetSourceIdentity"
            ]
        }
    ]
}</code></pre>
      </li><li class="listitem">
        <p>When you assume a
          role with another role, called role chaining, do the following:</p>
        <div class="itemizedlist">
           
           
        <ul class="itemizedlist"><li class="listitem">
            <p>Permissions for <code class="code">sts:SetSourceIdentity</code> are required in both the
                  permissions policy of the principal that is assuming the role, and in the role
                  trust policy of the target role. Otherwise, the assume role operation will
                  fail.</p>
          </li><li class="listitem">
            <p>  This role chaining can happen in
              Studio or any other downstream service, such as Amazon EMR. For more information about role
              chaining, see <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_terms-and-concepts.html">Roles terms and
                concepts</a>. </p>
          </li></ul></div>
      </li></ul></div>
    
    
  </li></ul></div>
   
    <h2 id="monitor-user-access-considerations">Considerations when using <code class="code">sourceIdentity</code></h2>
    <p>When you make AWS API calls from Studio notebooks, SageMaker Canvas, or Amazon SageMaker Data Wrangler, the
        <code class="code">sourceIdentity</code> is only recorded in CloudTrail if those calls are made using the
      Studio <a href="sagemaker-roles.html">execution role</a> session or any <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_terms-and-concepts.html#iam-term-role-chaining">chained
        role</a> from that session.</p>
    <p>When these API calls invoke other services to perform additional operations,
        <code class="code">sourceIdentity</code> logging depends on the specific implementation of the invoked
      services. </p>
    <div class="itemizedlist">
       
       
    <ul class="itemizedlist"><li class="listitem">
        <p>Amazon SageMaker Training, Processing, and Pipeline: When you create a job using these
          features, the job creation APIs are not able to ingest the <code class="code">sourceIdentity</code>
          that exists in the session. As a result, any AWS API calls made from these jobs do not
          record <code class="code">sourceIdentity</code> in CloudTrail logs.</p>
      </li><li class="listitem">
        <p>Amazon EMR: When connecting to Amazon EMR from Studio using <a href="studio-notebooks-emr-cluster-rbac.html">runtime roles</a>, administrators must
          explicitly <a href="https://docs.aws.amazon.com/emr/latest/ManagementGuide/emr-steps-runtime-roles.html">set the
            PropagateSourceIdentity field</a>. This ensures that Amazon EMR applies the
            <code class="code">sourceIdentity</code> from the calling credentials to a job or query session. The
            <code class="code">sourceIdentity</code> is then recorded in CloudTrail logs.</p>
      </li></ul></div>
    <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>The following exceptions apply when using <code class="code">sourceIdentity</code>.</p><div class="itemizedlist">
         
         
      <ul class="itemizedlist"><li class="listitem">
          <p>AWS API calls made from SageMaker shared spaces do not record
              <code class="code">sourceIdentity</code> in CloudTrail logs.</p>
        </li><li class="listitem">
          <p>If AWS API calls are made from sessions that are created by users or other
            services and the sessions are not based on the Studio execution role session, then
            the <code class="code">sourceIdentity</code> is not recorded in CloudTrail logs.</p>
        </li></ul></div></div></div>
   
    <h2 id="monitor-user-access-enable">Turn on <code class="code">sourceIdentity</code></h2>
    <p>The ability to propagate the user profile name as the <code class="code">sourceIdentity</code> in
      Studio is turned off by default.</p>
    <p>To enable the ability to propagate the user profile name as the
        <code class="code">sourceIdentity</code>, use the AWS CLI during domain creation and domain update. This
      feature is enabled at the domain level and not at the user profile level.</p>
    <p> After you enable this configuration, administrators can view the user profile in the
      AWS CloudTrail log for the service accessed. The user profile is given as the
        <code class="code">sourceIdentity</code> value in the <code class="code">userIdentity</code> section. For more
      information about using AWS CloudTrail logs with SageMaker, see <a href="logging-using-cloudtrail.html">Log Amazon SageMaker
        API Calls with AWS CloudTrail</a>. </p>
    <p>You can use the following code to enable the propagation of the user profile name as the
        <code class="code">sourceIdentity</code> during domain creation using the <code class="code">create-domain</code> API. </p>
<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">
create-domain
--domain-name &lt;value&gt;
--auth-mode &lt;value&gt;
--default-user-settings &lt;value&gt;
--subnet-ids &lt;value&gt;
--vpc-id &lt;value&gt;
[--tags &lt;value&gt;]
[--app-network-access-type &lt;value&gt;]
[--home-efs-file-system-kms-key-id &lt;value&gt;]
[--kms-key-id &lt;value&gt;]
[--app-security-group-management &lt;value&gt;]
[--domain-settings "ExecutionRoleIdentityConfig=USER_PROFILE_NAME"]
[--cli-input-json &lt;value&gt;]
[--generate-cli-skeleton &lt;value&gt;]
</code></pre>
    
    <p>You can enable the propagation of the user profile name as the <code class="code">sourceIdentity</code>
      during domain update using the <code class="code">update-domain</code> API.</p>
    <p>To update this configuration, all apps in the domain must be in the <code class="code">Stopped</code>
      or <code class="code">Deleted</code> state. For more information about how to stop and shut down apps, see
        <a href="studio-tasks-update-apps.html">Shut
        down and Update Studio Apps</a>.</p>
    <p>Use the following code to enable the propagation of the user profile name as the
        <code class="code">sourceIdentity</code>.</p>
<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">
update-domain
--domain-id &lt;value&gt;
[--default-user-settings &lt;value&gt;]
[--domain-settings-for-update "ExecutionRoleIdentityConfig=USER_PROFILE_NAME"]
[--cli-input-json &lt;value&gt;]
[--generate-cli-skeleton &lt;value&gt;]
</code></pre>
   
    <h2 id="monitor-user-access-disable">Turn off <code class="code">sourceIdentity</code></h2>
<p>You can also turn off the propagation of the user profile name as the
        <code class="code">sourceIdentity</code> using the AWS CLI. This occurs during domain update by passing
        the <code class="code">ExecutionRoleIdentityConfig=DISABLED</code> value for
        the <code class="code">--domain-settings-for-update</code> parameter as part of the
        <code class="code">update-domain</code> API call.</p>
    <p>In the AWS CLI, use the following code to disable the propagation of the user profile name
      as the <code class="code">sourceIdentity</code>.</p>
<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">update-domain
 --domain-id &lt;value&gt;
[--default-user-settings &lt;value&gt;]
[--domain-settings-for-update "ExecutionRoleIdentityConfig=DISABLED"]
[--cli-input-json &lt;value&gt;]
[--generate-cli-skeleton &lt;value&gt;]</code></pre>
  <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="https://docs.aws.amazon.com/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./logging-using-cloudtrail.html">Log SageMaker API Calls with CloudTrail</div><div id="next" class="next-link" accesskey="n" href="./automating-sagemaker-with-eventbridge.html">Automating with EventBridge</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=https://docs.aws.amazon.com/en_us/sagemaker/latest/dg/monitor-user-access.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=https://docs.aws.amazon.com/en_us/sagemaker/latest/dg/monitor-user-access.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>
<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Invoke a Multi-Model Endpoint - Amazon SageMaker</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="invoke-multi-model-endpoint" /><meta name="default_state" content="invoke-multi-model-endpoint" /><link rel="icon" type="image/ico" href="../../../assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="../../../assets/images/favicon.ico" /><link rel="canonical" href="invoke-multi-model-endpoint.html" /><meta name="description" content="Invoke an Amazon SageMaker multi-model endpoint with the TargetModel parameter." /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon SageMaker" /><meta name="guide" content="Developer Guide" /><meta name="abstract" content="Use Internet Monitor to build, train, and host machine learning models in AWS." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="invoke-multi-model-endpoint.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/sagemaker/latest/dg/invoke-multi-model-endpoint.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/sagemaker/latest/dg/invoke-multi-model-endpoint.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/sagemaker/latest/dg/invoke-multi-model-endpoint.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/sagemaker/latest/dg/invoke-multi-model-endpoint.html" hreflang="de" /><link rel="alternative" href="invoke-multi-model-endpoint.html" hreflang="en-us" /><link rel="alternative" href="invoke-multi-model-endpoint.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/sagemaker/latest/dg/invoke-multi-model-endpoint.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/sagemaker/latest/dg/invoke-multi-model-endpoint.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/sagemaker/latest/dg/invoke-multi-model-endpoint.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/sagemaker/latest/dg/invoke-multi-model-endpoint.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/sagemaker/latest/dg/invoke-multi-model-endpoint.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/sagemaker/latest/dg/invoke-multi-model-endpoint.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/sagemaker/latest/dg/invoke-multi-model-endpoint.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/sagemaker/latest/dg/invoke-multi-model-endpoint.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/sagemaker/latest/dg/invoke-multi-model-endpoint.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/sagemaker/latest/dg/invoke-multi-model-endpoint.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/sagemaker/latest/dg/invoke-multi-model-endpoint.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/sagemaker/latest/dg/invoke-multi-model-endpoint.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/sagemaker/latest/dg/invoke-multi-model-endpoint.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/sagemaker/latest/dg/invoke-multi-model-endpoint.html" hreflang="zh-tw" /><link rel="alternative" href="invoke-multi-model-endpoint.html" hreflang="x-default" /><meta name="feedback-item" content="SageMaker" /><meta name="this_doc_product" content="Amazon SageMaker" /><meta name="this_doc_guide" content="Developer Guide" /><script defer="" src="../../../assets/r/vendor4.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/vendor3.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/vendor1.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/awsdocs-common.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/awsdocs-doc-page.js@version=2021.12.02"></script><link href="../../../assets/r/vendor4.css@version=2021.12.02.css" rel="stylesheet" /><link href="../../../assets/r/awsdocs-common.css@version=2021.12.02.css" rel="stylesheet" /><link href="../../../assets/r/awsdocs-doc-page.css@version=2021.12.02.css" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'sagemaker'}"></script><meta id="panorama-serviceSubSection" value="Developer Guide" /><meta id="panorama-serviceConsolePage" value="Invoke a Multi-Model Endpoint" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Invoke a Multi-Model Endpoint - Amazon SageMaker</title><meta name="pdf" content="/pdfs/sagemaker/latest/dg/sagemaker-dg.pdf#invoke-multi-model-endpoint" /><meta name="rss" content="amazon-sagemaker-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=285" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/invoke-multi-model-endpoint.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/invoke-multi-model-endpoint.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/invoke-multi-model-endpoint.html" /><meta name="keywords" content="SageMaker,Amazon SageMaker,machine learning,notebook instance,inference,deploy model,endpoint,prediction,ML application,serverless machine learning,multi model deployment,inference pipelines,ML model" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon SageMaker",
        "item" : "https://docs.aws.amazon.com/sagemaker/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Developer Guide",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Deploy models for inference",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/deploy-model.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Real-time inference",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/realtime-endpoints.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Hosting options",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/realtime-endpoints-options.html"
      },
      {
        "@type" : "ListItem",
        "position" : 7,
        "name" : "Host multiple models in one container behind one endpoint",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/multi-model-endpoints.html"
      },
      {
        "@type" : "ListItem",
        "position" : 8,
        "name" : "Invoke a Multi-Model Endpoint",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/multi-model-endpoints.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="https://docs.aws.amazon.com/pdfs/sagemaker/latest/dg/sagemaker-dg.pdf#invoke-multi-model-endpoint" target="_blank" rel="noopener noreferrer" title="Open PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="https://docs.aws.amazon.com/index.html">Documentation</a><a href="https://docs.aws.amazon.com/sagemaker/index.html">Amazon SageMaker</a><a href="whatis.html">Developer Guide</a></div><div id="page-toc-src"><a href="invoke-multi-model-endpoint.html#invoke-multi-model-config-retry">Retry Requests on ModelNotReadyException
          Errors</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="invoke-multi-model-endpoint">Invoke a Multi-Model Endpoint</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>To invoke a multi-model endpoint, use the <a href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/sagemaker-runtime.html#SageMakerRuntime.Client.invoke_endpoint" rel="noopener noreferrer" target="_blank"><span><code class="code">invoke_endpoint</code></span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> from the SageMaker Runtime just as you would invoke a single
      model endpoint, with one change. Pass a new <code class="code">TargetModel</code> parameter that specifies
      which of the models at the endpoint to target. The SageMaker Runtime <code class="code">InvokeEndpoint</code>
      request supports <code class="code">X-Amzn-SageMaker-Target-Model</code> as a new header that takes the
      relative path of the model specified for invocation. The SageMaker system constructs the absolute
      path of the model by combining the prefix that is provided as part of the
        <code class="code">CreateModel</code> API call with the relative path of the model.</p><p>The following procedures are the same for both CPU and GPU-backed multi-model endpoints.</p><awsdocs-tabs><dl style="display: none">
      <dt>AWS SDK for Python (Boto 3)</dt><dd tab-id="aws-sdk-for-python-(boto-3)">
          <p>The following example prediction request uses the <a href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/sagemaker-runtime.html" rel="noopener noreferrer" target="_blank"><span>AWS SDK for Python (Boto 3)</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> in the sample notebook.</p>
          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">response = runtime_sagemaker_client.invoke_endpoint(
                        EndpointName = <code class="replaceable">"&lt;ENDPOINT_NAME&gt;"</code>,
                        ContentType  = "text/csv",
                        TargetModel  = <code class="replaceable">"&lt;MODEL_FILENAME&gt;.tar.gz"</code>,
                        Body         = body)</code></pre>
        </dd>
      <dt>AWS CLI</dt><dd tab-id="aws-cli">
          <p> The following example shows how to make a CSV request with two rows using the AWS Command Line Interface (AWS CLI):</p>
          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="bash ">aws sagemaker-runtime invoke-endpoint \
  --endpoint-name <code class="replaceable">"&lt;ENDPOINT_NAME&gt;"</code> \
  --body <code class="replaceable">"1.0,2.0,5.0"$'\n'"2.0,3.0,4.0"</code> \
  --content-type "text/csv" \
  --target-model <code class="replaceable">"&lt;MODEL_NAME&gt;.tar.gz"</code>
  output_file.txt
</code></pre>
          <p>An <code>output_file.txt</code> with information about your inference requests is 
            made if the inference was successful. For more examples on how to make predictions with the 
            AWS CLI, see 
            <a href="https://sagemaker.readthedocs.io/en/stable/frameworks/tensorflow/deploying_tensorflow_serving.html#making-predictions-with-the-aws-cli" rel="noopener noreferrer" target="_blank"><span>Making predictions with the AWS CLI</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> 
            in the SageMaker Python SDK documentation.</p>
        </dd>
    </dl></awsdocs-tabs><p>The multi-model endpoint dynamically loads target models as needed. You can observe this
      when running the <a href="https://sagemaker-examples.readthedocs.io/en/latest/advanced_functionality/multi_model_xgboost_home_value/xgboost_multi_model_endpoint_home_value.html" rel="noopener noreferrer" target="_blank"><span>MME Sample Notebook</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> as it iterates through random invocations against multiple
      target models hosted behind a single endpoint. The first request against a given model takes
      longer because the model has to be downloaded from Amazon Simple Storage Service (Amazon S3) and loaded into memory.
      This is called a <em>cold start</em>, and it is expected on multi-model endpoints to optimize for better price performance for customers.
      Subsequent calls finish faster because there's no additional
      overhead after the model has loaded.</p><div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>For GPU backed instances, the HTTP response code with 507 from the GPU container indicates a lack of memory or other resources.
      This causes unused models to be unloaded from the container in order to load more frequently used models.</p></div></div>
      <h2 id="invoke-multi-model-config-retry">Retry Requests on ModelNotReadyException
          Errors</h2>
      <p>The first time you call <code class="code">invoke_endpoint</code> for a model, the model is
        downloaded from Amazon Simple Storage Service and loaded into the inference container. This makes the first call
        take longer to return. Subsequent calls to the same model finish faster, because the model
        is already loaded.</p>
      <p>SageMaker returns a response for a call to <code class="code">invoke_endpoint</code> within 60 seconds.
        Some models are too large to download within 60 seconds. If the model does not finish
        loading before the 60 second timeout limit, the request to <code class="code">invoke_endpoint</code>
        returns with the error code <code class="code">ModelNotReadyException</code>, and the model continues to
        download and load into the inference container for up to 360 seconds. If you get a
          <code class="code">ModelNotReadyException</code> error code for an <code class="code">invoke_endpoint</code>
        request, retry the request. By default, the AWS SDKs for Python (Boto 3) (using <a href="https://boto3.amazonaws.com/v1/documentation/api/latest/guide/retries.html#legacy-retry-mode" rel="noopener noreferrer" target="_blank"><span>Legacy retry mode</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>) and Java retry <code class="code">invoke_endpoint</code> requests that
        result in <code class="code">ModelNotReadyException</code> errors. You can configure the retry strategy
        to continue retrying the request for up to 360 seconds. If you expect your model to take
        longer than 60 seconds to download and load into the container, set the SDK socket timeout
        to 70 seconds. For more information about configuring the retry strategy for the AWS SDK for Python (Boto3), see
          <a href="https://boto3.amazonaws.com/v1/documentation/api/latest/guide/retries.html#configuring-a-retry-mode" rel="noopener noreferrer" target="_blank"><span>Configuring a retry mode</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>. The following code shows an example that configures the
        retry strategy to retry calls to <code class="code">invoke_endpoint</code> for up to 180 seconds.</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python ">import boto3
from botocore.config import Config

# This example retry strategy sets the retry attempts to 2. 
# With this setting, the request can attempt to download and/or load the model 
# for upto 180 seconds: 1 orginal request (60 seconds) + 2 retries (120 seconds)
config = Config(
    read_timeout=70,
    retries=<span>{</span>
        'max_attempts': 2  # This value can be adjusted to 5 to go up to the 360s max timeout
    }
)
runtime_sagemaker_client = boto3.client('sagemaker-runtime', config=config)</code></pre>
    <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="https://docs.aws.amazon.com/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./create-multi-model-endpoint.html">Create
        a Multi-Model Endpoint</div><div id="next" class="next-link" accesskey="n" href="./add-models-to-endpoint.html">Add or Remove Models</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=https://docs.aws.amazon.com/en_us/sagemaker/latest/dg/invoke-multi-model-endpoint.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=https://docs.aws.amazon.com/en_us/sagemaker/latest/dg/invoke-multi-model-endpoint.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>
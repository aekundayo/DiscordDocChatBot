<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Capture data from real-time endpoint - Amazon SageMaker</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="model-monitor-data-capture-endpoint" /><meta name="default_state" content="model-monitor-data-capture-endpoint" /><link rel="icon" type="image/ico" href="../../../assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="../../../assets/images/favicon.ico" /><link rel="canonical" href="model-monitor-data-capture-endpoint.html" /><meta name="description" content="How to capture data with Amazon SageMaker Model Monitor." /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon SageMaker" /><meta name="guide" content="Developer Guide" /><meta name="abstract" content="Use Internet Monitor to build, train, and host machine learning models in AWS." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="model-monitor-data-capture-endpoint.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/sagemaker/latest/dg/model-monitor-data-capture-endpoint.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/sagemaker/latest/dg/model-monitor-data-capture-endpoint.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/sagemaker/latest/dg/model-monitor-data-capture-endpoint.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/sagemaker/latest/dg/model-monitor-data-capture-endpoint.html" hreflang="de" /><link rel="alternative" href="model-monitor-data-capture-endpoint.html" hreflang="en-us" /><link rel="alternative" href="model-monitor-data-capture-endpoint.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/sagemaker/latest/dg/model-monitor-data-capture-endpoint.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/sagemaker/latest/dg/model-monitor-data-capture-endpoint.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/sagemaker/latest/dg/model-monitor-data-capture-endpoint.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/sagemaker/latest/dg/model-monitor-data-capture-endpoint.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/sagemaker/latest/dg/model-monitor-data-capture-endpoint.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/sagemaker/latest/dg/model-monitor-data-capture-endpoint.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/sagemaker/latest/dg/model-monitor-data-capture-endpoint.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/sagemaker/latest/dg/model-monitor-data-capture-endpoint.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/sagemaker/latest/dg/model-monitor-data-capture-endpoint.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/sagemaker/latest/dg/model-monitor-data-capture-endpoint.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/sagemaker/latest/dg/model-monitor-data-capture-endpoint.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/sagemaker/latest/dg/model-monitor-data-capture-endpoint.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/sagemaker/latest/dg/model-monitor-data-capture-endpoint.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/sagemaker/latest/dg/model-monitor-data-capture-endpoint.html" hreflang="zh-tw" /><link rel="alternative" href="model-monitor-data-capture-endpoint.html" hreflang="x-default" /><meta name="feedback-item" content="SageMaker" /><meta name="this_doc_product" content="Amazon SageMaker" /><meta name="this_doc_guide" content="Developer Guide" /><script defer="" src="../../../assets/r/vendor4.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/vendor3.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/vendor1.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/awsdocs-common.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/awsdocs-doc-page.js@version=2021.12.02"></script><link href="../../../assets/r/vendor4.css@version=2021.12.02.css" rel="stylesheet" /><link href="../../../assets/r/awsdocs-common.css@version=2021.12.02.css" rel="stylesheet" /><link href="../../../assets/r/awsdocs-doc-page.css@version=2021.12.02.css" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'sagemaker'}"></script><meta id="panorama-serviceSubSection" value="Developer Guide" /><meta id="panorama-serviceConsolePage" value="Capture data from real-time endpoint" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Capture data from real-time endpoint - Amazon SageMaker</title><meta name="pdf" content="/pdfs/sagemaker/latest/dg/sagemaker-dg.pdf#model-monitor-data-capture-endpoint" /><meta name="rss" content="amazon-sagemaker-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=285" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/model-monitor-data-capture-endpoint.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/model-monitor-data-capture-endpoint.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/model-monitor-data-capture-endpoint.html" /><meta name="keywords" content="SageMaker,Amazon SageMaker,machine learning,notebook instance" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon SageMaker",
        "item" : "https://docs.aws.amazon.com/sagemaker/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Developer Guide",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Monitor data and model quality",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/model-monitor.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Capture data",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/model-monitor-data-capture.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Capture data from real-time endpoint",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/model-monitor-data-capture.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="https://docs.aws.amazon.com/pdfs/sagemaker/latest/dg/sagemaker-dg.pdf#model-monitor-data-capture-endpoint" target="_blank" rel="noopener noreferrer" title="Open PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="https://docs.aws.amazon.com/index.html">Documentation</a><a href="https://docs.aws.amazon.com/sagemaker/index.html">Amazon SageMaker</a><a href="whatis.html">Developer Guide</a></div><div id="page-toc-src"><a href="model-monitor-data-capture-endpoint.html#model-monitor-data-capture-defing.title">How to enable data capture</a><a href="model-monitor-data-capture-endpoint.html#model-monitor-data-capture-deploy">Deploy your model</a><a href="model-monitor-data-capture-endpoint.html#model-monitor-data-capture-view">View Captured Data</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="model-monitor-data-capture-endpoint">Capture data from real-time
                    endpoint</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>To prevent impact to inference requests, Data Capture stops capturing requests
                    at high levels of disk usage. It is recommended you keep your disk utilization
                    below 75% in order to ensure data capture continues capturing requests.</p></div></div><p>To capture data for your real-time endpoint, you must deploy a model using SageMaker
                hosting services. This requires that you create a SageMaker model, define an endpoint
                configuration, and create an HTTPS endpoint.</p><p>The steps required to turn on data capture are similar whether you use the
                AWS SDK for Python (Boto) or the SageMaker Python SDK. If you use the AWS SDK, define the <a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_DataCaptureConfig.html">DataCaptureConfig</a> dictionary, along with required fields, within the
                    <a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_CreateEndpointConfig.html">CreateEndpointConfig</a> method to turn on data capture. If you use the
                SageMaker Python SDK, import the <a href="https://sagemaker.readthedocs.io/en/stable/api/inference/model_monitor.html#sagemaker.model_monitor.data_capture_config.DataCaptureConfig" rel="noopener noreferrer" target="_blank"><span>DataCaptureConfig</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> Class and initialize an instance from this class.
                Then, pass this object to the <code class="code">DataCaptureConfig</code> parameter in the
                    <code class="code">sagemaker.model.Model.deploy()</code> method.</p><p>To use the proceeding code snippets, replace the <code class="replaceable">italicized
                    placeholder text</code> in the example code with your own
                information.</p>
                <h2 id="model-monitor-data-capture-defing.title">How to enable data capture</h2>
                <p>Specify a data capture configuration. You can capture the request payload, the
                    response payload, or both with this configuration. The proceeding code snippet
                    demonstrates how to enable data capture using the AWS SDK for Python (Boto) and the SageMaker
                    Python SDK.</p>
                <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>You do not need to use Model Monitor to capture request or response
                        payloads.</p></div></div>
                <awsdocs-tabs><dl style="display: none">
                    <dt>AWS SDK for Python (Boto)</dt><dd tab-id="aws-sdk-for-python-(boto)">
                            <p>Configure the data you want to capture with the <a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_DataCaptureConfig.html">DataCaptureConfig</a> dictionary when you create an
                                endpoint using the <code class="code">CreateEndpointConfig</code> method. Set
                                    <code class="code">EnableCapture</code> to the boolean value True. In
                                addition, provide the following mandatory parameters:</p>
                            <div class="itemizedlist">
                                 
                                 
                                 
                            <ul class="itemizedlist"><li class="listitem">
                                    <p><code class="code">EndpointConfigName</code>: the name of your endpoint
                                        configuration. You will use this name when you make a
                                            <code class="code">CreateEndpoint</code> request.</p>
                                </li><li class="listitem">
                                    <p><code class="code">ProductionVariants</code>: a list of models you want
                                        to host at this endpoint. Define a dictionary data type for
                                        each model.</p>
                                </li><li class="listitem">
                                    <p><code class="code">DataCaptureConfig</code>: dictionary data type where
                                        you specify an integer value that corresponds to the initial
                                        percentage of data to sample
                                            (<code class="code">InitialSamplingPercentage</code>), the Amazon S3 URI
                                        where you want captured data to be stored, and a capture
                                        options (<code class="code">CaptureOptions</code>) list. Specify either
                                            <code class="code">Input</code> or <code class="code">Output</code> for
                                            <code class="code">CaptureMode</code> within the
                                            <code class="code">CaptureOptions</code> list. </p>
                                </li></ul></div>
                            <p>You can optionally specify how SageMaker should encode captured data by
                                passing key-value pair arguments to the
                                    <code class="code">CaptureContentTypeHeader</code> dictionary.</p>
                            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python "># Create an endpoint config name.
endpoint_config_name = <code class="replaceable">'&lt;endpoint-config-name&gt;'</code>

# The name of the production variant.
variant_name = <code class="replaceable">'&lt;name-of-production-variant&gt;'</code>                   
  
# The name of the model that you want to host. 
# This is the name that you specified when creating the model.
model_name = <code class="replaceable">'&lt;The_name_of_your_model&gt;'</code>

instance_type = <code class="replaceable">'&lt;instance-type&gt;'</code>
#instance_type='ml.m5.xlarge' # Example    

# Number of instances to launch initially.
initial_instance_count = <code class="replaceable">&lt;integer&gt;</code>

# Sampling percentage. Choose an integer value between 0 and 100
initial_sampling_percentage = <code class="replaceable">&lt;integer&gt;</code>                                                                                                                                                                                                                        

# The S3 URI containing the captured data
s3_capture_upload_path = 's3://<code class="replaceable">&lt;bucket-name&gt;/&lt;data_capture_s3_key&gt;</code>'

# Specify either Input, Output, or both
capture_modes = [ "Input",  "Output" ] 
#capture_mode = [ "Input"] # Example - If you want to capture input only
                            
endpoint_config_response = sagemaker_client.create_endpoint_config(
    EndpointConfigName=endpoint_config_name, 
    # List of ProductionVariant objects, one for each model that you want to host at this endpoint.
    ProductionVariants=[
        <span>{</span>
            "VariantName": variant_name, 
            "ModelName": model_name, 
            "InstanceType": instance_type, # Specify the compute instance type.
            "InitialInstanceCount": initial_instance_count # Number of instances to launch initially.
        }
    ],
    DataCaptureConfig= <span>{</span>
        'EnableCapture': True, # Whether data should be captured or not.
        'InitialSamplingPercentage' : initial_sampling_percentage,
        'DestinationS3Uri': s3_capture_upload_path,
        'CaptureOptions': [<span>{</span>"CaptureMode" : capture_mode} for capture_mode in capture_modes] # Example - Use list comprehension to capture both Input and Output
    }
)

</code></pre>
                            <p>For more information about other endpoint configuration options,
                                see the <a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_CreateEndpointConfig.html">CreateEndpointConfig</a> API in the <a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_Operations_Amazon_SageMaker_Service.html">Amazon SageMaker Service API Reference Guide</a>.</p>
                        </dd>
                    <dt>SageMaker Python SDK</dt><dd tab-id="sagemaker-python-sdk">
                            <p>Import the <code class="code">DataCaptureConfig</code> Class from <a href="https://sagemaker.readthedocs.io/en/stable/api/inference/model_monitor.html" rel="noopener noreferrer" target="_blank"><span>sagemaker.model_monitor</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> module. Enable data capture by
                                setting <code class="code">EnableCapture</code> to the boolean value
                                    <code class="code">True</code>.</p>
                            <p>Optionally provide arguments for the following parameters:</p>
                            <div class="itemizedlist">
                                 
                                 
                            <ul class="itemizedlist"><li class="listitem">
                                    <p><code class="code">SamplingPercentage</code>: an integer value that
                                        corresponds to percentage of data to sample. If you do not
                                        provide a sampling percentage, SageMaker will sample a default of
                                        20 (20%) of your data.</p>
                                </li><li class="listitem">
                                    <p><code class="code">DestinationS3Uri</code>: the Amazon S3 URI SageMaker will use
                                        to store captured data. If you do not provide one, SageMaker will
                                        store captured data in
                                            <code>"s3://&lt;default-session-bucket&gt;/
                                            model-monitor/data-capture"</code>.</p>
                                </li></ul></div>
                            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python ">from sagemaker.model_monitor import DataCaptureConfig

# Set to True to enable data capture
enable_capture = True

# Optional - Sampling percentage. Choose an integer value between 0 and 100
sampling_percentage = <code class="replaceable">&lt;int&gt;</code> 
# sampling_percentage = 30 # Example 30%

# Optional - The S3 URI of stored captured-data location
s3_capture_upload_path = <code class="replaceable">'s3://&lt;bucket-name&gt;/&lt;data_capture_s3_key&gt;'</code>

# Specify either Input, Output or both. 
capture_modes = ['REQUEST','RESPONSE'] # In this example, we specify both
# capture_mode = ['REQUEST'] # Example - If you want to only capture input.

# Configuration object passed in when deploying Models to SM endpoints
data_capture_config = DataCaptureConfig(
    enable_capture = enable_capture, 
    sampling_percentage = sampling_percentage, # Optional
    destination_s3_uri = s3_capture_upload_path, # Optional
    capture_options = ["REQUEST", "RESPONSE"],
)</code></pre>
                        </dd>
                </dl></awsdocs-tabs>
             
                <h2 id="model-monitor-data-capture-deploy">Deploy your model</h2>
                <p>Deploy your model and create an HTTPS endpoint with <code class="code">DataCapture</code>
                    enabled.</p>
                <awsdocs-tabs><dl style="display: none">
                    <dt>AWS SDK for Python (Boto3)</dt><dd tab-id="aws-sdk-for-python-(boto3)">
                            <p>Provide the endpoint configuration to SageMaker. The service launches
                                the ML compute instances and deploys the model or models as
                                specified in the configuration.</p>
                            <p>Once you have your model and endpoint configuration, use the
                                    <a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_CreateEndpoint.html"><code class="code">CreateEndpoint</code></a> API to create your
                                endpoint. The endpoint name must be unique within an AWS Region in
                                your AWS account. </p>
                            <p>The following creates an endpoint using the endpoint configuration
                                specified in the request. Amazon SageMaker uses the endpoint to provision
                                resources and deploy models.</p>
                            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python "># The name of the endpoint. The name must be unique within an AWS Region in your AWS account.
endpoint_name = <code class="replaceable">'&lt;endpoint-name&gt;'</code> 

# The name of the endpoint configuration associated with this endpoint.
endpoint_config_name=<code class="replaceable">'&lt;endpoint-config-name&gt;'</code>

create_endpoint_response = sagemaker_client.create_endpoint(
                                            EndpointName=endpoint_name, 
                                            EndpointConfigName=endpoint_config_name) 
</code></pre>
                            <p>For more information, see the <a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_CreateEndpoint.html"><code class="code">CreateEndpoint</code></a> API.</p>
                        </dd>
                    <dt>SageMaker Python SDK</dt><dd tab-id="sagemaker-python-sdk">
                            <p>Define a name for your endpoint. This step is optional. If you do
                                not provide one, SageMaker will create a unique name for you:</p>
                            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python ">from datetime import datetime

endpoint_name = f"DEMO-<span>{</span>datetime.utcnow():%Y-%m-%d-%H%M}"
print("EndpointName =", endpoint_name)</code></pre>
                            <p>Deploy your model to a real-time, HTTPS endpoint with the Model
                                object’s built-in <code class="code">deploy()</code> method. Provide the name of
                                the Amazon EC2 instance type to deploy this model to in the
                                    <code class="code">instance_type</code> field along with the initial number
                                of instances to run the endpoint on for the
                                    <code class="code">initial_instance_count</code> field:</p>
                            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python ">initial_instance_count=<code class="replaceable">&lt;integer&gt;</code>
# initial_instance_count=1 # Example

instance_type=<code class="code" copy="true">'&lt;instance-type&gt;'</code>
# instance_type='ml.m4.xlarge' # Example

# Uncomment if you did not define this variable in the previous step
#data_capture_config = <code class="replaceable">&lt;name-of-data-capture-configuration&gt;</code>

model.deploy(
    initial_instance_count=initial_instance_count,
    instance_type=instance_type,
    endpoint_name=endpoint_name,
    data_capture_config=data_capture_config
)</code></pre>
                            
                        </dd>
                </dl></awsdocs-tabs>
             
                <h2 id="model-monitor-data-capture-view">View Captured Data</h2>
                <p>Create a predictor object from the SageMaker Python SDK <a href="https://sagemaker.readthedocs.io/en/stable/api/inference/predictors.html" rel="noopener noreferrer" target="_blank"><span>Predictor</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> Class. You will use the object returned by the
                        <code class="code">Predictor</code> Class to invoke your endpoint in a future step.
                    Provide the name of your endpoint (defined earlier as
                    <code class="code">endpoint_name</code>), along with serializer and deserializer objects for
                    the serializer and deserializer, respectively. For information about serializer
                    types, see the <a href="https://sagemaker.readthedocs.io/en/stable/api/inference/serializers.html" rel="noopener noreferrer" target="_blank"><span>Serializers</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> Class in the <a href="https://sagemaker.readthedocs.io/en/stable/index.html" rel="noopener noreferrer" target="_blank"><span>SageMaker Python
                        SDK</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python ">from sagemaker.predictor import Predictor
from sagemaker.serializers import <code class="replaceable">&lt;Serializer&gt;</code>
from sagemaker.deserializers import <code class="replaceable">&lt;Deserializers&gt;</code>

predictor = Predictor(endpoint_name=endpoint_name,
                      serializer = <code class="replaceable">&lt;Serializer_Class&gt;</code>,
                      deserializer = <code class="replaceable">&lt;Deserializer_Class&gt;</code>)

# Example
#from sagemaker.predictor import Predictor
#from sagemaker.serializers import CSVSerializer
#from sagemaker.deserializers import JSONDeserializer

#predictor = Predictor(endpoint_name=endpoint_name,
#                      serializer=CSVSerializer(),
#                      deserializer=JSONDeserializer())</code></pre>
                <p>In the proceeding code example scenario we invoke the endpoint with sample
                    validation data that we have stored locally in a CSV file named
                        <code>validation_with_predictions</code>. Our sample validation set
                    contains labels for each input.</p>
                <p>The first few lines of the with statement first opens the validation set CSV
                    file, then splits each row within the file by the comma character
                        <code class="code">","</code>, and then stores the two returned objects into a label and
                    input_cols variables. For each row, the input (<code class="code">input_cols</code>) is
                    passed to the predictor variable's (<code class="code">predictor</code>) objects built-in
                    method <code class="code">Predictor.predict()</code>.</p>
                <p>Suppose the model returns a probability. Probabilities range between integer
                    values of 0 and 1.0. If the probability returned by the model is greater than
                    80% (0.8) we assign the prediction an integer value label of 1. Otherwise, we
                    assign the prediction an integer value label of 0.</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python ">from time import sleep

validate_dataset = "validation_with_predictions.csv"

# Cut off threshold of 80%
cutoff = 0.8

limit = 200  # Need at least 200 samples to compute standard deviations
i = 0
with open(f"test_data/<span>{</span>validate_dataset}", "w") as validation_file:
    validation_file.write("probability,prediction,label\n")  # CSV header
    with open("test_data/validation.csv", "r") as f:
        for row in f:
            (label, input_cols) = row.split(",", 1)
            probability = float(predictor.predict(input_cols))
            prediction = "1" if probability &gt; cutoff else "0"
            baseline_file.write(f"<span>{</span>probability},<span>{</span>prediction},<span>{</span>label}\n")
            i += 1
            if i &gt; limit:
                break
            print(".", end="", flush=True)
            sleep(0.5)
print()
print("Done!")</code></pre>
                <p>Because you enabled the data capture in the previous steps, the request and
                    response payload, along with some additional meta data, is saved in the Amazon S3
                    location that you specified in <code class="code">DataCaptureConfig</code>. The delivery of
                    capture data to Amazon S3 can require a couple of minutes.</p>
                <p>View captured data by listing the data capture files stored in Amazon S3. The
                    format of the Amazon S3 path is:
                            <code>s3:///<code class="replaceable"><span>{</span>endpoint-name}/<span>{</span>variant-name}/yyyy/mm/dd/hh/filename</code>.jsonl</code>.</p>
                <p>Expect to see different files from different time periods, organized based on
                    the hour when the invocation occurred. Run the following to print out the
                    contents of a single capture file:</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python ">print("\n".join(capture_file[-3:-1]))</code></pre>
                <p>This will return a SageMaker specific JSON-line formatted file. The following is a
                    response sample taken from a real-time endpoint that we invoked using
                        <code class="code">csv/text</code> data:</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python "><span>{</span>"captureData":<span>{</span>"endpointInput":<span>{</span>"observedContentType":"text/csv","mode":"INPUT",
"data":"69,0,153.7,109,194.0,105,256.1,114,14.1,6,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,1,0\n",
"encoding":"CSV"},"endpointOutput":<span>{</span>"observedContentType":"text/csv; charset=utf-8","mode":"OUTPUT","data":"0.0254181120544672","encoding":"CSV"}},
"eventMetadata":<span>{</span>"eventId":"aaaaaaaa-bbbb-cccc-dddd-eeeeeeeeeeee","inferenceTime":"2022-02-14T17:25:49Z"},"eventVersion":"0"}
<span>{</span>"captureData":<span>{</span>"endpointInput":<span>{</span>"observedContentType":"text/csv","mode":"INPUT",
"data":"94,23,197.1,125,214.5,136,282.2,103,9.5,5,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,1\n",
"encoding":"CSV"},"endpointOutput":<span>{</span>"observedContentType":"text/csv; charset=utf-8","mode":"OUTPUT","data":"0.07675473392009735","encoding":"CSV"}},
"eventMetadata":<span>{</span>"eventId":"aaaaaaaa-bbbb-cccc-dddd-eeeeeeeeeeee","inferenceTime":"2022-02-14T17:25:49Z"},"eventVersion":"0"}</code></pre>
                <p>In the proceeding example, the <code class="code">capture_file</code> object is a list
                    type. Index the first element of the list to view a single inference
                    request.</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python "># The capture_file object is a list. Index the first element to view a single inference request  
print(json.dumps(json.loads(capture_file[0]), indent=2))</code></pre>
                <p>This will return a response similar to the following. The values returned will
                    differ based on your endpoint configuration, SageMaker model, and captured
                    data:</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python "><span>{</span>
  "captureData": <span>{</span>
    "endpointInput": <span>{</span>
      "observedContentType": "text/csv", # data MIME type
      "mode": "INPUT",
      "data": "50,0,188.9,94,203.9,104,151.8,124,11.6,8,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,1,0,1,0\n",
      "encoding": "CSV"
    },
    "endpointOutput": <span>{</span>
      "observedContentType": "text/csv; charset=character-encoding",
      "mode": "OUTPUT",
      "data": "0.023190177977085114",
      "encoding": "CSV"
    }
  },
  "eventMetadata": <span>{</span>
    "eventId": "aaaaaaaa-bbbb-cccc-dddd-eeeeeeeeeeee",
    "inferenceTime": "2022-02-14T17:25:06Z"
  },
  "eventVersion": "0"
}</code></pre>
            <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="https://docs.aws.amazon.com/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./model-monitor-data-capture.html">Capture data</div><div id="next" class="next-link" accesskey="n" href="./model-monitor-data-capture-batch.html">Capture data from batch transform job</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=https://docs.aws.amazon.com/en_us/sagemaker/latest/dg/model-monitor-data-capture-endpoint.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=https://docs.aws.amazon.com/en_us/sagemaker/latest/dg/model-monitor-data-capture-endpoint.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>
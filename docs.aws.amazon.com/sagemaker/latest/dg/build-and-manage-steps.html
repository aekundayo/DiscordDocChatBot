<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Pipeline Steps - Amazon SageMaker</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="build-and-manage-steps" /><meta name="default_state" content="build-and-manage-steps" /><link rel="icon" type="image/ico" href="../../../assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="../../../assets/images/favicon.ico" /><link rel="canonical" href="build-and-manage-steps.html" /><meta name="description" content="Describes the step types in Amazon SageMaker Model Building Pipelines." /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon SageMaker" /><meta name="guide" content="Developer Guide" /><meta name="abstract" content="Use Internet Monitor to build, train, and host machine learning models in AWS." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="build-and-manage-steps.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/sagemaker/latest/dg/build-and-manage-steps.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/sagemaker/latest/dg/build-and-manage-steps.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/sagemaker/latest/dg/build-and-manage-steps.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/sagemaker/latest/dg/build-and-manage-steps.html" hreflang="de" /><link rel="alternative" href="build-and-manage-steps.html" hreflang="en-us" /><link rel="alternative" href="build-and-manage-steps.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/sagemaker/latest/dg/build-and-manage-steps.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/sagemaker/latest/dg/build-and-manage-steps.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/sagemaker/latest/dg/build-and-manage-steps.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/sagemaker/latest/dg/build-and-manage-steps.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/sagemaker/latest/dg/build-and-manage-steps.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/sagemaker/latest/dg/build-and-manage-steps.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/sagemaker/latest/dg/build-and-manage-steps.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/sagemaker/latest/dg/build-and-manage-steps.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/sagemaker/latest/dg/build-and-manage-steps.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/sagemaker/latest/dg/build-and-manage-steps.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/sagemaker/latest/dg/build-and-manage-steps.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/sagemaker/latest/dg/build-and-manage-steps.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/sagemaker/latest/dg/build-and-manage-steps.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/sagemaker/latest/dg/build-and-manage-steps.html" hreflang="zh-tw" /><link rel="alternative" href="build-and-manage-steps.html" hreflang="x-default" /><meta name="feedback-item" content="SageMaker" /><meta name="this_doc_product" content="Amazon SageMaker" /><meta name="this_doc_guide" content="Developer Guide" /><script defer="" src="../../../assets/r/vendor4.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/vendor3.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/vendor1.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/awsdocs-common.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/awsdocs-doc-page.js@version=2021.12.02"></script><link href="../../../assets/r/vendor4.css@version=2021.12.02.css" rel="stylesheet" /><link href="../../../assets/r/awsdocs-common.css@version=2021.12.02.css" rel="stylesheet" /><link href="../../../assets/r/awsdocs-doc-page.css@version=2021.12.02.css" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'sagemaker'}"></script><meta id="panorama-serviceSubSection" value="Developer Guide" /><meta id="panorama-serviceConsolePage" value="Pipeline Steps" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Pipeline Steps - Amazon SageMaker</title><meta name="pdf" content="/pdfs/sagemaker/latest/dg/sagemaker-dg.pdf#build-and-manage-steps" /><meta name="rss" content="amazon-sagemaker-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=285" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/build-and-manage-steps.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/build-and-manage-steps.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/build-and-manage-steps.html" /><meta name="keywords" content="SageMaker,Amazon SageMaker,machine learning,notebook instance" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon SageMaker",
        "item" : "https://docs.aws.amazon.com/sagemaker/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Developer Guide",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Implement MLOps",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/mlops.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "SageMaker Workflows",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/workflows.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Amazon SageMaker Model Building Pipelines",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/pipelines.html"
      },
      {
        "@type" : "ListItem",
        "position" : 7,
        "name" : "SageMaker Pipelines Overview",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/pipelines-sdk.html"
      },
      {
        "@type" : "ListItem",
        "position" : 8,
        "name" : "Pipeline Steps",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/pipelines-sdk.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="https://docs.aws.amazon.com/pdfs/sagemaker/latest/dg/sagemaker-dg.pdf#build-and-manage-steps" target="_blank" rel="noopener noreferrer" title="Open PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="https://docs.aws.amazon.com/index.html">Documentation</a><a href="https://docs.aws.amazon.com/sagemaker/index.html">Amazon SageMaker</a><a href="whatis.html">Developer Guide</a></div><div id="page-toc-src"><a href="build-and-manage-steps.html#build-and-manage-steps-types">Step Types</a><a href="build-and-manage-steps.html#build-and-manage-properties">Step Properties</a><a href="build-and-manage-steps.html#build-and-manage-parallelism">Step Parallelism</a><a href="build-and-manage-steps.html#build-and-manage-data-dependency">Data Dependency Between Steps</a><a href="build-and-manage-steps.html#build-and-manage-custom-dependency">Custom Dependency Between Steps</a><a href="build-and-manage-steps.html#build-and-manage-images">Use a Custom Image in a Step</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="build-and-manage-steps">Pipeline Steps</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>SageMaker Pipelines are composed of steps. These steps define the actions that the pipeline takes and the
    relationships between steps using properties.</p><div class="highlights" id="inline-topiclist"><h6>Topics</h6><ul><li><a href="build-and-manage-steps.html#build-and-manage-steps-types">Step Types</a></li><li><a href="build-and-manage-steps.html#build-and-manage-properties">Step Properties</a></li><li><a href="build-and-manage-steps.html#build-and-manage-parallelism">Step Parallelism</a></li><li><a href="build-and-manage-steps.html#build-and-manage-data-dependency">Data Dependency Between Steps</a></li><li><a href="build-and-manage-steps.html#build-and-manage-custom-dependency">Custom Dependency Between Steps</a></li><li><a href="build-and-manage-steps.html#build-and-manage-images">Use a Custom Image in a Step</a></li></ul></div>
    <h2 id="build-and-manage-steps-types">Step Types</h2>
    <p>The following describes the requirements of each step type and provides an example
      implementation of the step. These are not functional implementations because they don't
      provide the resource and inputs needed. For a tutorial that implements these steps, see <a href="pipelines-build.html">Create and Manage SageMaker Pipelines</a>.</p>
    <p>Amazon SageMaker Model Building Pipelines support the following step types:</p>
    <div class="itemizedlist">
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
    <ul class="itemizedlist"><li class="listitem">
        <p><a href="build-and-manage-steps.html#step-type-processing">Processing</a></p>
      </li><li class="listitem">
        <p><a href="build-and-manage-steps.html#step-type-training">Training</a></p>
      </li><li class="listitem">
        <p><a href="build-and-manage-steps.html#step-type-tuning">Tuning</a></p>
      </li><li class="listitem">
        <p><a href="build-and-manage-steps.html#step-type-automl">AutoML</a></p>
      </li><li class="listitem">
        <p><a href="build-and-manage-steps.html#step-type-model">Model</a></p>
      </li><li class="listitem">
        <p><a href="build-and-manage-steps.html#step-type-create-model">CreateModel</a></p>
      </li><li class="listitem">
        <p><a href="build-and-manage-steps.html#step-type-register-model">RegisterModel</a></p>
      </li><li class="listitem">
        <p><a href="build-and-manage-steps.html#step-type-transform">Transform</a></p>
      </li><li class="listitem">
        <p><a href="build-and-manage-steps.html#step-type-condition">Condition</a></p>
      </li><li class="listitem">
        <p><a href="build-and-manage-steps.html#step-type-callback">Callback</a></p>
      </li><li class="listitem">
        <p><a href="build-and-manage-steps.html#step-type-lambda">Lambda</a></p>
      </li><li class="listitem">
        <p><a href="build-and-manage-steps.html#step-type-clarify-check">ClarifyCheck</a></p>
      </li><li class="listitem">
        <p><a href="build-and-manage-steps.html#step-type-quality-check">QualityCheck</a></p>
      </li><li class="listitem">
        <p><a href="build-and-manage-steps.html#step-type-emr">EMR</a></p>
      </li><li class="listitem">
        
        <p><a href="build-and-manage-steps.html#step-type-fail">Fail</a></p>
      </li></ul></div>

     
      <h3 id="step-type-processing">Processing Step</h3>
      <p>Use a processing step to create a processing job for data processing. For more
        information on processing jobs, see <a href="processing-job.html">Process Data and
          Evaluate Models</a>.</p>
      <p>A processing step requires a processor, a Python script that defines the processing
        code, outputs for processing, and job arguments. The following example shows how to create a
          <code class="code">ProcessingStep</code> definition. </p>

      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python ">from sagemaker.sklearn.processing import SKLearnProcessor

sklearn_processor = SKLearnProcessor(framework_version='1.0-1',
                                     role=<code class="replaceable">&lt;role&gt;</code>,
                                     instance_type='ml.m5.xlarge',
                                     instance_count=1)</code></pre>

      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python ">from sagemaker.processing import ProcessingInput, ProcessingOutput
from sagemaker.workflow.steps import ProcessingStep

inputs = [
    ProcessingInput(source=<code class="replaceable">&lt;input_data&gt;</code>, destination="/opt/ml/processing/input"),
]

outputs = [
    ProcessingOutput(output_name="train", source="/opt/ml/processing/train"),
    ProcessingOutput(output_name="validation", source="/opt/ml/processing/validation"),
    ProcessingOutput(output_name="test", source="/opt/ml/processing/test")
]

step_process = ProcessingStep(
    name="AbaloneProcess",
    step_args = sklearn_processor.run(inputs=inputs, outputs=outputs,
        code="abalone/preprocessing.py")
)</code></pre>

      
      <p><b>Pass runtime parameters</b></p>
      <p>The following example shows how to pass runtime parameters from a PySpark processor to a
          <code class="code">ProcessingStep</code>.</p>

      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python ">from sagemaker.workflow.pipeline_context import PipelineSession
from sagemaker.spark.processing import PySparkProcessor
from sagemaker.processing import ProcessingInput, ProcessingOutput
from sagemaker.workflow.steps import ProcessingStep

pipeline_session = PipelineSession()

pyspark_processor = PySparkProcessor(
    framework_version='2.4',
    role=<code class="replaceable">&lt;role&gt;</code>,
    instance_type='ml.m5.xlarge',
    instance_count=1,
    sagemaker_session=pipeline_session,
)

step_args = pyspark_processor.run(
    inputs=[ProcessingInput(source=<code class="replaceable">&lt;input_data&gt;</code>, destination="/opt/ml/processing/input"),],
    outputs=[
        ProcessingOutput(output_name="train", source="/opt/ml/processing/train"),
        ProcessingOutput(output_name="validation", source="/opt/ml/processing/validation"),
        ProcessingOutput(output_name="test", source="/opt/ml/processing/test")
    ],
    code="preprocess.py",
    arguments=None,
)


step_process = ProcessingStep(
    name="AbaloneProcess",
    step_args=step_args,
)</code></pre>
      
      <p>For more information on processing step requirements, see the <a href="https://sagemaker.readthedocs.io/en/stable/workflows/pipelines/sagemaker.workflow.pipelines.html#sagemaker.workflow.steps.ProcessingStep" rel="noopener noreferrer" target="_blank"><span>sagemaker.workflow.steps.ProcessingStep</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> documentation. For an in-depth example,
        see <em>Define a Processing Step for Feature Engineering</em> in the <a href="https://github.com/aws/amazon-sagemaker-examples/blob/62de6a1fca74c7e70089d77e36f1356033adbe5f/sagemaker-pipelines/tabular/abalone_build_train_deploy/sagemaker-pipelines-preprocess-train-evaluate-batch-transform.ipynb" rel="noopener noreferrer" target="_blank"><span>Orchestrate Jobs to Train and Evaluate Models with Amazon SageMaker Pipelines</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> example
        notebook.</p>
     

     
      <h3 id="step-type-training">Training Step</h3>
      <p>You use a training step to create a training job to train a model. For more information
        on training jobs, see <a href="how-it-works-training.html">Train a
          Model with Amazon SageMaker</a>.</p>
      <p>A training step requires an estimator, as well as training and validation data inputs.
        The following example shows how to create a <code class="code">TrainingStep</code> definition. For more
        information on training step requirements, see the <a href="https://sagemaker.readthedocs.io/en/stable/workflows/pipelines/sagemaker.workflow.pipelines.html#sagemaker.workflow.steps.TrainingStep" rel="noopener noreferrer" target="_blank"><span>sagemaker.workflow.steps.TrainingStep</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> documentation.</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python ">from sagemaker.workflow.pipeline_context import PipelineSession

from sagemaker.inputs import TrainingInput
from sagemaker.workflow.steps import TrainingStep

from sagemaker.xgboost.estimator import XGBoost

pipeline_session = PipelineSession()

xgb_estimator = XGBoost(..., sagemaker_session=pipeline_session)

step_args = xgb_estimator.fit(
    inputs=<span>{</span>
        "train": TrainingInput(
            s3_data=step_process.properties.ProcessingOutputConfig.Outputs[
                "train"
            ].S3Output.S3Uri,
            content_type="text/csv"
        ),
        "validation": TrainingInput(
            s3_data=step_process.properties.ProcessingOutputConfig.Outputs[
                "validation"
            ].S3Output.S3Uri,
            content_type="text/csv"
        )
    }
)

step_train = TrainingStep(
    name="TrainAbaloneModel",
    step_args=step_args,
)</code></pre>
     

     
      <h3 id="step-type-tuning">Tuning Step</h3>
      <p>You use a tuning step to create a hyperparameter tuning job, also known as
        hyperparameter optimization (HPO). A hyperparameter tuning job runs multiple training jobs,
        each one producing a model version. For more information on hyperparameter tuning, see <a href="automatic-model-tuning.html">Perform Automatic Model Tuning with SageMaker</a>.</p>

      <p>The tuning job is associated with the SageMaker experiment for the pipeline, with the
        training jobs created as trials. For more information, see <a href="pipelines-experiments.html">Experiments Integration</a>.</p>
      <p>A tuning step requires a <a href="https://sagemaker.readthedocs.io/en/stable/api/training/tuner.html" rel="noopener noreferrer" target="_blank"><span>HyperparameterTuner</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> and training inputs. You can retrain previous tuning jobs by
        specifying the <code class="code">warm_start_config</code> parameter of the
          <code class="code">HyperparameterTuner</code>. For more information on hyperparameter tuning and warm
        start, see <a href="automatic-model-tuning-warm-start.html">Run a Warm Start Hyperparameter Tuning
        Job</a>.</p>
      <p>You use the <a href="https://sagemaker.readthedocs.io/en/stable/workflows/pipelines/sagemaker.workflow.pipelines.html#sagemaker.workflow.steps.TuningStep.get_top_model_s3_uri" rel="noopener noreferrer" target="_blank"><span>get_top_model_s3_uri</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> method of the <a href="https://sagemaker.readthedocs.io/en/stable/workflows/pipelines/sagemaker.workflow.pipelines.html#sagemaker.workflow.steps.TuningStep" rel="noopener noreferrer" target="_blank"><span>sagemaker.workflow.steps.TuningStep</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> class to get the model artifact from one of
        the top-performing model versions. For a notebook that shows how to use a tuning step in a
        SageMaker pipeline, see <a href="https://github.com/aws/amazon-sagemaker-examples/blob/master/sagemaker-pipelines/tabular/tuning-step/sagemaker-pipelines-tuning-step.ipynb" rel="noopener noreferrer" target="_blank"><span>sagemaker-pipelines-tuning-step.ipynb</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p>

      <div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>Important</h6></div><div class="awsdocs-note-text"><p>Tuning steps were introduced in Amazon SageMaker Python SDK v2.48.0 and Amazon SageMaker Studio v3.8.0.
          You must update Studio before you use a tuning step or the pipeline DAG doesn't
          display. To update Studio, see <a href="studio-tasks-update-studio.html">Shut down and Update SageMaker Studio</a>.</p></div></div>

      <p>The following example shows how to create a <code class="code">TuningStep</code> definition.</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python ">from sagemaker.workflow.pipeline_context import PipelineSession

from sagemaker.tuner import HyperparameterTuner
from sagemaker.inputs import TrainingInput
from sagemaker.workflow.steps import TuningStep

tuner = HyperparameterTuner(..., sagemaker_session=PipelineSession())
    
step_tuning = TuningStep(
    name = "HPTuning",
    step_args = tuner.fit(inputs=TrainingInput(s3_data="s3://<code class="replaceable">my-bucket/my-data</code>"))
)</code></pre>
      <p><b>Get the best model version</b></p>
      <p>The following example shows how to get the best model version from the tuning job using
        the <code class="code">get_top_model_s3_uri</code> method. At most, the top 50 performing versions are
        available ranked according to <a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/HyperParameterTuningJobObjective.html">HyperParameterTuningJobObjective</a>. The <code class="code">top_k</code> argument is an index
        into the versions, where <code class="code">top_k=0</code> is the best-performing version and
          <code class="code">top_k=49</code> is the worst-performing version.</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python ">best_model = Model(
    image_uri=image_uri,
    model_data=step_tuning.get_top_model_s3_uri(
        top_k=0,
        s3_bucket=sagemaker_session.default_bucket()
    ),
    ...
)</code></pre>
      <p>For more information on tuning step requirements, see the <a href="https://sagemaker.readthedocs.io/en/stable/workflows/pipelines/sagemaker.workflow.pipelines.html#sagemaker.workflow.steps.TuningStep" rel="noopener noreferrer" target="_blank"><span>sagemaker.workflow.steps.TuningStep</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>
        
        documentation.</p>
     
     
      <h3 id="step-type-automl">AutoML Step</h3>
      <p>Use the <a href="https://sagemaker.readthedocs.io/en/stable/api/training/automl.html" rel="noopener noreferrer" target="_blank"><span>AutoML</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> API to create an AutoML job to automatically train a model. For more
        information on AutoML jobs, see <a href="autopilot-automate-model-development.html">Automate model
          development with Amazon SageMaker Autopilot</a>. </p>
      <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>Currently, the AutoML step supports only <a href="autopilot-model-support-validation.html">ensembling training
            mode</a>.</p></div></div>
      <p>The following example shows how to create a definition using
        <code class="code">AutoMLStep</code>.</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python ">from sagemaker.workflow.pipeline_context import PipelineSession
from sagemaker.workflow.automl_step import AutoMLStep

pipeline_session = PipelineSession()

auto_ml = AutoML(...,
    role="<code class="replaceable">&lt;role&gt;</code>",
    target_attribute_name="<code class="replaceable">my_target_attribute_name</code>",
    mode="<code class="replaceable">ENSEMBLING</code>",
    sagemaker_session=pipeline_session) 

input_training = AutoMLInput(
    inputs="s3://<code class="replaceable">my-bucket/my-training-data</code>",
    target_attribute_name="<code class="replaceable">my_target_attribute_name</code>",
    channel_type="training",
)
input_validation = AutoMLInput(
    inputs="s3://<code class="replaceable">my-bucket/my-validation-data</code>",
    target_attribute_name="<code class="replaceable">my_target_attribute_name</code>",
    channel_type="validation",
)

step_args = auto_ml.fit(
    inputs=[input_training, input_validation]
)

step_automl = AutoMLStep(
    name="AutoMLStep",
    step_args=step_args,
)     </code></pre>
      <p><b>Get the best model version</b></p>
      <p>The AutoML step automatically trains several model candidates. You can get the model
        with the best objective metric from the AutoML job using the
          <code class="code">get_best_auto_ml_model</code> method and an IAM <code class="code">role</code> to access model
        artifacts as follows.</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">best_model = step_automl.get_best_auto_ml_model(<code class="replaceable">role=&lt;role&gt;</code>)</code></pre>
      <p>For more information, see the <a href="https://sagemaker.readthedocs.io/en/stable/workflows/pipelines/sagemaker.workflow.pipelines.html#sagemaker.workflow.automl_step.AutoMLStep" rel="noopener noreferrer" target="_blank"><span>AutoML</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> step in the SageMaker Python SDK.</p>
     

     
      <h3 id="step-type-model">Model Step</h3>
      <p>Use a <code class="code">ModelStep</code> to create or register a SageMaker model. For more information
          on <code class="code">ModelStep</code> requirements, see the <a href="https://sagemaker.readthedocs.io/en/stable/workflows/pipelines/sagemaker.workflow.pipelines.html#sagemaker.workflow.model_step.ModelStep" rel="noopener noreferrer" target="_blank"><span>sagemaker.workflow.model_step.ModelStep</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> documentation.</p>
       
        <h4 id="step-type-model-create">Create a model</h4>
        <p>You can use a <code class="code">ModelStep</code> to create a SageMaker model. A <code class="code">ModelStep</code>
          requires model artifacts and information about the SageMaker instance type that you need to use
          to create the model. For more information on SageMaker models, see <a href="how-it-works-training.html">Train a
            Model with Amazon SageMaker</a>.</p>
        <p>The following example shows how to create a <code class="code">ModelStep</code> definition.</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python ">from sagemaker.workflow.pipeline_context import PipelineSession
from sagemaker.model import Model
from sagemaker.workflow.model_step import ModelStep

step_train = TrainingStep(...)
model = Model(
    image_uri=pytorch_estimator.training_image_uri(),
    model_data=step_train.properties.ModelArtifacts.S3ModelArtifacts,
    sagemaker_session=PipelineSession(),
    role=role,
)

step_model_create = ModelStep(
   name="MyModelCreationStep",
   step_args=model.create(instance_type="ml.m5.xlarge"),
)</code></pre>
       
       
        <h4 id="step-type-model-register">Register a model</h4>
        <p>You can use a <code class="code">ModelStep</code> to register a <code class="code">sagemaker.model.Model</code>
          or a <code class="code">sagemaker.pipeline.PipelineModel</code> with the Amazon SageMaker model registry. A
            <code class="code">PipelineModel</code> represents an inference pipeline, which is a model composed
          of a linear sequence of containers that process inference requests. For more information
          about how to register a model, see <a href="model-registry.html">Register and Deploy Models with Model Registry</a>.</p>
        <p>The following example shows how to create a <code class="code">ModelStep</code> that registers a
            <code class="code">PipelineModel</code>.</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python ">import time

from sagemaker.workflow.pipeline_context import PipelineSession
from sagemaker.sklearn import SKLearnModel
from sagemaker.xgboost import XGBoostModel

pipeline_session = PipelineSession()

code_location = 's3://<span>{</span>0}/<span>{</span>1}/code'.format(<code class="replaceable">bucket_name</code>, prefix)

sklearn_model = SKLearnModel(
   model_data=processing_step.properties.ProcessingOutputConfig.Outputs['model'].S3Output.S3Uri,
   entry_point='inference.py',
   source_dir='sklearn_source_dir/',
   code_location=code_location,
   framework_version='1.0-1',
   role=role,
   sagemaker_session=pipeline_session,
   py_version='py3'
)

xgboost_model = XGBoostModel(
   model_data=training_step.properties.ModelArtifacts.S3ModelArtifacts,
   entry_point='inference.py',
   source_dir='xgboost_source_dir/',
   code_location=code_location,
   framework_version='0.90-2',
   py_version='py3',
   sagemaker_session=pipeline_session,
   role=role
)

from sagemaker.workflow.model_step import ModelStep
from sagemaker import PipelineModel

pipeline_model = PipelineModel(
   models=[sklearn_model, xgboost_model],
   role=role,sagemaker_session=pipeline_session,
)

register_model_step_args = pipeline_model.register(
    content_types=["application/json"],
   response_types=["application/json"],
   inference_instances=["ml.t2.medium", "ml.m5.xlarge"],
   transform_instances=["ml.m5.xlarge"],
   model_package_group_name='sipgroup',
)

step_model_registration = ModelStep(
   name="AbaloneRegisterModel",
   step_args=register_model_step_args,
)</code></pre>
       
     

     
      <h3 id="step-type-create-model">CreateModel Step</h3>
      <div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>Important</h6></div><div class="awsdocs-note-text"><p>We recommend using <a href="build-and-manage-steps.html#step-type-model">Model Step</a>
          to create models as of v2.90.0 of the SageMaker Python SDK. <code class="code">CreateModelStep</code> will
          continue to work in previous versions of the SageMaker Python SDK, but is no longer actively
          supported.</p></div></div>
      <p>You use a <code class="code">CreateModel</code> step to create a SageMaker model. For more information on
        SageMaker models, see <a href="how-it-works-training.html">Train a
          Model with Amazon SageMaker</a>.</p>
      <p>A create model step requires model artifacts and information about the SageMaker instance
        type that you need to use to create the model. The following example shows how to create a
          <code class="code">CreateModel</code> step definition. For more information on <code class="code">CreateModel</code>
        step requirements, see the <a href="https://sagemaker.readthedocs.io/en/stable/workflows/pipelines/sagemaker.workflow.pipelines.html#sagemaker.workflow.steps.CreateModelStep" rel="noopener noreferrer" target="_blank"><span>sagemaker.workflow.steps.CreateModelStep</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> documentation.</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python ">from sagemaker.workflow.steps import CreateModelStep

step_create_model = CreateModelStep(
    name="AbaloneCreateModel",
    model=best_model,
    inputs=inputs
)</code></pre>
     

     
      <h3 id="step-type-register-model">RegisterModel Step</h3>
      <div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>Important</h6></div><div class="awsdocs-note-text"><p>We recommend using <a href="build-and-manage-steps.html#step-type-model">Model Step</a>
          to register models as of v2.90.0 of the SageMaker Python SDK. <code class="code">RegisterModel</code> will
          continue to work in previous versions of the SageMaker Python SDK, but is no longer actively
          supported.</p></div></div>
      <p>You use a <code class="code">RegisterModel</code> step to register a <a href="https://sagemaker.readthedocs.io/en/stable/api/inference/model.html" rel="noopener noreferrer" target="_blank"><span>sagemaker.model.Model</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> or a <a href="https://sagemaker.readthedocs.io/en/stable/api/inference/pipeline.html#pipelinemodel" rel="noopener noreferrer" target="_blank"><span>sagemaker.pipeline.PipelineModel</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> with the Amazon SageMaker model registry. A
          <code class="code">PipelineModel</code> represents an inference pipeline, which is a model composed of
        a linear sequence of containers that process inference requests.</p>
      <p>For more information about how to register a model, see <a href="model-registry.html">Register and Deploy Models with Model Registry</a>. For more information on <code class="code">RegisterModel</code> step
        requirements, see the <a href="https://sagemaker.readthedocs.io/en/stable/workflows/pipelines/sagemaker.workflow.pipelines.html#sagemaker.workflow.step_collections.RegisterModel" rel="noopener noreferrer" target="_blank"><span>sagemaker.workflow.step_collections.RegisterModel</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> documentation.</p>

      <p>The following example shows how to create a <code class="code">RegisterModel</code> step that
        registers a <code class="code">PipelineModel</code>.</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python ">import time
from sagemaker.sklearn import SKLearnModel
from sagemaker.xgboost import XGBoostModel

code_location = 's3://<span>{</span>0}/<span>{</span>1}/code'.format(<code class="replaceable">bucket_name</code>, prefix)

sklearn_model = SKLearnModel(model_data=processing_step.properties.ProcessingOutputConfig.Outputs['model'].S3Output.S3Uri,
 entry_point='inference.py',
 source_dir='<code class="replaceable">sklearn_source_dir/</code>',
 code_location=code_location,
 framework_version='1.0-1',
 role=role,
 sagemaker_session=sagemaker_session,
 py_version='py3')

xgboost_model = XGBoostModel(model_data=training_step.properties.ModelArtifacts.S3ModelArtifacts,
 entry_point='inference.py',
 source_dir='<code class="replaceable">xgboost_source_dir/</code>',
 code_location=code_location,
 framework_version='0.90-2',
 py_version='py3',
 sagemaker_session=sagemaker_session,
 role=role)

from sagemaker.workflow.step_collections import RegisterModel
from sagemaker import PipelineModel
pipeline_model = PipelineModel(models=[sklearn_model,xgboost_model],role=role,sagemaker_session=sagemaker_session)

step_register = RegisterModel(
 name="<code class="replaceable">AbaloneRegisterModel</code>",
 model=pipeline_model,
 content_types=["application/json"],
 response_types=["application/json"],
 inference_instances=["<code class="replaceable">ml.t2.medium</code>", "<code class="replaceable">ml.m5.xlarge</code>"],
 transform_instances=["<code class="replaceable">ml.m5.xlarge</code>"],
 model_package_group_name='<code class="replaceable">sipgroup</code>',
)</code></pre>

      <p>If <code class="code">model</code> isn't provided, the register model step requires an estimator as
        shown in the following example.</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python ">from sagemaker.workflow.step_collections import RegisterModel

step_register = RegisterModel(
    name="<code class="replaceable">AbaloneRegisterModel</code>",
    estimator=xgb_train,
    model_data=step_train.properties.ModelArtifacts.S3ModelArtifacts,
    content_types=["text/csv"],
    response_types=["text/csv"],
    inference_instances=["<code class="replaceable">ml.t2.medium", "ml.m5.xlarge</code>"],
    transform_instances=["<code class="replaceable">ml.m5.xlarge</code>"],
    model_package_group_name=model_package_group_name,
    approval_status=model_approval_status,
    model_metrics=model_metrics
)</code></pre>
     
     
      <h3 id="step-type-transform">Transform Step</h3>
      <p>You use a transform step for batch transformation to run inference on an entire dataset.
        For more information about batch transformation, see <a href="inference-pipeline-batch.html">Run
                Batch
                Transforms with Inference Pipelines</a>.</p>
      <p>A transform step requires a transformer and the data on which to run batch
        transformation. The following example shows how to create a <code class="code">Transform</code> step
        definition. For more information on <code class="code">Transform</code> step requirements, see the <a href="https://sagemaker.readthedocs.io/en/stable/workflows/pipelines/sagemaker.workflow.pipelines.html#sagemaker.workflow.steps.TransformStep" rel="noopener noreferrer" target="_blank"><span>sagemaker.workflow.steps.TransformStep</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> documentation.</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python ">from sagemaker.workflow.pipeline_context import PipelineSession

from sagemaker.transformer import Transformer
from sagemaker.inputs import TransformInput
from sagemaker.workflow.steps import TransformStep

transformer = Transformer(..., sagemaker_session=PipelineSession())

step_transform = TransformStep(
    name="AbaloneTransform",
    step_args=transformer.transform(data="s3://<code class="replaceable">my-bucket/my-data</code>"),
)</code></pre>
     

     
      <h3 id="step-type-condition">Condition Step</h3>
      <p>You use a condition step to evaluate the condition of step properties to assess which
        action should be taken next in the pipeline.</p>
      <p>A condition step requires a list of conditions, a list of steps to run if the condition
        evaluates to <code class="code">true</code>, and a list of steps to run if the condition evaluates to
          <code class="code">false</code>. The following example shows how to create a <code class="code">ConditionStep</code>
        definition. </p>
      <p><b>Limitations</b></p>
      <div class="itemizedlist">
         
         
      <ul class="itemizedlist"><li class="listitem">
          <p>SageMaker Pipelines doesn't support the use of nested condition steps. You can't pass a condition
            step as the input for another condition step.</p>
        </li><li class="listitem">
          <p>A condition step can't use identical steps in both branches. If you need the same
            step functionality in both branches, duplicate the step and give it a different
            name.</p>
        </li></ul></div>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python ">from sagemaker.workflow.conditions import ConditionLessThanOrEqualTo
from sagemaker.workflow.condition_step import (
    ConditionStep,
    JsonGet
)

cond_lte = ConditionLessThanOrEqualTo(
    left=JsonGet(
        step_name=step_eval.name,
        property_file=evaluation_report,
        json_path="regression_metrics.mse.value"
    ),
    right=6.0
)

step_cond = ConditionStep(
    name="AbaloneMSECond",
    conditions=[cond_lte],
    if_steps=[step_register, step_create_model, step_transform],
    else_steps=[]
)</code></pre>
      <p>For more information on <code class="code">ConditionStep</code> requirements, see the <a href="https://sagemaker.readthedocs.io/en/stable/workflows/pipelines/sagemaker.workflow.pipelines.html#conditionstep" rel="noopener noreferrer" target="_blank"><span>sagemaker.workflow.condition_step.ConditionStep</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> API reference. For more
        information on supported conditions, see <em><a href="https://sagemaker.readthedocs.io/en/stable/amazon_sagemaker_model_building_pipeline.html#conditions" rel="noopener noreferrer" target="_blank"><span>Amazon SageMaker Model Building Pipelines - Conditions</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></em> in the SageMaker Python SDK documentation. </p>
     

     
      <h3 id="step-type-callback">Callback Step</h3>
      <p>You use a <code class="code">Callback</code> step to incorporate additional processes and AWS
        services into your workflow that aren't directly provided by Amazon SageMaker Model Building Pipelines. When a
          <code class="code">Callback</code> step runs, the following procedure occurs:</p>
      <div class="itemizedlist">
         
         
         
         
      <ul class="itemizedlist"><li class="listitem">
          <p>SageMaker Pipelines sends a message to a customer-specified Amazon Simple Queue Service (Amazon SQS) queue. The message
            contains a SageMaker Pipelines–generated token and a customer-supplied list of input
            parameters. After sending the message, SageMaker Pipelines waits for a response from the
            customer.</p>
        </li><li class="listitem">
          <p>The customer retrieves the message from the Amazon SQS queue and starts their custom
            process.</p>
        </li><li class="listitem">
          <p>When the process finishes, the customer calls one of the following APIs and submits
            the SageMaker Pipelines–generated token:</p>
          <div class="itemizedlist">
             
             
          <ul class="itemizedlist"><li class="listitem">
              <p>
                <a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_SendPipelineExecutionStepSuccess.html">SendPipelineExecutionStepSuccess</a>, along with a list of output
                parameters</p>
            </li><li class="listitem">
              <p>
                <a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_SendPipelineExecutionStepFailure.html">SendPipelineExecutionStepFailure</a>, along with a failure reason</p>
            </li></ul></div>
        </li><li class="listitem">
          <p>The API call causes SageMaker Pipelines to either continue the pipeline process or fail the
            process.</p>
        </li></ul></div>
      <p>For more information on <code class="code">Callback</code> step requirements, see the <a href="https://sagemaker.readthedocs.io/en/stable/workflows/pipelines/sagemaker.workflow.pipelines.html#sagemaker.workflow.callback_step.CallbackStep" rel="noopener noreferrer" target="_blank"><span>sagemaker.workflow.callback_step.CallbackStep</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> documentation. For a complete
        solution, see <a href="http://aws.amazon.com/blogs/machine-learning/extend-amazon-sagemaker-pipelines-to-include-custom-steps-using-callback-steps/" rel="noopener noreferrer" target="_blank"><span>Extend SageMaker Pipelines to include custom steps using callback steps</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p>

      <div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>Important</h6></div><div class="awsdocs-note-text"><p><code class="code">Callback</code> steps were introduced in Amazon SageMaker Python SDK v2.45.0 and
          Amazon SageMaker Studio v3.6.2. You must update Studio before you use a <code class="code">Callback</code>
          step or the pipeline DAG doesn't display. To update Studio, see <a href="studio-tasks-update-studio.html">Shut down and Update SageMaker Studio</a>.</p></div></div>

      <p>The following sample demonstrates an implementation of the preceding procedure.</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python ">from sagemaker.workflow.callback_step import CallbackStep

step_callback = CallbackStep(
    name="MyCallbackStep",
    sqs_queue_url="https://sqs.us-east-2.amazonaws.com/012345678901/MyCallbackQueue",
    inputs=<span>{</span>...},
    outputs=[...]
)

callback_handler_code = '
    import boto3
    import json

    def handler(event, context):
        sagemaker_client=boto3.client("sagemaker")

        for record in event["Records"]:
            payload=json.loads(record["body"])
            token=payload["token"]

            # Custom processing

            # Call SageMaker to complete the step
            sagemaker_client.send_pipeline_execution_step_success(
                CallbackToken=token,
                OutputParameters=<span>{</span>...}
            )
'</code></pre>
      <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>Output parameters for <code class="code">CallbackStep</code> should not be nested. For example, if
          you use a nested dictionary as your output parameter, then the dictionary is treated as a
          single string (ex. <code class="code"><span>{</span>"output1": "<span>{</span>\"nested_output1\":\"my-output\"}"}</code>). If you
          provide a nested value, then when you try to refer to a particular output parameter, a
          non-retryable client error is thrown.</p></div></div>
      <p><b>Stopping behavior</b></p>
      <p>A pipeline process doesn't stop while a <code class="code">Callback</code> step is running.</p>
      <p>When you call <a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_StopPipelineExecution.html">StopPipelineExecution</a> on a pipeline process with a running <code class="code">Callback</code>
        step, SageMaker Pipelines sends an additional Amazon SQS message to the specified SQS queue. The body of the
        SQS message contains a <b>Status</b> field, which is set to
          <code class="code">Stopping</code>. The following shows an example SQS message body.</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "token": "26vcYbeWsZ",
  "pipelineExecutionArn": "arn:aws:sagemaker:us-east-2:012345678901:pipeline/callback-pipeline/execution/7pinimwddh3a",
  "arguments": <span>{</span>
    "number": 5,
    "stringArg": "some-arg",
    "inputData": "s3://sagemaker-us-west-2-012345678901/abalone/abalone-dataset.csv"
  },
  "status": "Stopping"
}</code></pre>
      <p>You should add logic to your Amazon SQS message consumer to take any needed action (for
        example, resource cleanup) upon receipt of the message, followed by a call to
          <code class="code">SendPipelineExecutionStepSuccess</code> or
          <code class="code">SendPipelineExecutionStepFailure</code>.</p>
      <p>Only when SageMaker Pipelines receives one of these calls does it stop the pipeline process.</p>
     

     
      <h3 id="step-type-lambda">Lambda Step</h3>
      <p>You use a Lambda step to run an AWS Lambda function. You can run an existing Lambda
        function, or SageMaker can create and run a new Lambda function. For a notebook that shows how to
        use a Lambda step in a SageMaker pipeline, see <a href="https://github.com/aws/amazon-sagemaker-examples/blob/master/sagemaker-pipelines/tabular/lambda-step/sagemaker-pipelines-lambda-step.ipynb" rel="noopener noreferrer" target="_blank"><span>sagemaker-pipelines-lambda-step.ipynb</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p>

      <div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>Important</h6></div><div class="awsdocs-note-text"><p>Lambda steps were introduced in Amazon SageMaker Python SDK v2.51.0 and Amazon SageMaker Studio v3.9.1.
          You must update Studio before you use a Lambda step or the pipeline DAG doesn't
          display. To update Studio, see <a href="studio-tasks-update-studio.html">Shut down and Update SageMaker Studio</a>.</p></div></div>

      <p>SageMaker provides the <a href="https://sagemaker.readthedocs.io/en/stable/api/utility/lambda_helper.html" rel="noopener noreferrer" target="_blank"><span>sagemaker.lambda_helper.Lambda</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> class to create, update, invoke, and delete Lambda
        functions. <code class="code">Lambda</code> has the following signature.</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python ">Lambda(
    function_arn,       # Only required argument to invoke an existing Lambda function

    # The following arguments are required to create a Lambda function:
    function_name,
    execution_role_arn,
    zipped_code_dir,    # Specify either zipped_code_dir and s3_bucket, OR script
    s3_bucket,          # S3 bucket where zipped_code_dir is uploaded
    script,             # Path of Lambda function script
    handler,            # Lambda handler specified as "lambda_script.lambda_handler"
    timeout,            # Maximum time the Lambda function can run before the lambda step fails
    ...
)</code></pre>

      <p>The <a href="https://sagemaker.readthedocs.io/en/stable/workflows/pipelines/sagemaker.workflow.pipelines.html#sagemaker.workflow.lambda_step.LambdaStep" rel="noopener noreferrer" target="_blank"><span>sagemaker.workflow.lambda_step.LambdaStep</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> class has a <code class="code">lambda_func</code>
        argument of type <code class="code">Lambda</code>. To invoke an existing Lambda function, the only
        requirement is to supply the Amazon Resource Name (ARN) of the function to
          <code class="code">function_arn</code>. If you don't supply a value for <code class="code">function_arn</code>, you
        must specify <code class="code">handler</code> and one of the following:</p>
      <div class="itemizedlist">
         
         
      <ul class="itemizedlist"><li class="listitem">
          <p><code class="code">zipped_code_dir</code> – The path of the zipped Lambda function</p>
          <p><code class="code">s3_bucket</code> – Amazon S3 bucket where <code class="code">zipped_code_dir</code> is to
            be uploaded</p>
        </li><li class="listitem">
          <p><code class="code">script</code> – The path of the Lambda function script file</p>
        </li></ul></div>

      <p>The following example shows how to create a <code class="code">Lambda</code> step definition that
        invokes an existing Lambda function.</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python ">from sagemaker.workflow.lambda_step import LambdaStep
from sagemaker.lambda_helper import Lambda

step_lambda = LambdaStep(
    name="ProcessingLambda",
    lambda_func=Lambda(
        function_arn="arn:aws:lambda:us-west-2:012345678910:function:split-dataset-lambda"
    ),
    inputs=<span>{</span>
        s3_bucket = s3_bucket,
        data_file = data_file
    },
    outputs=[
        "train_file", "test_file"
    ]
)</code></pre>

      <p>The following example shows how to create a <code class="code">Lambda</code> step definition that
        creates and invokes a Lambda function using a Lambda function script.</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python ">from sagemaker.workflow.lambda_step import LambdaStep
from sagemaker.lambda_helper import Lambda

step_lambda = LambdaStep(
    name="ProcessingLambda",
    lambda_func=Lambda(
      function_name="split-dataset-lambda",
      execution_role_arn=execution_role_arn,
      script="lambda_script.py",
      handler="lambda_script.lambda_handler",
      ...
    ),
    inputs=<span>{</span>
        s3_bucket = s3_bucket,
        data_file = data_file
    },
    outputs=[
        "train_file", "test_file"
    ]
)</code></pre>

      <p><b>Inputs and outputs</b></p>
      <p>If your <code class="code">Lambda</code> function has inputs or outputs, these must also be defined
        in your <code class="code">Lambda</code> step.</p>
      <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>Input and output parameters should not be nested. For example, if you use a nested
          dictionary as your output parameter, then the dictionary is treated as a single string
          (ex. <code class="code"><span>{</span>"output1": "<span>{</span>\"nested_output1\":\"my-output\"}"}</code>). If you provide a
          nested value and try to refer to it later, a non-retryable client error is thrown.</p></div></div>
      <p>When defining the <code class="code">Lambda</code> step, <code class="code">inputs</code> must be a dictionary of
        key-value pairs. Each value of the <code class="code">inputs</code> dictionary must be a primitive type
        (string, integer, or float). Nested objects are not supported. If left undefined, the
          <code class="code">inputs</code> value defaults to <code class="code">None</code>.</p>
      <p>The <code class="code">outputs</code> value must be a list of keys. These keys refer to a dictionary
        defined in the output of the <code class="code">Lambda</code> function. Like <code class="code">inputs</code>, these
        keys must be primitive types, and nested objects are not supported.</p>

      <p><b>Timeout and stopping behavior</b></p>
      <p>The <code class="code">Lambda</code> class has a <code class="code">timeout</code> argument that specifies the
        maximum time that the Lambda function can run. The default value is 120 seconds with a
        maximum value of 10 minutes. If the Lambda function is running when the timeout is met, the
        Lambda step fails; however, the Lambda function continues to run.</p>
      <p>A pipeline process can't be stopped while a Lambda step is running because the Lambda
        function invoked by the Lambda step can't be stopped. If you attempt to stop the process
        while the Lambda function is running, the pipeline waits for the Lambda function to finish or
        until the timeout is hit, whichever occurs first, and then stops. If the Lambda function
        finishes, the pipeline process status is <code class="code">Stopped</code>. If the timeout is hit the
        pipeline process status is <code class="code">Failed</code>.</p>
     

     
      <h3 id="step-type-clarify-check">ClarifyCheck Step</h3>
      <p>You can use the <code class="code">ClarifyCheck</code> step to conduct baseline drift checks against
        previous baselines for bias analysis and model explainability. You can then generate and
          <a href="pipelines-quality-clarify-baseline-lifecycle.html#pipelines-quality-clarify-baseline-calculations">register your baselines</a> with the <code class="code">model.register()</code> method and pass
        the output of that method to <a href="build-and-manage-steps.html#step-type-model">Model Step</a> using <code class="code"><a href="https://sagemaker.readthedocs.io/en/stable/amazon_sagemaker_model_building_pipeline.html#model-step" rel="noopener noreferrer" target="_blank"><span>step_args</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></code>. These baselines for drift check can be used by Amazon SageMaker Model Monitor for your
        model endpoints so that you don’t need to do a <a href="model-monitor-create-baseline.html">baseline</a> suggestion
        separately. The <code class="code">ClarifyCheck</code> step can also pull baselines for drift check from
        the model registry. The <code class="code">ClarifyCheck</code> step leverages the Amazon SageMaker Clarify
        prebuilt container that provides a range of model monitoring capabilities, including
        constraint suggestion and constraint validation against a given baseline. For more
        information, see <a href="clarify-configure-processing-jobs.html#clarify-processing-job-configure-container">Getting Started with a SageMaker Clarify Container</a>.</p>
       
        <h4 id="configuring-step-type-clarify">Configuring the ClarifyCheck step </h4>
        <p>You can configure the <code class="code">ClarifyCheck</code> step to conduct only one of the
          following check types each time it’s used in a pipeline.</p>
        <div class="itemizedlist">
           
           
           
        <ul class="itemizedlist"><li class="listitem">
            <p>Data bias check</p>
          </li><li class="listitem">
            <p>Model bias check</p>
          </li><li class="listitem">
            <p>Model explainability check</p>
          </li></ul></div>
        <p>You do this by setting the <code class="code">clarify_check_config</code> parameter with one of the
          following check type values:</p>
        <div class="itemizedlist">
           
           
           
        <ul class="itemizedlist"><li class="listitem">
            <p><code class="code">DataBiasCheckConfig</code></p>
          </li><li class="listitem">
            <p><code class="code">ModelBiasCheckConfig</code></p>
          </li><li class="listitem">
            <p><code class="code">ModelExplainabilityCheckConfig</code></p>
          </li></ul></div>
        <p>The <code class="code">ClarifyCheck</code> step launches a processing job that runs the SageMaker
          Clarify prebuilt container and requires dedicated <a href="clarify-configure-processing-jobs.html">configurations for the
            check and the processing job</a>. <code class="code">ClarifyCheckConfig</code> and
            <code class="code">CheckJobConfig</code> are helper functions for these configurations that are
          aligned with how the SageMaker Clarify processing job computes for checking model bias, data
          bias, or model explainability. For more information, see <a href="clarify-processing-job-run.html">Run SageMaker Clarify Processing Jobs for Bias Analysis and
            Explainability</a>.
        </p>
       
       
        <h4 id="controlling-step-type-clarify">Controlling step behaviors for drift
            check</h4>
        <p>The <code class="code">ClarifyCheck</code> step requires the following two boolean flags to control
          its behavior:</p>
        <div class="itemizedlist">
           
           
        <ul class="itemizedlist"><li class="listitem">
            <p><code class="code">skip_check</code>: This parameter indicates if the drift check against the
              previous baseline is skipped or not. If it is set to <code class="code">False</code>, the previous
              baseline of the configured check type must be available.</p>
          </li><li class="listitem">
            <p><code class="code">register_new_baseline</code>: This parameter indicates if a newly calculated
              baseline can be accessed though step property
                <code class="code">BaselineUsedForDriftCheckConstraints</code>. If it is set to
                <code class="code">False</code>, the previous baseline of the configured check type also must be
              available. This can be accessed through the
                <code class="code">BaselineUsedForDriftCheckConstraints</code> property. </p>
          </li></ul></div>
        <p>For more information, see <a href="pipelines-quality-clarify-baseline-lifecycle.html">Baseline calculation, drift
      detection and lifecycle with ClarifyCheck and QualityCheck steps in Amazon SageMaker Model Building Pipelines</a>.</p>
       
       
        <h4 id="step-type-clarify-working-with-baselines">Working with baselines</h4>
        <p>You can optionally specify the <code class="code">model_package_group_name</code> to locate the
          existing baseline and the <code class="code">ClarifyCheck</code> step pulls the
            <code class="code">DriftCheckBaselines</code> on the latest approved model package in the model
          package group. Or, you can provide a previous baseline through the
            <code class="code">supplied_baseline_constraints</code> parameter. If you specify both the
            <code class="code">model_package_group_name</code> and the
          <code class="code">supplied_baseline_constraints</code>, the <code class="code">ClarifyCheck</code> step uses the
          baseline specified by the <code class="code">supplied_baseline_constraints</code> parameter.</p>
       
      <p>For more information on using the <code class="code">ClarifyCheck</code> step requirements, see the
          <a href="https://sagemaker.readthedocs.io/en/stable/workflows/pipelines/sagemaker.workflow.pipelines.html#sagemaker.workflow.steps.ClarifyCheckStep" rel="noopener noreferrer" target="_blank"><span> sagemaker.workflow.steps.ClarifyCheckStep</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> in the <em>Amazon SageMaker SageMaker
          SDK for Python</em>. For an Amazon SageMaker Studio notebook that shows how to use
          <code class="code">ClarifyCheck</code> step in SageMaker Pipelines, see <a href="https://github.com/aws/amazon-sagemaker-examples/tree/master/sagemaker-pipelines/tabular/model-monitor-clarify-pipelines/sagemaker-pipeline-model-monitor-clarify-steps.ipynb" rel="noopener noreferrer" target="_blank"><span>sagemaker-pipeline-model-monitor-clarify-steps.ipynb</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p>
      <div class="example"><h6>Example Create a <code class="code">ClarifyCheck</code> step for data bias check</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="Python ">from sagemaker.workflow.check_job_config import CheckJobConfig
from sagemaker.workflow.clarify_check_step import DataBiasCheckConfig, ClarifyCheckStep
from sagemaker.workflow.execution_variables import ExecutionVariables

check_job_config = CheckJobConfig(
    role=role,
    instance_count=1,
    instance_type="<code class="replaceable">ml.c5.xlarge</code>",
    volume_size_in_gb=<code class="replaceable">120</code>,
    sagemaker_session=sagemaker_session,
)

data_bias_data_config = DataConfig(
    s3_data_input_path=step_process.properties.ProcessingOutputConfig.Outputs["train"].S3Output.S3Uri,
    s3_output_path=Join(on='/', values=['s3:/', your_bucket, base_job_prefix, ExecutionVariables.PIPELINE_EXECUTION_ID, '<code class="replaceable">databiascheckstep</code>']),
    label=0,
    dataset_type="<code class="replaceable">text/csv</code>",
    s3_analysis_config_output_path=data_bias_analysis_cfg_output_path,
)

data_bias_config = BiasConfig(
    label_values_or_threshold=[<code class="replaceable">15.0</code>], facet_name=[<code class="replaceable">8</code>], facet_values_or_threshold=[[<code class="replaceable">0.5</code>]]  
)

data_bias_check_config = DataBiasCheckConfig(
    data_config=data_bias_data_config,
    data_bias_config=data_bias_config,
)h

data_bias_check_step = ClarifyCheckStep(
    name="<code class="replaceable">DataBiasCheckStep</code>",
    clarify_check_config=data_bias_check_config,
    check_job_config=check_job_config,
    skip_check=False,
    register_new_baseline=False
   supplied_baseline_constraints="<code class="replaceable">s3://sagemaker-us-west-2-111122223333/baseline/analysis.json</code>",
    model_package_group_name="<code class="replaceable">MyModelPackageGroup</code>"
)</code></pre></div></div>
     
     
      <h3 id="step-type-quality-check">QualityCheck Step</h3>
      <p>You can use the <code class="code">QualityCheck</code> step to conduct <a href="model-monitor-create-baseline.html">baseline suggestions</a>
        and drift checks against a previous baseline for data quality or model quality in a
        pipeline. You can then generate and <a href="pipelines-quality-clarify-baseline-lifecycle.html#pipelines-quality-clarify-baseline-calculations">register your baselines</a> with the <code class="code">model.register()</code> method and pass
        the output of that method to <a href="build-and-manage-steps.html#step-type-model">Model Step</a> using <code class="code"><a href="https://sagemaker.readthedocs.io/en/stable/amazon_sagemaker_model_building_pipeline.html#model-step" rel="noopener noreferrer" target="_blank"><span>step_args</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></code>. Model Monitor can use these baselines for drift check for your model
        endpoints so that you don’t need to do a baseline suggestion separately. The
          <code class="code">QualityCheck</code> step can also pull baselines for drift check from the model
        registry. The <code class="code">QualityCheck</code> step leverages the Amazon SageMaker Model Monitor prebuilt
        container, which has a range of model monitoring capabilities including constraint
        suggestion, statistics generation, and constraint validation against a baseline. For more
        information, see <a href="model-monitor-pre-built-container.html">Amazon SageMaker Model Monitor prebuilt container</a>.</p>
       
        <h4 id="configuring-step-type-quality">Configuring the QualityCheck step</h4>
        <p>You can configure the <code class="code">QualityCheck</code> step to conduct only one of the
          following check types each time it’s used in a pipeline.</p>
        <div class="itemizedlist">
           
           
        <ul class="itemizedlist"><li class="listitem">
            <p>Data quality check</p>
          </li><li class="listitem">
            <p>Model quality check</p>
          </li></ul></div>
        <p>You do this by setting the <code class="code">quality_check_config</code> parameter with one of the
          following check type values:</p>
        <div class="itemizedlist">
           
           
        <ul class="itemizedlist"><li class="listitem">
            <p><code class="code">DataQualityCheckConfig</code></p>
          </li><li class="listitem">
            <p><code class="code">ModelQualityCheckConfig</code></p>
          </li></ul></div>
        <p>The <code class="code">QualityCheck</code> step launches a processing job that runs the Model Monitor
          prebuilt container and requires dedicated configurations for the check and the processing
          job. The <code class="code">QualityCheckConfig</code> and <code class="code">CheckJobConfig</code> are helper
          functions for these configurations that are aligned with how Model Monitor creates a baseline for
          the model quality or data quality monitoring. For more information on the Model Monitor baseline
          suggestions, see <a href="model-monitor-create-baseline.html">Create a Baseline</a> and <a href="model-monitor-model-quality-baseline.html">Create a Model Quality
                    Baseline</a>.</p>
       
       
        <h4 id="controlling-step-type-quality">Controlling step behaviors for drift
            check</h4>
        <p>The <code class="code">QualityCheck</code> step requires the following two Boolean flags to control
          its behavior:</p>
        <div class="itemizedlist">
           
           
        <ul class="itemizedlist"><li class="listitem">
            <p><code class="code">skip_check</code>: This parameter indicates if the drift check against the
              previous baseline is skipped or not. If it is set to <code class="code">False</code>, the previous
              baseline of the configured check type must be available.</p>
          </li><li class="listitem">
            <p><code class="code">register_new_baseline</code>: This parameter indicates if a newly calculated
              baseline can be accessed through step properties
                <code class="code">BaselineUsedForDriftCheckConstraints</code> and
                <code class="code">BaselineUsedForDriftCheckStatistics</code>. If it is set to
              <code class="code">False</code>, the previous baseline of the configured check type must also be
              available. These can be accessed through the
                <code class="code">BaselineUsedForDriftCheckConstraints</code> and
                <code class="code">BaselineUsedForDriftCheckStatistics</code> properties.</p>
          </li></ul></div>
        <p>For more information, see <a href="pipelines-quality-clarify-baseline-lifecycle.html">Baseline calculation, drift
      detection and lifecycle with ClarifyCheck and QualityCheck steps in Amazon SageMaker Model Building Pipelines</a>.</p>
       
       
        <h4 id="step-type-quality-working-with-baselines">Working with baselines</h4>
        <p>You can specify a previous baseline directly through the
            <code class="code">supplied_baseline_statistics</code> and <code class="code">supplied_baseline_constraints</code>
          parameters, or you can simply specify the <code class="code">model_package_group_name</code> and the
            <code class="code">QualityCheck</code> step pulls the <code class="code">DriftCheckBaselines</code> on the latest
          approved model package in the model package group. When you specify the
            <code class="code">model_package_group_name</code>, the <code class="code">supplied_baseline_constraints</code>,
          and <code class="code">supplied_baseline_statistics</code>, the <code class="code">QualityCheck</code> step uses the
          baseline specified by <code class="code">supplied_baseline_constraints</code> and
            <code class="code">supplied_baseline_statistics</code> on the check type of the
            <code class="code">QualityCheck</code> step you are running.</p>
       
      <p>For more information on using the <code class="code">QualityCheck</code> step requirements, see the
          <a href="https://sagemaker.readthedocs.io/en/stable/workflows/pipelines/sagemaker.workflow.pipelines.html#sagemaker.workflow.steps.QualityCheckStep" rel="noopener noreferrer" target="_blank"><span> sagemaker.workflow.steps.QualityCheckStep</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> in the <em>Amazon SageMaker SageMaker
          SDK for Python</em>. For an Amazon SageMaker Studio notebook that shows how to use
          <code class="code">QualityCheck</code> step in SageMaker Pipelines, see <a href="https://github.com/aws/amazon-sagemaker-examples/tree/master/sagemaker-pipelines/tabular/model-monitor-clarify-pipelines/sagemaker-pipeline-model-monitor-clarify-steps.ipynb" rel="noopener noreferrer" target="_blank"><span>sagemaker-pipeline-model-monitor-clarify-steps.ipynb</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>. </p>
      <div class="example"><h6>Example Create a <code class="code">QualityCheck</code> step for data quality check</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="Python ">from sagemaker.workflow.check_job_config import CheckJobConfig
from sagemaker.workflow.quality_check_step import DataQualityCheckConfig, QualityCheckStep
from sagemaker.workflow.execution_variables import ExecutionVariables

check_job_config = CheckJobConfig(
    role=role,
    instance_count=1,
    instance_type="<code class="replaceable">ml.c5.xlarge</code>",
    volume_size_in_gb=<code class="replaceable">120</code>,
    sagemaker_session=sagemaker_session,
)

data_quality_check_config = DataQualityCheckConfig(
    baseline_dataset=step_process.properties.ProcessingOutputConfig.Outputs["<code class="replaceable">train</code>"].S3Output.S3Uri,
    dataset_format=DatasetFormat.csv(header=False, output_columns_position="START"),
    output_s3_uri=Join(on='/', values=['s3:/', your_bucket, base_job_prefix, ExecutionVariables.PIPELINE_EXECUTION_ID, 'dataqualitycheckstep'])
)

data_quality_check_step = QualityCheckStep(
    name="DataQualityCheckStep",
    skip_check=False,
    register_new_baseline=False,
    quality_check_config=data_quality_check_config,
    check_job_config=check_job_config,
    supplied_baseline_statistics="s3://<code class="replaceable">sagemaker-us-west-2-555555555555/baseline/statistics.json</code>",
    supplied_baseline_constraints="s3://<code class="replaceable">sagemaker-us-west-2-555555555555/baseline/constraints.json</code>",
    model_package_group_name="<code class="replaceable">MyModelPackageGroup</code>"
)</code></pre></div></div>
     
     
      <h3 id="step-type-emr">EMR Step</h3>
      <p>You can use the Amazon SageMaker Model Building Pipelines <a href="https://docs.aws.amazon.com/emr/latest/ManagementGuide/emr-overview.html">EMR</a> step to process <a href="https://docs.aws.amazon.com/emr/latest/ManagementGuide/emr-work-with-steps.html">Amazon EMR
            steps</a> on a running Amazon EMR cluster or have the pipeline create and manage an 
            Amazon EMR cluster for you. For more information about Amazon EMR, see <a href="https://docs.aws.amazon.com/emr/latest/ManagementGuide/emr-gs.html">Getting started with
          Amazon EMR</a>.</p>
      <p>The EMR step requires that <code class="code">EMRStepConfig</code> include the location of the
        JAR file to be used by the Amazon EMR cluster and any arguments to be passed. You also provide
          the Amazon EMR cluster ID if you want to run the step on a running EMR cluster, or the cluster configuration
          if you want the EMR step to run on a cluster that it creates, manages, and terminates for you.
        The following sections include examples and links to sample notebooks demonstrating both methods.</p>
      <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><div class="itemizedlist">
           
           
           
           
           
           
        <ul class="itemizedlist"><li class="listitem">
            <p>EMR steps require that the role passed to your pipeline has additional
              permissions. You should attach the <a href="security-iam-awsmanpol-pipelines.html#security-iam-awsmanpol-AmazonSageMakerPipelinesIntegrations">AWS managed policy: <code class="code">AmazonSageMakerPipelinesIntegrations</code></a> to your
              pipeline role, or ensure that the role includes the permissions in that policy.</p>
          </li><li class="listitem">
            <p>EMR step is not supported on EMR serverless, nor on Amazon EMR on EKS.</p>
          </li><li class="listitem">
            <p>If you process an EMR step on a running cluster, you can only use a cluster that is in one of the following states:
                <code class="code">STARTING</code>, <code class="code">BOOTSTRAPPING</code>, <code class="code">RUNNING</code>, or
                <code class="code">WAITING</code>.</p>
          </li><li class="listitem">
            <p>If you process EMR steps on a running cluster, you can have at most 256 EMR steps in a <code class="code">PENDING</code> state on an EMR cluster. EMR
              steps submitted beyond this limit result in pipeline execution failure. You may
              consider using <a href="pipelines-retry-policy.html">Retry Policy for Pipeline Steps</a>.</p>
          </li><li class="listitem"><p>You can specify either cluster ID or cluster configuration, but not both.</p></li><li class="listitem"><p>The EMR step relies on Amazon EventBridge to monitor changes in the EMR step or cluster state.  
            If you process your Amazon EMR job on a running cluster, the EMR step uses the <code class="code">SageMakerPipelineExecutionEMRStepStatusUpdateRule</code> rule
            to monitor EMR step state. If you process your job on a cluster that the EMR step creates for you, the step uses the <code class="code">SageMakerPipelineExecutionEMRClusterStatusRule</code>
            rule to monitor changes in cluster state. If you see either of these EventBridge rules in your AWS account, do not delete them
            or else your EMR step may not complete.</p></li></ul></div></div></div>
        <p><b>Launch a new job on a running Amazon EMR cluster</b></p>
        <p>If you want to launch a new job on a running Amazon EMR cluster, you pass the cluster ID as a string to the 
          <code class="code">cluster_id</code> argument of <code class="code">EMRStep</code>. The following example demonstrates this procedure.</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="Python ">from sagemaker.workflow.emr_step import EMRStep, EMRStepConfig

emr_config = EMRStepConfig(
    jar="<code class="replaceable">jar-location</code>", # required, path to jar file used
    args=["--verbose", "--force"], # optional list of arguments to pass to the jar
    main_class="com.my.Main1", # optional main class, this can be omitted if jar above has a manifest 
    properties=[ # optional list of Java properties that are set when the step runs
    <span>{</span>
        "key": "mapred.tasktracker.map.tasks.maximum",
        "value": "2"
    },
    <span>{</span>
        "key": "mapreduce.map.sort.spill.percent",
        "value": "0.90"
   },
   <span>{</span>
       "key": "mapreduce.tasktracker.reduce.tasks.maximum",
       "value": "5"
    }
  ]
)

step_emr = EMRStep (
    name="EMRSampleStep", # required
    cluster_id="j-1ABCDEFG2HIJK", # include cluster_id to use a running cluster
    step_config=emr_config, # required
    display_name="My EMR Step",
    description="Pipeline step to execute EMR job"
)</code></pre>
      <p>For a sample notebook that guides you through a complete example, see <a href="https://github.com/aws/amazon-sagemaker-examples/blob/main/sagemaker-pipelines/tabular/emr-step/sagemaker-pipelines-emr-step-with-running-emr-cluster.ipynb" rel="noopener noreferrer" target="_blank"><span>
          SageMaker Pipelines EMR Step With Running EMR Cluster</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p>
        <p><b>Launch a new job on a new Amazon EMR cluster</b></p>
        <p>If you want to launch a new job on a new cluster that <code class="code">EMRStep</code> creates for you,
          provide your cluster configuration as a dictionary with the same structure as a 
          <a href="https://docs.aws.amazon.com/emr/latest/APIReference/API_RunJobFlow.html">RunJobFlow</a> request. However, 
          do not include the following fields in your cluster configuration:</p>
          <div class="itemizedlist">
             
             
             
             
             
          <ul class="itemizedlist"><li class="listitem"><p>[<code class="code">Name</code>]</p></li><li class="listitem"><p>[<code class="code">Steps</code>]</p></li><li class="listitem"><p>[<code class="code">AutoTerminationPolicy</code>]</p></li><li class="listitem"><p>[<code class="code">Instances</code>][<code class="code">KeepJobFlowAliveWhenNoSteps</code>]</p></li><li class="listitem"><p>[<code class="code">Instances</code>][<code class="code">TerminationProtected</code>]</p></li></ul></div>
          <p>All other <code class="code">RunJobFlow</code> arguments are available for use in your cluster configuration. For
            details about the request syntax, see <a href="https://docs.aws.amazon.com/emr/latest/APIReference/API_RunJobFlow.html">RunJobFlow</a>.</p>
          <p>The following example passes a cluster configuration to an EMR step definition, which
            prompts the step to launch a new job on a new EMR cluster. The EMR cluster configuration
            in this example includes specifications for primary and core EMR cluster nodes. For more 
            information about Amazon EMR node types, see <a href="https://docs.aws.amazon.com/emr/latest/ManagementGuide/emr-master-core-task-nodes.html">
              Understand node types: primary, core, and task nodes</a>.</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="Python ">from sagemaker.workflow.emr_step import EMRStep, EMRStepConfig

emr_step_config = EMRStepConfig(
    jar="<code class="replaceable">jar-location</code>", # required, path to jar file used
    args=["--verbose", "--force"], # optional list of arguments to pass to the jar
    main_class="com.my.Main1", # optional main class, this can be omitted if jar above has a manifest 
    properties=[ # optional list of Java properties that are set when the step runs
    <span>{</span>
        "key": "mapred.tasktracker.map.tasks.maximum",
        "value": "2"
    },
    <span>{</span>
        "key": "mapreduce.map.sort.spill.percent",
        "value": "0.90"
   },
   <span>{</span>
       "key": "mapreduce.tasktracker.reduce.tasks.maximum",
       "value": "5"
    }
  ]
)

# include your cluster configuration as a dictionary
emr_cluster_config = <span>{</span>
    "Applications": [
        <span>{</span>
            "Name": "Spark", 
        }
    ],
    "Instances":<span>{</span>
        "InstanceGroups":[
            <span>{</span>
                "InstanceRole": "MASTER",
                "InstanceCount": 1,
                "InstanceType": "m5.2xlarge"
            },
            <span>{</span>
                "InstanceRole": "CORE",
                "InstanceCount": 2,
                "InstanceType": "m5.2xlarge"
            }
        ]
    },
    "BootstrapActions":[],
    "ReleaseLabel": "emr-6.6.0",
    "JobFlowRole": "<code class="replaceable">job-flow-role</code>",
    "ServiceRole": "<code class="replaceable">service-role</code>"
}

emr_step = EMRStep(
    name="emr-step",
    cluster_id=None,
    display_name="emr_step",
    description="MyEMRStepDescription",
    step_config=emr_step_config,
    cluster_config=emr_cluster_config
)</code></pre>
      <p>For a sample notebook that guides you through a complete example, see <a href="https://github.com/aws/amazon-sagemaker-examples/blob/main/sagemaker-pipelines/tabular/emr-step/sagemaker-pipelines-emr-step-with-cluster-lifecycle-management.ipynb" rel="noopener noreferrer" target="_blank"><span>
        SageMaker Pipelines EMR Step With Cluster Lifecycle Management</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p>
     
     
      <h3 id="step-type-fail">Fail Step</h3>
      <p>You use a <code class="code">FailStep</code> to stop an Amazon SageMaker Model Building Pipelines execution when a desired condition
        or state is not achieved and to mark that pipeline's execution as failed. The
          <code class="code">FailStep</code> also allows you to enter a custom error message, indicating the
        cause of the pipeline's execution failure. </p>
      <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>When a <code class="code">FailStep</code> and other pipeline steps execute concurrently, the
          pipeline does not terminate until all concurrent steps are completed.</p></div></div>
       
        <h4 id="step-type-fail-limitations">Limitations for using
            <code class="code">FailStep</code></h4>
        <div class="itemizedlist">
           
           
           
        <ul class="itemizedlist"><li class="listitem">
            <p>You cannot add a <code class="code">FailStep</code> to the <code class="code">DependsOn</code> list of other
              steps. For more information, see <a href="build-and-manage-steps.html#build-and-manage-custom-dependency">Custom Dependency Between Steps</a>.</p>
          </li><li class="listitem">
            <p>Other steps cannot reference the <code class="code">FailStep</code>. It is
                <em>always</em> the last step in a pipeline's execution.</p>
          </li><li class="listitem">
            <p>You cannot retry a pipeline execution ending with a <code class="code">FailStep</code>.</p>
          </li></ul></div>
       
      <p>You can create the <code class="code">FailStep</code>
        <code class="code">ErrorMessage</code> in the form of a static text string. Alternatively, you can also
        use <a href="build-and-manage-parameters.html">Pipeline Parameters</a> a <a href="https://sagemaker.readthedocs.io/en/stable/workflows/pipelines/sagemaker.workflow.pipelines.html?highlight=Join#sagemaker.workflow.functions.Join" rel="noopener noreferrer" target="_blank"><span> Join</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> operation, or other <a href="build-and-manage-steps.html#build-and-manage-properties">step
          properties</a> to create a more informative error message.</p>
      <div class="example"><div class="example-contents"><p>The following example code snippet uses a <code class="code">FailStep</code> with an
            <code class="code">ErrorMessage</code> configured with Pipeline Parameters and a <code class="code">Join</code>
          operation.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="Python ">from sagemaker.workflow.fail_step import FailStep
from sagemaker.workflow.functions import Join
from sagemaker.workflow.parameters import ParameterInteger

mse_threshold_param = ParameterInteger(name="MseThreshold", default_value=5)
step_fail = FailStep(
    name="<code class="replaceable">AbaloneMSEFail</code>",
    error_message=Join(
        on=" ", values=["<code class="replaceable">Execution failed due to MSE &gt;</code>", mse_threshold_param]
    ),
)
</code></pre></div></div>
     
   
    <h2 id="build-and-manage-properties">Step Properties</h2>
    <p>The <code class="code">properties</code> attribute is used to add data dependencies between steps in
      the pipeline. These data dependencies are then used by SageMaker Pipelines to construct the DAG from the
      pipeline definition. These properties can be referenced as placeholder values and are resolved
      at runtime. </p>
    <p>The <code class="code">properties</code> attribute of a SageMaker Pipelines step matches the object returned by a
        <code class="code">Describe</code> call for the corresponding SageMaker job type. For each job type, the
        <code class="code">Describe</code> call returns the following response object:</p>
    <div class="itemizedlist">
       
       
       
    <ul class="itemizedlist"><li class="listitem">
        <p><code class="code">ProcessingStep</code> – <a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_DescribeProcessingJob.html">DescribeProcessingJob</a></p>
      </li><li class="listitem">
        <p><code class="code">TrainingStep</code> – <a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_DescribeTrainingJob.html">DescribeTrainingJob</a></p>
      </li><li class="listitem">
        <p><code class="code">TransformStep</code> – <a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_DescribeTransformJob.html">DescribeTransformJob</a></p>
      </li></ul></div>
    <p>To check which properties are referrable for each step type during data dependency
      creation, see <em><a href="https://sagemaker.readthedocs.io/en/stable/amazon_sagemaker_model_building_pipeline.html#data-dependency-property-reference" rel="noopener noreferrer" target="_blank"><span>Data Dependency - Property Reference</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></em> in the
      <a href="https://sagemaker.readthedocs.io" rel="noopener noreferrer" target="_blank"><span>Amazon SageMaker Python SDK</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p>
   
    <h2 id="build-and-manage-parallelism">Step Parallelism</h2>
    <p>When a step does not depend on any other step, it is run immediately upon pipeline
      execution. However, executing too many pipeline steps in parallel can quickly exhaust
      available resources. Control the number of concurrent steps for a pipeline execution with
        <code class="code">ParallelismConfiguration</code>.</p>
    <p>The following example uses <code class="code">ParallelismConfiguration</code> to set the concurrent
      step limit to five.</p>
    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python ">pipeline.create(
    parallelism_config=ParallelismConfiguration(5),
)</code></pre>
   
    <h2 id="build-and-manage-data-dependency">Data Dependency Between Steps</h2>
    <p>You define the structure of your DAG by specifying the data relationships between steps.
      To create data dependencies between steps, pass the properties of one step as the input to
      another step in the pipeline. The step receiving the input isn't started until after the step
      providing the input finishes running.</p>
    <p>A data dependency uses JsonPath notation in the following format. This format traverses
      the JSON property file, which means you can append as many
        <code class="replaceable">&lt;property&gt;</code> instances as needed to reach the desired nested
      property in the file. For more information on JsonPath notation, see the <a href="https://github.com/json-path/JsonPath" rel="noopener noreferrer" target="_blank"><span>JsonPath repo</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p>
    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python "><code class="replaceable">&lt;step_name&gt;</code>.properties.<code class="replaceable">&lt;property&gt;</code>.<code class="replaceable">&lt;property&gt;</code></code></pre>
    <p>The following shows how to specify an Amazon S3 bucket using the
        <code class="code">ProcessingOutputConfig</code> property of a processing step.</p>
    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python ">step_process.properties.ProcessingOutputConfig.Outputs["train_data"].S3Output.S3Uri</code></pre>
    <p>To create the data dependency, pass the bucket to a training step as follows.</p>
    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python ">from sagemaker.workflow.pipeline_context import PipelineSession

sklearn_train = SKLearn(..., sagemaker_session=PipelineSession())

step_train = TrainingStep(
    name="CensusTrain",
    step_args=sklearn_train.fit(inputs=TrainingInput(
        s3_data=step_process.properties.ProcessingOutputConfig.Outputs[
            "train_data"].S3Output.S3Uri
    ))
)</code></pre>
    <p>To check which properties are referrable for each step type during data dependency
      creation, see <em><a href="https://sagemaker.readthedocs.io/en/stable/amazon_sagemaker_model_building_pipeline.html#data-dependency-property-reference" rel="noopener noreferrer" target="_blank"><span>Data Dependency - Property Reference</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></em> in the
      <a href="https://sagemaker.readthedocs.io" rel="noopener noreferrer" target="_blank"><span>Amazon SageMaker Python SDK</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p>
   
    <h2 id="build-and-manage-custom-dependency">Custom Dependency Between Steps</h2>
    <p>When you specify a data dependency, SageMaker Pipelines provides the data connection between the steps.
      Alternatively, one step can access the data from a previous step without directly using SageMaker Pipelines.
      In this case, you can create a custom dependency that tells SageMaker Pipelines not to start a step until
      after another step has finished running. You create a custom dependency by specifying a step's
        <code class="code">DependsOn</code> attribute.</p>
    <p>As an example, the following defines a step <code class="code">C</code> that starts only after both
      step <code class="code">A</code> and step <code class="code">B</code> finish running.</p>
    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  'Steps': [
    <span>{</span>'Name':'A', ...},
    <span>{</span>'Name':'B', ...},
    <span>{</span>'Name':'C', 'DependsOn': ['A', 'B']}
  ]
}</code></pre>
    <p>SageMaker Pipelines throws a validation exception if the dependency would create a cyclic
      dependency.</p>

    <p>The following example creates a training step that starts after a processing step finishes
      running.</p>
    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python ">processing_step = ProcessingStep(...)
training_step = TrainingStep(...)

training_step.add_depends_on([processing_step])</code></pre>

    <p>The following example creates a training step that doesn't start until two different
      processing steps finish running.</p>
    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python ">processing_step_1 = ProcessingStep(...)
processing_step_2 = ProcessingStep(...)

training_step = TrainingStep(...)

training_step.add_depends_on([processing_step_1, processing_step_2])</code></pre>

    <p>The following provides an alternate way to create the custom dependency.</p>
    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python ">training_step.add_depends_on([processing_step_1])
training_step.add_depends_on([processing_step_2])</code></pre>

    <p>The following example creates a training step that receives input from one processing step
      and waits for a different processing step to finish running.</p>
    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python ">processing_step_1 = ProcessingStep(...)
processing_step_2 = ProcessingStep(...)

training_step = TrainingStep(
    ...,
    inputs=TrainingInput(
        s3_data=processing_step_1.properties.ProcessingOutputConfig.Outputs[
            "train_data"
        ].S3Output.S3Uri
    )

training_step.add_depends_on([processing_step_2])</code></pre>

    <p>The following example shows how to retrieve a string list of the custom dependencies of a
      step.</p>
    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python ">custom_dependencies = training_step.depends_on</code></pre>
   
    <h2 id="build-and-manage-images">Use a Custom Image in a Step</h2>
    <p> You can use any of the available SageMaker <a href="https://github.com/aws/deep-learning-containers/blob/master/available_images.md" rel="noopener noreferrer" target="_blank"><span>Deep
        Learning Container images</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> when you create a step in your pipeline. </p>
    <p>You can also use your own container with pipeline steps. Because you can’t create an image
      from within Amazon SageMaker Studio, you must create your image using another method before using it
      with Amazon SageMaker Model Building Pipelines.</p>
    <p>To use your own container when creating the steps for your pipeline, include the image URI
      in the estimator definition. For more information on using your own container with SageMaker,
        see <a href="your-algorithms.html">Using Docker Containers with SageMaker</a>.</p>
  <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="https://docs.aws.amazon.com/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./build-and-manage-parameters.html">Pipeline Parameters</div><div id="next" class="next-link" accesskey="n" href="./build-and-manage-propertyfile.html">Property Files and
        JsonGet</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=https://docs.aws.amazon.com/en_us/sagemaker/latest/dg/build-and-manage-steps.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=https://docs.aws.amazon.com/en_us/sagemaker/latest/dg/build-and-manage-steps.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>
<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Define a scaling policy - Amazon SageMaker</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="endpoint-auto-scaling-add-code-define" /><meta name="default_state" content="endpoint-auto-scaling-add-code-define" /><link rel="icon" type="image/ico" href="../../../assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="../../../assets/images/favicon.ico" /><link rel="canonical" href="endpoint-auto-scaling-add-code-define.html" /><meta name="description" content="Specify metrics and target values for auto scaling in your scaling policy definition." /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon SageMaker" /><meta name="guide" content="Developer Guide" /><meta name="abstract" content="Use Internet Monitor to build, train, and host machine learning models in AWS." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="endpoint-auto-scaling-add-code-define.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/sagemaker/latest/dg/endpoint-auto-scaling-add-code-define.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/sagemaker/latest/dg/endpoint-auto-scaling-add-code-define.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/sagemaker/latest/dg/endpoint-auto-scaling-add-code-define.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/sagemaker/latest/dg/endpoint-auto-scaling-add-code-define.html" hreflang="de" /><link rel="alternative" href="endpoint-auto-scaling-add-code-define.html" hreflang="en-us" /><link rel="alternative" href="endpoint-auto-scaling-add-code-define.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/sagemaker/latest/dg/endpoint-auto-scaling-add-code-define.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/sagemaker/latest/dg/endpoint-auto-scaling-add-code-define.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/sagemaker/latest/dg/endpoint-auto-scaling-add-code-define.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/sagemaker/latest/dg/endpoint-auto-scaling-add-code-define.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/sagemaker/latest/dg/endpoint-auto-scaling-add-code-define.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/sagemaker/latest/dg/endpoint-auto-scaling-add-code-define.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/sagemaker/latest/dg/endpoint-auto-scaling-add-code-define.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/sagemaker/latest/dg/endpoint-auto-scaling-add-code-define.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/sagemaker/latest/dg/endpoint-auto-scaling-add-code-define.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/sagemaker/latest/dg/endpoint-auto-scaling-add-code-define.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/sagemaker/latest/dg/endpoint-auto-scaling-add-code-define.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/sagemaker/latest/dg/endpoint-auto-scaling-add-code-define.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/sagemaker/latest/dg/endpoint-auto-scaling-add-code-define.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/sagemaker/latest/dg/endpoint-auto-scaling-add-code-define.html" hreflang="zh-tw" /><link rel="alternative" href="endpoint-auto-scaling-add-code-define.html" hreflang="x-default" /><meta name="feedback-item" content="SageMaker" /><meta name="this_doc_product" content="Amazon SageMaker" /><meta name="this_doc_guide" content="Developer Guide" /><script defer="" src="../../../assets/r/vendor4.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/vendor3.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/vendor1.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/awsdocs-common.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/awsdocs-doc-page.js@version=2021.12.02"></script><link href="../../../assets/r/vendor4.css@version=2021.12.02.css" rel="stylesheet" /><link href="../../../assets/r/awsdocs-common.css@version=2021.12.02.css" rel="stylesheet" /><link href="../../../assets/r/awsdocs-doc-page.css@version=2021.12.02.css" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'sagemaker'}"></script><meta id="panorama-serviceSubSection" value="Developer Guide" /><meta id="panorama-serviceConsolePage" value="Define a scaling policy" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Define a scaling policy - Amazon SageMaker</title><meta name="pdf" content="/pdfs/sagemaker/latest/dg/sagemaker-dg.pdf#endpoint-auto-scaling-add-code-define" /><meta name="rss" content="amazon-sagemaker-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=285" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/endpoint-auto-scaling-add-code-define.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/endpoint-auto-scaling-add-code-define.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/endpoint-auto-scaling-add-code-define.html" /><meta name="keywords" content="SageMaker,Amazon SageMaker,machine learning,notebook instance,inference,deploy model,endpoint,prediction,ML application,serverless machine learning,multi model deployment,inference pipelines,ML model,auto scale,custom metric,predefined metrics,online explainability metric" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon SageMaker",
        "item" : "https://docs.aws.amazon.com/sagemaker/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Developer Guide",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Deploy models for inference",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/deploy-model.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Real-time inference",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/realtime-endpoints.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Automatically Scale Amazon SageMaker Models",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/endpoint-auto-scaling.html"
      },
      {
        "@type" : "ListItem",
        "position" : 7,
        "name" : "Define a scaling policy",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/endpoint-auto-scaling.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="https://docs.aws.amazon.com/pdfs/sagemaker/latest/dg/sagemaker-dg.pdf#endpoint-auto-scaling-add-code-define" target="_blank" rel="noopener noreferrer" title="Open PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="https://docs.aws.amazon.com/index.html">Documentation</a><a href="https://docs.aws.amazon.com/sagemaker/index.html">Amazon SageMaker</a><a href="whatis.html">Developer Guide</a></div><div id="page-toc-src"><a href="endpoint-auto-scaling-add-code-define.html#endpoint-auto-scaling-add-code-predefined">Use a predefined
                    metric</a><a href="endpoint-auto-scaling-add-code-define.html#endpoint-auto-scaling-add-code-custom">Use a custom metric</a><a href="endpoint-auto-scaling-add-code-define.html#endpoint-auto-scaling-online-explainability">Use an online
                    explainability metric</a><a href="endpoint-auto-scaling-add-code-define.html#endpoint-auto-scaling-add-code-cooldown">
                    Add a cooldown period</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="endpoint-auto-scaling-add-code-define">Define a scaling policy</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>To specify the metrics and target values for a scaling policy, you configure a
            target-tracking
            scaling policy. You can use
            either
            a predefined metric or a custom metric.</p><p>Scaling
            policy configuration is represented by a JSON block. You save your
            scaling policy configuration as a JSON block in a text file. You use that text file when
            invoking the AWS CLI or the Application Auto Scaling API. For more information about policy configuration
            syntax, see <a href="https://docs.aws.amazon.com/autoscaling/application/APIReference/API_TargetTrackingScalingPolicyConfiguration.html"><code class="code">TargetTrackingScalingPolicyConfiguration</code></a> in the
                <em>Application Auto Scaling API Reference</em>.</p><p> The following options are available for defining a target-tracking scaling policy
            configuration.</p>
            <h2 id="endpoint-auto-scaling-add-code-predefined">Use a predefined
                    metric</h2>
            <p>To quickly define a target-tracking scaling policy for a variant, use the
                    <code class="code">SageMakerVariantInvocationsPerInstance</code>
                
                predefined metric.
                <code class="code">SageMakerVariantInvocationsPerInstance</code> is the average number of times
                per minute that each instance for a variant is invoked.
                We
                strongly recommend using this metric.</p>
            <p></p>
            <p>To use a predefined metric in a scaling policy, create a target tracking
                configuration for your policy. In the target tracking configuration, include a
                    <code class="code">PredefinedMetricSpecification</code> for the predefined metric and a
                    <code class="code">TargetValue</code> for the target value of that metric.</p>
            <div class="example"><div class="example-contents"><p>The following example is a typical policy configuration for target-tracking
                    scaling for a variant. In this configuration, we use the
                        <code class="code">SageMakerVariantInvocationsPerInstance</code> predefined metric to
                    adjust the number of variant instances so that each instance has a
                        <code class="code">InvocationsPerInstance</code> metric of 70. </p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
    "TargetValue": 70.0,
    "PredefinedMetricSpecification":
    <span>{</span>
        "PredefinedMetricType": "SageMakerVariantInvocationsPerInstance"
    }
}</code></pre></div></div>
         
            <h2 id="endpoint-auto-scaling-add-code-custom">Use a custom metric</h2>
            <p>If you need to define a target-tracking scaling policy that meets your custom
                requirements, define a custom metric. You can define a custom metric based on
                any
                production variant metric that changes in proportion to scaling.
                </p>
            <p>Not
                all SageMaker metrics work for target tracking. The metric must be a
                valid utilization metric, and it must describe how busy an instance is. The value of
                the metric must increase or decrease in inverse proportion to the number of variant
                instances. That is, the value of the metric should decrease when the number of
                instances increases.</p>
            <div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>Important</h6></div><div class="awsdocs-note-text"><p>Before deploying automatic scaling in production, you must test automatic
                    scaling with your custom metric.</p></div></div>
            <div class="example"><div class="example-contents"><p>The following example is a target-tracking configuration for a scaling policy.
                    In this configuration, for a variant named <code class="code">my-variant</code>, a custom
                    metric adjusts the variant based on an average CPU utilization of 50 percent
                    across all instances.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
    "TargetValue": 50,
    "CustomizedMetricSpecification":
    <span>{</span>
        "MetricName": "CPUUtilization",
        "Namespace": "/aws/sagemaker/Endpoints",
        "Dimensions": [
            <span>{</span>"Name": "EndpointName", "Value": "my-endpoint" },
            <span>{</span>"Name": "VariantName","Value": "my-variant"}
        ],
        "Statistic": "Average",
        "Unit": "Percent"
    }
}</code></pre></div></div>
         
            <h2 id="endpoint-auto-scaling-online-explainability">Use an online
                    explainability metric</h2>
            <p>This guide shows how to use a metric to track the scaling of endpoints with online
                explainability. When an endpoint has online explainability activated, it emits a
                    <code class="code">ExplanationsPerInstance</code> metric that outputs the average number of
                records explained per minute, per instance, for a <a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_ProductionVariant.html">variant</a>.
                The resource utilization of explaining records can be more different than that of
                predicting records. We strongly recommend using this metric for target-tracking
                scaling of endpoints with online explainability activated.</p>
            <p>To use this online explainability metric inside a scaling policy, create a target
                tracking configuration. In the tracking configuration, include a
                    <code class="code">CustomizedMetricSpecification</code> for the custom metrics and a
                    <code class="code">TargetValue</code> for the target value.</p>
            <p>The following is an example of a policy configuration that uses
                    <code class="code">ExplanationsPerInstance</code>. It is used to adjust the number of variant
                instances so that each instance has an <code class="code">ExplanationsPerInstance</code> metric
                of 20.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python "><span>{</span>
    "TargetValue": 20,
    "CustomizedMetricSpecification":
    <span>{</span>
        "MetricName": "ExplanationsPerInstance",
        "Namespace": "AWS/SageMaker",
        "Dimensions": [
            <span>{</span>"Name": "EndpointName", "Value": "my-endpoint" },
            <span>{</span>"Name": "VariantName","Value": "my-variant"}
        ],
        "Statistic": "Sum"
    }
}
            </code></pre>
            <p><a href="https://docs.aws.amazon.com/autoscaling/application/userguide/application-auto-scaling-target-tracking.html">Application Auto Scaling</a> allows multiple target tracking scaling policies for a
                scalable target. Consider adding the <code class="code">InvocationsPerInstance</code> policy from
                the <a href="endpoint-auto-scaling-add-code-define.html#endpoint-auto-scaling-add-code-predefined">predefined metric</a> section (in addition to the
                    <code class="code">ExplanationsPerInstance</code> policy). For example, if most invocations
                don't return an explanation because of the threshold value set in the
                    <code class="code">EnableExplanations</code> parameter, then the endpoint can choose the
                    <code class="code">InvocationsPerInstance</code> policy. If there is a large number of
                explanations, the endpoint can use the <code class="code">ExplanationsPerInstance</code> policy.
            </p>
         
            <h2 id="endpoint-auto-scaling-add-code-cooldown">
                    Add a cooldown period</h2>
            <p>To add a cooldown period for scaling-out your model, specify a value, in seconds,
                for <code class="code">ScaleOutCooldown</code>. Similarly, to add a cooldown period for
                scaling-in your model, add a value, in seconds, for <code class="code">ScaleInCooldown</code>.
                For more information about <code class="code">ScaleInCooldown</code> and
                    <code class="code">ScaleOutCooldown</code>, see <a href="https://docs.aws.amazon.com/autoscaling/application/APIReference/API_TargetTrackingScalingPolicyConfiguration.html"><code class="code">TargetTrackingScalingPolicyConfiguration</code></a> in the
                    <em>Application Auto Scaling API Reference</em>. </p>
            <div class="example"><div class="example-contents"><p>The following is an example target-tracking configuration for a scaling
                    policy. In this configuration, the
                        <code class="code">SageMakerVariantInvocationsPerInstance</code> predefined metric is
                    used to adjust scaling based on an average of
                    70
                    across all instances of that variant. The configuration
                    provides a scale-in cooldown period of 10 minutes and a scale-out cooldown
                    period of 5 minutes. </p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
    "TargetValue": 70.0,
    "PredefinedMetricSpecification":
    <span>{</span>
        "PredefinedMetricType": "SageMakerVariantInvocationsPerInstance"
    },
    "ScaleInCooldown": 600,
    "ScaleOutCooldown": 300
}</code></pre></div></div>
        <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="https://docs.aws.amazon.com/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./endpoint-auto-scaling-add-policy.html">Register a model</div><div id="next" class="next-link" accesskey="n" href="./endpoint-auto-scaling-add-code-apply.html">Apply a scaling policy</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=https://docs.aws.amazon.com/en_us/sagemaker/latest/dg/endpoint-auto-scaling-add-code-define.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=https://docs.aws.amazon.com/en_us/sagemaker/latest/dg/endpoint-auto-scaling-add-code-define.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>
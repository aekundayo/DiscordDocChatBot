<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Install External Libraries and Kernels in Notebook Instances - Amazon SageMaker</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="nbi-add-external" /><meta name="default_state" content="nbi-add-external" /><link rel="icon" type="image/ico" href="../../../assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="../../../assets/images/favicon.ico" /><link rel="canonical" href="nbi-add-external.html" /><meta name="description" content="Amazon SageMaker notebook instances come with multiple environments already installed. These environments contain Jupyter kernels and Python packages including: scikit, Pandas, NumPy, TensorFlow, and MXNet. These environments, along with all files in the" /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon SageMaker" /><meta name="guide" content="Developer Guide" /><meta name="abstract" content="Use Internet Monitor to build, train, and host machine learning models in AWS." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="nbi-add-external.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/sagemaker/latest/dg/nbi-add-external.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/sagemaker/latest/dg/nbi-add-external.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/sagemaker/latest/dg/nbi-add-external.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/sagemaker/latest/dg/nbi-add-external.html" hreflang="de" /><link rel="alternative" href="nbi-add-external.html" hreflang="en-us" /><link rel="alternative" href="nbi-add-external.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/sagemaker/latest/dg/nbi-add-external.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/sagemaker/latest/dg/nbi-add-external.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/sagemaker/latest/dg/nbi-add-external.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/sagemaker/latest/dg/nbi-add-external.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/sagemaker/latest/dg/nbi-add-external.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/sagemaker/latest/dg/nbi-add-external.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/sagemaker/latest/dg/nbi-add-external.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/sagemaker/latest/dg/nbi-add-external.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/sagemaker/latest/dg/nbi-add-external.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/sagemaker/latest/dg/nbi-add-external.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/sagemaker/latest/dg/nbi-add-external.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/sagemaker/latest/dg/nbi-add-external.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/sagemaker/latest/dg/nbi-add-external.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/sagemaker/latest/dg/nbi-add-external.html" hreflang="zh-tw" /><link rel="alternative" href="nbi-add-external.html" hreflang="x-default" /><meta name="feedback-item" content="SageMaker" /><meta name="this_doc_product" content="Amazon SageMaker" /><meta name="this_doc_guide" content="Developer Guide" /><script defer="" src="../../../assets/r/vendor4.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/vendor3.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/vendor1.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/awsdocs-common.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/awsdocs-doc-page.js@version=2021.12.02"></script><link href="../../../assets/r/vendor4.css@version=2021.12.02.css" rel="stylesheet" /><link href="../../../assets/r/awsdocs-common.css@version=2021.12.02.css" rel="stylesheet" /><link href="../../../assets/r/awsdocs-doc-page.css@version=2021.12.02.css" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'sagemaker'}"></script><meta id="panorama-serviceSubSection" value="Developer Guide" /><meta id="panorama-serviceConsolePage" value="Install External Libraries and Kernels in Notebook Instances" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Install External Libraries and Kernels in Notebook Instances - Amazon SageMaker</title><meta name="pdf" content="/pdfs/sagemaker/latest/dg/sagemaker-dg.pdf#nbi-add-external" /><meta name="rss" content="amazon-sagemaker-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=285" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/nbi-add-external.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/nbi-add-external.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/nbi-add-external.html" /><meta name="keywords" content="SageMaker,Amazon SageMaker,machine learning,notebook instance" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon SageMaker",
        "item" : "https://docs.aws.amazon.com/sagemaker/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Developer Guide",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Use machine learning environments offered by SageMaker",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/machine-learning-environments.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Amazon SageMaker Notebook Instances",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/nbi.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Customize a Notebook Instance Using a Lifecycle Configuration Script",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/notebook-lifecycle-config.html"
      },
      {
        "@type" : "ListItem",
        "position" : 7,
        "name" : "Install External Libraries and Kernels in Notebook Instances",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/notebook-lifecycle-config.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="https://docs.aws.amazon.com/pdfs/sagemaker/latest/dg/sagemaker-dg.pdf#nbi-add-external" target="_blank" rel="noopener noreferrer" title="Open PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="https://docs.aws.amazon.com/index.html">Documentation</a><a href="https://docs.aws.amazon.com/sagemaker/index.html">Amazon SageMaker</a><a href="whatis.html">Developer Guide</a></div><div id="page-toc-src"><a href="nbi-add-external.html#nbi-add-external-tools">Package installation tools</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="nbi-add-external">Install External Libraries and Kernels in Notebook
          Instances</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>Amazon SageMaker notebook instances come with multiple environments already installed. These
      environments contain Jupyter kernels and Python packages including: scikit, Pandas,
      NumPy, TensorFlow, and MXNet. These environments, along with all files in the
          <code class="code">sample-notebooks</code> folder, are refreshed when you stop and start a
      notebook instance. You can also install your own environments that contain your choice
      of packages and kernels.</p><p>The different Jupyter kernels in Amazon SageMaker notebook instances are separate conda
      environments. For information about conda environments, see <a href="https://conda.io/docs/user-guide/tasks/manage-environments.html" rel="noopener noreferrer" target="_blank"><span>Managing
          environments</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> in the <em>Conda</em> documentation.</p><p>Install custom environments and kernels on the notebook instance's Amazon EBS volume. This
      ensures that they persist when you stop and restart the notebook instance, and that any
      external libraries you install are not updated by SageMaker. To do that, use a lifecycle
      configuration that includes both a script that runs when you create the notebook instance
      (<code class="code">on-create)</code> and a script that runs each time you restart the notebook
      instance (<code class="code">on-start</code>). For more information about using notebook instance
      lifecycle configurations, see <a href="notebook-lifecycle-config.html">Customize a Notebook Instance Using a
                Lifecycle Configuration Script</a>. There is a GitHub
      repository that contains sample lifecycle configuration scripts at <a href="https://github.com/aws-samples/amazon-sagemaker-notebook-instance-lifecycle-config-samples" rel="noopener noreferrer" target="_blank"><span>SageMaker
          Notebook Instance Lifecycle Config Samples</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p><p>The examples at <a href="https://github.com/aws-samples/amazon-sagemaker-notebook-instance-lifecycle-config-samples/blob/master/scripts/persistent-conda-ebs/on-create.sh" rel="noopener noreferrer" target="_blank"><span>https://github.com/aws-samples/amazon-sagemaker-notebook-instance-lifecycle-config-samples/blob/master/scripts/persistent-conda-ebs/on-create.sh</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>
      and <a href="https://github.com/aws-samples/amazon-sagemaker-notebook-instance-lifecycle-config-samples/blob/master/scripts/persistent-conda-ebs/on-start.sh" rel="noopener noreferrer" target="_blank"><span>https://github.com/aws-samples/amazon-sagemaker-notebook-instance-lifecycle-config-samples/blob/master/scripts/persistent-conda-ebs/on-start.sh</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>
      show the best practice for installing environments and kernels on a notebook instance.
      The <code class="code">on-create</code>
  script installs the <code class="code">ipykernel</code> library to create custom
      environments
      as Jupyter kernels, then uses <code class="code">pip install</code> and <code class="code">conda
          install</code> to install libraries. You can adapt the script to create custom
      environments and install libraries
      that you want. SageMaker does not update these libraries when you stop and restart the
      notebook instance, so you can ensure that your custom environment has specific
      versions of libraries that you want. The <code class="code">on-start</code> script installs any
      custom environments that you create as Jupyter kernels, so that they appear in the
      dropdown list in the Jupyter <b>New</b> menu.</p>
    <h2 id="nbi-add-external-tools">Package installation tools</h2>
    <p>SageMaker notebooks support the following package installation tools:</p>
    <div class="itemizedlist">
       
       
    <ul class="itemizedlist"><li class="listitem"><p>conda install</p></li><li class="listitem"><p>pip install</p></li></ul></div>
    <p>You can install packages using the following methods:</p>
    <div class="itemizedlist">
       
       
       
    <ul class="itemizedlist"><li class="listitem">
        <p>Lifecycle configuration scripts.</p>
        <p>For example scripts, see
          <a href="https://github.com/aws-samples/amazon-sagemaker-notebook-instance-lifecycle-config-samples" rel="noopener noreferrer" target="_blank"><span>SageMaker
            Notebook Instance Lifecycle Config Samples</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>. For more information on lifecycle configuration, see
          <a href="notebook-lifecycle-config.html">Customize a Notebook Instance Using a Lifecycle
            Configuration Script</a>.</p>
      </li><li class="listitem">
        <p>Notebooks – The following commands are supported.</p>
        <div class="itemizedlist">
           
           
        <ul class="itemizedlist"><li class="listitem"><p><code class="code">%conda install</code></p></li><li class="listitem"><p><code class="code">%pip install</code></p></li></ul></div>
      </li><li class="listitem">
        <p>The Jupyter terminal – You can install packages using pip and conda directly.</p>
      </li></ul></div>
    <p>From within a notebook you can use the system command syntax (lines starting with !) to
      install packages, for example, <code class="code">!pip install</code> and <code class="code">!conda install</code>.
      More recently, new commands have been added to IPython: <code class="code">%pip</code> and <code class="code">%conda</code>.
      These commands are the recommended way to install packages from a notebook as they correctly
      take into account the active environment or interpreter being used. For more information, see
      <a href="https://github.com/ipython/ipython/pull/11524" rel="noopener noreferrer" target="_blank"><span>Add %pip and %conda magic functions</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p>

     
      <h3 id="nbi-add-external-tools-conda">Conda</h3>
      <p>Conda is an open source package management system and environment management system,
        which can install packages and their dependencies. SageMaker supports using Conda with either
        of the two main channels, the default channel, and the conda-forge channel. For more
        information, see
        <a href="https://docs.conda.io/projects/conda/en/latest/user-guide/concepts/channels.html" rel="noopener noreferrer" target="_blank"><span>Conda channels</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.
        The conda-forge channel is a community channel where contributors can upload packages.</p>
      <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>Due to how Conda resolves the dependency graph, installing packages from conda-forge
          can take significantly longer (in the worst cases, upwards of 10 minutes).</p></div></div>
      <p>The Deep Learning AMI comes with many conda environments and many packages
        preinstalled. Due to the number of packages preinstalled, finding a set of packages that
        are guaranteed to be compatible is difficult. You may see a warning "The environment is
        inconsistent, please check the package plan carefully". Despite this warning, SageMaker ensures
        that all the SageMaker provided environments are correct. SageMaker cannot guarantee that any user
        installed packages will function correctly.</p>
      <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>Users of SageMaker, AWS Deep Learning AMI and Amazon EMR can access the commercial Anaconda repository without
          taking a commercial license through February 1, 2024 when using Anaconda in those
          services. For any usage outside of these three services, customers are responsible for
          determining their own Anaconda license requirements.</p></div></div>
      <p>Conda has two methods for activating environments: conda activate/deactivate, and source
        activate/deactivate. For more information, see
        <a href="https://stackoverflow.com/questions/49600611/python-anaconda-should-i-use-conda-activate-or-source-activate-in-linux" rel="noopener noreferrer" target="_blank"><span>Should
         I use 'conda activate' or 'source activate' in Linux</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p>
      <p>SageMaker supports moving Conda environments onto the Amazon EBS volume, which is persisted when
        the instance is stopped. The environments aren't persisted when the environments are installed
        to the root volume, which is the default behavior. For an example lifecycle script, see
        <a href="https://github.com/aws-samples/amazon-sagemaker-notebook-instance-lifecycle-config-samples/tree/master/scripts/persistent-conda-ebs" rel="noopener noreferrer" target="_blank"><span>persistent-conda-ebs</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p>
      <div class="itemizedlist">
        <h6>Supported conda operations (see note at the bottom of this topic)</h6>
         
         
         
         
         
         
         
      <ul class="itemizedlist"><li class="listitem"><p>conda install of a package in a single environment</p></li><li class="listitem"><p>conda install of a package in all environments</p></li><li class="listitem"><p>conda install of a R package in the R environment</p></li><li class="listitem"><p>Installing a package from the main conda repository</p></li><li class="listitem"><p>Installing a package from conda-forge</p></li><li class="listitem"> <p>Changing the Conda install location to use EBS</p></li><li class="listitem"><p>Supporting both conda activate and source activate</p></li></ul></div>
     

     
      <h3 id="nbi-add-external-tools-pip">Pip</h3>
      <p>Pip is the de facto tool for installing and managing Python packages. Pip searches for
        packages on the Python Package Index (PyPI) by default. Unlike Conda, pip doesn't have
        built in environment support, and is not as thorough as Conda when it comes to packages
        with native/system library dependencies. Pip can be used to install packages in Conda
        environments.</p>
      <p>You can use alternative package repositories with pip instead of the PyPI. For an example
        lifecycle script, see
        <a href="https://github.com/aws-samples/amazon-sagemaker-notebook-instance-lifecycle-config-samples/blob/master/scripts/add-pypi-repository/on-start.sh" rel="noopener noreferrer" target="_blank"><span>on-start.sh</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p>
      <div class="itemizedlist">
        <h6>Supported pip operations (see note at the bottom of this topic)</h6>
         
         
         
         
         
      <ul class="itemizedlist"><li class="listitem"><p>Using pip to install a package without an active conda environment (install packages system wide)</p></li><li class="listitem"><p>Using pip to install a package in a conda environment</p></li><li class="listitem"><p>Using pip to install a package in all conda environments</p></li><li class="listitem"> <p>Changing the pip install location to use EBS</p></li><li class="listitem"><p>Using an alternative repository to install packages with pip</p></li></ul></div>
     

     
      <h3 id="nbi-add-external-tools-misc">Unsupported</h3>
      <p>SageMaker aims to support as many package installation operations as possible. However,
        if the packages were installed by SageMaker or DLAMI, and you use the following operations on these
        packages, it might make your notebook instance unstable:</p>
      <div class="itemizedlist">
         
         
         
      <ul class="itemizedlist"><li class="listitem"><p>Uninstalling</p></li><li class="listitem"><p>Downgrading</p></li><li class="listitem"><p>Upgrading</p></li></ul></div>
      <p>We do not provide support for installing packages via yum install or installing R
        packages from CRAN.</p>
      <p>Due to potential issues with network conditions or configurations, or the availability
        of Conda or PyPi, we cannot guarantee that packages will install in a fixed or deterministic
        amount of time.</p>
      <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>We cannot guarantee that a package installation will be successful. Attempting to
          install a package in an environment with incompatible dependencies can result in a
          failure. In such a case you should contact the library maintainer to see if it is
          possible to update the package dependencies. Alternatively you can attempt to modify
          the environment in such a way as to allow the installation. This modification however
          will likely mean removing or updating existing packages, which means we can no longer
          guarantee stability of this environment.</p></div></div>
     

  <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="https://docs.aws.amazon.com/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./nbi-lifecycle-config-install.html">Lifecycle Configuration Best
                    Practices</div><div id="next" class="next-link" accesskey="n" href="./nbi-software-updates.html">Notebook Instance Software Updates</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=https://docs.aws.amazon.com/en_us/sagemaker/latest/dg/nbi-add-external.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=https://docs.aws.amazon.com/en_us/sagemaker/latest/dg/nbi-add-external.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>
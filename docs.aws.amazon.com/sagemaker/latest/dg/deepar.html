<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>DeepAR Forecasting Algorithm - Amazon SageMaker</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="deepar" /><meta name="default_state" content="deepar" /><link rel="icon" type="image/ico" href="../../../assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="../../../assets/images/favicon.ico" /><link rel="canonical" href="deepar.html" /><meta name="description" content="The Amazon SageMaker DeepAR forecasting algorithm is a supervised learning algorithm for forecasting scalar (one-dimensional) time series using recurrent neural networks (RNN). Classical forecasting methods, such as autoregressive integrated moving average (ARIMA) or exponential smoothing (ETS), fit a single model to each individual time series. They then use that model to extrapolate the time series into the future." /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon SageMaker" /><meta name="guide" content="Developer Guide" /><meta name="abstract" content="Use Internet Monitor to build, train, and host machine learning models in AWS." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="deepar.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/sagemaker/latest/dg/deepar.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/sagemaker/latest/dg/deepar.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/sagemaker/latest/dg/deepar.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/sagemaker/latest/dg/deepar.html" hreflang="de" /><link rel="alternative" href="deepar.html" hreflang="en-us" /><link rel="alternative" href="deepar.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/sagemaker/latest/dg/deepar.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/sagemaker/latest/dg/deepar.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/sagemaker/latest/dg/deepar.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/sagemaker/latest/dg/deepar.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/sagemaker/latest/dg/deepar.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/sagemaker/latest/dg/deepar.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/sagemaker/latest/dg/deepar.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/sagemaker/latest/dg/deepar.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/sagemaker/latest/dg/deepar.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/sagemaker/latest/dg/deepar.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/sagemaker/latest/dg/deepar.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/sagemaker/latest/dg/deepar.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/sagemaker/latest/dg/deepar.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/sagemaker/latest/dg/deepar.html" hreflang="zh-tw" /><link rel="alternative" href="deepar.html" hreflang="x-default" /><meta name="feedback-item" content="SageMaker" /><meta name="this_doc_product" content="Amazon SageMaker" /><meta name="this_doc_guide" content="Developer Guide" /><script defer="" src="../../../assets/r/vendor4.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/vendor3.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/vendor1.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/awsdocs-common.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/awsdocs-doc-page.js@version=2021.12.02"></script><link href="../../../assets/r/vendor4.css@version=2021.12.02.css" rel="stylesheet" /><link href="../../../assets/r/awsdocs-common.css@version=2021.12.02.css" rel="stylesheet" /><link href="../../../assets/r/awsdocs-doc-page.css@version=2021.12.02.css" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'sagemaker'}"></script><meta id="panorama-serviceSubSection" value="Developer Guide" /><meta id="panorama-serviceConsolePage" value="DeepAR Forecasting Algorithm" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>DeepAR Forecasting Algorithm - Amazon SageMaker</title><meta name="pdf" content="/pdfs/sagemaker/latest/dg/sagemaker-dg.pdf#deepar" /><meta name="rss" content="amazon-sagemaker-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=285" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/deepar.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/deepar.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/deepar.html" /><meta name="keywords" content="SageMaker,Amazon SageMaker,machine learning,notebook instance" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon SageMaker",
        "item" : "https://docs.aws.amazon.com/sagemaker/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Developer Guide",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Train machine learning models",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/train-model.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Choose an Algorithm",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/algorithms-choose.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Use Amazon SageMaker Built-in Algorithms or Pre-trained Models",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/algos.html"
      },
      {
        "@type" : "ListItem",
        "position" : 7,
        "name" : "Built-in SageMaker Algorithms for Time-Series Data",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/algorithms-time-series.html"
      },
      {
        "@type" : "ListItem",
        "position" : 8,
        "name" : "DeepAR Forecasting Algorithm",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/algorithms-time-series.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="https://docs.aws.amazon.com/pdfs/sagemaker/latest/dg/sagemaker-dg.pdf#deepar" target="_blank" rel="noopener noreferrer" title="Open PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="https://docs.aws.amazon.com/index.html">Documentation</a><a href="https://docs.aws.amazon.com/sagemaker/index.html">Amazon SageMaker</a><a href="whatis.html">Developer Guide</a></div><div id="page-toc-src"><a href="deepar.html#deepar-inputoutput">Input/Output Interface for the DeepAR
                Algorithm</a><a href="deepar.html#deepar_best_practices"> Best Practices for Using the DeepAR
                Algorithm</a><a href="deepar.html#deepar-instances">EC2 Instance Recommendations for the DeepAR
                Algorithm</a><a href="deepar.html#deepar-sample-notebooks">Sample Notebooks</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="deepar">DeepAR
            Forecasting Algorithm</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>The Amazon SageMaker DeepAR forecasting algorithm is a supervised learning algorithm for
        forecasting scalar (one-dimensional) time series using recurrent neural networks (RNN).
        Classical forecasting methods, such as autoregressive integrated moving average (ARIMA) or
        exponential smoothing (ETS), fit a single model to each individual time series. They then
        use that model to extrapolate the time series into the future. </p><p>In many applications, however, you have many similar time series across a set of
        cross-sectional units. For example, you might have time series groupings for demand for
        different products, server loads, and requests for webpages. For this type of application,
        you can benefit from training a single model jointly over all of the time series. DeepAR
        takes this approach. When your dataset contains hundreds of related time series, DeepAR
        outperforms the standard ARIMA and ETS methods. You can also use the trained model to
        generate forecasts for new time series that are similar to the ones it has been trained
        on.</p><p>The training input for the DeepAR algorithm is one or, preferably, more
            <code class="code">target</code> time series that have been generated by the same process or similar
        processes. Based on this input dataset, the algorithm trains a model that learns an
        approximation of this process/processes and uses it to predict how the target time series
        evolves. Each target time series can be optionally associated with a vector of static
        (time-independent) categorical features provided by the <code class="code">cat</code> field and a vector
        of dynamic (time-dependent) time series provided by the <code class="code">dynamic_feat</code> field.
        SageMaker trains the DeepAR model by randomly sampling training examples from each target time
        series in the training dataset. Each training example consists of a pair of adjacent context
        and prediction windows with fixed predefined lengths. To control how far in the past the
        network can see, use the <code class="code">context_length</code> hyperparameter. To control how far in
        the future predictions can be made, use the <code class="code">prediction_length</code> hyperparameter.
        For more information, see <a href="deepar_how-it-works.html">How the DeepAR Algorithm Works</a>.</p><div class="highlights"><h6>Topics</h6><ul><li><a href="deepar.html#deepar-inputoutput">Input/Output Interface for the DeepAR
                Algorithm</a></li><li><a href="deepar.html#deepar_best_practices"> Best Practices for Using the DeepAR
                Algorithm</a></li><li><a href="deepar.html#deepar-instances">EC2 Instance Recommendations for the DeepAR
                Algorithm</a></li><li><a href="deepar.html#deepar-sample-notebooks">DeepAR Sample Notebooks</a></li><li><a href="deepar_how-it-works.html">How the DeepAR Algorithm Works</a></li><li><a href="deepar_hyperparameters.html">DeepAR Hyperparameters</a></li><li><a href="deepar-tuning.html">Tune a DeepAR Model</a></li><li><a href="deepar-in-formats.html">DeepAR Inference Formats</a></li></ul></div>

        <h2 id="deepar-inputoutput">Input/Output Interface for the DeepAR
                Algorithm</h2>
        <p>DeepAR supports two data channels. The required <code class="code">train</code> channel describes
            the training dataset. The optional <code class="code">test</code> channel describes a dataset that
            the algorithm uses to evaluate model accuracy after training. You can provide training
            and test datasets in <a href="http://jsonlines.org/" rel="noopener noreferrer" target="_blank"><span>JSON Lines</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> format. Files
            can be in gzip or <a href="https://parquet.apache.org/" rel="noopener noreferrer" target="_blank"><span>Parquet</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> file
            format.</p>
        <p>When specifying the paths for the training and test data, you can specify a single
            file or a directory that contains multiple files, which can be stored in subdirectories.
            If you specify a directory, DeepAR uses all files in the directory as inputs for the
            corresponding channel, except those that start with a period (.) and those named
                <em>_SUCCESS</em>. This ensures that you can directly use output folders
            produced by Spark jobs as input channels for your DeepAR training jobs.</p>
        <p>By default, the DeepAR model determines the input format from the file extension
                (<code class="code">.json</code>, <code class="code">.json.gz</code>, or <code class="code">.parquet</code>) in the
            specified input path. If the path does not end in one of these extensions, you must
            explicitly specify the format in the SDK for Python. Use the <code class="code">content_type</code>
            parameter of the <a href="https://sagemaker.readthedocs.io/en/stable/session.html#sagemaker.session.s3_input" rel="noopener noreferrer" target="_blank"><span>s3_input</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> class.</p>
        <p>The records in your input files should contain the following fields:</p>
        <div class="itemizedlist">
             
             
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><code class="code">start</code>—A string with the format <code class="code">YYYY-MM-DD
                        HH:MM:SS</code>. The start timestamp can't contain time zone
                    information.</p>
            </li><li class="listitem">
                <p><code class="code">target</code>—An array of floating-point values or integers that
                    represent the time series. You can encode missing values as <code class="code">null</code>
                    literals, or as <code class="code">"NaN"</code> strings in JSON, or as <code class="code">nan</code>
                    floating-point values in Parquet.</p>
            </li><li class="listitem">
                <p><code class="code">dynamic_feat</code> (optional)—An array of arrays of
                    floating-point values or integers that represents the vector of custom feature
                    time series (dynamic features). If you set this field, all records must have the
                    same number of inner arrays (the same number of feature time series). In
                    addition, each inner array must be the same length as the associated
                        <code class="code">target</code> value plus <code class="code">prediction_length</code>. Missing
                    values are not supported in the features. For example, if target time series
                    represents the demand of different products, an associated
                        <code class="code">dynamic_feat</code> might be a boolean time-series which indicates
                    whether a promotion was applied (1) to the particular product or not (0): </p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>"start": ..., "target": [1, 5, 10, 2], "dynamic_feat": [[0, 1, 1, 0]]}</code></pre>
            </li><li class="listitem">
                <p><code class="code">cat</code> (optional)—An array of categorical features that can
                    be used to encode the groups that the record belongs to. Categorical features
                    must be encoded as a 0-based sequence of positive integers. For example, the
                    categorical domain <span>{</span>R, G, B} can be encoded as <span>{</span>0, 1, 2}. All values from each
                    categorical domain must be represented in the training dataset. That's because
                    the DeepAR algorithm can forecast only for categories that have been observed
                    during training. And, each categorical feature is embedded in a low-dimensional
                    space whose dimensionality is controlled by the <code class="code">embedding_dimension</code>
                    hyperparameter. For more information, see <a href="deepar_hyperparameters.html">DeepAR Hyperparameters</a>.</p>
            </li></ul></div>
        <p>If you use a JSON file, it must be in <a href="http://jsonlines.org/" rel="noopener noreferrer" target="_blank"><span>JSON
                Lines</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> format. For example:</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>"start": "2009-11-01 00:00:00", "target": [4.3, "NaN", 5.1, ...], "cat": [0, 1], "dynamic_feat": [[1.1, 1.2, 0.5, ...]]}
<span>{</span>"start": "2012-01-30 00:00:00", "target": [1.0, -5.0, ...], "cat": [2, 3], "dynamic_feat": [[1.1, 2.05, ...]]}
<span>{</span>"start": "1999-01-30 00:00:00", "target": [2.0, 1.0], "cat": [1, 4], "dynamic_feat": [[1.3, 0.4]]}</code></pre>
        <p>In this example, each time series has two associated categorical features and one time
            series features.</p>
        <p>For Parquet, you use the
            same
            three fields as
            columns.
            In addition, <code class="code">"start"</code> can be the <code class="code">datetime</code> type. You can
            compress Parquet files using gzip (<code class="code">gzip</code>) or the Snappy compression library
                (<code class="code">snappy</code>).</p>
        <p>If the algorithm is trained without <code class="code">cat</code> and <code class="code">dynamic_feat</code>
            fields, it learns a "global" model, that is a model that is agnostic to the specific
            identity of the target time series at inference time and is conditioned only on its
            shape.</p>
        <p>If the model is conditioned on the <code class="code">cat</code> and <code class="code">dynamic_feat</code>
            feature data provided for each time series, the prediction will probably be influenced
            by the character of time series with the corresponding <code class="code">cat</code> features. For
            example, if the <code class="code">target</code> time series represents the demand of clothing items,
            you can associate a two-dimensional <code class="code">cat</code> vector that encodes the type of
            item (e.g. 0 = shoes, 1 = dress) in the first component and the color of an item (e.g. 0
            = red, 1 = blue) in the second component. A sample input would look as follows:</p>

        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span> "start": ..., "target": ..., "cat": [0, 0], ... } # red shoes
<span>{</span> "start": ..., "target": ..., "cat": [1, 1], ... } # blue dress</code></pre>

        <p>At inference time, you can request predictions for targets with <code class="code">cat</code>
            values that are combinations of the <code class="code">cat</code> values observed in the training
            data, for example:</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span> "start": ..., "target": ..., "cat": [0, 1], ... } # blue shoes
<span>{</span> "start": ..., "target": ..., "cat": [1, 0], ... } # red dress</code></pre>

        <p>The following guidelines apply to training data:</p>
        <div class="itemizedlist">
             
             
             
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p>The start time and length of the time series can differ. For example, in
                    marketing, products often enter a retail catalog at different dates, so their
                    start dates naturally differ. But all series must have the same frequency,
                    number of categorical features, and number of dynamic features. </p>
            </li><li class="listitem">
                <p>Shuffle the training file with respect to the position of the time series in
                    the file. In other words, the time series should occur in random order in the
                    file.</p>
            </li><li class="listitem">
                <p>Make sure to set the <code class="code">start</code> field correctly. The algorithm uses
                    the <code class="code">start</code> timestamp to derive the internal features. </p>
            </li><li class="listitem">
                <p>If you use categorical features (<code class="code">cat</code>), all time series must have
                    the same number of categorical features. If the dataset contains the
                        <code class="code">cat</code> field, the algorithm uses it and extracts the cardinality
                    of the groups from the dataset. By default, <code class="code">cardinality</code> is
                        <code class="code">"auto"</code>. If the dataset contains the <code class="code">cat</code> field, but
                    you don't want to use it, you can disable it by setting <code class="code">cardinality</code>
                    to <code class="code">""</code>. If a model was trained using a <code class="code">cat</code> feature, you
                    must include it for inference.</p>
            </li><li class="listitem">
                <p>If your dataset contains the <code class="code">dynamic_feat</code> field, the algorithm
                    uses it automatically. All time series have to have the same number of feature
                    time series. The time points in each of the feature time series correspond
                    one-to-one to the time points in the target. In addition, the entry in the
                        <code class="code">dynamic_feat</code> field should have the same length as the
                        <code class="code">target</code>. If the dataset contains the <code class="code">dynamic_feat</code>
                    field, but you don't want to use it, disable it by
                        setting(<code class="code">num_dynamic_feat</code> to <code class="code">""</code>). If the model was
                    trained with the <code class="code">dynamic_feat</code> field, you must provide this field
                    for inference. In addition, each of the features has to have the length of the
                    provided target plus the <code class="code">prediction_length</code>. In other words, you
                    must provide the feature value in the future.</p>
            </li></ul></div>
        <p>If you specify optional test channel data, the DeepAR algorithm evaluates the trained
            model with
            different
            accuracy metrics. The algorithm calculates the root mean square error (RMSE) over the
            test data as follows:</p>
        <div class="mediaobject">
             
                <img src="../../../images/sagemaker/latest/dg/images/deepar-1.png" class="aws-docs-img-whiteBg aws-docs-img-padding" alt="&#xA;                RMSE Formula: Sqrt(1/nT(Sum[i,t](y-hat(i,t)-y(i,t))^2))&#xA;            " style="max-width:100%" />
             
             
        </div>
        <p><em>y</em><sub><em>i</em>,<em>t</em></sub>
            is the true value of time series <em>i</em> at the time
                <em>t</em>.
                    <em>ŷ</em><sub><em>i</em>,<em>t</em></sub>
            is the mean prediction. The sum is over all <em>n</em> time series in the
            test set and over the last Τ time points for each time series, where Τ
            corresponds to the forecast horizon. You specify the length of the forecast horizon by
            setting the <code class="code">prediction_length</code> hyperparameter. For more information, see
                <a href="deepar_hyperparameters.html">DeepAR Hyperparameters</a>.</p>
        <p>In addition, the algorithm evaluates the accuracy of the forecast distribution using
            weighted quantile loss. For a quantile in the range [0, 1], the weighted quantile loss
            is defined as follows:</p>
        <div class="mediaobject">
             
                <img src="../../../images/sagemaker/latest/dg/images/deepar-2.png" class="aws-docs-img-whiteBg aws-docs-img-padding" alt="&#xA;                Quantile loss&#xA;            " style="max-width:100%" />
             
             
        </div>
        <p>
            <em>q</em><sub><em>i</em>,<em>t</em></sub><sup>(τ)</sup>
            is the τ-quantile of the distribution that the model predicts. To specify which
            quantiles to calculate loss for, set the <code class="code">test_quantiles</code> hyperparameter. In
            addition to these, the average of the prescribed quantile losses is reported as part of
            the training logs. For information, see <a href="deepar_hyperparameters.html">DeepAR Hyperparameters</a>. </p>
        <p>For inference, DeepAR accepts JSON format and the following fields:</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p>
                    <code class="code">"instances"</code>, which includes one or more time series in JSON Lines
                    format</p>
            </li><li class="listitem">
                <p> A name of <code class="code">"configuration"</code>, which includes parameters for
                    generating the forecast </p>
            </li></ul></div>
        <p>For more information, see <a href="deepar-in-formats.html">DeepAR Inference Formats</a>.</p>

     
        <h2 id="deepar_best_practices"> Best Practices for Using the DeepAR
                Algorithm</h2>
        <p>When preparing your time series data, follow these best practices to achieve the best
            results:</p>
        <div class="itemizedlist">
             
             
             
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p>Except for when splitting your dataset for training and testing, always
                    provide the entire time series for training, testing, and when calling the model
                    for inference. Regardless of how you set <code class="code">context_length</code>, don't
                    break up the time series or provide only a part of it. The model uses data
                    points further back than the value set in <code class="code">context_length</code> for the
                    lagged values feature.</p>
            </li><li class="listitem">
                <p>When tuning a DeepAR model, you can split the dataset to create a training
                    dataset and a test dataset. In a typical evaluation, you would test the model on
                    the same time series used for training, but on the future
                        <code class="code">prediction_length</code> time points that follow immediately after the
                    last time point visible during training. You can create training and test
                    datasets that satisfy this criteria by using the entire dataset (the full length
                    of all time series that are available) as a test set and removing the last
                        <code class="code">prediction_length</code> points from each time series for training.
                    During training, the model doesn't see the target values for time points on
                    which it is evaluated during testing. During testing, the algorithm withholds
                    the last <code class="code">prediction_length</code> points of each time series in the test
                    set and generates a prediction. Then it compares the forecast with the withheld
                    values. You can create more complex evaluations by repeating time series
                    multiple times in the test set, but cutting them at different endpoints. With
                    this approach, accuracy metrics are averaged over multiple forecasts from
                    different time points. For more information, see <a href="deepar-tuning.html">Tune a DeepAR Model</a>.</p>
            </li><li class="listitem">
                <p>Avoid using very large values (&gt;400) for the <code class="code">prediction_length</code>
                    because it makes the model slow and less accurate. If you want to forecast
                    further into the future, consider aggregating your data at a lower frequency.
                    For example, use <code class="code">5min</code> instead of <code class="code">1min</code>.</p>
            </li><li class="listitem">
                <p>Because lags are used, a model can look further back in the time series than
                    the value specified for <code class="code">context_length</code>. Therefore, you don't need
                    to set this parameter to a large value. We recommend starting with the value
                    that you used for <code class="code">prediction_length</code>.</p>
            </li><li class="listitem">
                <p>We recommend training a DeepAR model on as many time series as are available.
                    Although a DeepAR model trained on a single time series might work well,
                    standard forecasting algorithms, such as ARIMA or ETS, might provide more
                    accurate results. The DeepAR algorithm starts to outperform the standard methods
                    when your dataset contains hundreds of related time series. Currently, DeepAR
                    requires that the total number of observations available across all training
                    time series is at least 300.</p>
            </li></ul></div>
     
        <h2 id="deepar-instances">EC2 Instance Recommendations for the DeepAR
                Algorithm</h2>
        <p>You can train DeepAR on both GPU and CPU instances and in both single and
            multi-machine settings. We recommend starting with a single CPU instance (for example,
            ml.c4.2xlarge or ml.c4.4xlarge), and switching to GPU instances and multiple machines
            only when necessary. Using GPUs and multiple machines improves throughput only for
            larger models (with many cells per layer and many layers) and for large mini-batch sizes
            (for example, greater than 512).</p>
        <p>For inference, DeepAR supports only CPU instances.</p>
        <p>Specifying large values for <code class="code">context_length</code>,
                <code class="code">prediction_length</code>, <code class="code">num_cells</code>, <code class="code">num_layers</code>, or
                <code class="code">mini_batch_size</code> can create models that are too large for small
            instances. In this case, use a larger instance type or reduce the values for these
            parameters. This problem also frequently occurs when running hyperparameter tuning jobs.
            In that case, use an instance type large enough for the model tuning job and consider
            limiting the upper values of the critical parameters to avoid job failures. </p>
     
        <h2 id="deepar-sample-notebooks">DeepAR Sample Notebooks</h2>

        <p>For a sample notebook that shows how to prepare a time series dataset for training the
            SageMaker DeepAR algorithm and how to deploy the trained model for performing inferences, see
                <a href="https://sagemaker-examples.readthedocs.io/en/latest/introduction_to_amazon_algorithms/deepar_electricity/DeepAR-Electricity.html" rel="noopener noreferrer" target="_blank"><span>DeepAR demo on electricity dataset</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>, which illustrates the advanced features
            of DeepAR on a real world dataset. For instructions on creating and accessing Jupyter
            notebook instances that you can use to run the example in SageMaker, see <a href="nbi.html">Amazon SageMaker Notebook Instances</a>. After creating and opening a notebook instance, choose the
                <b>SageMaker Examples</b> tab to see a list of all of the SageMaker
            examples. To open a notebook, choose its <b>Use</b> tab, and
            choose <b>Create copy</b>.</p>
    <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="https://docs.aws.amazon.com/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./algorithms-time-series.html">Time-Series</div><div id="next" class="next-link" accesskey="n" href="./deepar_how-it-works.html">How DeepAR Works</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=https://docs.aws.amazon.com/en_us/sagemaker/latest/dg/deepar.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=https://docs.aws.amazon.com/en_us/sagemaker/latest/dg/deepar.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>
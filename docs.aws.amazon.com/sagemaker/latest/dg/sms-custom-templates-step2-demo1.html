<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Demo Template: Annotation of Images with crowd-bounding-box - Amazon SageMaker</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="sms-custom-templates-step2-demo1" /><meta name="default_state" content="sms-custom-templates-step2-demo1" /><link rel="icon" type="image/ico" href="../../../assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="../../../assets/images/favicon.ico" /><link rel="canonical" href="sms-custom-templates-step2-demo1.html" /><meta name="description" content="When you chose to use a custom template as your task type in the Amazon SageMaker Ground Truth console, you reach the Custom labeling task panel . There you can choose from multiple base templates. The templates represent some of the most common tasks and provide a sample to work from as you create your customized labeling task's template. If you are not using the console, or as an additional recourse, see" /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon SageMaker" /><meta name="guide" content="Developer Guide" /><meta name="abstract" content="Use Internet Monitor to build, train, and host machine learning models in AWS." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="sms-custom-templates-step2-demo1.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/sagemaker/latest/dg/sms-custom-templates-step2-demo1.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/sagemaker/latest/dg/sms-custom-templates-step2-demo1.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/sagemaker/latest/dg/sms-custom-templates-step2-demo1.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/sagemaker/latest/dg/sms-custom-templates-step2-demo1.html" hreflang="de" /><link rel="alternative" href="sms-custom-templates-step2-demo1.html" hreflang="en-us" /><link rel="alternative" href="sms-custom-templates-step2-demo1.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/sagemaker/latest/dg/sms-custom-templates-step2-demo1.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/sagemaker/latest/dg/sms-custom-templates-step2-demo1.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/sagemaker/latest/dg/sms-custom-templates-step2-demo1.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/sagemaker/latest/dg/sms-custom-templates-step2-demo1.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/sagemaker/latest/dg/sms-custom-templates-step2-demo1.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/sagemaker/latest/dg/sms-custom-templates-step2-demo1.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/sagemaker/latest/dg/sms-custom-templates-step2-demo1.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/sagemaker/latest/dg/sms-custom-templates-step2-demo1.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/sagemaker/latest/dg/sms-custom-templates-step2-demo1.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/sagemaker/latest/dg/sms-custom-templates-step2-demo1.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/sagemaker/latest/dg/sms-custom-templates-step2-demo1.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/sagemaker/latest/dg/sms-custom-templates-step2-demo1.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/sagemaker/latest/dg/sms-custom-templates-step2-demo1.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/sagemaker/latest/dg/sms-custom-templates-step2-demo1.html" hreflang="zh-tw" /><link rel="alternative" href="sms-custom-templates-step2-demo1.html" hreflang="x-default" /><meta name="feedback-item" content="SageMaker" /><meta name="this_doc_product" content="Amazon SageMaker" /><meta name="this_doc_guide" content="Developer Guide" /><script defer="" src="../../../assets/r/vendor4.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/vendor3.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/vendor1.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/awsdocs-common.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/awsdocs-doc-page.js@version=2021.12.02"></script><link href="../../../assets/r/vendor4.css@version=2021.12.02.css" rel="stylesheet" /><link href="../../../assets/r/awsdocs-common.css@version=2021.12.02.css" rel="stylesheet" /><link href="../../../assets/r/awsdocs-doc-page.css@version=2021.12.02.css" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'sagemaker'}"></script><meta id="panorama-serviceSubSection" value="Developer Guide" /><meta id="panorama-serviceConsolePage" value="Demo Template: Annotation of Images with crowd-bounding-box" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Demo Template: Annotation of Images with crowd-bounding-box - Amazon SageMaker</title><meta name="pdf" content="/pdfs/sagemaker/latest/dg/sagemaker-dg.pdf#sms-custom-templates-step2-demo1" /><meta name="rss" content="amazon-sagemaker-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=285" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/sms-custom-templates-step2-demo1.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/sms-custom-templates-step2-demo1.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/sms-custom-templates-step2-demo1.html" /><meta name="keywords" content="SageMaker,Amazon SageMaker,machine learning,notebook instance" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon SageMaker",
        "item" : "https://docs.aws.amazon.com/sagemaker/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Developer Guide",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Label data with a human-in-the-loop",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/data-label.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Use Amazon SageMaker Ground Truth to Label Data",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/sms.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Creating Custom Labeling Workflows",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/sms-custom-templates.html"
      },
      {
        "@type" : "ListItem",
        "position" : 7,
        "name" : "Demo Template: Annotation of Images with crowd-bounding-box",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/sms-custom-templates.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="https://docs.aws.amazon.com/pdfs/sagemaker/latest/dg/sagemaker-dg.pdf#sms-custom-templates-step2-demo1" target="_blank" rel="noopener noreferrer" title="Open PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="https://docs.aws.amazon.com/index.html">Documentation</a><a href="https://docs.aws.amazon.com/sagemaker/index.html">Amazon SageMaker</a><a href="whatis.html">Developer Guide</a></div><div id="page-toc-src"><a href="sms-custom-templates-step2-demo1.html#sms-custom-templates-step2-demo1-base-template">Starter Bounding Box custom template</a><a href="sms-custom-templates-step2-demo1.html#sms-custom-templates-step2-demo1-your-own-template">Your own Bounding Box custom template</a><a href="sms-custom-templates-step2-demo1.html#sms-custom-templates-step2-demo1-manifest">Your manifest file</a><a href="sms-custom-templates-step2-demo1.html#sms-custom-templates-step2-demo1-pre-annotation">Your pre-annotation Lambda function</a><a href="sms-custom-templates-step2-demo1.html#sms-custom-templates-step2-demo1-post-annotation">Your post-annotation Lambda function</a><a href="sms-custom-templates-step2-demo1.html#sms-custom-templates-step2-demo1-job-output">The output of your labeling job</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="sms-custom-templates-step2-demo1">Demo Template: Annotation of Images with <code class="code">crowd-bounding-box</code></h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>When you chose to use a custom template as your task type in the Amazon SageMaker Ground Truth
            console, you reach the <b>Custom labeling task panel</b>. There you can
            choose from multiple base templates. The templates represent some of the most common
            tasks and provide a sample to work from as you create your customized labeling task's
            template. If you are not using the console, or as an additional recourse, see <a href="https://github.com/aws-samples/amazon-sagemaker-ground-truth-task-uis" rel="noopener noreferrer" target="_blank"><span>Amazon SageMaker
                Ground Truth Sample Task UIs </span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> for a repository of demo templates
            for a variety of labeling job task types.</p><p>This demonstration works with the <b>BoundingBox</b> template. The
            demonstration also works with the AWS Lambda functions needed for processing your data
            before and after the task. In the Github repository above, to find templates that work
            with AWS Lambda functions, look for <code class="code"><span>{</span><span>{</span> task.input.<code class="replaceable">&lt;property
                    name&gt;</code> }}</code> in the template.</p><div class="highlights" id="inline-topiclist"><h6>Topics</h6><ul><li><a href="sms-custom-templates-step2-demo1.html#sms-custom-templates-step2-demo1-base-template">Starter Bounding Box custom template</a></li><li><a href="sms-custom-templates-step2-demo1.html#sms-custom-templates-step2-demo1-your-own-template">Your own Bounding Box custom template</a></li><li><a href="sms-custom-templates-step2-demo1.html#sms-custom-templates-step2-demo1-manifest">Your manifest file</a></li><li><a href="sms-custom-templates-step2-demo1.html#sms-custom-templates-step2-demo1-pre-annotation">Your pre-annotation Lambda function</a></li><li><a href="sms-custom-templates-step2-demo1.html#sms-custom-templates-step2-demo1-post-annotation">Your post-annotation Lambda function</a></li><li><a href="sms-custom-templates-step2-demo1.html#sms-custom-templates-step2-demo1-job-output">The output of your labeling job</a></li></ul></div>
                <h2 id="sms-custom-templates-step2-demo1-base-template">Starter Bounding Box custom template</h2>
                <p>This is the starter bounding box template that is provided.</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="html ">&lt;script src="https://assets.crowd.aws/crowd-html-elements.js"&gt;&lt;/script&gt;

&lt;crowd-form&gt;
  &lt;crowd-bounding-box
    name="boundingBox"
    src="<span>{</span><span>{</span> task.input.taskObject | grant_read_access }}"
    header="<span>{</span><span>{</span> task.input.header }}"
    labels="<span>{</span><span>{</span> task.input.labels | to_json | escape }}"
  &gt;

    &lt;!-- The &lt;full-instructions&gt; tag is where you will define the full instructions of your task. --&gt;
    &lt;full-instructions header="Bounding Box Instructions" &gt;
      &lt;p&gt;Use the bounding box tool to draw boxes around the requested target of interest:&lt;/p&gt;
      &lt;ol&gt;
        &lt;li&gt;Draw a rectangle using your mouse over each instance of the target.&lt;/li&gt;
        &lt;li&gt;Make sure the box does not cut into the target, leave a 2 - 3 pixel margin&lt;/li&gt;
        &lt;li&gt;
          When targets are overlapping, draw a box around each object,
          include all contiguous parts of the target in the box.
          Do not include parts that are completely overlapped by another object.
        &lt;/li&gt;
        &lt;li&gt;
          Do not include parts of the target that cannot be seen,
          even though you think you can interpolate the whole shape of the target.
        &lt;/li&gt;
        &lt;li&gt;Avoid shadows, they're not considered as a part of the target.&lt;/li&gt;
        &lt;li&gt;If the target goes off the screen, label up to the edge of the image.&lt;/li&gt;
      &lt;/ol&gt;
    &lt;/full-instructions&gt;

    &lt;!-- The &lt;short-instructions&gt; tag allows you to specify instructions that are displayed in the left hand side of the task interface.
    It is a best practice to provide good and bad examples in this section for quick reference. --&gt;
    &lt;short-instructions&gt;
      Use the bounding box tool to draw boxes around the requested target of interest.
    &lt;/short-instructions&gt;
  &lt;/crowd-bounding-box&gt;
&lt;/crowd-form&gt;
</code></pre>
                
            
            <p>The custom templates use the <a href="https://shopify.github.io/liquid/" rel="noopener noreferrer" target="_blank"><span>Liquid
                    template language</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>, and each of the items between double curly braces is
                a variable. The pre-annotation AWS Lambda function should provide an object named
                    <code class="code">taskInput</code> and that object's properties can be accessed as <code class="code"><span>{</span><span>{</span>
                    task.input.&lt;property name&gt; }}</code> in your template.</p>
             
                    <h2 id="sms-custom-templates-step2-demo1-your-own-template">Your own Bounding Box custom template</h2>
                
              <p>As an example, assume you have a large collection of animal photos in which you
                know the kind of animal in an image from a prior image-classification job. Now you
                want to have a bounding box drawn around it.</p>
            <p>In the starter sample, there are three variables: <code class="code">taskObject</code>, <code class="code">header</code>, and <code class="code">labels</code>.</p>
            <p>Each of these would be represented in different parts of the bounding box.</p>
            <div class="itemizedlist">
                 
                 
                 
            <ul class="itemizedlist"><li class="listitem"><p><code class="code">taskObject</code> is an HTTP(S) URL or S3 URI for the photo to be annotated. The added <code class="code">| grant_read_access</code> is a filter that will convert an S3 URI to an HTTPS URL with short-lived access to that resource. If you're using an HTTP(S) URL, it's not needed.</p></li><li class="listitem"><p><code class="code">header</code> is the text above the photo to be labeled, something like "Draw a box around the bird in the photo."</p></li><li class="listitem"><p><code class="code">labels</code> is an array, represented as <code class="code">['item1', 'item2', ...]</code>. These are labels that can be assigned by the worker to the different boxes they draw. You can have one or many.</p></li></ul></div>
            <p>Each of the variable names come from the JSON object in the response from your pre-annotation Lambda, The names above are merely suggested, Use whatever variable names make sense to you and will promote code readability among your team.</p>
            <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Only use variables when necessary</h6></div><div class="awsdocs-note-text"><p>If a field will not change, you can remove that variable from the template and replace it with that text, otherwise you have to repeat that text as a value in each object in your manifest or code it into your pre-annotation Lambda function.</p></div></div>
            
            <div class="example"><h6>Example : Final Customized Bounding Box Template</h6><div class="example-contents"><p>To keep things simple, this template will have one variable, one label, and very basic instructions. Assuming your manifest has an "animal" property in each data object, that value can be re-used in two parts of the template.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="html ">&lt;script src="https://assets.crowd.aws/crowd-html-elements.js"&gt;&lt;/script&gt;
&lt;crowd-form&gt;
  &lt;crowd-bounding-box
    name="boundingBox"
    labels="[ '<span>{</span><span>{</span> task.input.animal }}' ]"
    src="<span>{</span><span>{</span> task.input.source-ref | grant_read_access }}"
    header="Draw a box around the <span>{</span><span>{</span> task.input.animal }}."
  &gt;
    &lt;full-instructions header="Bounding Box Instructions" &gt;
      &lt;p&gt;Draw a bounding box around the <span>{</span><span>{</span> task.input.animal }} in the image. If 
      there is more than one <span>{</span><span>{</span> task.input.animal }} per image, draw a bounding 
      box around the largest one.&lt;/p&gt;
      &lt;p&gt;The box should be tight around the <span>{</span><span>{</span> task.input.animal }} with 
      no more than a couple of pixels of buffer around the 
      edges.&lt;/p&gt;
      &lt;p&gt;If the image does not contain a <span>{</span><span>{</span> task.input.animal }}, check the &lt;strong&gt;
      Nothing to label&lt;/strong&gt; box.
    &lt;/full-instructions&gt;
    &lt;short-instructions&gt;
      &lt;p&gt;Draw a bounding box around the <span>{</span><span>{</span> task.input.animal }} in each image. If 
      there is more than one <span>{</span><span>{</span> task.input.animal }} per image, draw a bounding 
      box around the largest one.&lt;/p&gt;
    &lt;/short-instructions&gt;
  &lt;/crowd-bounding-box&gt;
&lt;/crowd-form&gt;</code></pre><p>Note the re-use of <code class="code"><span>{</span><span>{</span> task.input.animal }}</code> throughout the template. If your manifest had all of the animal names beginning with a capital letter, you could use <code class="code"><span>{</span><span>{</span> task.input.animal | downcase }}</code>, incorporating one of Liquid's built-in filters in sentences where it needed to be presented lowercase.</p></div></div>
     
                    <h2 id="sms-custom-templates-step2-demo1-manifest">Your manifest file</h2>
                
                <p>Your manifest file should provide the variable values you're using in your template. You can do some transformation of your manifest data in your pre-annotation Lambda, but if you don't need to, you maintain a lower risk of errors and your Lambda will run faster. Here's a sample manifest file for the template.</p>
                
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>"source-ref": "&lt;S3 image URI&gt;", "animal": "horse"}
<span>{</span>"source-ref": "&lt;S3 image URI&gt;", "animal" : "bird"}
<span>{</span>"source-ref": "&lt;S3 image URI&gt;", "animal" : "dog"}
<span>{</span>"source-ref": "&lt;S3 image URI&gt;", "animal" : "cat"}</code></pre>
             
                    <h2 id="sms-custom-templates-step2-demo1-pre-annotation">Your pre-annotation Lambda function</h2>      

                <p>As part of the job set-up, provide the ARN of an AWS Lambda function that can
                be called to process your manifest entries and pass them to the template
                engine.</p>
                    
                    <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Naming your Lambda function</h6></div><div class="awsdocs-note-text"><p>The best practice in naming your function is to use one of the following
                    four strings as part of the function name: <code class="code">SageMaker</code>,
                        <code class="code">Sagemaker</code>, <code class="code">sagemaker</code>, or
                        <code class="code">LabelingFunction</code>. This applies to both your pre-annotation and
                    post-annotation functions.</p></div></div>
                
                <p>When you're using the console, if you have AWS Lambda functions that are owned
                by your account, a drop-down list of functions meeting the naming requirements will
                be provided to choose one.</p>
                
               <p>In this very basic example, you're just passing through the information from
                the manifest without doing any additional processing on it. This sample
                pre-annotation function is written for Python 3.7.</p>
               
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python ">import json

def lambda_handler(event, context):
    return <span>{</span>
        "taskInput": event['dataObject']
    }</code></pre>
                <p>The JSON object from your manifest will be provided as a child of the <code class="code">event</code> object. The properties inside the <code class="code">taskInput</code> object will be available as variables to your template, so simply setting the value of <code class="code">taskInput</code> to <code class="code">event['dataObject']</code> will pass all the values from your manifest object to your template without having to copy them individually. If you wish to send more values to the template, you can add them to the <code class="code">taskInput</code> object.</p>
             
                    <h2 id="sms-custom-templates-step2-demo1-post-annotation">Your post-annotation Lambda function</h2>
                    <p>As part of the job set-up, provide the ARN of an AWS Lambda function that
                can be called to process the form data when a worker completes a task. This can be
                as simple or complex as you want. If you want to do answer consolidation and scoring
                as it comes in, you can apply the scoring and/or consolidation algorithms of your
                choice. If you want to store the raw data for offline processing, that is an
                option.</p>
                <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Provide permissions to your post-annotation Lambda</h6></div><div class="awsdocs-note-text"><p>The annotation data will be in a file designated by the <code class="code">s3Uri</code>
                    string in the <code class="code">payload</code> object. To process the annotations as they
                    come in, even for a simple pass through function, you need to assign
                        <code class="code">S3ReadOnly</code> access to your Lambda so it can read the annotation
                    files.</p><p>In the Console page for creating your Lambda, scroll to the <b>Execution role</b> panel. Select <b>Create a new role from one or more templates</b>. Give the role a name. From the <b>Policy templates</b> drop-down, choose <b>Amazon S3 object read-only permissions</b>. Save the Lambda and the role will be saved and selected.</p></div></div>
                <p>The following sample is in Python 2.7.</p>
                
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python ">import json
import boto3
from urlparse import urlparse

def lambda_handler(event, context):
    consolidated_labels = []

    parsed_url = urlparse(event['payload']['s3Uri']);
    s3 = boto3.client('s3')
    textFile = s3.get_object(Bucket = parsed_url.netloc, Key = parsed_url.path[1:])
    filecont = textFile['Body'].read()
    annotations = json.loads(filecont);
    
    for dataset in annotations:
        for annotation in dataset['annotations']:
            new_annotation = json.loads(annotation['annotationData']['content'])
            label = <span>{</span>
                'datasetObjectId': dataset['datasetObjectId'],
                'consolidatedAnnotation' : <span>{</span>
                'content': <span>{</span>
                    event['labelAttributeName']: <span>{</span>
                        'workerId': annotation['workerId'],
                        'boxesInfo': new_annotation,
                        'imageSource': dataset['dataObject']
                        }
                    }
                }
            }
            consolidated_labels.append(label)
    
    return consolidated_labels</code></pre>

                    <p>The post-annotation Lambda will often receive batches of task results in
                the event object. That batch will be the <code class="code">payload</code> object the Lambda
                should iterate through. What you send back will be an object meeting the <a href="sms-custom-templates-step3.html">API contract</a>.</p>
                   
                 
                    <h2 id="sms-custom-templates-step2-demo1-job-output">The output of your labeling job</h2>
            
            <p>You'll find the output of the job in a folder named after your labeling job in the target S3 bucket you specified. It will be in a subfolder named <code class="code">manifests</code>.</p>
            <p>For a bounding box task, the output you find in the output manifest will look a
                bit like the demo below. The example has been cleaned up for printing. The actual
                output will be a single line per record.</p>
            <div class="example"><h6>Example : JSON in your output manifest</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><span>{</span>
  "source-ref":"&lt;URL&gt;",
  "&lt;<code class="replaceable">label attribute name</code>&gt;":
    <span>{</span>
       "workerId":"&lt;URL&gt;",
       "imageSource":"&lt;image URL&gt;",
       "boxesInfo":"<span>{</span>\"boundingBox\":<span>{</span>\"boundingBoxes\":[<span>{</span>\"height\":878, \"label\":\"bird\", \"left\":208, \"top\":6, \"width\":809}], \"inputImageProperties\":<span>{</span>\"height\":924, \"width\":1280}}}"},
  "&lt;<code class="replaceable">label attribute name</code>&gt;-metadata":
    <span>{</span>
      "type":"groundTruth/custom",
      "job_name":"&lt;Labeling job name&gt;",
      "human-annotated":"yes"
    },
  "animal" : "bird"
}</code></pre><p>Note how the additional <code class="code">animal</code> attribute from your original manifest is passed to the output manifest on the same level as the <code class="code">source-ref</code> and labeling data. Any properties from your input manifest, whether they were used in your template or not, will be passed to the output manifest.</p></div></div>
                <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="https://docs.aws.amazon.com/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./sms-custom-templates-step3-lambda-test.html">Test Pre-Annotation and Post-Annotation Lambda Functions</div><div id="next" class="next-link" accesskey="n" href="./sms-custom-templates-step2-demo2.html">Demo: Text Intent with crowd-classifier</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=https://docs.aws.amazon.com/en_us/sagemaker/latest/dg/sms-custom-templates-step2-demo1.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=https://docs.aws.amazon.com/en_us/sagemaker/latest/dg/sms-custom-templates-step2-demo1.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>
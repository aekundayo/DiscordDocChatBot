<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Connect to an Amazon EMR cluster from your Studio notebook - Amazon SageMaker</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="scheduled-notebook-connect-emr" /><meta name="default_state" content="scheduled-notebook-connect-emr" /><link rel="icon" type="image/ico" href="../../../assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="../../../assets/images/favicon.ico" /><link rel="canonical" href="scheduled-notebook-connect-emr.html" /><meta name="description" content="Connecting to Amazon EMR in your Jupyter notebook in Studio." /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon SageMaker" /><meta name="guide" content="Developer Guide" /><meta name="abstract" content="Use Internet Monitor to build, train, and host machine learning models in AWS." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="scheduled-notebook-connect-emr.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/sagemaker/latest/dg/scheduled-notebook-connect-emr.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/sagemaker/latest/dg/scheduled-notebook-connect-emr.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/sagemaker/latest/dg/scheduled-notebook-connect-emr.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/sagemaker/latest/dg/scheduled-notebook-connect-emr.html" hreflang="de" /><link rel="alternative" href="scheduled-notebook-connect-emr.html" hreflang="en-us" /><link rel="alternative" href="scheduled-notebook-connect-emr.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/sagemaker/latest/dg/scheduled-notebook-connect-emr.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/sagemaker/latest/dg/scheduled-notebook-connect-emr.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/sagemaker/latest/dg/scheduled-notebook-connect-emr.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/sagemaker/latest/dg/scheduled-notebook-connect-emr.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/sagemaker/latest/dg/scheduled-notebook-connect-emr.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/sagemaker/latest/dg/scheduled-notebook-connect-emr.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/sagemaker/latest/dg/scheduled-notebook-connect-emr.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/sagemaker/latest/dg/scheduled-notebook-connect-emr.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/sagemaker/latest/dg/scheduled-notebook-connect-emr.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/sagemaker/latest/dg/scheduled-notebook-connect-emr.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/sagemaker/latest/dg/scheduled-notebook-connect-emr.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/sagemaker/latest/dg/scheduled-notebook-connect-emr.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/sagemaker/latest/dg/scheduled-notebook-connect-emr.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/sagemaker/latest/dg/scheduled-notebook-connect-emr.html" hreflang="zh-tw" /><link rel="alternative" href="scheduled-notebook-connect-emr.html" hreflang="x-default" /><meta name="feedback-item" content="SageMaker" /><meta name="this_doc_product" content="Amazon SageMaker" /><meta name="this_doc_guide" content="Developer Guide" /><script defer="" src="../../../assets/r/vendor4.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/vendor3.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/vendor1.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/awsdocs-common.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/awsdocs-doc-page.js@version=2021.12.02"></script><link href="../../../assets/r/vendor4.css@version=2021.12.02.css" rel="stylesheet" /><link href="../../../assets/r/awsdocs-common.css@version=2021.12.02.css" rel="stylesheet" /><link href="../../../assets/r/awsdocs-doc-page.css@version=2021.12.02.css" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'sagemaker'}"></script><meta id="panorama-serviceSubSection" value="Developer Guide" /><meta id="panorama-serviceConsolePage" value="Connect to an Amazon EMR cluster from your Studio notebook" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Connect to an Amazon EMR cluster from your Studio notebook - Amazon SageMaker</title><meta name="pdf" content="/pdfs/sagemaker/latest/dg/sagemaker-dg.pdf#scheduled-notebook-connect-emr" /><meta name="rss" content="amazon-sagemaker-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=285" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/scheduled-notebook-connect-emr.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/scheduled-notebook-connect-emr.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/scheduled-notebook-connect-emr.html" /><meta name="keywords" content="SageMaker,Amazon SageMaker,machine learning,notebook instance" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon SageMaker",
        "item" : "https://docs.aws.amazon.com/sagemaker/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Developer Guide",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Implement MLOps",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/mlops.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "SageMaker Workflows",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/workflows.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "SageMaker Notebook Jobs",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/notebook-auto-run.html"
      },
      {
        "@type" : "ListItem",
        "position" : 7,
        "name" : "Create and manage your scheduled notebook jobs",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/create-manage-notebook-auto-run.html"
      },
      {
        "@type" : "ListItem",
        "position" : 8,
        "name" : "Schedule a notebook job",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/create-notebook-auto-run.html"
      },
      {
        "@type" : "ListItem",
        "position" : 9,
        "name" : "Connect to an Amazon EMR cluster from your Studio notebook",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/create-notebook-auto-run.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="https://docs.aws.amazon.com/pdfs/sagemaker/latest/dg/sagemaker-dg.pdf#scheduled-notebook-connect-emr" target="_blank" rel="noopener noreferrer" title="Open PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="https://docs.aws.amazon.com/index.html">Documentation</a><a href="https://docs.aws.amazon.com/sagemaker/index.html">Amazon SageMaker</a><a href="whatis.html">Developer Guide</a></div><div id="page-toc-src"><a href="scheduled-notebook-connect-emr.html#scheduled-notebook-connect-emr-pass-param">Pass parameters
              to your EMR connection command</a><a href="scheduled-notebook-connect-emr.html#scheduled-notebook-connect-emr-credentials">Pass user
              credentials to your Kerberos, LDAP, or HTTP Basic Auth-authenticated Amazon EMR
              cluster</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="scheduled-notebook-connect-emr">Connect to an Amazon EMR cluster from your Studio notebook</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>If you connect to an Amazon EMR cluster from your Jupyter notebook in Studio, you might need to perform additional
          setup. In particular, the following discussion addresses two issues:</p><div class="itemizedlist">
           
           
        <ul class="itemizedlist"><li class="listitem">
            <p><b>Passing parameters into your Amazon EMR connection
                command</b>. In SparkMagic kernels, parameters you pass to your Amazon EMR
              connection command may not work as expected due to differences in how Papermill passes
              parameters and how SparkMagic receives parameters. The workaround to address this
              limitation is to pass parameters as environment variables. For more details about the
              issue and workaround, see <a href="scheduled-notebook-connect-emr.html#scheduled-notebook-connect-emr-pass-param">Pass parameters to your EMR
              connection command</a>.</p>
          </li><li class="listitem">
            <p><b>Passing user credentials to Kerberos, LDAP, or HTTP Basic
                Auth-authenticated Amazon EMR clusters</b>. In interactive mode, Studio asks for
              credentials in a popup form where you can enter your sign-in credentials. In your
              noninteractive scheduled notebook, you have to pass them through the AWS Secrets Manager. For
              more details about how to use the AWS Secrets Manager in your scheduled notebook jobs, see <a href="scheduled-notebook-connect-emr.html#scheduled-notebook-connect-emr-credentials">Pass user credentials to
              your Kerberos, LDAP, or HTTP Basic Auth-authenticated Amazon EMR cluster</a>.</p>
          </li></ul></div>
          <h2 id="scheduled-notebook-connect-emr-pass-param">Pass parameters to your EMR
              connection command</h2>
          <p>If you are using images with the SparkMagic PySpark and Spark kernels and want to
            parameterize your EMR connection command, provide your parameters in the
            <b>Environment variables</b> field instead of the Parameters field in the Create Job form (in the <b>Additional
              Options</b> dropdown menu). Make sure your EMR
            connection command in the Jupyter notebook passes these parameters as environment
            variables. For example, suppose you pass <code class="code">cluster-id</code> as an environment
            variable when you create your job. Your EMR connection command should look like the
            following:</p>
          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="py ">%%local
import os</code></pre>
          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="py ">%sm_analytics emr connect —cluster-id <span>{</span>os.getenv('cluster_id')} --auth-type None</code></pre>
          <p>You need this workaround to meet requirements by SparkMagic and Papermill. For
            background context, the SparkMagic kernel expects that the <code class="code">%%local</code> magic
            command accompany any local variables you define. However, Papermill does not pass the
              <code class="code">%%local</code> magic command with your overrides. In order to work around this
            Papermill limitation, you must supply your parameters as environment variables in the
              <b>Environment variables</b> field.</p>
         
          <h2 id="scheduled-notebook-connect-emr-credentials">Pass user credentials to
              your Kerberos, LDAP, or HTTP Basic Auth-authenticated Amazon EMR cluster</h2>
          <p>To establish a secure connection to an Amazon EMR cluster that uses Kerberos, LDAP, or HTTP
            Basic Auth authentication, you use the AWS Secrets Manager to pass user credentials to your
            connection command. For information about how to create a Secrets Manager secret, see
              <a href="https://docs.aws.amazon.com/secretsmanager/latest/userguide/create_secret.html">Create an AWS Secrets Manager secret</a>. You pass the secret with the
              <code class="code">--secrets</code> argument, as shown in the following example:</p>
          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="py ">%sm_analytics emr connect --cluster-id j_abcde12345 
    --auth Kerberos 
    --secret aws_secret_id_123</code></pre>
          <p>Your administrator can set up a flexible access policy using an
            attribute-based-access-control (ABAC) method, which assigns access based on special
            tags. You can set up flexible access to create a single secret for all users in the
            account or a secret for each user. The following code samples demonstrate these
            scenarios:</p>
          <p><b>Create a single secret for all users in the
            account</b></p>
          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="py "><span>{</span>
    "Version" : "2012-10-17",
    "Statement" : [ 
        <span>{</span>
            "Effect": "Allow",
            "Principal" : <span>{</span>"AWS" : "arn:aws:iam::<code class="replaceable">AWS_ACCOUNT_ID</code>:role/service-role/AmazonSageMaker-ExecutionRole-20190101T012345"},

            "Action" : "secretsmanager:GetSecretValue",
            "Resource" : [  "arn:aws:secretsmanager:us-west-2:<code class="replaceable">AWS_ACCOUNT_ID</code>:secret:aes123-1a2b3c", 
                            "arn:aws:secretsmanager:us-west-2:<code class="replaceable">AWS_ACCOUNT_ID</code>:secret:aes456-4d5e6f", 
                            "arn:aws:secretsmanager:us-west-2:<code class="replaceable">AWS_ACCOUNT_ID</code>:secret:aes789-7g8h9i" ]
        }
    ]
}</code></pre>
          <p><b>Create a different secret for each user</b></p>

          <p>You can create a different secret for each user using the <code class="code">PrincipleTag</code>
            tag, as shown in the following example:</p>
          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="py "><span>{</span>
    "Version" : "2012-10-17",
    "Statement" : [ 
        <span>{</span>
            "Effect": "Allow",
            "Principal" : <span>{</span>"AWS" : "arn:aws:iam::<code class="replaceable">AWS_ACCOUNT_ID</code>:role/service-role/AmazonSageMaker-ExecutionRole-20190101T012345"},
            "Condition" : <span>{</span>
                "StringEquals" : <span>{</span>
                    "aws:ResourceTag/<code class="replaceable">user-identity</code>": "$<span>{</span>aws:PrincipalTag/<code class="replaceable">user-identity</code>}"
                }
            },
            "Action" : "secretsmanager:GetSecretValue",
            "Resource" : [  "arn:aws:secretsmanager:us-west-2:<code class="replaceable">AWS_ACCOUNT_ID</code>:secret:aes123-1a2b3c", 
                            "arn:aws:secretsmanager:us-west-2:<code class="replaceable">AWS_ACCOUNT_ID</code>:secret:aes456-4d5e6f", 
                            "arn:aws:secretsmanager:us-west-2:<code class="replaceable">AWS_ACCOUNT_ID</code>:secret:aes789-7g8h9i" ]
        }
    ]
}</code></pre>
        <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="https://docs.aws.amazon.com/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./create-notebook-auto-execution-advanced-default.html">Set up default options for
            local notebooks</div><div id="next" class="next-link" accesskey="n" href="./notebook-auto-run-troubleshoot-override.html">Parameterize your notebook</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=https://docs.aws.amazon.com/en_us/sagemaker/latest/dg/scheduled-notebook-connect-emr.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=https://docs.aws.amazon.com/en_us/sagemaker/latest/dg/scheduled-notebook-connect-emr.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>
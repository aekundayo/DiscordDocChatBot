<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Security and Permissions - Amazon SageMaker</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="data-wrangler-security" /><meta name="default_state" content="data-wrangler-security" /><link rel="icon" type="image/ico" href="../../../assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="../../../assets/images/favicon.ico" /><link rel="canonical" href="data-wrangler-security.html" /><meta name="description" content="Understand the permissions needed to use Data Wrangler." /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon SageMaker" /><meta name="guide" content="Developer Guide" /><meta name="abstract" content="Use Internet Monitor to build, train, and host machine learning models in AWS." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="data-wrangler-security.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/sagemaker/latest/dg/data-wrangler-security.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/sagemaker/latest/dg/data-wrangler-security.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/sagemaker/latest/dg/data-wrangler-security.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/sagemaker/latest/dg/data-wrangler-security.html" hreflang="de" /><link rel="alternative" href="data-wrangler-security.html" hreflang="en-us" /><link rel="alternative" href="data-wrangler-security.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/sagemaker/latest/dg/data-wrangler-security.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/sagemaker/latest/dg/data-wrangler-security.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/sagemaker/latest/dg/data-wrangler-security.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/sagemaker/latest/dg/data-wrangler-security.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/sagemaker/latest/dg/data-wrangler-security.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/sagemaker/latest/dg/data-wrangler-security.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/sagemaker/latest/dg/data-wrangler-security.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/sagemaker/latest/dg/data-wrangler-security.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/sagemaker/latest/dg/data-wrangler-security.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/sagemaker/latest/dg/data-wrangler-security.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/sagemaker/latest/dg/data-wrangler-security.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/sagemaker/latest/dg/data-wrangler-security.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/sagemaker/latest/dg/data-wrangler-security.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/sagemaker/latest/dg/data-wrangler-security.html" hreflang="zh-tw" /><link rel="alternative" href="data-wrangler-security.html" hreflang="x-default" /><meta name="feedback-item" content="SageMaker" /><meta name="this_doc_product" content="Amazon SageMaker" /><meta name="this_doc_guide" content="Developer Guide" /><script defer="" src="../../../assets/r/vendor4.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/vendor3.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/vendor1.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/awsdocs-common.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/awsdocs-doc-page.js@version=2021.12.02"></script><link href="../../../assets/r/vendor4.css@version=2021.12.02.css" rel="stylesheet" /><link href="../../../assets/r/awsdocs-common.css@version=2021.12.02.css" rel="stylesheet" /><link href="../../../assets/r/awsdocs-doc-page.css@version=2021.12.02.css" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'sagemaker'}"></script><meta id="panorama-serviceSubSection" value="Developer Guide" /><meta id="panorama-serviceConsolePage" value="Security and Permissions" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Security and Permissions - Amazon SageMaker</title><meta name="pdf" content="/pdfs/sagemaker/latest/dg/sagemaker-dg.pdf#data-wrangler-security" /><meta name="rss" content="amazon-sagemaker-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=285" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/data-wrangler-security.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/data-wrangler-security.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/data-wrangler-security.html" /><meta name="keywords" content="SageMaker,Amazon SageMaker,machine learning,notebook instance" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon SageMaker",
        "item" : "https://docs.aws.amazon.com/sagemaker/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Developer Guide",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Prepare data",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/data-prep.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Prepare ML Data with Amazon SageMaker Data Wrangler",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/data-wrangler.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Security and Permissions",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/data-wrangler.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="https://docs.aws.amazon.com/pdfs/sagemaker/latest/dg/sagemaker-dg.pdf#data-wrangler-security" target="_blank" rel="noopener noreferrer" title="Open PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="https://docs.aws.amazon.com/index.html">Documentation</a><a href="https://docs.aws.amazon.com/sagemaker/index.html">Amazon SageMaker</a><a href="whatis.html">Developer Guide</a></div><div id="page-toc-src"><a href="data-wrangler-security.html#data-wrangler-security-bucket-policy">Add a Bucket Policy To
                    Restrict Access to Datasets Imported to Data Wrangler</a><a href="data-wrangler-security.html#data-wrangler-security-allowlist">Create an Allowlist for Data Wrangler</a><a href="data-wrangler-security.html#data-wrangler-security-iam-policy">Grant an IAM Role Permission
                    to Use Data Wrangler</a><a href="data-wrangler-security.html#data-wrangler-security-snowflake">Snowflake and Data Wrangler</a><a href="data-wrangler-security.html#data-wrangler-security-kms">Data Encryption with AWS KMS</a><a href="data-wrangler-security.html#data-wrangler-appflow-permissions">Amazon AppFlow Permissions</a><a href="data-wrangler-security.html#data-wrangler-lifecycle-configuration">Using Lifecycle Configurations in
                Data Wrangler</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="data-wrangler-security">Security and Permissions</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>When you query data from Athena or Amazon Redshift, the queried dataset is automatically stored in
            the default SageMaker S3 bucket for the AWS Region in which you are using Studio.
            Additionally, when you export a Jupyter Notebook from Amazon SageMaker Data Wrangler and run it, your data
            flows, or .flow files, are saved to the same default bucket, under the prefix <em>data_wrangler_flows</em>.</p><p>For high-level security needs, you can configure a bucket policy that restricts the
            AWS roles that have access to this default SageMaker S3 bucket. Use the following section
            to add this type of policy to an S3 bucket. To follow the instructions on this page, use
            the AWS Command Line Interface (AWS CLI). To learn how, see <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-configure.html">Configuring the AWS CLI</a>
            in the IAM User Guide.</p><p>Additionally, you need to grant each IAM role that uses Data Wrangler permissions to access
            required resources. If you do not require granular permissions for the IAM role you
            use to access Data Wrangler, you can add the IAM managed policy, <a href="https://console.aws.amazon.com/iam/home?#/policies/arn:aws:iam::aws:policy/AmazonSageMakerFullAccess" rel="noopener noreferrer" target="_blank"><span><code class="code">AmazonSageMakerFullAccess</code></span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>, to an IAM role that you use
            to create your Studio user. This policy grants you full permission to use Data Wrangler. If
            you require more granular permissions, refer to the section, <a href="data-wrangler-security.html#data-wrangler-security-iam-policy">Grant an IAM Role Permission
                    to Use Data Wrangler</a>.</p>
            <h2 id="data-wrangler-security-bucket-policy">Add a Bucket Policy To
                    Restrict Access to Datasets Imported to Data Wrangler</h2>
            <p>You can add a policy to the S3 bucket that contains your Data Wrangler resources using an
                Amazon S3 bucket policy. Resources that Data Wrangler uploads to your default SageMaker S3 bucket in
                the AWS Region you are using Studio in include the following:</p>
            <div class="itemizedlist">
                 
                 
                 
            <ul class="itemizedlist"><li class="listitem">
                    <p>Queried Amazon Redshift results. These are stored under the <em>redshift/</em> prefix.</p>
                </li><li class="listitem">
                    <p>Queried Athena results. These are stored under the <em>athena/</em> prefix. </p>
                </li><li class="listitem">
                    <p>The .flow files uploaded to Amazon S3 when you run an exported Jupyter Notebook
                        Data Wrangler produces. These are stored under the <em>data_wrangler_flows/</em> prefix.</p>
                </li></ul></div>
            <p>Use the following procedure to create an S3 bucket policy that you can add to
                restrict IAM role access to that bucket. To learn how to add a policy to an S3
                bucket, see <a href="https://docs.aws.amazon.com/AmazonS3/latest/user-guide/add-bucket-policy.html">How do I add an S3
                    Bucket policy?</a>.</p>
            <div class="procedure"><h6>To set up a bucket policy on the S3 bucket that stores your Data Wrangler
                    resources:</h6><ol><li>
                    <p>Configure one or more IAM roles that you want to be able to access
                        Data Wrangler.</p>
                </li><li>
                    <p>Open a command prompt or shell. For each role that you create, replace
                            <code class="replaceable">role-name</code> with the name of the role and run
                        the following:</p>
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">$ aws iam get-role --role-name <code class="replaceable">role-name</code></code></pre>
                    <p>In the response, you see a <code class="code">RoleId</code> string which begins with
                            <code class="code">AROA</code>. Copy this string. </p>
                </li><li>
                    <p>Add the following policy to the SageMaker default bucket in the AWS Region in
                        which you are using Data Wrangler. Replace <code class="replaceable">region</code> with the
                        AWS Region in which the bucket is located, and
                            <code class="replaceable">account-id</code> with your AWS account ID.
                        Replace <code class="code">userId</code>s starting with
                            <code class="replaceable">AROAEXAMPLEID</code> with the IDs of an AWS roles
                        to which you want to grant permission to use Data Wrangler. </p>
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Effect": "Deny",
      "Principal": "*",
      "Action": "s3:*",
      "Resource": [
        "arn:aws:s3:::sagemaker-<code class="replaceable">region</code>-<code class="replaceable">account-id</code>/data_wrangler_flows/",
        "arn:aws:s3:::sagemaker-<code class="replaceable">region</code>-<code class="replaceable">account-id</code>/data_wrangler_flows/*",
        "arn:aws:s3:::sagemaker-<code class="replaceable">region</code>-<code class="replaceable">account-id</code>/athena",
        "arn:aws:s3:::sagemaker-<code class="replaceable">region</code>-<code class="replaceable">account-id</code>/athena/*",
        "arn:aws:s3:::sagemaker-<code class="replaceable">region</code>-<code class="replaceable">account-id</code>/redshift",
        "arn:aws:s3:::sagemaker-<code class="replaceable">region</code>-<code class="replaceable">account-id</code>/redshift/*"
        
      ],
      "Condition": <span>{</span>
        "StringNotLike": <span>{</span>
          "aws:userId": [
            "<code class="replaceable">AROAEXAMPLEID_1</code>:*",
            "<code class="replaceable">AROAEXAMPLEID_2</code>:*"
          ]
        }
      }
    }
  ]
}</code></pre>
                </li></ol></div>
         
        <h2 id="data-wrangler-security-allowlist">Create an Allowlist for Data Wrangler</h2>
        <p>Whenever a user starts running Data Wrangler from the Amazon SageMaker Studio user interface,
            they make call to the SageMaker application programming interface (API) to create a Data Wrangler application.</p>
        <p>Your organization might not provide your users with permissions to make those API calls by default. 
            To provide permissions, you must create and attach a policy to the user's IAM roles using the following policy template: 
            <a href="https://s3.us-west-2.amazonaws.com/amazon-sagemaker-data-wrangler-documentation-artifacts/DataWranglerAllowListExample.txt" rel="noopener noreferrer" target="_blank"><span>Data Wrangler Allow List Example</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p>
        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>The preceding policy example only gives your users access to the Data Wrangler application.</p></div></div>
        
        <p>For information about creating a policy, see <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_create-console.html#access_policies_create-json-editor">Creating policies on the JSON tab</a>.
            When you're creating a policy, copy and paste the JSON policy from 
            <a href="https://s3.us-west-2.amazonaws.com/amazon-sagemaker-data-wrangler-documentation-artifacts/DataWranglerAllowListExample.txt" rel="noopener noreferrer" target="_blank"><span>Data Wrangler Allow List Example</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> in the <b>JSON</b> tab.</p>
        <div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>Important</h6></div><div class="awsdocs-note-text"><p>Delete any IAM policies that prevent users from running the following operations:</p><div class="itemizedlist">
                 
                 
            <ul class="itemizedlist"><li class="listitem">
                    <p><a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_CreateApp.html">CreateApp</a></p>
                </li><li class="listitem">
                    <p><a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_DescribeApp.html">DescribeApp</a></p>
                </li></ul></div><p>If you don't delete the policies, your users could still be affected by them.</p></div></div>
        <p>After you've creating the policy using the template, attach it to the IAM roles of your users. For information about attaching a policy, see 
            <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_manage-attach-detach.html#add-policies-console">Adding IAM identity permissions (console)</a>.</p>
        
     
            <h2 id="data-wrangler-security-iam-policy">Grant an IAM Role Permission
                    to Use Data Wrangler</h2>
            <p>You can grant an IAM role permission to use Data Wrangler with the general IAM managed
                policy, <a href="https://console.aws.amazon.com/iam/home?#/policies/arn:aws:iam::aws:policy/AmazonSageMakerFullAccess" rel="noopener noreferrer" target="_blank"><span><code class="code">AmazonSageMakerFullAccess</code></span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>. This is a general policy
                that includes <a href="security-iam-awsmanpol-AmazonSageMakerFullAccess.html">permissions</a> required to use all SageMaker services. This policy grants an
                IAM role full access to Data Wrangler. You should be aware of the following when using
                    <code class="code">AmazonSageMakerFullAccess</code> to grant access to Data Wrangler:</p>
            <div class="itemizedlist">
                 
                 
            <ul class="itemizedlist"><li class="listitem">
                    <p>If you import data from Amazon Redshift, the <b>Database User</b> name
                        must have the prefix <code class="code">sagemaker_access</code>.</p>
                </li><li class="listitem">
                    <p>This managed policy only grants permission to access buckets with one of
                        the following in the name: <code class="code">SageMaker</code>, <code class="code">SageMaker</code>,
                            <code class="code">sagemaker</code>, or <code class="code">aws-glue</code>. If want to use Data Wrangler to
                        import from an S3 bucket without these phrases in the name, refer to the
                        last section on this page to learn how to grant permission to an IAM entity
                        to access your S3 buckets.</p>
                </li></ul></div>
            <p>If you have high-security needs, you can attach the policies in this section to an
                IAM entity to grant permissions required to use Data Wrangler.</p>
            <p>If you have datasets in Amazon Redshift or Athena that an IAM role needs to import from
                Data Wrangler, you must add a policy to that entity to access these resources. The following
                policies are the most restrictive policies you can use to give an IAM role
                permission to import data from Amazon Redshift and Athena. </p>
            <p>To learn how to attach a custom policy to an IAM role, refer to <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_manage.html#create-managed-policy-console">Managing IAM policies</a> in the IAM User Guide.</p>
            <p><b>Policy example to grant access to an Athena dataset
                    import</b></p>
            <p>The following policy assumes that the IAM role has permission to access the
                underlying S3 bucket where data is stored through a separate IAM policy.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Effect": "Allow",
            "Action": [
                "athena:ListDataCatalogs",
                "athena:ListDatabases",
                "athena:ListTableMetadata",
                "athena:GetQueryExecution",
                "athena:GetQueryResults",
                "athena:StartQueryExecution",
                "athena:StopQueryExecution"
            ],
            "Resource": [
                "*"
            ]
        },
        <span>{</span>
            "Effect": "Allow",
            "Action": [
                "glue:CreateTable"
            ],
            "Resource": [
                "arn:aws:glue:*:*:table/*/sagemaker_tmp_*",
                "arn:aws:glue:*:*:table/sagemaker_featurestore/*",
                "arn:aws:glue:*:*:catalog",
                "arn:aws:glue:*:*:database/*"
            ]
        },
        <span>{</span>
            "Effect": "Allow",
            "Action": [
                "glue:DeleteTable"
            ],
            "Resource": [
                "arn:aws:glue:*:*:table/*/sagemaker_tmp_*",
                "arn:aws:glue:*:*:catalog",
                "arn:aws:glue:*:*:database/*"
            ]
        },
        <span>{</span>
            "Effect": "Allow",
            "Action": [
                "glue:GetDatabases",
                "glue:GetTable",
                "glue:GetTables"
            ],
            "Resource": [
                "arn:aws:glue:*:*:table/*",
                "arn:aws:glue:*:*:catalog",
                "arn:aws:glue:*:*:database/*"
            ]
        },
        <span>{</span>
            "Effect": "Allow",
            "Action": [
                "glue:CreateDatabase",
                "glue:GetDatabase"
            ],
            "Resource": [
                "arn:aws:glue:*:*:catalog",
                "arn:aws:glue:*:*:database/sagemaker_featurestore",
                "arn:aws:glue:*:*:database/sagemaker_processing",
                "arn:aws:glue:*:*:database/default",
                "arn:aws:glue:*:*:database/sagemaker_data_wrangler"
            ]
        }
    ]
}</code></pre>
            <p><b><b>Policy example to grant access to an
                        Amazon Redshift dataset import</b></b></p>
            <p>The following policy grants permission to set up an Amazon Redshift connection to Data Wrangler using
                database users that have the prefix <code class="code">sagemaker_access</code> in the name. To
                grant permission to connect using additional database users, add additional entries
                under <code class="code">"Resources"</code> in the following policy. The following policy assumes
                that the IAM role has permission to access the underlying S3 bucket where data is
                stored through a separate IAM policy, if applicable. </p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Effect": "Allow",
            "Action": [
                "redshift-data:ExecuteStatement",
                "redshift-data:DescribeStatement",
                "redshift-data:CancelStatement",
                "redshift-data:GetStatementResult",
                "redshift-data:ListSchemas",
                "redshift-data:ListTables"
            ],
            "Resource": [
                "*"
            ]
        },
        <span>{</span>
            "Effect": "Allow",
            "Action": [
                "redshift:GetClusterCredentials"
            ],
            "Resource": [
                "arn:aws:redshift:*:*:dbuser:*/sagemaker_access*",
                "arn:aws:redshift:*:*:dbname:*"
            ]
        }
    ]
}</code></pre>
            <p><b>Policy to grant access to an S3 bucket</b></p>
            <p>If your dataset is stored in Amazon S3, you can grant an IAM role permission to
                access this bucket with a policy similar to the following. This example grants
                programmatic read-write access to the bucket named
                <code class="replaceable">test</code>.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Effect": "Allow",
      "Action": ["s3:ListBucket"],
      "Resource": ["arn:aws:s3:::<code class="replaceable">test</code>"]
    },
    <span>{</span>
      "Effect": "Allow",
      "Action": [
        "s3:PutObject",
        "s3:GetObject",
        "s3:DeleteObject"
      ],
      "Resource": ["arn:aws:s3:::<code class="replaceable">test</code>/*"]
    }
  ]
}</code></pre>
            <p>To import data from Athena and Amazon Redshift, you must grant an IAM role permission to
                access the following prefixes under the default Amazon S3 bucket in the AWS Region Data Wrangler
                in which is being used: <code class="code">athena/</code>, <code class="code">redshift/</code>. If a default
                Amazon S3 bucket does not already exist in the AWS Region, you must also give the IAM
                role permission to create a bucket in this region.</p>
            <p>Additionally, if you want the IAM role to be able to use the Amazon SageMaker Feature Store, SageMaker Pipelines,
                and Data Wrangler job export options, you must grant access to the prefix
                    <code class="code">data_wrangler_flows/</code> in this bucket.</p>
            <p> Data Wrangler uses the <code class="code">athena/</code> and <code class="code">redshift/</code> prefixes to store
                preview files and imported datasets. To learn more, see <a href="data-wrangler-import.html#data-wrangler-import-storage">Imported Data Storage</a>.</p>
            <p>Data Wrangler uses the <code class="code">data_wrangler_flows/</code> prefix to store .flow files when
                you run a Jupyter Notebook exported from Data Wrangler. To learn more, see <a href="data-wrangler-data-export.html">Export</a>.</p>
            <p>Use a policy similar to the following to grant the permissions described in the
                preceding paragraphs.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Effect": "Allow",
            "Action": [
                "s3:GetObject",
                "s3:PutObject"
            ],
            "Resource": [
                "arn:aws:s3:::sagemaker-<code class="replaceable">region</code>-<code class="replaceable">account-id</code>/data_wrangler_flows/",
                "arn:aws:s3:::sagemaker-<code class="replaceable">region</code>-<code class="replaceable">account-id</code>/data_wrangler_flows/*",
                "arn:aws:s3:::sagemaker-<code class="replaceable">region</code>-<code class="replaceable">account-id</code>/athena",
                "arn:aws:s3:::sagemaker-<code class="replaceable">region</code>-<code class="replaceable">account-id</code>/athena/*",
                "arn:aws:s3:::sagemaker-<code class="replaceable">region</code>-<code class="replaceable">account-id</code>/redshift",
                "arn:aws:s3:::sagemaker-<code class="replaceable">region</code>-<code class="replaceable">account-id</code>/redshift/*"
            ]
        },
        <span>{</span>
            "Effect": "Allow",
            "Action": [
                "s3:CreateBucket",
                "s3:ListBucket"
            ],
            "Resource": "arn:aws:s3:::sagemaker-<code class="replaceable">region</code>-<code class="replaceable">account-id</code>"
        },
        <span>{</span>
            "Effect": "Allow",
            "Action": [
                "s3:ListAllMyBuckets",
                "s3:GetBucketLocation"
            ],
            "Resource": "*"
        }
    ]
}</code></pre>
            <p>You can also access data in your Amazon S3 bucket from another AWS account by
                specifying the Amazon S3 bucket URI. To do this, the IAM policy that grants access to the
                Amazon S3 bucket in the other account should use a policy similar to the following
                example, where <code class="code">BucketFolder</code> is the specific directory in the user's
                bucket <code class="code">UserBucket</code>. This policy should be added to the user granting
                access to their bucket for another user. </p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version": "2012-10-17",
   "Statement": [
       <span>{</span>
            "Effect": "Allow",
            "Action": [
                "s3:GetObject",
                "s3:PutObject",
                "s3:PutObjectAcl"
            ],
            "Resource": "arn:aws:s3:::<code class="replaceable">UserBucket</code>/<code class="replaceable">BucketFolder/</code>*"
            },
                <span>{</span>
                "Effect": "Allow",
                "Action": [
                    "s3:ListBucket"
                ],
                "Resource": "arn:aws:s3:::<code class="replaceable">UserBucket</code>",
                "Condition": <span>{</span>
                "StringLike": <span>{</span>
                    "s3:prefix": [
                    "<code class="replaceable">BucketFolder</code>/*"
                    ]
                }
            }
        } 
    ]
}</code></pre>
            <p>The user that is accessing the bucket (not the bucket owner) must add a policy
                similar to the following example to their user. Note that <code class="code">AccountX</code> and
                    <code class="code">TestUser</code> below refers to the bucket owner and their user
                respectively.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Effect": "Allow",
            "Principal": <span>{</span>
                "AWS": "arn:aws:iam::<code class="replaceable">AccountX:user</code>/<code class="replaceable">TestUser</code>"
            },
            "Action": [
                "s3:GetObject",
                "s3:PutObject",
                "s3:PutObjectAcl"
            ],
            "Resource": [
                "arn:aws:s3:::<code class="replaceable">UserBucket</code>/<code class="replaceable">BucketFolder</code>/*"
            ]
        },
        <span>{</span>
            "Effect": "Allow",
            "Principal": <span>{</span>
                "AWS": "arn:aws:iam::<code class="replaceable">AccountX:user</code>/<code class="replaceable">TestUser</code>"
            },
            "Action": [
                "s3:ListBucket"
            ],
            "Resource": [
                "arn:aws:s3:::<code class="replaceable">UserBucket</code>"
            ]
        }
    ]
}</code></pre>
            <p><b>Policy example to grant access to use SageMaker
                Studio</b></p>
            <p>Use a policy like to the following to create an IAM execution role that can be
                used to set up a Studio instance. </p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Effect": "Allow",
            "Action": [
                "sagemaker:CreatePresignedDomainUrl",
                "sagemaker:DescribeDomain",
                "sagemaker:ListDomains",
                "sagemaker:DescribeUserProfile",
                "sagemaker:ListUserProfiles",
                "sagemaker:*App",
                "sagemaker:ListApps"
            ],
            "Resource": "*"
        }
    ]
}</code></pre>
         
            <h2 id="data-wrangler-security-snowflake">Snowflake and Data Wrangler</h2>
            <p>All permissions for AWS resources are managed via your IAM role attached to
                your Studio instance. The Snowflake administrator manages Snowflake-specific
                permissions, as they can grant granular permissions and privileges to each Snowflake
                user. This includes databases, schemas, tables, warehouses, and storage integration
                objects. You must ensure that the correct permissions are set up outside of Data Wrangler. </p>
            <p>Note that the Snowflake <code class="code">COPY INTO Amazon S3</code> command moves data from
                Snowflake to Amazon S3 over the public internet by default, but data in
                transit is secured using SSL. Data at rest in Amazon S3 is encrypted with SSE-KMS using
                the default AWS KMS key.</p>
            <p>With respect to Snowflake credentials storage, Data Wrangler does not store customer
                credentials. Data Wrangler uses Secrets Manager to store the credentials in a secret and rotates
                secrets as part of a best practice security plan. The Snowflake or Studio
                administrator needs to ensure that the data scientist’s Studio execution role is
                granted permission to perform <code class="code">GetSecretValue</code> on the secret storing the
                credentials. If already attached to the Studio execution role, the
                    <code class="code">AmazonSageMakerFullAccess</code> policy has the necessary permissions to
                read secrets created by Data Wrangler and secrets created by following the naming and tagging
                convention in the instructions above. Secrets that do not follow the conventions
                must be separately granted access. We recommend using Secrets Manager to prevent sharing
                credentials over unsecured channels; however, note that a logged-in user can
                retrieve the plain-text password by launching a terminal or Python notebook in
                Studio and then invoking API calls from the Secrets Manager API. </p>
         
            <h2 id="data-wrangler-security-kms">Data Encryption with AWS KMS</h2>
            <p>Within Data Wrangler, you can decrypt encrypted files and add them to your Data Wrangler flow. You
                can also encrypt the output of the transforms using either a default AWS KMS key or
                one that you provide.</p>
            <p>You can import files if they have the following:</p>
            <div class="itemizedlist">
                 
                 
            <ul class="itemizedlist"><li class="listitem">
                    <p>server-side encryption</p>
                </li><li class="listitem">
                    <p>SSE-KMS as the encryption type</p>
                </li></ul></div>
            <p>To decrypt the file and import to a Data Wrangler flow, you must add the SageMaker Studio
                user that you're using as a key user.</p>
            <p>The following screenshot shows a Studio user role added as a key user. See
                    <a href="https://console.aws.amazon.com/iam/home#/roles" rel="noopener noreferrer" target="_blank"><span>IAM Roles</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> to access users
                under the left panel to make this change.</p>
            <div class="mediaobject">
                 
                    <img src="../../../images/sagemaker/latest/dg/images/data-wrangler-kms.png" class="aws-docs-img-whiteBg aws-docs-img-padding" />
                 
            </div>
             
                <h3 id="data-wrangler-s3-cmk-setup">Amazon S3 customer managed key setup for Data Wrangler
                        imported data storage</h3>
                <p> By default, Data Wrangler uses Amazon S3 buckets that have the following naming convention:
                        <code class="code">sagemaker-region-account number</code>. For example, if your account
                    number is <code class="code">111122223333</code> and you are using Studio in us-east-1,
                    your imported datasets are stored with the following naming convention:
                        <code class="code">sagemaker-us-east-1-111122223333</code>. </p>
                <p>The following instructions explain how to set up a customer managed key for your default
                    Amazon S3 bucket.</p>
                <div class="orderedlist">
                     
                     
                <ol><li>
                        <p>To enable server-side encryption and setup a customer managed key for your
                            default S3 bucket, see <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/UsingKMSEncryption.html">Using KMS Encryption</a>.</p>
                    </li><li>
                        <p>After following step 1, navigate to AWS KMS in your AWS Management Console. Find the
                            customer managed key you selected in step 1 of the previous step and add the
                            Studio role as the key user. To do this, follow the instructions in
                                <a href="https://docs.aws.amazon.com/kms/latest/developerguide/key-policies.html#key-policy-default-allow-users">Allows key users to use a customer managed key</a>.</p>
                    </li></ol></div>
             
             
                <h3 id="data-wrangler-export-kms">Encrypting the Data That You
                        Export</h3>
                <p>You can encrypt the data that you export using one of the following
                    methods:</p>
                <div class="itemizedlist">
                     
                     
                <ul class="itemizedlist"><li class="listitem">
                        <p>Specifying that your Amazon S3 bucket has object use SSE-KMS
                            encryption.</p>
                    </li><li class="listitem">
                        <p>Specifying an AWS KMS key to encrypt the data that you export from
                            Data Wrangler.</p>
                    </li></ul></div>
                <p>On the <b>Export data</b> page, specify a value for the
                        <b>AWS KMS key ID or ARN</b>.</p>
                <p>For more information on using AWS KMS keys, see <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/UsingKMSEncryption.html">Protecting Data
                        Using Server-Side Encryption with AWS KMS keys Stored in AWSAWS Key Management Service
                        (SSE-KMS) </a>.</p>
             
         
        <h2 id="data-wrangler-appflow-permissions">Amazon AppFlow Permissions</h2>
        <p>When you're performing a transfer, you must specify an IAM role that has permissions to perform the transfer. You can use the same IAM role that has permissions to use Data Wrangler. By default, the IAM role that you use to access Data Wrangler is the <code class="code">SageMakerExecutionRole</code>.</p>
        <p>The IAM role must have the following permissions:</p>
        <div class="itemizedlist">
             
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p>Permissions to Amazon AppFlow</p>
            </li><li class="listitem">
                <p>Permissions to the AWS Glue Data Catalog</p>
            </li><li class="listitem">
                <p>Permissions for AWS Glue to discover the data sources that are available</p>
            </li></ul></div>

        <p>When you run a transfer, Amazon AppFlow stores metadata from the transfer in the AWS Glue Data Catalog. Data Wrangler uses the metadata from the catalog to determine whether it's available for you to query and import.</p>
        <p>To add permissions to Amazon AppFlow, add the <code class="code">AmazonAppFlowFullAccess</code> AWS
            managed policy to the IAM role. For more information about adding policies, see <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_manage-attach-detach.html">Adding or
                removing IAM identity permissions</a>.</p>
        <p>If you're transferring data to Amazon S3, you must also attach the following policy.</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">
<span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Sid": "VisualEditor0",
      "Effect": "Allow",
      "Action": [
        "s3:GetBucketTagging",
        "s3:ListBucketVersions",
        "s3:CreateBucket",
        "s3:ListBucket",
        "s3:GetBucketPolicy",
        "s3:PutEncryptionConfiguration",
        "s3:GetEncryptionConfiguration",
        "s3:PutBucketTagging",
        "s3:GetObjectTagging",
        "s3:GetBucketOwnershipControls",
        "s3:PutObjectTagging",
        "s3:DeleteObject",
        "s3:DeleteBucket",
        "s3:DeleteObjectTagging",
        "s3:GetBucketPublicAccessBlock",
        "s3:GetBucketPolicyStatus",
        "s3:PutBucketPublicAccessBlock",
        "s3:PutAccountPublicAccessBlock",
        "s3:ListAccessPoints",
        "s3:PutBucketOwnershipControls",
        "s3:PutObjectVersionTagging",
        "s3:DeleteObjectVersionTagging",
        "s3:GetBucketVersioning",
        "s3:GetBucketAcl",
        "s3:PutObject",
        "s3:GetObject",
        "s3:GetAccountPublicAccessBlock",
        "s3:ListAllMyBuckets",
        "s3:GetAnalyticsConfiguration",
        "s3:GetBucketLocation"
      ],
      "Resource": "*"
    }
  ]
}                                      
                </code></pre>
        <p>To add AWS Glue permissions, add the <code class="code">AWSGlueConsoleFullAccess</code> managed policy
            to the IAM role. For more information about AWS Glue permissions with Amazon AppFlow, see
            [link-to-appflow-page].</p>
        <p>Amazon AppFlow needs to access AWS Glue and Data Wrangler for you to import the data that you've
            transferred. To grant Amazon AppFlow access, add the following trust policy to the IAM
            role.</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">
<span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Effect": "Allow",
            "Principal": <span>{</span>
                "AWS": "arn:aws:iam::<code class="replaceable">123456789012</code>:root",
                "Service": [
                    "appflow.amazonaws.com"
                ]
            },
            "Action": "sts:AssumeRole"
        }
    ]
}
</code></pre>
        <p>To display the Amazon AppFlow data in Data Wrangler, add the following policy to the IAM role:</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">
<span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Effect": "Allow",
            "Action": "glue:SearchTables",
            "Resource": [
                "arn:aws:glue:*:*:table/*/*",
                "arn:aws:glue:*:*:database/*",
                "arn:aws:glue:*:*:catalog"
            ]
        }
    ]
}   
</code></pre>

     
        <h2 id="data-wrangler-lifecycle-configuration">Using Lifecycle Configurations in
                Data Wrangler</h2>
        <p>You might have an Amazon EC2 instance that is configured to run Kernel Gateway applications, but not the Data Wrangler application. Kernel Gateway applications provide access to the environment and the kernels that you
            use to run Studio notebooks and terminals. The Data Wrangler application is the UI application that runs Data Wrangler. Amazon EC2 instances that aren't Data Wrangler instances require a modification to their lifecycle configurations to run Data Wrangler. Lifecycle configurations are shell scripts that automate the customization of your Amazon SageMaker Studio
            environment.</p>
        
        <p>For more information about lifecycle configurations, see <a href="studio-lcc.html">Use lifecycle configurations with Amazon SageMaker Studio</a>.</p>
        <p>The default lifecycle configuration for your instance doesn't support using Data Wrangler. You can make the following modifications to the default configuration to use Data Wrangler with your instance.</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">
#!/bin/bash
set -eux
STATUS=$(
python3 -c "import sagemaker_dataprep"
echo $?
)
if [ "$STATUS" -eq 0 ]; then
echo 'Instance is of Type Data Wrangler'
else
echo 'Instance is not of Type Data Wrangler'

# Replace this with the URL of your git repository
export REPOSITORY_URL="https://github.com/aws-samples/sagemaker-studio-lifecycle-config-examples.git"

git -C /root clone $REPOSTIORY_URL

fi
    </code></pre>
        <p>You can save the script as <code class="code">lifecycle_configuration.sh</code>.</p>
        
        <p>You attach the lifecycle configuration to your Studio domain or user profile. For more information about creating and attaching a lifecycle configuration, see <a href="studio-lcc-create.html">Create and associate a lifecycle configuration</a>.</p>
        <p>The following instructions show you how to attach a lifecycle configuration to a Studio domain or user profile.</p>
        <p>You might run into errors when you're creating or attaching a lifecycle configuration. For information about debugging lifecycle configuration errors, <a href="studio-lcc-debug.html#studio-lcc-debug-kernel">KernelGateway app failure</a>.</p>
        
    <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="https://docs.aws.amazon.com/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./data-wrangler-interactively-prepare-data-notebook.html">Use Data Preparation in a Studio Notebook to Get Data
            Insights</div><div id="next" class="next-link" accesskey="n" href="./data-wrangler-release-notes.html">Release Notes</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=https://docs.aws.amazon.com/en_us/sagemaker/latest/dg/data-wrangler-security.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=https://docs.aws.amazon.com/en_us/sagemaker/latest/dg/data-wrangler-security.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>
<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Querying Lineage Entities - Amazon SageMaker</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="querying-lineage-entities" /><meta name="default_state" content="querying-lineage-entities" /><link rel="icon" type="image/ico" href="../../../assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="../../../assets/images/favicon.ico" /><link rel="canonical" href="querying-lineage-entities.html" /><meta name="description" content="Amazon SageMaker automatically generates graphs of lineage entities as you use them. You can query this data to answer a variety of questions of your ML workslfows." /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon SageMaker" /><meta name="guide" content="Developer Guide" /><meta name="abstract" content="Use Internet Monitor to build, train, and host machine learning models in AWS." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="querying-lineage-entities.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/sagemaker/latest/dg/querying-lineage-entities.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/sagemaker/latest/dg/querying-lineage-entities.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/sagemaker/latest/dg/querying-lineage-entities.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/sagemaker/latest/dg/querying-lineage-entities.html" hreflang="de" /><link rel="alternative" href="querying-lineage-entities.html" hreflang="en-us" /><link rel="alternative" href="querying-lineage-entities.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/sagemaker/latest/dg/querying-lineage-entities.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/sagemaker/latest/dg/querying-lineage-entities.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/sagemaker/latest/dg/querying-lineage-entities.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/sagemaker/latest/dg/querying-lineage-entities.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/sagemaker/latest/dg/querying-lineage-entities.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/sagemaker/latest/dg/querying-lineage-entities.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/sagemaker/latest/dg/querying-lineage-entities.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/sagemaker/latest/dg/querying-lineage-entities.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/sagemaker/latest/dg/querying-lineage-entities.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/sagemaker/latest/dg/querying-lineage-entities.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/sagemaker/latest/dg/querying-lineage-entities.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/sagemaker/latest/dg/querying-lineage-entities.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/sagemaker/latest/dg/querying-lineage-entities.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/sagemaker/latest/dg/querying-lineage-entities.html" hreflang="zh-tw" /><link rel="alternative" href="querying-lineage-entities.html" hreflang="x-default" /><meta name="feedback-item" content="SageMaker" /><meta name="this_doc_product" content="Amazon SageMaker" /><meta name="this_doc_guide" content="Developer Guide" /><script defer="" src="../../../assets/r/vendor4.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/vendor3.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/vendor1.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/awsdocs-common.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/awsdocs-doc-page.js@version=2021.12.02"></script><link href="../../../assets/r/vendor4.css@version=2021.12.02.css" rel="stylesheet" /><link href="../../../assets/r/awsdocs-common.css@version=2021.12.02.css" rel="stylesheet" /><link href="../../../assets/r/awsdocs-doc-page.css@version=2021.12.02.css" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'sagemaker'}"></script><meta id="panorama-serviceSubSection" value="Developer Guide" /><meta id="panorama-serviceConsolePage" value="Querying Lineage Entities" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Querying Lineage Entities - Amazon SageMaker</title><meta name="pdf" content="/pdfs/sagemaker/latest/dg/sagemaker-dg.pdf#querying-lineage-entities" /><meta name="rss" content="amazon-sagemaker-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=285" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/querying-lineage-entities.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/querying-lineage-entities.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/querying-lineage-entities.html" /><meta name="keywords" content="SageMaker,Amazon SageMaker,machine learning,notebook instance" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon SageMaker",
        "item" : "https://docs.aws.amazon.com/sagemaker/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Developer Guide",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Implement MLOps",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/mlops.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Amazon SageMaker ML Lineage Tracking",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/lineage-tracking.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Querying Lineage Entities",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/lineage-tracking.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="https://docs.aws.amazon.com/pdfs/sagemaker/latest/dg/sagemaker-dg.pdf#querying-lineage-entities" target="_blank" rel="noopener noreferrer" title="Open PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="https://docs.aws.amazon.com/index.html">Documentation</a><a href="https://docs.aws.amazon.com/sagemaker/index.html">Amazon SageMaker</a><a href="whatis.html">Developer Guide</a></div><div id="page-toc-src"><a href="querying-lineage-entities.html#querying-lineage-entities-getting-started">Getting Started</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="querying-lineage-entities">Querying Lineage Entities</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>Amazon SageMaker automatically generates graphs of lineage entities as you use them. You can query this data 
      to answer a variety of questions. You can query your lineage entities to: </p><div class="itemizedlist">
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
    <ul class="itemizedlist"><li class="listitem"><p>Retrieve all data sets that went into the creation of a model.</p></li><li class="listitem"><p>Retrieve all jobs that went into the creation of an endpoint.</p></li><li class="listitem"><p>Retrieve all models that use a data set.</p></li><li class="listitem"><p>Retrieve all endpoints that use a model.</p></li><li class="listitem"><p>Retrieve which endpoints are derived from a certain data set.</p></li><li class="listitem"><p>Retrieve the pipeline execution that created a training job.</p></li><li class="listitem"><p>Retrieve the relationships between entities for investigation, governance, and reproducibility.</p></li><li class="listitem"><p>Retrieve all downstream trials that use the artifact.</p></li><li class="listitem"><p>Retrieve all upstream trials that use the artifact.</p></li><li class="listitem"><p>Retrieve a list of artifacts that use the provided S3 uri.</p></li><li class="listitem"><p>Retrieve upstream artifacts that use the dataset artifact.</p></li><li class="listitem"><p>Retrieve downstream artifacts that use the dataset artifact.</p></li><li class="listitem"><p>Retrieve datasets that use the image artifact.</p></li><li class="listitem"><p>Retrieve actions that use the context.</p></li><li class="listitem"><p>Retrieve processing jobs that use the endpoint.</p></li><li class="listitem"><p>Retrieve transform jobs that use the endpoint.</p></li><li class="listitem"><p>Retrieve trial components that use the endpoint.</p></li><li class="listitem"><p>Retrieve the ARN for the pipeline execution associated with the model package group.</p></li><li class="listitem"><p>Retrieve all artifacts that use the action.</p></li><li class="listitem"><p>Retrieve all upstream datasets that use the model package approval action.</p></li><li class="listitem"><p>Retrieve model package from model package approval action.</p></li><li class="listitem"><p>Retrieve downstream endpoint contexts that use the endpoint.</p></li><li class="listitem"><p>Retrieve the ARN for the pipeline execution associated with the trial component.</p></li><li class="listitem"><p>Retrieve datasets that use the trial component.</p></li><li class="listitem"><p>Retrieve models that use the trial component.</p></li><li class="listitem"><p>Explore your lineage for visualization.</p></li></ul></div><div class="itemizedlist">
      <h6>Limitations</h6>
       
       
       
    <ul class="itemizedlist"><li class="listitem"><p>Lineage querying is not available in the following Regions:</p>
        <div class="itemizedlist">
           
           
           
           
           
        <ul class="itemizedlist"><li class="listitem"><p>Africa (Cape Town) – af-south</p></li><li class="listitem"><p>Asia Pacific (Jakarta) – ap-southeast-3</p></li><li class="listitem"><p>Asia Pacific (Osaka) – ap-northeast-3</p></li><li class="listitem"><p>Europe (Milan) – eu-south-1</p></li><li class="listitem"><p>Israel (Tel Aviv) – il-central-1</p></li></ul></div></li><li class="listitem"><p>The maximum depth of relationships to discover is currently limited to 10.</p>
      </li><li class="listitem"><p>Filtering is limited to the following properties: last modified date, created date, type, and
          lineage entity type. </p></li></ul></div><div class="highlights" id="inline-topiclist"><h6>Topics</h6><ul><li><a href="querying-lineage-entities.html#querying-lineage-entities-getting-started">Getting Started with Querying Lineage Entities</a></li></ul></div>
      <h2 id="querying-lineage-entities-getting-started">Getting Started with Querying Lineage Entities</h2>
      <p>The easiest way to get started is either via the:</p>
<div class="itemizedlist">
   
   
<ul class="itemizedlist"><li class="listitem"><p><a href="https://github.com/aws/sagemaker-python-sdk/blob/master/src/sagemaker/lineage/artifact.py#L397" rel="noopener noreferrer" target="_blank"><span>
          Amazon SageMaker SDK for Python</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> which has defined many common use cases.</p></li><li class="listitem"><p>For a notebook that demonstrates how to use SageMaker Lineage APIs to query relationships across the lineage graph, 
    see <a href="https://github.com/aws/amazon-sagemaker-examples/blob/master/sagemaker-lineage/sagemaker-lineage-multihop-queries.ipynb" rel="noopener noreferrer" target="_blank"><span>sagemaker-lineage-multihop-queries.ipynb</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p></li></ul></div>      
      <p>The following examples show how to use the <code class="code">LineageQuery</code> and <code class="code">LineageFilter</code> APIs to construct 
        queries to answer questions about the Lineage Graph and extract entity relationships for a few use cases.</p>
      <div class="example"><h6>Example Using the <code class="code">LineageQuery</code> API to find entity associations</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="Python ">from sagemaker.lineage.context import Context, EndpointContext
from sagemaker.lineage.action import Action
from sagemaker.lineage.association import Association
from sagemaker.lineage.artifact import Artifact, ModelArtifact, DatasetArtifact

from sagemaker.lineage.query import (
    LineageQuery,
    LineageFilter,
    LineageSourceEnum,
    LineageEntityEnum,
    LineageQueryDirectionEnum,
)
# Find the endpoint context and model artifact that should be used for the lineage queries.

contexts = Context.list(source_uri=endpoint_arn)
context_name = list(contexts)[0].context_name
endpoint_context = EndpointContext.load(context_name=context_name)
        </code></pre></div></div>
      <div class="example"><h6>Example Find all the datasets associated with an endpoint</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="Python "># Define the LineageFilter to look for entities of type `ARTIFACT` and the source of type `DATASET`.

query_filter = LineageFilter(
    entities=[LineageEntityEnum.ARTIFACT], sources=[LineageSourceEnum.DATASET]
)

# Providing this `LineageFilter` to the `LineageQuery` constructs a query that traverses through the given context `endpoint_context`
# and find all datasets.

query_result = LineageQuery(sagemaker_session).query(
    start_arns=[endpoint_context.context_arn],
    query_filter=query_filter,
    direction=LineageQueryDirectionEnum.ASCENDANTS,
    include_edges=False,
)

# Parse through the query results to get the lineage objects corresponding to the datasets
dataset_artifacts = []
for vertex in query_result.vertices:
    dataset_artifacts.append(vertex.to_lineage_object().source.source_uri)

pp.pprint(dataset_artifacts)</code></pre></div></div>
      <div class="example"><h6>Example Find the models associated with an endpoint</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="Python "># Define the LineageFilter to look for entities of type `ARTIFACT` and the source of type `MODEL`.

query_filter = LineageFilter(
    entities=[LineageEntityEnum.ARTIFACT], sources=[LineageSourceEnum.MODEL]
)

# Providing this `LineageFilter` to the `LineageQuery` constructs a query that traverses through the given context `endpoint_context`
# and find all datasets.

query_result = LineageQuery(sagemaker_session).query(
    start_arns=[endpoint_context.context_arn],
    query_filter=query_filter,
    direction=LineageQueryDirectionEnum.ASCENDANTS,
    include_edges=False,
)

# Parse through the query results to get the lineage objects corresponding to the model
model_artifacts = []
for vertex in query_result.vertices:
    model_artifacts.append(vertex.to_lineage_object().source.source_uri)

# The results of the `LineageQuery` API call return the ARN of the model deployed to the endpoint along with
# the S3 URI to the model.tar.gz file associated with the model
pp.pprint(model_artifacts)</code></pre></div></div>
      <div class="example"><h6>Example Find the trial components associated with the endpoint</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="Python "># Define the LineageFilter to look for entities of type `TRIAL_COMPONENT` and the source of type `TRAINING_JOB`.

query_filter = LineageFilter(
    entities=[LineageEntityEnum.TRIAL_COMPONENT],
    sources=[LineageSourceEnum.TRAINING_JOB],
)

# Providing this `LineageFilter` to the `LineageQuery` constructs a query that traverses through the given context `endpoint_context`
# and find all datasets.

query_result = LineageQuery(sagemaker_session).query(
    start_arns=[endpoint_context.context_arn],
    query_filter=query_filter,
    direction=LineageQueryDirectionEnum.ASCENDANTS,
    include_edges=False,
)

# Parse through the query results to get the ARNs of the training jobs associated with this Endpoint
trial_components = []
for vertex in query_result.vertices:
    trial_components.append(vertex.arn)

pp.pprint(trial_components)</code></pre></div></div>
      <div class="example"><h6>Example Changing the focal point of lineage</h6><div class="example-contents"><p>The <code class="code">LineageQuery</code> can be modified to have different <code class="code">start_arns</code> which changes the 
          focal point of lineage. In addition, the <code class="code">LineageFilter</code> can take multiple sources and entities to 
          expand the scope of the query.</p><p>In the following we use the model as the lineage focal point and find the endpoints and datasets associated 
            with it.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="Python "># Get the ModelArtifact

model_artifact_summary = list(Artifact.list(source_uri=model_package_arn))[0]
model_artifact = ModelArtifact.load(artifact_arn=model_artifact_summary.artifact_arn)
query_filter = LineageFilter(
    entities=[LineageEntityEnum.ARTIFACT],
    sources=[LineageSourceEnum.ENDPOINT, LineageSourceEnum.DATASET],
)

query_result = LineageQuery(sagemaker_session).query(
    start_arns=[model_artifact.artifact_arn],  # Model is the starting artifact
    query_filter=query_filter,
    # Find all the entities that descend from the model, i.e. the endpoint
    direction=LineageQueryDirectionEnum.DESCENDANTS,
    include_edges=False,
)

associations = []
for vertex in query_result.vertices:
    associations.append(vertex.to_lineage_object().source.source_uri)

query_result = LineageQuery(sagemaker_session).query(
    start_arns=[model_artifact.artifact_arn],  # Model is the starting artifact
    query_filter=query_filter,
    # Find all the entities that ascend from the model, i.e. the datasets
    direction=LineageQueryDirectionEnum.ASCENDANTS,
    include_edges=False,
)

for vertex in query_result.vertices:
    associations.append(vertex.to_lineage_object().source.source_uri)

pp.pprint(associations)</code></pre></div></div>
      <div class="example"><h6>Example Using <code class="code">LineageQueryDirectionEnum.BOTH</code> to find ascendent and descendent relationships</h6><div class="example-contents"><p>When the direction is set to <code class="code">BOTH</code>, the query traverses the graph to find ascendant and descendant 
          relationships. This traversal takes place not only from the starting node, but from each node that is visited. For 
          example; if a training job is run twice and both models generated by the training job are deployed to endpoints, 
          the result of the query with direction set to <code class="code">BOTH</code> shows both endpoints. This is because the same 
          image is used for training and deploying the model. Since the image is common to the model, the <code class="code">start_arn</code> 
          and both the endpoints, appear in the query result.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="Python ">query_filter = LineageFilter(
    entities=[LineageEntityEnum.ARTIFACT],
    sources=[LineageSourceEnum.ENDPOINT, LineageSourceEnum.DATASET],
)

query_result = LineageQuery(sagemaker_session).query(
    start_arns=[model_artifact.artifact_arn],  # Model is the starting artifact
    query_filter=query_filter,
    # This specifies that the query should look for associations both ascending and descending for the start
    direction=LineageQueryDirectionEnum.BOTH,
    include_edges=False,
)

associations = []
for vertex in query_result.vertices:
    associations.append(vertex.to_lineage_object().source.source_uri)

pp.pprint(associations)</code></pre></div></div>
      <div class="example"><h6>Example  Directions in <code class="code">LineageQuery</code> - <code class="code">ASCENDANTS</code> vs. <code class="code">DESCENDANTS</code></h6><div class="example-contents"><p>To understand the direction in the Lineage Graph, take the following entity relationship graph - 
          Dataset -&gt; Training Job -&gt; Model -&gt; Endpoint</p><p>The endpoint is a descendant of the model, and the model is a descendant of the dataset. Similarly, 
            the model is an ascendant of the endpoint. The <code class="code">direction</code> parameter can be used to specify 
            whether the query should return entities that are descendants or ascendants of the entity in <code class="code">start_arns</code>. 
            If the <code class="code">start_arns</code> contains a model and the direction is <code class="code">DESCENDANTS</code>, the query returns 
            the endpoint. If the direction is <code class="code">ASCENDANTS</code>, the query returns the dataset.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="Python "># In this example, we'll look at the impact of specifying the direction as ASCENDANT or DESCENDANT in a `LineageQuery`.

query_filter = LineageFilter(
    entities=[LineageEntityEnum.ARTIFACT],
    sources=[
        LineageSourceEnum.ENDPOINT,
        LineageSourceEnum.MODEL,
        LineageSourceEnum.DATASET,
        LineageSourceEnum.TRAINING_JOB,
    ],
)

query_result = LineageQuery(sagemaker_session).query(
    start_arns=[model_artifact.artifact_arn],
    query_filter=query_filter,
    direction=LineageQueryDirectionEnum.ASCENDANTS,
    include_edges=False,
)

ascendant_artifacts = []

# The lineage entity returned for the Training Job is a TrialComponent which can't be converted to a
# lineage object using the method `to_lineage_object()` so we extract the TrialComponent ARN.
for vertex in query_result.vertices:
    try:
        ascendant_artifacts.append(vertex.to_lineage_object().source.source_uri)
    except:
        ascendant_artifacts.append(vertex.arn)

print("Ascendant artifacts : ")
pp.pprint(ascendant_artifacts)

query_result = LineageQuery(sagemaker_session).query(
    start_arns=[model_artifact.artifact_arn],
    query_filter=query_filter,
    direction=LineageQueryDirectionEnum.DESCENDANTS,
    include_edges=False,
)

descendant_artifacts = []
for vertex in query_result.vertices:
    try:
        descendant_artifacts.append(vertex.to_lineage_object().source.source_uri)
    except:
        # Handling TrialComponents.
        descendant_artifacts.append(vertex.arn)

print("Descendant artifacts : ")
pp.pprint(descendant_artifacts)</code></pre></div></div>
      <div class="example"><h6>Example SDK helper functions to make lineage queries easier</h6><div class="example-contents"><p>The classes <code class="code">EndpointContext</code>, <code class="code">ModelArtifact</code>, and <code class="code">DatasetArtifact</code> have 
          helper functions that are wrappers over the <code class="code">LineageQuery</code> API to make certain lineage queries easier 
          to leverage. The following example shows how to use these helper function.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="Python "># Find all the datasets associated with this endpoint

datasets = []
dataset_artifacts = endpoint_context.dataset_artifacts()
for dataset in dataset_artifacts:
    datasets.append(dataset.source.source_uri)
print("Datasets : ", datasets)

# Find the training jobs associated with the endpoint
training_job_artifacts = endpoint_context.training_job_arns()
training_jobs = []
for training_job in training_job_artifacts:
    training_jobs.append(training_job)
print("Training Jobs : ", training_jobs)

# Get the ARN for the pipeline execution associated with this endpoint (if any)
pipeline_executions = endpoint_context.pipeline_execution_arn()
if pipeline_executions:
    for pipeline in pipelines_executions:
        print(pipeline)

# Here we use the `ModelArtifact` class to find all the datasets and endpoints associated with the model

dataset_artifacts = model_artifact.dataset_artifacts()
endpoint_contexts = model_artifact.endpoint_contexts()

datasets = [dataset.source.source_uri for dataset in dataset_artifacts]
endpoints = [endpoint.source.source_uri for endpoint in endpoint_contexts]

print("Datasets associated with this model : ")
pp.pprint(datasets)

print("Endpoints associated with this model : ")
pp.pprint(endpoints)

# Here we use the `DatasetArtifact` class to find all the endpoints hosting models that were trained with a particular dataset
# Find the artifact associated with the dataset

dataset_artifact_arn = list(Artifact.list(source_uri=training_data))[0].artifact_arn
dataset_artifact = DatasetArtifact.load(artifact_arn=dataset_artifact_arn)

# Find the endpoints that used this training dataset
endpoint_contexts = dataset_artifact.endpoint_contexts()
endpoints = [endpoint.source.source_uri for endpoint in endpoint_contexts]

print("Endpoints associated with the training dataset <span>{</span>}".format(training_data))
pp.pprint(endpoints)</code></pre></div></div>
      <div class="example"><h6>Example Getting a Lineage graph visualization</h6><div class="example-contents"><p>A helper class <code class="code">Visualizer</code> is provided in the sameple notebook <a href="https://github.com/aws/amazon-sagemaker-examples/blob/master/sagemaker-lineage/visualizer.py" rel="noopener noreferrer" target="_blank"><span>visualizer.py
        </span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> to help plot the lineage graph. When the query response is rendered, a graph with the lineage 
          relationships from the <code class="code">StartArns</code> is displayed. From the <code class="code">StartArns</code> the visualization 
          shows the relationships with the other lineage entities returned in the <code class="code">query_lineage</code> 
          API action.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="Python "># Graph APIs
# Here we use the boto3 `query_lineage` API to generate the query response to plot.

from visualizer import Visualizer

query_response = sm_client.query_lineage(
    StartArns=[endpoint_context.context_arn], Direction="Ascendants", IncludeEdges=True
)

viz = Visualizer()
viz.render(query_response, "Endpoint")
        
        query_response = sm_client.query_lineage(
    StartArns=[model_artifact.artifact_arn], Direction="Ascendants", IncludeEdges=True
)
viz.render(query_response, "Model")</code></pre></div></div>
    <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="https://docs.aws.amazon.com/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./lineage-tracking-manual-creation.html">Manually Create Entities</div><div id="next" class="next-link" accesskey="n" href="./xaccount-lineage-tracking.html">Cross-Account Tracking</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=https://docs.aws.amazon.com/en_us/sagemaker/latest/dg/querying-lineage-entities.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=https://docs.aws.amazon.com/en_us/sagemaker/latest/dg/querying-lineage-entities.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>
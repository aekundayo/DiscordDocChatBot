<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Define metrics and environment variables - Amazon SageMaker</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="automatic-model-tuning-define-metrics-variables" /><meta name="default_state" content="automatic-model-tuning-define-metrics-variables" /><link rel="icon" type="image/ico" href="../../../assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="../../../assets/images/favicon.ico" /><link rel="canonical" href="automatic-model-tuning-define-metrics-variables.html" /><meta name="description" content="Learn to define metrics and environment variables so you can use a custom algorithm or use a built-in algorithm from Amazon SageMaker." /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon SageMaker" /><meta name="guide" content="Developer Guide" /><meta name="abstract" content="Use Internet Monitor to build, train, and host machine learning models in AWS." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="automatic-model-tuning-define-metrics-variables.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/sagemaker/latest/dg/automatic-model-tuning-define-metrics-variables.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/sagemaker/latest/dg/automatic-model-tuning-define-metrics-variables.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/sagemaker/latest/dg/automatic-model-tuning-define-metrics-variables.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/sagemaker/latest/dg/automatic-model-tuning-define-metrics-variables.html" hreflang="de" /><link rel="alternative" href="automatic-model-tuning-define-metrics-variables.html" hreflang="en-us" /><link rel="alternative" href="automatic-model-tuning-define-metrics-variables.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/sagemaker/latest/dg/automatic-model-tuning-define-metrics-variables.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/sagemaker/latest/dg/automatic-model-tuning-define-metrics-variables.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/sagemaker/latest/dg/automatic-model-tuning-define-metrics-variables.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/sagemaker/latest/dg/automatic-model-tuning-define-metrics-variables.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/sagemaker/latest/dg/automatic-model-tuning-define-metrics-variables.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/sagemaker/latest/dg/automatic-model-tuning-define-metrics-variables.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/sagemaker/latest/dg/automatic-model-tuning-define-metrics-variables.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/sagemaker/latest/dg/automatic-model-tuning-define-metrics-variables.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/sagemaker/latest/dg/automatic-model-tuning-define-metrics-variables.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/sagemaker/latest/dg/automatic-model-tuning-define-metrics-variables.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/sagemaker/latest/dg/automatic-model-tuning-define-metrics-variables.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/sagemaker/latest/dg/automatic-model-tuning-define-metrics-variables.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/sagemaker/latest/dg/automatic-model-tuning-define-metrics-variables.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/sagemaker/latest/dg/automatic-model-tuning-define-metrics-variables.html" hreflang="zh-tw" /><link rel="alternative" href="automatic-model-tuning-define-metrics-variables.html" hreflang="x-default" /><meta name="feedback-item" content="SageMaker" /><meta name="this_doc_product" content="Amazon SageMaker" /><meta name="this_doc_guide" content="Developer Guide" /><script defer="" src="../../../assets/r/vendor4.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/vendor3.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/vendor1.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/awsdocs-common.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/awsdocs-doc-page.js@version=2021.12.02"></script><link href="../../../assets/r/vendor4.css@version=2021.12.02.css" rel="stylesheet" /><link href="../../../assets/r/awsdocs-common.css@version=2021.12.02.css" rel="stylesheet" /><link href="../../../assets/r/awsdocs-doc-page.css@version=2021.12.02.css" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'sagemaker'}"></script><meta id="panorama-serviceSubSection" value="Developer Guide" /><meta id="panorama-serviceConsolePage" value="Define metrics and environment variables" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Define metrics and environment variables - Amazon SageMaker</title><meta name="pdf" content="/pdfs/sagemaker/latest/dg/sagemaker-dg.pdf#automatic-model-tuning-define-metrics-variables" /><meta name="rss" content="amazon-sagemaker-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=285" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/automatic-model-tuning-define-metrics-variables.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/automatic-model-tuning-define-metrics-variables.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/automatic-model-tuning-define-metrics-variables.html" /><meta name="keywords" content="SageMaker,Amazon SageMaker,machine learning,notebook instance,automatic model tuning,hyperparameter optimization,metric,built-in,custom,environment variables" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon SageMaker",
        "item" : "https://docs.aws.amazon.com/sagemaker/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Developer Guide",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Train machine learning models",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/train-model.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Perform Automatic Model Tuning with SageMaker",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/automatic-model-tuning.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Define metrics and environment variables",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/automatic-model-tuning.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="https://docs.aws.amazon.com/pdfs/sagemaker/latest/dg/sagemaker-dg.pdf#automatic-model-tuning-define-metrics-variables" target="_blank" rel="noopener noreferrer" title="Open PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="https://docs.aws.amazon.com/index.html">Documentation</a><a href="https://docs.aws.amazon.com/sagemaker/index.html">Amazon SageMaker</a><a href="whatis.html">Developer Guide</a></div><div id="page-toc-src"><a href="automatic-model-tuning-define-metrics-variables.html#automatic-model-tuning-define-metrics">Define metrics</a><a href="automatic-model-tuning-define-metrics-variables.html#automatic-model-tuning-define-variables">Specify environment
          variables</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="automatic-model-tuning-define-metrics-variables">Define metrics and
        environment variables</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>A tuning job optimizes hyperparameters for training jobs that it launches by using a
      metric to evaluate performance. This guide shows how to define metrics so that you can use a
      custom algorithm for training, or use a built-in algorithm from Amazon SageMaker. This guide also
      shows how to specify environment variables during an Automatic model tuning (AMT) job.</p>
      <h2 id="automatic-model-tuning-define-metrics">Define metrics</h2>
      <p>Amazon SageMaker hyperparameter tuning parses your machine learning algorithm's
          <code class="code">stdout</code> and <code class="code">stderr</code> streams to find metrics, such as loss or
        validation-accuracy. The metrics show how well the model is performing on the dataset. </p>
      <p>The following sections describe how to use two types of algorithms for training:
        built-in and custom.</p>

       
        <h3 id="automatic-model-tuning-define-metrics-builtin">Use a built-in algorithm
            for training</h3>
        <p>If you use one of the <a href="algos.html">SageMaker built-in algorithms</a>, metrics are already defined for you. In addition,
          built-in algorithms automatically send metrics to hyperparameter tuning for optimization.
          These metrics are also written to Amazon CloudWatch logs. For more information, see <a href="logging-cloudwatch.html">Log Amazon SageMaker
            Events with Amazon CloudWatch</a>. </p>
        <p>For the objective metric for the tuning job, choose one of the metrics that the
          built-in algorithm emits. For a list of available metrics, see the model tuning section
          for the appropriate algorithm in <a href="algos.html">Use Amazon SageMaker Built-in Algorithms or Pre-trained
            Models</a>.</p>
        <p>You can choose up to 40 metrics to monitor in your <a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_HyperParameterAlgorithmSpecification.html">tuning
            job</a>. Select one of those metrics to be the objective metric. The hyperparameter
          tuning job returns the <a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_DescribeHyperParameterTuningJob.html#sagemaker-DescribeHyperParameterTuningJob-response-BestTrainingJob">training job </a> that performed the best against the objective metric.</p>
        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>Hyperparameter tuning automatically sends an additional hyperparameter
              <code class="code">_tuning_objective_metric</code> to pass your objective metric to the tuning job
            for use during training.</p></div></div>
       
       
        <h3 id="automatic-model-tuning-define-metrics-custom">Use a custom algorithm for
            training</h3>
        <p>This section shows how to define your own metrics to use your own custom algorithm for
          training. When doing so, make sure that your algorithm writes at least one metric to
            <code class="code">stderr</code> or <code class="code">stdout</code>. Hyperparameter tuning parses these streams
          to find algorithm metrics that show how well the model is performing on the
          dataset.</p>
        <p>You can define custom metrics by specifying a name and regular expression for each
          metric that your tuning job monitors. Then, pass these metric definitions to the <a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_CreateHyperParameterTuningJob.html"><code class="code">CreateHyperParameterTuningJob</code></a> API in the
            <code class="code">TrainingJobDefinition</code> parameter in the <code class="code">MetricDefinitions</code> field
          of <code class="code">AlgorithmSpecification</code>.</p>
        <p>The following shows sample output from a log written to <code class="code">stderr</code> or
            <code class="code">stdout</code> by a training algorithm.</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">GAN_loss=0.138318;  Scaled_reg=2.654134; disc:[-0.017371,0.102429] real 93.3% gen 0.0% disc-combined=0.000000; disc_train_loss=1.374587;  Loss = 16.020744;  Iteration 0 took 0.704s;  Elapsed=0s</code></pre>
        <p>The following code example shows how to use regular expressions in Python (regex).
          This is used to search the sample log output and capture the numeric values of four
          different metrics.</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">[
    <span>{</span>
        "Name": "ganloss",
        "Regex": "GAN_loss=(.*?);",
    },
    <span>{</span>
        "Name": "disc-combined",
        "Regex": "disc-combined=(.*?);",
    },
    <span>{</span>
        "Name": "discloss",
        "Regex": "disc_train_loss=(.*?);",
    },
    <span>{</span>
        "Name": "loss",
        "Regex": "Loss = (.*?);",
    },
]</code></pre>
        <p>In regular expressions, parenthesis <code class="code">()</code> are used to group parts of the
          regular expression together.</p>
        <div class="itemizedlist">
           
           
           
           
        <ul class="itemizedlist"><li class="listitem">
            <p>For the <code class="code">loss</code> metric that is defined in the code example, the
              expression <code class="code">(.*?);</code> captures any character between the exact text
                <code class="code">"Loss="</code> and the first semicolon (<code class="code">;</code>) character.</p>
          </li><li class="listitem">
            <p>The character <code class="code">.</code> instructs the regular expression to match any
              character.</p>
          </li><li class="listitem">
            <p> The character <code class="code">*</code> means to match zero or more characters. </p>
          </li><li class="listitem">
            <p>The character <code class="code">?</code> means capture only until the first instance of the
                <code class="code">;</code> character. </p>
          </li></ul></div>
        <p>The loss metric defined in the code sample will capture <code class="code">Loss = 16.020744</code>
          from the sample output.</p>
        <p>Choose one of the metrics that you define as the objective metric for the tuning job.
          If you are using the SageMaker API, specify the value of the <code class="code">name</code> key in the
            <code class="code">HyperParameterTuningJobObjective</code> field of the
            <code class="code">HyperParameterTuningJobConfig</code> parameter that you send to the <a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_CreateHyperParameterTuningJob.html"><code class="code">CreateHyperParameterTuningJob</code></a> operation.</p>
       
     
      <h2 id="automatic-model-tuning-define-variables">Specify environment
          variables</h2>
      <p>SageMaker AMT optimizes hyperparameters within a tuning job to find the best parameters for
        model performance. You can use environment variables to configure your tuning job to change
        its behavior. You can also use environment variables that you used during training inside
        your tuning job.</p>
      <p>If you want to use an environment variable from your tuning job or specify a new
        environment variable, input a string value for <code class="code">Environment</code> within the SageMaker
          <a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_HyperParameterTrainingJobDefinition.html">HyperParameterTrainingJobDefinition</a>
        API. Pass this training job definition to the <a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_CreateHyperParameterTuningJob.html">CreateHyperParameterTuningJob</a> API.</p>
      <p>For example, the environment variable <code class="code">SM_LOG_LEVEL</code> can be set to the
        following values to tailor the output from a Python container.</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">NOTSET=0
DEBUG=10
INFO=20
WARN=30
ERROR=40
CRITICAL=50</code></pre>
      <p>As an example, to set the log level to <code class="code">10</code> to debug your container logs, set
        the environment variable inside the <a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_HyperParameterTrainingJobDefinition.html">HyperParameterTrainingJobDefinition</a>, as follows.</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><span>{</span>
   "<a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_CreateHyperParameterTuningJob.html#sagemaker-CreateHyperParameterTuningJob-request-HyperParameterTuningJobConfig">HyperParameterTuningJobConfig</a>": <span>{</span> 
   ...,
   }
   "<a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_CreateHyperParameterTuningJob.html#sagemaker-CreateHyperParameterTuningJob-request-TrainingJobDefinition">TrainingJobDefinition</a>": <span>{</span> 
      ...,
      "Environment" : [
          <span>{</span>
            "SM_LOG_LEVEL": 10 
          }
      ],
      ...,
   },
   ...,        
}        </code></pre>
    <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="https://docs.aws.amazon.com/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./automatic-model-tuning-how-it-works.html">How Hyperparameter Tuning Works</div><div id="next" class="next-link" accesskey="n" href="./automatic-model-tuning-define-ranges.html">Define Hyperparameter Ranges</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=https://docs.aws.amazon.com/en_us/sagemaker/latest/dg/automatic-model-tuning-define-metrics-variables.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=https://docs.aws.amazon.com/en_us/sagemaker/latest/dg/automatic-model-tuning-define-metrics-variables.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>
<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Configure SageMaker Debugger to Save Tensors - Amazon SageMaker</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="debugger-configure-hook" /><meta name="default_state" content="debugger-configure-hook" /><link rel="icon" type="image/ico" href="../../../assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="../../../assets/images/favicon.ico" /><link rel="canonical" href="debugger-configure-hook.html" /><meta name="description" content="Tensors are data collections of updated parameters from the backward and forward pass of each training iteration. SageMaker Debugger collects the output tensors to analyze the state of a training job. SageMaker Debugger's CollectionConfig and DebuggerHookConfig" /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon SageMaker" /><meta name="guide" content="Developer Guide" /><meta name="abstract" content="Use Internet Monitor to build, train, and host machine learning models in AWS." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="debugger-configure-hook.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/sagemaker/latest/dg/debugger-configure-hook.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/sagemaker/latest/dg/debugger-configure-hook.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/sagemaker/latest/dg/debugger-configure-hook.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/sagemaker/latest/dg/debugger-configure-hook.html" hreflang="de" /><link rel="alternative" href="debugger-configure-hook.html" hreflang="en-us" /><link rel="alternative" href="debugger-configure-hook.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/sagemaker/latest/dg/debugger-configure-hook.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/sagemaker/latest/dg/debugger-configure-hook.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/sagemaker/latest/dg/debugger-configure-hook.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/sagemaker/latest/dg/debugger-configure-hook.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/sagemaker/latest/dg/debugger-configure-hook.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/sagemaker/latest/dg/debugger-configure-hook.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/sagemaker/latest/dg/debugger-configure-hook.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/sagemaker/latest/dg/debugger-configure-hook.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/sagemaker/latest/dg/debugger-configure-hook.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/sagemaker/latest/dg/debugger-configure-hook.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/sagemaker/latest/dg/debugger-configure-hook.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/sagemaker/latest/dg/debugger-configure-hook.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/sagemaker/latest/dg/debugger-configure-hook.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/sagemaker/latest/dg/debugger-configure-hook.html" hreflang="zh-tw" /><link rel="alternative" href="debugger-configure-hook.html" hreflang="x-default" /><meta name="feedback-item" content="SageMaker" /><meta name="this_doc_product" content="Amazon SageMaker" /><meta name="this_doc_guide" content="Developer Guide" /><script defer="" src="../../../assets/r/vendor4.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/vendor3.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/vendor1.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/awsdocs-common.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/awsdocs-doc-page.js@version=2021.12.02"></script><link href="../../../assets/r/vendor4.css@version=2021.12.02.css" rel="stylesheet" /><link href="../../../assets/r/awsdocs-common.css@version=2021.12.02.css" rel="stylesheet" /><link href="../../../assets/r/awsdocs-doc-page.css@version=2021.12.02.css" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'sagemaker'}"></script><meta id="panorama-serviceSubSection" value="Developer Guide" /><meta id="panorama-serviceConsolePage" value="Configure SageMaker Debugger to Save Tensors" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Configure SageMaker Debugger to Save Tensors - Amazon SageMaker</title><meta name="pdf" content="/pdfs/sagemaker/latest/dg/sagemaker-dg.pdf#debugger-configure-hook" /><meta name="rss" content="amazon-sagemaker-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=285" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/debugger-configure-hook.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/debugger-configure-hook.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/debugger-configure-hook.html" /><meta name="keywords" content="SageMaker,Amazon SageMaker,machine learning,notebook instance" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon SageMaker",
        "item" : "https://docs.aws.amazon.com/sagemaker/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Developer Guide",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Train machine learning models",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/train-model.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Debug and improve model performance",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/train-debug-and-improve-model-performance.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Use Amazon SageMaker Debugger to debug and improve model performance",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/train-debugger.html"
      },
      {
        "@type" : "ListItem",
        "position" : 7,
        "name" : "Debug Training Jobs Using Amazon SageMaker Debugger",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/debugger-debug-training-jobs.html"
      },
      {
        "@type" : "ListItem",
        "position" : 8,
        "name" : "Step 2: Launch and Debug Training Jobs Using SageMaker Python SDK",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/debugger-configuration-for-debugging.html"
      },
      {
        "@type" : "ListItem",
        "position" : 9,
        "name" : "Configure SageMaker Debugger to Save Tensors",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/debugger-configuration-for-debugging.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="https://docs.aws.amazon.com/pdfs/sagemaker/latest/dg/sagemaker-dg.pdf#debugger-configure-hook" target="_blank" rel="noopener noreferrer" title="Open PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="https://docs.aws.amazon.com/index.html">Documentation</a><a href="https://docs.aws.amazon.com/sagemaker/index.html">Amazon SageMaker</a><a href="whatis.html">Developer Guide</a></div><div id="page-toc-src"><a href="debugger-configure-hook.html#debugger-configure-tensor-collections">Configure Tensor Collections</a><a href="debugger-configure-hook.html#debugger-configure-tensor-hook"> Configure the
                        DebuggerHookConfig API to Save Tensors</a><a href="debugger-configure-hook.html#debugger-save-tensors">Example Notebooks and Code Samples to Configure Debugger Hook</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="debugger-configure-hook">Configure SageMaker Debugger to Save
                Tensors</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p><em>Tensors</em> are data collections of updated parameters from the
            backward and forward pass of each training iteration. SageMaker Debugger collects the
            output tensors to analyze the state of a training job. SageMaker Debugger's <a href="https://sagemaker.readthedocs.io/en/stable/api/training/debugger.html#sagemaker.debugger.CollectionConfig" rel="noopener noreferrer" target="_blank"><span><code class="code">CollectionConfig</code></span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> and <a href="https://sagemaker.readthedocs.io/en/stable/api/training/debugger.html#sagemaker.debugger.DebuggerHookConfig" rel="noopener noreferrer" target="_blank"><span><code class="code">DebuggerHookConfig</code></span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> API operations provide methods for
            grouping tensors into <em>collections</em> and saving them to a target S3
            bucket. </p><div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>After properly configured and activated, SageMaker Debugger saves the output tensors in a
                default S3 bucket, unless otherwise specified. The format of the default S3 bucket
                URI is
                    <code class="code">s3://sagemaker-&lt;region&gt;-&lt;12digit_account_id&gt;/&lt;training-job-name&gt;/debug-output/</code>.</p></div></div><p>While constructing a SageMaker estimator, activate SageMaker Debugger by specifying the
                <code class="code">debugger_hook_config</code> parameter. The following steps include examples of
            how to set up the <code class="code">debugger_hook_config</code> using the
                <code class="code">CollectionConfig</code> and <code class="code">DebuggerHookConfig</code> API operations to
            pull tensors out of your training jobs and save them.</p>
            <h2 id="debugger-configure-tensor-collections">Configure Tensor Collections
                    Using the <code class="code">CollectionConfig</code> API</h2>
            <p>Use the <code class="code">CollectionConfig</code> API operation to configure tensor
                collections. Debugger provides pre-built tensor collections that cover a variety of
                regular expressions (regex) of parameters if using Debugger-supported deep learning
                frameworks and machine learning algorithms. As shown in the following example code,
                add the built-in tensor collections you want to debug.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="py ">from sagemaker.debugger import CollectionConfig

collection_configs=[
    CollectionConfig(name="weights"),
    CollectionConfig(name="gradients")
]</code></pre>
            <p>The preceding collections set up the Debugger hook to save the tensors every 500
                steps based on the default <code class="code">"save_interval"</code> value.</p>
            <p>For a full list of available Debugger built-in collections, see <a href="https://github.com/awslabs/sagemaker-debugger/blob/master/docs/api.md#collection" rel="noopener noreferrer" target="_blank"><span>Debugger Built-in Collections</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p>
            <p>If you want to customize the built-in collections, such as changing the save
                intervals and tensor regex, use the following <code class="code">CollectionConfig</code> template
                to adjust parameters.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="py ">from sagemaker.debugger import CollectionConfig

collection_configs=[
    CollectionConfig(
        name="<code class="replaceable">tensor_collection</code>",
        parameters=<span>{</span>
            "<code class="replaceable">key_1</code>": "<code class="replaceable">value_1</code>",
            "<code class="replaceable">key_2</code>": "<code class="replaceable">value_2</code>",
            ...
            "<code class="replaceable">key_n</code>": "<code class="replaceable">value_n</code>"
        }
    )
]</code></pre>
            <p>For more information about available parameter keys, see <a href="https://sagemaker.readthedocs.io/en/stable/api/training/debugger.html#sagemaker.debugger.CollectionConfig" rel="noopener noreferrer" target="_blank"><span>CollectionConfig</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> in the <a href="https://sagemaker.readthedocs.io" rel="noopener noreferrer" target="_blank"><span>Amazon SageMaker Python SDK</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>. For example, the
                following code example shows how you can adjust the save intervals of the "losses"
                tensor collection at different phases of training: save loss every 100 steps in
                training phase and validation loss every 10 steps in validation phase. </p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="py ">from sagemaker.debugger import CollectionConfig

collection_configs=[
    CollectionConfig(
        name="<code class="replaceable">losses</code>",
        parameters=<span>{</span>
            "<code class="replaceable">train.save_interval</code>": "<code class="replaceable">100</code>",
            "<code class="replaceable">eval.save_interval</code>": "<code class="replaceable">10</code>"
        }
    )
]</code></pre>
            <div class="awsdocs-note awsdocs-tip"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Tip</h6></div><div class="awsdocs-note-text"><p>This tensor collection configuration object can be used for both <a href="debugger-configure-hook.html#debugger-configure-tensor-hook">DebuggerHookConfig</a> and <a href="use-debugger-built-in-rules.html#debugger-built-in-rules-configuration-param-change">Rule</a> API operations.</p></div></div>
         
            <h2 id="debugger-configure-tensor-hook"> Configure the
                        <code class="code">DebuggerHookConfig</code> API to Save Tensors</h2>
            <p>Use the <a href="https://sagemaker.readthedocs.io/en/stable/api/training/debugger.html                 #sagemaker.debugger.DebuggerHookConfig" rel="noopener noreferrer" target="_blank"><span>DebuggerHookConfig</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> API to create a <code class="code">debugger_hook_config</code>
                object using the <code class="code">collection_configs</code> object you created in the previous
                step.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="py ">from sagemaker.debugger import DebuggerHookConfig

debugger_hook_config=DebuggerHookConfig(
    collection_configs=<code class="userinput">collection_configs</code>
)</code></pre>
            <p>Debugger saves the model training output tensors into the default S3 bucket. The
                format of the default S3 bucket URI is
                    <code class="code">s3://sagemaker-&lt;region&gt;-&lt;12digit_account_id&gt;/&lt;training-job-name&gt;/debug-output/.</code></p>
            <p>If you want to specify an exact S3 bucket URI, use the following code
                example:</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="py ">from sagemaker.debugger import DebuggerHookConfig

debugger_hook_config=DebuggerHookConfig(
    s3_output_path="<code class="replaceable">specify-your-s3-bucket-uri</code>"
    collection_configs=<code class="userinput">collection_configs</code>
)</code></pre>
            <p>For more information, see <a href="https://sagemaker.readthedocs.io/en/stable/api/training/debugger.html#sagemaker.debugger.DebuggerHookConfig" rel="noopener noreferrer" target="_blank"><span>DebuggerHookConfig</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> in the <a href="https://sagemaker.readthedocs.io" rel="noopener noreferrer" target="_blank"><span>Amazon SageMaker Python SDK</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p>
         
    <h2 id="debugger-save-tensors">Example Notebooks and Code Samples to Configure Debugger Hook</h2>
    <p>The following sections provide notebooks and code examples of how to use Debugger hook to
        save, access, and visualize output tensors.</p>
    <div class="highlights" id="inline-topiclist"><h6>Topics</h6><ul><li><a href="debugger-configure-hook.html#debugger-tensor-visualization-notebooks">Tensor Visualization Example
                Notebooks</a></li><li><a href="debugger-configure-hook.html#debugger-save-built-in-collections">Save Tensors Using Debugger Built-in
                Collections</a></li><li><a href="debugger-configure-hook.html#debugger-save-modified-built-in-collections">Save Tensors Using Debugger
                Modified Built-in Collections</a></li><li><a href="debugger-configure-hook.html#debugger-save-custom-collections">Save Tensors Using Debugger Custom
                Collections</a></li></ul></div>
     
        <h3 id="debugger-tensor-visualization-notebooks">Tensor Visualization Example
                Notebooks</h3>
        <p>The following two notebook examples show advanced use of Amazon SageMaker Debugger for visualizing
            tensors. Debugger provides a transparent view into training deep learning models.</p>
        <div class="itemizedlist">
             
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><a href="https://github.com/awslabs/amazon-sagemaker-examples/tree/master/sagemaker-debugger/mnist_tensor_analysis" rel="noopener noreferrer" target="_blank"><span>Interactive Tensor Analysis in SageMaker Studio Notebook with
                    MXNet</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></p>
                <p>This notebook example shows how to visualize saved tensors using Amazon SageMaker Debugger. By
                    visualizing the tensors, you can see how the tensor values change while training
                    deep learning algorithms. This notebook includes a training job with a poorly
                    configured neural network and uses Amazon SageMaker Debugger to aggregate and analyze tensors,
                    including gradients, activation outputs, and weights. For example, the following
                    plot shows the distribution of gradients of a convolutional layer that is
                    suffering from a vanishing gradient problem.</p>
                <div class="mediaobject">
                     
                        <img src="../../../images/sagemaker/latest/dg/images/debugger/debugger-vanishing-gradient.gif" class="aws-docs-img-whiteBg aws-docs-img-padding" alt="&#xA;                        A graph plotting the distribution of gradients of a convolutional&#xA;                            layer suffering from a vanishing gradient problem&#xA;                    " />
                     
                     
                </div>
                <p>This notebook also illustrates how a good initial hyperparameter setting
                    improves the training process by generating the same tensor distribution plots.
                </p>
            </li><li class="listitem">
                <p><a href="https://github.com/awslabs/amazon-sagemaker-examples/tree/master/sagemaker-debugger/mnist_tensor_plot" rel="noopener noreferrer" target="_blank"><span> Visualizing and Debugging Tensors from MXNet Model Training</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></p>
                <p> This notebook example shows how to save and visualize tensors from an MXNet
                    Gluon model training job using Amazon SageMaker Debugger. It illustrates that Debugger is set to save
                    all tensors to an Amazon S3 bucket and retrieves ReLu activation outputs for the
                    visualization. The following figure shows a three-dimensional visualization of
                    the ReLu activation outputs. The color scheme is set to blue to indicate values
                    close to 0 and yellow to indicate values close to 1. </p>
                <div class="mediaobject">
                     
                        <img src="../../../images/sagemaker/latest/dg/images/tensorplot.gif" class="aws-docs-img-whiteBg aws-docs-img-padding" alt="&#xA;                        A visualization of the ReLU activation outputs&#xA;                    " style="max-width:80%" />
                     
                     
                </div>
                <p>In this notebook, the <code class="code">TensorPlot</code> class imported from
                        <code class="code">tensor_plot.py</code> is designed to plot convolutional neural
                    networks (CNNs) that take two-dimensional images for inputs. The
                        <code>tensor_plot.py</code> script provided with the notebook
                    retrieves tensors using Debugger and visualizes the CNN. You can run this notebook
                    on SageMaker Studio to reproduce the tensor visualization and implement your own
                    convolutional neural network model. </p>
            </li><li class="listitem">
                <p><a href="https://github.com/awslabs/amazon-sagemaker-examples/tree/master/sagemaker-debugger/mxnet_realtime_analysis" rel="noopener noreferrer" target="_blank"><span>Real-time Tensor Analysis in a SageMaker Notebook with MXNet</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></p>
                <p>This example guides you through installing required components for emitting
                    tensors in an Amazon SageMaker training job and using the Debugger API operations to
                    access those tensors while training is running. A gluon CNN model is trained on
                    the Fashion MNIST dataset. While the job is running, you will see how Debugger
                    retrieves activation outputs of the first convolutional layer from each of 100
                    batches and visualizes them. Also, this will show you how to visualize weights
                    after the job is done.</p>
            </li></ul></div>
     
     
        <h3 id="debugger-save-built-in-collections">Save Tensors Using Debugger Built-in
                Collections</h3>
        <p>You can use built-in collections of tensors using the <code class="code">CollectionConfig</code>
            API and save them using the <code class="code">DebuggerHookConfig</code> API. The following example
            shows how to use the default settings of Debugger hook configurations to construct a
            SageMaker TensorFlow estimator. You can also utilize this for MXNet, PyTorch, and XGBoost
            estimators.</p>
        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>In the following example code, the <code class="code">s3_output_path</code> parameter for
                    <code class="code">DebuggerHookConfig</code> is optional. If you do not specify it, Debugger
                saves the tensors at <code class="code">s3://&lt;output_path&gt;/debug-output/</code>, where the
                    <code class="code">&lt;output_path&gt;</code> is the default output path of SageMaker training jobs.
                For example:</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">"s3://sagemaker-us-east-1-111122223333/sagemaker-debugger-training-YYYY-MM-DD-HH-MM-SS-123/debug-output"</code></pre></div></div>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python.py ">import sagemaker
from sagemaker.tensorflow import TensorFlow
from sagemaker.debugger import DebuggerHookConfig, CollectionConfig

<b># use Debugger CollectionConfig to call built-in collections</b>
<b>collection_configs</b>=[
        CollectionConfig(name="weights"),
        CollectionConfig(name="gradients"),
        CollectionConfig(name="losses"),
        CollectionConfig(name="biases")
    ]

# configure Debugger hook
# set a target S3 bucket as you want
sagemaker_session=sagemaker.Session()
BUCKET_NAME=sagemaker_session.default_bucket()
LOCATION_IN_BUCKET='debugger-built-in-collections-hook'

<b>hook_config</b>=DebuggerHookConfig(
    s3_output_path='s3://<span>{</span>BUCKET_NAME}/<span>{</span>LOCATION_IN_BUCKET}'.
                    format(BUCKET_NAME=BUCKET_NAME, 
                           LOCATION_IN_BUCKET=LOCATION_IN_BUCKET),
    collection_configs=<b>collection_configs</b>
)

# construct a SageMaker TensorFlow estimator
sagemaker_estimator=TensorFlow(
    entry_point='directory/to/your_training_script.py',
    role=sm.get_execution_role(),
    base_job_name='debugger-demo-job',
    instance_count=1,
    instance_type="<code class="replaceable">ml.p3.2xlarge</code>",
    framework_version="<code class="replaceable">2.9.0</code>",
    py_version="<code class="replaceable">py39</code>",
    
    # debugger-specific hook argument below
    debugger_hook_config=<b>hook_config</b>
)

sagemaker_estimator.fit()</code></pre>
        <p>To see a list of Debugger built-in collections, see <a href="https://github.com/awslabs/sagemaker-debugger/blob/master/docs/api.md#collection" rel="noopener noreferrer" target="_blank"><span>Debugger Built-in Collections</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p>
     
     
        <h3 id="debugger-save-modified-built-in-collections">Save Tensors Using Debugger
                Modified Built-in Collections</h3>
        <p>You can modify the Debugger built-in collections using the <code class="code">CollectionConfig</code>
            API operation. The following example shows how to tweak the built-in <code class="code">losses</code>
            collection and construct a SageMaker TensorFlow estimator. You can also use this for MXNet,
            PyTorch, and XGBoost estimators.</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python.py ">import sagemaker
from sagemaker.tensorflow import TensorFlow
from sagemaker.debugger import DebuggerHookConfig, CollectionConfig

# use Debugger CollectionConfig to call and modify built-in collections
<b>collection_configs</b>=[
    CollectionConfig(
                name="losses", 
                parameters=<span>{</span>"save_interval": "50"})]

# configure Debugger hook
# set a target S3 bucket as you want
sagemaker_session=sagemaker.Session()
BUCKET_NAME=sagemaker_session.default_bucket()
LOCATION_IN_BUCKET='debugger-modified-collections-hook'

<b>hook_config</b>=DebuggerHookConfig(
    s3_output_path='s3://<span>{</span>BUCKET_NAME}/<span>{</span>LOCATION_IN_BUCKET}'.
                    format(BUCKET_NAME=BUCKET_NAME, 
                           LOCATION_IN_BUCKET=LOCATION_IN_BUCKET),
    collection_configs=<b>collection_configs</b>
)

# construct a SageMaker TensorFlow estimator
sagemaker_estimator=TensorFlow(
    entry_point='directory/to/your_training_script.py',
    role=sm.get_execution_role(),
    base_job_name='debugger-demo-job',
    instance_count=1,
    instance_type="<code class="replaceable">ml.p3.2xlarge</code>",
    framework_version="<code class="replaceable">2.9.0</code>",
    py_version="<code class="replaceable">py39</code>",
    
    # debugger-specific hook argument below
    debugger_hook_config=<b>hook_config</b>
)

sagemaker_estimator.fit()</code></pre>
        <p>For a full list of <code class="code">CollectionConfig</code> parameters, see <a href="https://github.com/awslabs/sagemaker-debugger/blob/master/docs/api.md#configuring-collection-using-sagemaker-python-sdk" rel="noopener noreferrer" target="_blank"><span> Debugger CollectionConfig API</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p>
     
     
        <h3 id="debugger-save-custom-collections">Save Tensors Using Debugger Custom
                Collections</h3>
        <p>You can also save a reduced number of tensors instead of the full set of tensors (for
            example, if you want to reduce the amount of data saved in your Amazon S3 bucket). The
            following example shows how to customize the Debugger hook configuration to specify target
            tensors that you want to save. You can use this for TensorFlow, MXNet, PyTorch, and
            XGBoost estimators.</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python.py ">import sagemaker
from sagemaker.tensorflow import TensorFlow
from sagemaker.debugger import DebuggerHookConfig, CollectionConfig

# use Debugger CollectionConfig to create a custom collection
<b>collection_configs</b>=[
        CollectionConfig(
            name="custom_activations_collection",
            parameters=<span>{</span>
                "include_regex": "relu|tanh", # Required
                "reductions": "mean,variance,max,abs_mean,abs_variance,abs_max"
            })
    ]
    
# configure Debugger hook
# set a target S3 bucket as you want
sagemaker_session=sagemaker.Session()
BUCKET_NAME=sagemaker_session.default_bucket()
LOCATION_IN_BUCKET='debugger-custom-collections-hook'

<b>hook_config</b>=DebuggerHookConfig(
    s3_output_path='s3://<span>{</span>BUCKET_NAME}/<span>{</span>LOCATION_IN_BUCKET}'.
                    format(BUCKET_NAME=BUCKET_NAME, 
                           LOCATION_IN_BUCKET=LOCATION_IN_BUCKET),
    collection_configs=<b>collection_configs</b>
)

# construct a SageMaker TensorFlow estimator
sagemaker_estimator=TensorFlow(
    entry_point='directory/to/your_training_script.py',
    role=sm.get_execution_role(),
    base_job_name='debugger-demo-job',
    instance_count=1,
    instance_type="<code class="replaceable">ml.p3.2xlarge</code>",
    framework_version="<code class="replaceable">2.9.0</code>",
    py_version="<code class="replaceable">py39</code>",
    
    # debugger-specific hook argument below
    debugger_hook_config=<b>hook_config</b>
)

sagemaker_estimator.fit()</code></pre>
        <p>For a full list of <code class="code">CollectionConfig</code> parameters, see <a href="https://github.com/awslabs/sagemaker-debugger/blob/master/docs/api.md#configuring-collection-using-sagemaker-python-sdk" rel="noopener noreferrer" target="_blank"><span> Debugger CollectionConfig</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p>
     
    
<awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="https://docs.aws.amazon.com/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./debugger-configuration-for-debugging.html">Step 2: Launch and Debug Training Jobs Using SageMaker Python SDK</div><div id="next" class="next-link" accesskey="n" href="./use-debugger-built-in-rules.html">Configure Debugger Built-in Rules</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=https://docs.aws.amazon.com/en_us/sagemaker/latest/dg/debugger-configure-hook.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=https://docs.aws.amazon.com/en_us/sagemaker/latest/dg/debugger-configure-hook.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>
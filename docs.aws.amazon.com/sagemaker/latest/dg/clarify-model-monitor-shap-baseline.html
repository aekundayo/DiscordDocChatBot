<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Create a SHAP Baseline for Models in Production - Amazon SageMaker</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="clarify-model-monitor-shap-baseline" /><meta name="default_state" content="clarify-model-monitor-shap-baseline" /><link rel="icon" type="image/ico" href="../../../assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="../../../assets/images/favicon.ico" /><link rel="canonical" href="clarify-model-monitor-shap-baseline.html" /><meta name="description" content="Explanations are typically contrastive, that is, they account for deviations from a baseline. For information on explainability baselines, see ." /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon SageMaker" /><meta name="guide" content="Developer Guide" /><meta name="abstract" content="Use Internet Monitor to build, train, and host machine learning models in AWS." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="clarify-model-monitor-shap-baseline.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/sagemaker/latest/dg/clarify-model-monitor-shap-baseline.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/sagemaker/latest/dg/clarify-model-monitor-shap-baseline.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/sagemaker/latest/dg/clarify-model-monitor-shap-baseline.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/sagemaker/latest/dg/clarify-model-monitor-shap-baseline.html" hreflang="de" /><link rel="alternative" href="clarify-model-monitor-shap-baseline.html" hreflang="en-us" /><link rel="alternative" href="clarify-model-monitor-shap-baseline.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/sagemaker/latest/dg/clarify-model-monitor-shap-baseline.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/sagemaker/latest/dg/clarify-model-monitor-shap-baseline.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/sagemaker/latest/dg/clarify-model-monitor-shap-baseline.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/sagemaker/latest/dg/clarify-model-monitor-shap-baseline.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/sagemaker/latest/dg/clarify-model-monitor-shap-baseline.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/sagemaker/latest/dg/clarify-model-monitor-shap-baseline.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/sagemaker/latest/dg/clarify-model-monitor-shap-baseline.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/sagemaker/latest/dg/clarify-model-monitor-shap-baseline.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/sagemaker/latest/dg/clarify-model-monitor-shap-baseline.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/sagemaker/latest/dg/clarify-model-monitor-shap-baseline.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/sagemaker/latest/dg/clarify-model-monitor-shap-baseline.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/sagemaker/latest/dg/clarify-model-monitor-shap-baseline.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/sagemaker/latest/dg/clarify-model-monitor-shap-baseline.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/sagemaker/latest/dg/clarify-model-monitor-shap-baseline.html" hreflang="zh-tw" /><link rel="alternative" href="clarify-model-monitor-shap-baseline.html" hreflang="x-default" /><meta name="feedback-item" content="SageMaker" /><meta name="this_doc_product" content="Amazon SageMaker" /><meta name="this_doc_guide" content="Developer Guide" /><script defer="" src="../../../assets/r/vendor4.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/vendor3.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/vendor1.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/awsdocs-common.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/awsdocs-doc-page.js@version=2021.12.02"></script><link href="../../../assets/r/vendor4.css@version=2021.12.02.css" rel="stylesheet" /><link href="../../../assets/r/awsdocs-common.css@version=2021.12.02.css" rel="stylesheet" /><link href="../../../assets/r/awsdocs-doc-page.css@version=2021.12.02.css" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'sagemaker'}"></script><meta id="panorama-serviceSubSection" value="Developer Guide" /><meta id="panorama-serviceConsolePage" value="Create a SHAP Baseline for Models in Production" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Create a SHAP Baseline for Models in Production - Amazon SageMaker</title><meta name="pdf" content="/pdfs/sagemaker/latest/dg/sagemaker-dg.pdf#clarify-model-monitor-shap-baseline" /><meta name="rss" content="amazon-sagemaker-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=285" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/clarify-model-monitor-shap-baseline.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/clarify-model-monitor-shap-baseline.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/clarify-model-monitor-shap-baseline.html" /><meta name="keywords" content="SageMaker,Amazon SageMaker,machine learning,notebook instance" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon SageMaker",
        "item" : "https://docs.aws.amazon.com/sagemaker/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Developer Guide",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Monitor data and model quality",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/model-monitor.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Monitor Feature Attribution Drift for Models in Production",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/clarify-model-monitor-feature-attribution-drift.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Create a SHAP Baseline for Models in Production",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/clarify-model-monitor-feature-attribution-drift.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="https://docs.aws.amazon.com/pdfs/sagemaker/latest/dg/sagemaker-dg.pdf#clarify-model-monitor-shap-baseline" target="_blank" rel="noopener noreferrer" title="Open PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="https://docs.aws.amazon.com/index.html">Documentation</a><a href="https://docs.aws.amazon.com/sagemaker/index.html">Amazon SageMaker</a><a href="whatis.html">Developer Guide</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="clarify-model-monitor-shap-baseline">Create a SHAP Baseline for Models
                in Production</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>Explanations are typically contrastive, that is, they account for deviations from a
            baseline. For information on explainability baselines, see <a href="clarify-feature-attribute-shap-baselines.html">SHAP Baselines for
                Explainability</a>.</p><p>In addition to providing explanations for per-instance inferences, SageMaker Clarify also supports
            global explanation for ML models that helps you understand the behavior of a model as a
            whole in terms of its features. SageMaker Clarify generates a global explanation of an ML model by
            aggregating the Shapley values over multiple instances. SageMaker Clarify supports the following
            different ways of aggregation, which you can use to define baselines:</p><div class="itemizedlist">
             
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><code class="code">mean_abs</code> – Mean of absolute SHAP values for all
                    instances.</p>
            </li><li class="listitem">
                <p><code class="code">median</code> – Median of SHAP values for all instances.</p>
            </li><li class="listitem">
                <p><code class="code">mean_sq</code> – Mean of squared SHAP values for all
                    instances.</p>
            </li></ul></div><p>After you have configured your application to capture real-time or batch transform inference data, the
            first task to monitor for drift in feature attribution is to create a baseline to
            compare against. This involves configuring the data inputs, which groups are sensitive,
            how the predictions are captured, and the model and its posttraining bias metrics. Then
            you need to start the baselining job. Model explainability monitor can explain the
            predictions of a deployed model that's producing inferences and detect feature
            attribution drift on a regular basis.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">
model_explainability_monitor = ModelExplainabilityMonitor(
    role=role,
    sagemaker_session=sagemaker_session,
    max_runtime_in_seconds=1800,
)</code></pre><p>In this example, the explainability baselining job shares the test dataset with the
            bias baselining job, so it uses the same <code class="code">DataConfig</code>, and the only
            difference is the job output URI.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">model_explainability_baselining_job_result_uri = f"<span>{</span>baseline_results_uri}/model_explainability"
model_explainability_data_config = DataConfig(
    s3_data_input_path=validation_dataset,
    s3_output_path=model_explainability_baselining_job_result_uri,
    label=label_header,
    headers=all_headers,
    dataset_type=dataset_type,
)</code></pre><p>Currently the SageMaker Clarify explainer offers a scalable and efficient implementation of SHAP,
            so the explainability config is SHAPConfig, including the following:</p><div class="itemizedlist">
             
             
             
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><code class="code">baseline</code> – A list of rows (at least one) or S3 object URI
                    to be used as the baseline dataset in the Kernel SHAP algorithm. The format
                    should be the same as the dataset format. Each row should contain only the
                    feature columns/values and omit the label column/values.</p>
            </li><li class="listitem">
                <p><code class="code">num_samples</code> – Number of samples to be used in the Kernel
                    SHAP algorithm. This number determines the size of the generated synthetic
                    dataset to compute the SHAP values.</p>
            </li><li class="listitem">
                <p>agg_method – Aggregation method for global SHAP values. Following are
                    valid values:</p>
                <div class="itemizedlist">
                     
                     
                     
                <ul class="itemizedlist"><li class="listitem">
                        <p><code class="code">mean_abs</code> – Mean of absolute SHAP values for all
                            instances.</p>
                    </li><li class="listitem">
                        <p><code class="code">median</code> – Median of SHAP values for all
                            instances.</p>
                    </li><li class="listitem">
                        <p><code class="code">mean_sq</code> – Mean of squared SHAP values for all
                            instances.</p>
                    </li></ul></div>
            </li><li class="listitem">
                <p><code class="code">use_logit</code> – Indicator of whether the logit function is to
                    be applied to the model predictions. Default is <code class="code">False</code>. If
                        <code class="code">use_logit</code> is <code class="code">True</code>, the SHAP values will have
                    log-odds units.</p>
            </li><li class="listitem">
                <p><code class="code">save_local_shap_values</code> (bool) – Indicator of whether to
                    save the local SHAP values in the output location. Default is
                    <code class="code">False</code>.</p>
            </li></ul></div><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class=""># Here use the mean value of test dataset as SHAP baseline
test_dataframe = pd.read_csv(test_dataset, header=None)
shap_baseline = [list(test_dataframe.mean())]

shap_config = SHAPConfig(
    baseline=shap_baseline,
    num_samples=100,
    agg_method="mean_abs",
    save_local_shap_values=False,
)</code></pre><p>Start a baselining job. The same <code class="code">model_config</code> is required because the
            explainability baselining job needs to create a shadow endpoint to get predictions for
            the generated synthetic dataset.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">model_explainability_monitor.suggest_baseline(
    data_config=model_explainability_data_config,
    model_config=model_config,
    explainability_config=shap_config,
)
print(f"ModelExplainabilityMonitor baselining job: <span>{</span>model_explainability_monitor.latest_baselining_job_name}")</code></pre><awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="https://docs.aws.amazon.com/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./clarify-model-monitor-feature-attribution-drift.html">Monitor Feature Attribution Drift</div><div id="next" class="next-link" accesskey="n" href="./clarify-model-monitor-model-attribution-drift-violations.html">Feature Attribution Drift Violations</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=https://docs.aws.amazon.com/en_us/sagemaker/latest/dg/clarify-model-monitor-shap-baseline.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=https://docs.aws.amazon.com/en_us/sagemaker/latest/dg/clarify-model-monitor-shap-baseline.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>
<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Use Apache Spark with Amazon SageMaker - Amazon SageMaker</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="apache-spark" /><meta name="default_state" content="apache-spark" /><link rel="icon" type="image/ico" href="../../../assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="../../../assets/images/favicon.ico" /><link rel="canonical" href="apache-spark.html" /><meta name="description" content="This section provides information for developers who want to use Apache Spark for preprocessing data and Amazon SageMaker for model training and hosting. For information about supported versions of Apache Spark, see the Getting SageMaker Spark page in the SageMaker Spark GitHub repository." /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon SageMaker" /><meta name="guide" content="Developer Guide" /><meta name="abstract" content="Use Internet Monitor to build, train, and host machine learning models in AWS." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="apache-spark.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/sagemaker/latest/dg/apache-spark.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/sagemaker/latest/dg/apache-spark.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/sagemaker/latest/dg/apache-spark.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/sagemaker/latest/dg/apache-spark.html" hreflang="de" /><link rel="alternative" href="apache-spark.html" hreflang="en-us" /><link rel="alternative" href="apache-spark.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/sagemaker/latest/dg/apache-spark.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/sagemaker/latest/dg/apache-spark.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/sagemaker/latest/dg/apache-spark.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/sagemaker/latest/dg/apache-spark.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/sagemaker/latest/dg/apache-spark.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/sagemaker/latest/dg/apache-spark.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/sagemaker/latest/dg/apache-spark.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/sagemaker/latest/dg/apache-spark.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/sagemaker/latest/dg/apache-spark.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/sagemaker/latest/dg/apache-spark.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/sagemaker/latest/dg/apache-spark.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/sagemaker/latest/dg/apache-spark.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/sagemaker/latest/dg/apache-spark.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/sagemaker/latest/dg/apache-spark.html" hreflang="zh-tw" /><link rel="alternative" href="apache-spark.html" hreflang="x-default" /><meta name="feedback-item" content="SageMaker" /><meta name="this_doc_product" content="Amazon SageMaker" /><meta name="this_doc_guide" content="Developer Guide" /><script defer="" src="../../../assets/r/vendor4.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/vendor3.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/vendor1.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/awsdocs-common.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/awsdocs-doc-page.js@version=2021.12.02"></script><link href="../../../assets/r/vendor4.css@version=2021.12.02.css" rel="stylesheet" /><link href="../../../assets/r/awsdocs-common.css@version=2021.12.02.css" rel="stylesheet" /><link href="../../../assets/r/awsdocs-doc-page.css@version=2021.12.02.css" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'sagemaker'}"></script><meta id="panorama-serviceSubSection" value="Developer Guide" /><meta id="panorama-serviceConsolePage" value="Use Apache Spark with Amazon SageMaker" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Use Apache Spark with Amazon SageMaker - Amazon SageMaker</title><meta name="pdf" content="/pdfs/sagemaker/latest/dg/sagemaker-dg.pdf#apache-spark" /><meta name="rss" content="amazon-sagemaker-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=285" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/apache-spark.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/apache-spark.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/apache-spark.html" /><meta name="keywords" content="SageMaker,Amazon SageMaker,machine learning,notebook instance" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon SageMaker",
        "item" : "https://docs.aws.amazon.com/sagemaker/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Developer Guide",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Amazon SageMaker Reference",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/reference.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Machine Learning Frameworks and Languages",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/frameworks.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Use Apache Spark with Amazon SageMaker",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/frameworks.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="https://docs.aws.amazon.com/pdfs/sagemaker/latest/dg/sagemaker-dg.pdf#apache-spark" target="_blank" rel="noopener noreferrer" title="Open PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="https://docs.aws.amazon.com/index.html">Documentation</a><a href="https://docs.aws.amazon.com/sagemaker/index.html">Amazon SageMaker</a><a href="whatis.html">Developer Guide</a></div><div id="page-toc-src"><a href="apache-spark.html#spark-sdk-download">Download the SageMaker Spark Library</a><a href="apache-spark.html#spark-sdk-common-process">Integrate Your Apache Spark Application with
                SageMaker</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="apache-spark">Use Apache Spark with Amazon SageMaker</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>This section provides information for developers who want to use Apache Spark for
        preprocessing data and Amazon SageMaker for model training and hosting. For information about
        supported versions of Apache Spark, see the <a href="https://github.com/aws/sagemaker-spark#getting-sagemaker-spark" rel="noopener noreferrer" target="_blank"><span>Getting SageMaker
            Spark</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> page in the SageMaker Spark GitHub repository.</p><p>SageMaker provides an Apache Spark library, in both Python and Scala, that you can use to
        easily train models in SageMaker using <code class="code">org.apache.spark.sql.DataFrame</code> data frames in
        your Spark clusters. After model training, you can also host the model using SageMaker hosting
        services. </p><p>The SageMaker Spark library, <code class="code">com.amazonaws.services.sagemaker.sparksdk</code>, provides
        the following classes, among others:</p><div class="itemizedlist">
         
         
         
    <ul class="itemizedlist"><li class="listitem">
            <p><code class="code">SageMakerEstimator</code>—Extends the
                    <code class="code">org.apache.spark.ml.Estimator</code> interface. You can use this estimator
                for model training in SageMaker.</p>
        </li><li class="listitem">
            <p><code class="code">KMeansSageMakerEstimator</code>, <code class="code">PCASageMakerEstimator</code>, and
                    <code class="code">XGBoostSageMakerEstimator</code>—Extend the
                    <code class="code">SageMakerEstimator</code> class. </p>
        </li><li class="listitem">
            <p><code class="code">SageMakerModel</code>—Extends the
                    <code class="code">org.apache.spark.ml.Model</code> class. You can use this
                    <code class="code">SageMakerModel</code> for model hosting and obtaining inferences in
                SageMaker.</p>
        </li></ul></div><p>With SageMaker Studio, you can easily connect to an Amazon EMR cluster. For more information, see 
        <a href="studio-notebooks-emr-cluster.html">Prepare data at Scale with Studio Notebooks</a>.</p>
        <h2 id="spark-sdk-download">Download the SageMaker Spark Library</h2>
        <p>You have the following options for downloading the Spark library provided by
            SageMaker:</p>
        <div class="itemizedlist">
             
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p>You can download the source code for both PySpark and Scala libraries from the
                        <a href="https://github.com/aws/sagemaker-spark" rel="noopener noreferrer" target="_blank"><span>SageMaker Spark</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>
                    GitHub repository. </p>
            </li><li class="listitem">
                <p>For the Python Spark library, you have the following additional
                    options:</p>
                <div class="itemizedlist">
                     
                     
                <ul class="itemizedlist"><li class="listitem">
                        <p>Use pip install:</p>
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">pip install sagemaker_pyspark</code></pre>
                    </li><li class="listitem">
                        <p>In a notebook instance, create a new notebook that uses either the
                                <code class="code">Sparkmagic (PySpark)</code> or the <code class="code">Sparkmagic
                                (PySpark3)</code> kernel and connect to a remote Amazon EMR cluster.
                                
                        </p>
                        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>The EMR cluster must be configured with an IAM role that has the
                                    <code class="code">AmazonSageMakerFullAccess</code> policy attached. For
                                information about configuring roles for an EMR cluster, see <a href="https://docs.aws.amazon.com/emr/latest/ManagementGuide/emr-iam-roles.html">Configure IAM Roles for Amazon EMR Permissions to AWS
                                    Services</a> in the <em>Amazon EMR Management
                                    Guide</em>.</p></div></div>
                        <p> </p>
                    </li></ul></div>
            </li><li class="listitem">
                <p>You can get the Scala library from Maven. Add the Spark library to your
                    project by adding the following dependency to your <code>pom.xml</code>
                    file:</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">&lt;dependency&gt;
    &lt;groupId&gt;com.amazonaws&lt;/groupId&gt;
    &lt;artifactId&gt;sagemaker-spark_2.11&lt;/artifactId&gt;
    &lt;version&gt;spark_2.2.0-1.0&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
            </li></ul></div>
     
        <h2 id="spark-sdk-common-process">Integrate Your Apache Spark Application with
                SageMaker</h2>
        <p>The following is high-level summary of the steps for integrating your Apache Spark
            application with SageMaker.</p>
        <div class="procedure"><ol><li>
                <p>Continue data preprocessing using the Apache Spark library that you are
                    familiar with. Your dataset remains a <code class="code">DataFrame</code> in your Spark
                    cluster. Load your data into a <code class="code">DataFrame</code> and preprocess it so that
                    you have a <code>features</code> column with
                        <code class="code">org.apache.spark.ml.linalg.Vector</code> of <code class="code">Doubles</code>, and
                    an optional <code>label</code> column with values of
                    <code class="code">Double</code>​ type.</p>
            </li><li>
                <p>Use the estimator in the SageMaker Spark library to train your model. For example,
                    if you choose the k-means algorithm provided by SageMaker for model training, you
                    call the <code class="code">KMeansSageMakerEstimator.fit</code> method. </p>
                <p>Provide your <code class="code">DataFrame</code> as input. The estimator returns a
                        <code class="code">SageMakerModel</code> object. </p>
                <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p><code class="code">SageMakerModel</code> extends the
                            <code class="code">org.apache.spark.ml.Model</code>.</p></div></div>
                <p>The <code class="code">fit</code> method does the following: </p>
                <ol><li>
                        <p>Converts the input <code class="code">DataFrame</code> to the protobuf format by
                            selecting the <code>features</code> and
                                <code>label</code> columns from the input
                                <code>DataFrame</code> and uploading the protobuf data to an
                            Amazon S3 bucket. The protobuf format is efficient for model training in
                            SageMaker.</p>
                    </li><li>
                        <p>Starts model training in SageMaker by sending a SageMaker <a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_CreateTrainingJob.html"><code class="code">CreateTrainingJob</code></a> request. After model training
                            has completed, SageMaker saves the model artifacts to an S3 bucket. </p>
                        <p>SageMaker assumes the IAM role that you specified for model training to
                            perform tasks on your behalf. For example, it uses the role to read
                            training data from an S3 bucket and to write model artifacts to a
                            bucket. </p>
                    </li><li>
                        <p>Creates and returns a <code class="code">SageMakerModel</code> object. The
                            constructor does the following tasks, which are related to deploying
                            your model to SageMaker. </p>
                        <ol><li>
                                <p>Sends a <a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_CreateModel.html"><code class="code">CreateModel</code></a> request to SageMaker. </p>
                            </li><li>
                                <p>Sends a <a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_CreateEndpointConfig.html"><code class="code">CreateEndpointConfig</code></a> request to
                                    SageMaker.</p>
                            </li><li>
                                <p>Sends a <a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_CreateEndpoint.html"><code class="code">CreateEndpoint</code></a> request to SageMaker, which
                                    then launches the specified resources, and hosts the model on
                                    them. </p>
                            </li></ol>
                    </li></ol>
            </li><li>
                <p>You can get inferences from your model hosted in SageMaker with the
                        <code class="code">SageMakerModel.transform</code>. </p>
                <p>Provide an input <code class="code">DataFrame</code> with features as input. The
                        <code class="code">transform</code> method transforms it to a <code class="code">DataFrame</code>
                    containing inferences. Internally, the <code class="code">transform</code> method sends a
                    request to the <a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_InvokeEndpoint.html"><code class="code">InvokeEndpoint</code></a> SageMaker API to get inferences. The
                        <code class="code">transform</code> method appends the inferences to the input
                        <code class="code">DataFrame</code>.</p>
            </li></ol></div>
    <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="https://docs.aws.amazon.com/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./mxnet.html">Apache MXNet</div><div id="next" class="next-link" accesskey="n" href="./apache-spark-example1.html">Example 1: SageMaker with Apache Spark </div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=https://docs.aws.amazon.com/en_us/sagemaker/latest/dg/apache-spark.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=https://docs.aws.amazon.com/en_us/sagemaker/latest/dg/apache-spark.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>
<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Troubleshooting - Amazon SageMaker</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="studio-notebooks-emr-troubleshooting" /><meta name="default_state" content="studio-notebooks-emr-troubleshooting" /><link rel="icon" type="image/ico" href="../../../assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="../../../assets/images/favicon.ico" /><link rel="canonical" href="studio-notebooks-emr-troubleshooting.html" /><meta name="description" content="Learn to troubleshoot common errors that might occur while connecting or using Amazon EMR clusters from Studio notebooks." /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon SageMaker" /><meta name="guide" content="Developer Guide" /><meta name="abstract" content="Use Internet Monitor to build, train, and host machine learning models in AWS." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="studio-notebooks-emr-troubleshooting.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/sagemaker/latest/dg/studio-notebooks-emr-troubleshooting.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/sagemaker/latest/dg/studio-notebooks-emr-troubleshooting.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/sagemaker/latest/dg/studio-notebooks-emr-troubleshooting.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/sagemaker/latest/dg/studio-notebooks-emr-troubleshooting.html" hreflang="de" /><link rel="alternative" href="studio-notebooks-emr-troubleshooting.html" hreflang="en-us" /><link rel="alternative" href="studio-notebooks-emr-troubleshooting.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/sagemaker/latest/dg/studio-notebooks-emr-troubleshooting.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/sagemaker/latest/dg/studio-notebooks-emr-troubleshooting.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/sagemaker/latest/dg/studio-notebooks-emr-troubleshooting.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/sagemaker/latest/dg/studio-notebooks-emr-troubleshooting.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/sagemaker/latest/dg/studio-notebooks-emr-troubleshooting.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/sagemaker/latest/dg/studio-notebooks-emr-troubleshooting.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/sagemaker/latest/dg/studio-notebooks-emr-troubleshooting.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/sagemaker/latest/dg/studio-notebooks-emr-troubleshooting.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/sagemaker/latest/dg/studio-notebooks-emr-troubleshooting.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/sagemaker/latest/dg/studio-notebooks-emr-troubleshooting.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/sagemaker/latest/dg/studio-notebooks-emr-troubleshooting.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/sagemaker/latest/dg/studio-notebooks-emr-troubleshooting.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/sagemaker/latest/dg/studio-notebooks-emr-troubleshooting.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/sagemaker/latest/dg/studio-notebooks-emr-troubleshooting.html" hreflang="zh-tw" /><link rel="alternative" href="studio-notebooks-emr-troubleshooting.html" hreflang="x-default" /><meta name="feedback-item" content="SageMaker" /><meta name="this_doc_product" content="Amazon SageMaker" /><meta name="this_doc_guide" content="Developer Guide" /><script defer="" src="../../../assets/r/vendor4.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/vendor3.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/vendor1.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/awsdocs-common.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/awsdocs-doc-page.js@version=2021.12.02"></script><link href="../../../assets/r/vendor4.css@version=2021.12.02.css" rel="stylesheet" /><link href="../../../assets/r/awsdocs-common.css@version=2021.12.02.css" rel="stylesheet" /><link href="../../../assets/r/awsdocs-doc-page.css@version=2021.12.02.css" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'sagemaker'}"></script><meta id="panorama-serviceSubSection" value="Developer Guide" /><meta id="panorama-serviceConsolePage" value="Troubleshooting" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Troubleshooting - Amazon SageMaker</title><meta name="pdf" content="/pdfs/sagemaker/latest/dg/sagemaker-dg.pdf#studio-notebooks-emr-troubleshooting" /><meta name="rss" content="amazon-sagemaker-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=285" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/studio-notebooks-emr-troubleshooting.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/studio-notebooks-emr-troubleshooting.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/studio-notebooks-emr-troubleshooting.html" /><meta name="keywords" content="SageMaker,Amazon SageMaker,machine learning,notebook instance,SageMaker Amazon EMR,SageMaker AWS Glue,SageMaker Spark,SageMaker Hive,SageMaker Presto" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon SageMaker",
        "item" : "https://docs.aws.amazon.com/sagemaker/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Developer Guide",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Prepare data",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/data-prep.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Scale data preparation using Apache Spark, Hive, or Presto on Amazon EMR or AWS Glue from Amazon SageMaker Studio notebooks",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/studio-notebooks-emr-spark-glue.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Prepare data using Amazon EMR",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/studio-notebooks-emr-cluster.html"
      },
      {
        "@type" : "ListItem",
        "position" : 7,
        "name" : "Troubleshooting",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/studio-notebooks-emr-cluster.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="https://docs.aws.amazon.com/pdfs/sagemaker/latest/dg/sagemaker-dg.pdf#studio-notebooks-emr-troubleshooting" target="_blank" rel="noopener noreferrer" title="Open PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="https://docs.aws.amazon.com/index.html">Documentation</a><a href="https://docs.aws.amazon.com/sagemaker/index.html">Amazon SageMaker</a><a href="whatis.html">Developer Guide</a></div><div id="page-toc-src"><a href="studio-notebooks-emr-troubleshooting.html#studio-notebooks-emr-troubleshooting.memoryerror">Troubleshoot Livy
                    connections hanging or failing</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="studio-notebooks-emr-troubleshooting">Troubleshooting</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>The following are common errors that might occur while connecting or using Amazon EMR
            clusters from Studio notebooks.</p>
            <h2 id="studio-notebooks-emr-troubleshooting.memoryerror">Troubleshoot Livy
                    connections hanging or failing</h2>
            <p>The following are Livy connectivity issues that might occur while using Amazon EMR
                clusters from Studio notebooks.</p>
            <div class="itemizedlist">
                 
                 
            <ul class="itemizedlist"><li class="listitem">
                    <p><span class="topcom">Your Amazon EMR cluster encountered an out-of-memory
                            error.</span></p>
                    <p>A possible reason for a Livy connection via <code class="code">sparkmagic</code>
                        hanging or failing is if your Amazon EMR cluster encountered an out-of-memory
                        error. </p>
                    <p>By default, the Java configuration parameter of the Apache Spark driver,
                            <code class="code">spark.driver.defaultJavaOptions</code>, is set to
                            <code class="code">-XX:OnOutOfMemoryError='kill -9 %p'</code>. This means that the
                        default action taken when the driver program encounters an
                            <code class="code">OutOfMemoryError</code> is to terminate the driver program by
                        sending a SIGKILL signal. When the Apache Spark driver is terminated, any
                        Livy connection via <code class="code">sparkmagic</code> that depends on that driver
                        hangs or fails. This is because the Spark driver is responsible for managing
                        the Spark application's resources, including task scheduling and execution.
                        Without the driver, the Spark application cannot function, and any attempts
                        to interact with it fails.</p>

                    <p>If you suspect that your Spark cluster is experiencing memory issues, you
                        can check <a href="https://docs.aws.amazon.com/emr/latest/ManagementGuide/emr-manage-view-web-log-files.html">Amazon EMR logs</a>. Containers killed due to out-of-memory errors
                        typically exit with a code of <code class="code">137</code>. In such cases, you need to
                        restart the Spark application and establish a new Livy connection to resume
                        interaction with the Spark cluster.</p>

                    <p>You can refer to the knowledge base article <a href="https://repost.aws/knowledge-center/emr-spark-yarn-memory-limit" rel="noopener noreferrer" target="_blank"><span>How do I resolve the error "Container killed by YARN for exceeding
                            memory limits" in Spark on Amazon EMR?</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> on AWS re:Post to learn about
                        various strategies and parameters that can be used to address an
                        out-of-memory issue.</p>
                    <p>We recommend reviewing the <a href="https://aws.github.io/aws-emr-best-practices/" rel="noopener noreferrer" target="_blank"><span>Amazon EMR Best Practices
                            Guides</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> for best practices and tuning guidance on running Apache
                        Spark workloads on your Amazon EMR clusters.</p>
                </li><li class="listitem">
                    <p><span class="topcom">Your Livy session times out when connecting to an
                            Amazon EMR cluster for the first time.</span></p>
                    <p>When you initially connect to an Amazon EMR cluster using <a href="https://pypi.org/project/sagemaker-studio-analytics-extension/" rel="noopener noreferrer" target="_blank"><span>sagemaker-studio-analytics-extension</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>, which enables connection
                        to a remote Spark (Amazon EMR) cluster via the <a href="https://github.com/jupyter-incubator/sparkmagic" rel="noopener noreferrer" target="_blank"><span>SparkMagic</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>
                        library using <a href="https://livy.apache.org/" rel="noopener noreferrer" target="_blank"><span>Apache Livy</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>, you
                        may encounter a connection timeout error:</p>
                    <p><code class="code">An error was encountered: Session 0 did not start up in 60
                            seconds.</code></p>

                    <p>If your Amazon EMR cluster requires the initialization of a Spark application
                        upon establishing a connection, there is an increased chance of seeing
                        connection timeout errors.</p>

                    <p>To reduce the chances of getting timeouts when connecting to an Amazon EMR
                        cluster using Livy through the analytics extension,
                            <code class="code">sagemaker-studio-analytics-extension</code> version
                            <code class="code">0.0.19</code> and later override the default server session
                        timeout to <code class="code">120</code> seconds instead of <code class="code">sparkmagic</code>'s
                        default of <code class="code">60</code> seconds.</p>
                    <p> We recommend upgrading your extension <code class="code">0.0.18</code> and sooner by
                        running the following upgrade command.</p>
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python ">pip install --upgrade sagemaker-studio-analytics-extension</code></pre>

                    <p>Note that when providing a custom timeout configuration in
                            <code class="code">sparkmagic</code>,
                            <code class="code">sagemaker-studio-analytics-extension</code> honors this override.
                        However, setting the session timeout to <code class="code">60</code> seconds
                        automatically triggers the default server session timeout of
                            <code class="code">120</code> seconds in
                            <code class="code">sagemaker-studio-analytics-extension</code>.</p>
                </li></ul></div>
        <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="https://docs.aws.amazon.com/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./studio-notebooks-emr-cross-accounts-permissions.html">Additional Configuration for Cross Accounts (For
                Administrators)</div><div id="next" class="next-link" accesskey="n" href="./studio-notebooks-glue.html">Prepare data using AWS Glue Interactive Sessions</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=https://docs.aws.amazon.com/en_us/sagemaker/latest/dg/studio-notebooks-emr-troubleshooting.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=https://docs.aws.amazon.com/en_us/sagemaker/latest/dg/studio-notebooks-emr-troubleshooting.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>
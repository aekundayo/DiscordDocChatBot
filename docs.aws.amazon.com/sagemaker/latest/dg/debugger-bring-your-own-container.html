<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Use Debugger with Custom Training Containers - Amazon SageMaker</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="debugger-bring-your-own-container" /><meta name="default_state" content="debugger-bring-your-own-container" /><link rel="icon" type="image/ico" href="../../../assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="../../../assets/images/favicon.ico" /><link rel="canonical" href="debugger-bring-your-own-container.html" /><meta name="description" content="Amazon SageMaker Debugger is available for any deep learning models that you bring to Amazon SageMaker. The AWS CLI, SageMaker Estimator API, and the Debugger APIs enable you to use any Docker base images to build and customize containers to train your models. To use Debugger with customized containers, you need to make a minimal change to your training script to implement the Debugger hook callback and retrieve tensors from training jobs." /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon SageMaker" /><meta name="guide" content="Developer Guide" /><meta name="abstract" content="Use Internet Monitor to build, train, and host machine learning models in AWS." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="debugger-bring-your-own-container.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/sagemaker/latest/dg/debugger-bring-your-own-container.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/sagemaker/latest/dg/debugger-bring-your-own-container.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/sagemaker/latest/dg/debugger-bring-your-own-container.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/sagemaker/latest/dg/debugger-bring-your-own-container.html" hreflang="de" /><link rel="alternative" href="debugger-bring-your-own-container.html" hreflang="en-us" /><link rel="alternative" href="debugger-bring-your-own-container.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/sagemaker/latest/dg/debugger-bring-your-own-container.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/sagemaker/latest/dg/debugger-bring-your-own-container.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/sagemaker/latest/dg/debugger-bring-your-own-container.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/sagemaker/latest/dg/debugger-bring-your-own-container.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/sagemaker/latest/dg/debugger-bring-your-own-container.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/sagemaker/latest/dg/debugger-bring-your-own-container.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/sagemaker/latest/dg/debugger-bring-your-own-container.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/sagemaker/latest/dg/debugger-bring-your-own-container.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/sagemaker/latest/dg/debugger-bring-your-own-container.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/sagemaker/latest/dg/debugger-bring-your-own-container.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/sagemaker/latest/dg/debugger-bring-your-own-container.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/sagemaker/latest/dg/debugger-bring-your-own-container.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/sagemaker/latest/dg/debugger-bring-your-own-container.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/sagemaker/latest/dg/debugger-bring-your-own-container.html" hreflang="zh-tw" /><link rel="alternative" href="debugger-bring-your-own-container.html" hreflang="x-default" /><meta name="feedback-item" content="SageMaker" /><meta name="this_doc_product" content="Amazon SageMaker" /><meta name="this_doc_guide" content="Developer Guide" /><script defer="" src="../../../assets/r/vendor4.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/vendor3.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/vendor1.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/awsdocs-common.js@version=2021.12.02"></script><script defer="" src="../../../assets/r/awsdocs-doc-page.js@version=2021.12.02"></script><link href="../../../assets/r/vendor4.css@version=2021.12.02.css" rel="stylesheet" /><link href="../../../assets/r/awsdocs-common.css@version=2021.12.02.css" rel="stylesheet" /><link href="../../../assets/r/awsdocs-doc-page.css@version=2021.12.02.css" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'sagemaker'}"></script><meta id="panorama-serviceSubSection" value="Developer Guide" /><meta id="panorama-serviceConsolePage" value="Use Debugger with Custom Training Containers" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Use Debugger with Custom Training Containers - Amazon SageMaker</title><meta name="pdf" content="/pdfs/sagemaker/latest/dg/sagemaker-dg.pdf#debugger-bring-your-own-container" /><meta name="rss" content="amazon-sagemaker-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=285" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/debugger-bring-your-own-container.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/debugger-bring-your-own-container.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/sagemaker/latest/dg/debugger-bring-your-own-container.html" /><meta name="keywords" content="SageMaker,Amazon SageMaker,machine learning,notebook instance" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon SageMaker",
        "item" : "https://docs.aws.amazon.com/sagemaker/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Developer Guide",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Train machine learning models",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/train-model.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Debug and improve model performance",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/train-debug-and-improve-model-performance.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Use Amazon SageMaker Debugger to debug and improve model performance",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/train-debugger.html"
      },
      {
        "@type" : "ListItem",
        "position" : 7,
        "name" : "Use Debugger with Custom Training Containers",
        "item" : "https://docs.aws.amazon.com/sagemaker/latest/dg/train-debugger.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="https://docs.aws.amazon.com/pdfs/sagemaker/latest/dg/sagemaker-dg.pdf#debugger-bring-your-own-container" target="_blank" rel="noopener noreferrer" title="Open PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="https://docs.aws.amazon.com/index.html">Documentation</a><a href="https://docs.aws.amazon.com/sagemaker/index.html">Amazon SageMaker</a><a href="whatis.html">Developer Guide</a></div><div id="page-toc-src"><a href="debugger-bring-your-own-container.html#debugger-bring-your-own-container-1">Preparation to Build a Custom Container</a><a href="debugger-bring-your-own-container.html#debugger-script-mode">Register Debugger Hook to Your Training Script</a><a href="debugger-bring-your-own-container.html#debugger-bring-your-own-container-2">Configure a Dockerfile</a><a href="debugger-bring-your-own-container.html#debugger-bring-your-own-container-3">Build and Push the Custom Container to an ECR</a><a href="debugger-bring-your-own-container.html#debugger-bring-your-own-container-4">Run and Debug Training Jobs Using the Custom Container</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="debugger-bring-your-own-container">Use Debugger with Custom Training
            Containers</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>Amazon SageMaker Debugger is available for any deep learning models that you bring to Amazon SageMaker. The AWS CLI,
        SageMaker <code class="code">Estimator</code> API, and the Debugger APIs enable you to use any Docker base
        images to build and customize containers to train your models. To use Debugger with customized
        containers, you need to make a minimal change to your training script to implement the
        Debugger hook callback and retrieve tensors from training jobs.</p><p>You need the following resources to build a customized container with Debugger.</p><div class="itemizedlist">
         
         
         
         
    <ul class="itemizedlist"><li class="listitem"><p><a href="https://sagemaker.readthedocs.io" rel="noopener noreferrer" target="_blank"><span>Amazon SageMaker Python SDK</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></p></li><li class="listitem"><p><a href="https://github.com/awslabs/sagemaker-debugger" rel="noopener noreferrer" target="_blank"><span>The SMDebug open source client
                    library</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></p></li><li class="listitem"><p>A Docker base image of your choice</p></li><li class="listitem"><p>Your training script with a Debugger hook registered – For more information about
                registering a Debugger hook to your training script, see <a href="debugger-bring-your-own-container.html#debugger-script-mode">Register Debugger Hook to Your Training
                Script</a>.</p></li></ul></div><p>For an end-to-end example of using Debugger with a custom training container, see the
        following example notebook.</p><div class="itemizedlist">
         
    <ul class="itemizedlist"><li class="listitem"><p><a href="https://sagemaker-examples.readthedocs.io/en/latest/sagemaker-debugger/build_your_own_container_with_debugger/debugger_byoc.html" rel="noopener noreferrer" target="_blank"><span>Build a Custom Training Container and Debug Training Jobs with Debugger</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></p></li></ul></div><div class="awsdocs-note awsdocs-tip"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Tip</h6></div><div class="awsdocs-note-text"><p>This custom container with Debugger guide is an extension of the <a href="adapt-training-container.html">Adapting your own training container</a> guide
            which walks you thorough how to build and push your custom training container to
            Amazon ECR.</p></div></div>
        <h2 id="debugger-bring-your-own-container-1">Prepare to Build a Custom Training
                Container</h2>
        <p>To build a docker container, the basic structure of files should look like the
            following:</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">├── debugger_custom_container_test_notebook.ipynb      # a notebook to run python snippet codes
└── debugger_custom_container_test_folder              # this is a docker folder
    ├──  your-training-script.py                       # your training script with Debugger hook
    └──  Dockerfile                                    # a Dockerfile to build your own container</code></pre>
     
        <h2 id="debugger-script-mode">Register Debugger Hook to Your Training
                Script</h2>
        <p>To debug your model training, you need to add a Debugger hook to your training script.</p>
        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>This step is required to collect model parameters (output tensors) for debugging your model training.
            If you only want to monitor and profile, you can skip this hook registration step
            and exclude the <code class="code">debugger_hook_config</code> parameter when constructing an estimater.</p></div></div>
        <p>The following example code shows the structure of a training script using the Keras
            ResNet50 model and how to pass the Debugger hook as a Keras callback for debugging. To
            find a complete training script, see <a href="https://github.com/aws/amazon-sagemaker-examples/blob/master/sagemaker-debugger/build_your_own_container_with_debugger/docker/tf_keras_resnet_byoc.py" rel="noopener noreferrer" target="_blank"><span>TensorFlow training script with SageMaker Debugger hook</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python.py "># An example of training script (your-training-script.py)
import tensorflow.compat.v2 as tf
from tensorflow.keras.applications.resnet50 import ResNet50
import smdebug.tensorflow as smd

def train(batch_size, epoch, model, hook):

    ...
    model.fit(X_train, Y_train,
              batch_size=batch_size,
              epochs=epoch,
              validation_data=(X_valid, Y_valid),
              shuffle=True,

              <b># smdebug modification: Pass the Debugger hook in the main() as a Keras callback</b>
              callbacks=[<code class="replaceable">hook</code>])

def main():
    parser=argparse.ArgumentParser(description="Train resnet50 cifar10")

    # hyperparameter settings
    parser.add_argument(...)
    
    args = parser.parse_args()

    model=ResNet50(weights=None, input_shape=(32,32,3), classes=10)

    <b># Add the following line to register the Debugger hook for Keras.</b>
    hook=<code class="replaceable">smd.KerasHook.create_from_json_file()</code>

    # Start the training.
    train(args.batch_size, args.epoch, model, hook)

if __name__ == "__main__":
    main()
        </code></pre>
        <p>For more information about registering the Debugger hook for the supported frameworks
            and algorithm, see the following links in the SMDebug client library:</p>
        <div class="itemizedlist">
             
             
             
             
        <ul class="itemizedlist"><li class="listitem"><p><a href="https://github.com/awslabs/sagemaker-debugger/blob/master/docs/tensorflow.md" rel="noopener noreferrer" target="_blank"><span>SMDebug TensorFlow hook</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></p></li><li class="listitem"><p><a href="https://github.com/awslabs/sagemaker-debugger/blob/master/docs/pytorch.md" rel="noopener noreferrer" target="_blank"><span>SMDebug PyTorch hook</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></p></li><li class="listitem"><p><a href="https://github.com/awslabs/sagemaker-debugger/blob/master/docs/mxnet.md" rel="noopener noreferrer" target="_blank"><span>SMDebug MXNet hook</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></p></li><li class="listitem"><p><a href="https://github.com/awslabs/sagemaker-debugger/blob/master/docs/xgboost.md" rel="noopener noreferrer" target="_blank"><span>SMDebug XGBoost hook</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></p></li></ul></div>
        <p>In the following example notebooks' training scripts, you can find more examples about
            how to add the Debugger hooks to training scripts and collect output tensors in
            detail:</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem"><p><a href="https://sagemaker-examples.readthedocs.io/en/latest/sagemaker-debugger/tensorflow2/tensorflow2_keras_custom_container/tf2-keras-custom-container.html" rel="noopener noreferrer" target="_blank"><span> Debugger in script mode with the TensorFlow 2.1 framework</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></p>
                <p>To see the difference between using Debugger in a Deep Learning Container and in
                    script mode, open this notebook and put it and <a href="https://sagemaker-examples.readthedocs.io/en/latest/sagemaker-debugger/tensorflow2/tensorflow2_zero_code_change/tf2-keras-default-container.html" rel="noopener noreferrer" target="_blank"><span> the previous Debugger in a Deep Learning Container TensorFlow v2.1 notebook
                        example</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> side by side. </p>
                <p> In script mode, the hook configuration part is removed from the script in which
                    you set the estimator. Instead, the Debugger hook feature is merged into the training
                    script, <a href="https://github.com/awslabs/amazon-sagemaker-examples/blob/master/sagemaker-debugger/tensorflow2/tensorflow2_keras_custom_container/src/tf_keras_resnet_byoc.py" rel="noopener noreferrer" target="_blank"><span> TensorFlow Keras ResNet training script in script mode</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>. The training
                    script imports the <code class="code">smdebug</code> library in the required TensorFlow Keras
                    environment to communicate with the TensorFlow ResNet50 algorithm. It also manually
                    implements the <code class="code">smdebug</code> hook functionality by adding the
                    <code class="code">callbacks=[hook]</code> argument inside the <code class="code">train</code> function
                    (in line 49), and by adding the manual hook configuration (in line 89) provided
                    through SageMaker Python SDK.</p>
                <p>This script mode example runs the training job in the TF 2.1 framework for direct
                    comparison with the zero script change in the TF 2.1 example. The benefit of setting
                    up Debugger in script mode is the flexibility to choose framework versions not covered
                    by AWS Deep Learning Containers. </p>
            </li><li class="listitem"><p><a href="https://github.com/awslabs/amazon-sagemaker-examples/tree/master/sagemaker-debugger/pytorch_custom_container" rel="noopener noreferrer" target="_blank"><span> Using Amazon SageMaker Debugger in a PyTorch Container in Script Mode </span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></p>
                <p>This notebook enables Debugger in script mode in PyTorch v1.3.1 framework. PyTorch
                    v1.3.1 is supported by SageMaker containers, and this example shows details of how to
                    modify a training script. </p>
                <p>The SageMaker PyTorch estimator is already in script mode by default. In the notebook,
                    the line to activate <code class="code">script_mode</code> is not included in the estimator
                    configuration.</p>
                <p>This notebook shows detailed steps to change <a href="https://github.com/pytorch/examples/blob/master/mnist/main.py" rel="noopener noreferrer" target="_blank"><span>the
                        original PyTorch training script</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> to a modified version to enable
                    Debugger. Additionally, this example shows how you can use Debugger built-in rules
                    to detect training issues such as the vanishing gradients problem, and the
                    Debugger trial features to call and analyze the saved tensors. </p>
            </li></ul></div>
     
        <h2 id="debugger-bring-your-own-container-2">Create and Configure a
                Dockerfile</h2>
        <p>Open your SageMaker JupyterLab and create a new folder,
                <code>debugger_custom_container_test_folder</code> in this example, to save
            your training script and <code>Dockerfile</code>. The following code example is
            a <code class="code">Dockerfile</code> that includes essential docker build commends. Paste the
            following code into the <code>Dockerfile</code> text file and save it. Upload
            your training script to the same folder.</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="py "># Specify a docker base image
FROM tensorflow/tensorflow:2.2.0rc2-gpu-py3
RUN /usr/bin/python3 -m pip install --upgrade pip
RUN pip install --upgrade protobuf

# Install required packages to enable the SageMaker Python SDK and the smdebug library
RUN pip install sagemaker-training
RUN pip install smdebug
CMD ["bin/bash"]</code></pre>
        <p>If you want to use a pre-built AWS Deep Learning Container image, see <a href="https://aws.amazon.com/releasenotes/available-deep-learning-containers-images/" rel="noopener noreferrer" target="_blank"><span>Available AWS Deep Learning Containers Images</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p>
     
        <h2 id="debugger-bring-your-own-container-3">Build and Push the Custom Training
                Container to Amazon ECR</h2>
        <p>Create a test notebook,
                <code>debugger_custom_container_test_notebook.ipynb</code>, and run the
            following code in the notebook cell. This will access the
                <code class="code">debugger_byoc_test_docker</code> directory, build the docker with the
            specified <code class="code">algorithm_name</code>, and push the docker container to your
            Amazon ECR.</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="bash ">import boto3

account_id = boto3.client('sts').get_caller_identity().get('Account')
ecr_repository = 'sagemaker-debugger-mnist-byoc-tf2'
tag = ':latest'

region = boto3.session.Session().region_name

uri_suffix = 'amazonaws.com'
if region in ['cn-north-1', 'cn-northwest-1']:
    uri_suffix = 'amazonaws.com.cn'
byoc_image_uri = '<span>{</span>}.dkr.ecr.<span>{</span>}.<span>{</span>}/<span>{</span>}'.format(account_id, region, uri_suffix, ecr_repository + tag)

!docker build -t $ecr_repository docker
!$(aws ecr get-login --region $region --registry-ids $account_id --no-include-email)
!aws ecr create-repository --repository-name $ecr_repository
!docker tag <span>{</span>ecr_repository + tag} $byoc_image_uri
!docker push $byoc_image_uri</code></pre>
    <div class="awsdocs-note awsdocs-tip"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Tip</h6></div><div class="awsdocs-note-text"><p>If you use one of the AWS Deep Learning Container base images, run the following code to log
            in to Amazon ECR and access to the Deep Learning Container image repository.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="bash ">! aws ecr get-login-password --region <span>{</span>region} | docker login --username AWS --password-stdin 763104351884.dkr.ecr.us-east-1.amazonaws.com</code></pre></div></div>
        <h2 id="debugger-bring-your-own-container-4">Run and Debug Training Jobs Using
                the Custom Training Container</h2>
        <p>After you build and push your docker container to Amazon ECR, configure a SageMaker estimator
            with your training script and the Debugger-specific parameters. After you execute the
                <code class="code">estimator.fit()</code>, Debugger will collect output tensors, monitor them, and
            detect training issues. Using the saved tensors, you can further analyze the training
            job by using the <code class="code">smdebug</code> core features and tools. Configuring a workflow of
            Debugger rule monitoring process with Amazon CloudWatch Events and AWS Lambda, you can automate a stopping
            training job process whenever the Debugger rules spots training issues.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="py ">import sagemaker
from sagemaker.estimator import Estimator
from sagemaker.debugger import Rule, DebuggerHookConfig, CollectionConfig, rule_configs

<code class="userinput">profiler_config</code>=<code class="replaceable">ProfilerConfig(...)</code>
<code class="userinput">debugger_hook_config</code>=<code class="replaceable">DebuggerHookConfig(...)</code>
<code class="userinput">rules</code>=[
    <code class="replaceable">Rule.sagemaker(rule_configs.built_in_rule())</code>,
    <code class="replaceable">ProfilerRule.sagemaker(rule_configs.BuiltInRule())</code>
]

estimator=Estimator(
    image_uri=byoc_image_uri,
    entry_point="./debugger_custom_container_test_folder/your-training-script.py"
    role=sagemaker.get_execution_role(),
    base_job_name='debugger-custom-container-test',
    instance_count=1,
    instance_type='ml.p3.2xlarge',
    
    # Debugger-specific parameters
    profiler_config=<code class="userinput">profiler_config</code>,
    debugger_hook_config=<code class="userinput">debugger_hook_config</code>,
    rules=<code class="userinput">rules</code>
)

# start training
estimator.fit()</code></pre>
    <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="https://docs.aws.amazon.com/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./debugger-custom-rules.html">Create Custom Rules</div><div id="next" class="next-link" accesskey="n" href="./debugger-createtrainingjob-api.html">Configure Debugger Using SageMaker API</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=https://docs.aws.amazon.com/en_us/sagemaker/latest/dg/debugger-bring-your-own-container.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=SageMaker&amp;topic_url=https://docs.aws.amazon.com/en_us/sagemaker/latest/dg/debugger-bring-your-own-container.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>